define("template/auth", ["Handlebars"], function(a) {
    var t = function(t) {
        var i = a.template(t);
        return function(a) {
            return i(a, {
                partials: l
            })
        }
    }, l = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += "<h1>" + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.alt.kakaoStory", r) : o.call(t, "t", "auth.alt.kakaoStory", r))) + '</h1><div class="_loginPageBackgroundBox bg_box"></div><div class="login_content"><div data-part="box"></div></div><div data-part="loginFooter"></div>'
            });
            return a.wrap = '<div class="login_contatiner" data-kant-group="lgi">', a
        }(),
        popupLayout: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += '<div class="share_head"><h1><span class="ic"></span>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "writing.shareDialogTitle", r) : o.call(t, "t", "writing.shareDialogTitle", r))) + '</h1></div><div class="_loginBoxWrapper share_con"><div data-part="box"></div></div>'
            });
            return a
        }(),
        loginBox: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += '<div class="_loginViewTitleWrapper" style="display:none"><h1 class="login_tit"><span class="txt">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.loginTitle", r) : o.call(t, "t", "auth.loginBox.loginTitle", r))) + '</span></h1></div><div class="_loginPageTitleWrapper" style="display:none"><p class="marketing"><img class="_loginPageMessageImg login_message"></p></div><div class="_loginPopupTitleWrapper" style="display:none"><p class="desc">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.loginTitle", r) : o.call(t, "t", "auth.loginBox.loginTitle", r))) + '</p></div><form action="#" class="_loginBoxForm"><fieldset class="login_inp"><legend>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.loginArea", r) : o.call(t, "t", "auth.loginBox.loginArea", r))) + '</legend><ul class="login_lst"><li><span class="inp_box addbtn"><label class="_loginBoxEmailPlaceholder" for="u_id">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.emailPlaceholder", r) : o.call(t, "t", "auth.loginBox.emailPlaceholder", r))) + '</label><input class="_loginBoxEmailInput" name="email" type="email" id="u_id" tabindex="1" autocapitalize="off"> <button type="button" class="_loginBoxEmailTooltipBtn btn_help" tabindex="5" data-kant-id="3">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.emailTooltipBtn", r) : o.call(t, "t", "auth.loginBox.emailTooltipBtn", r))) + '</button><div class="_emailTooltipContainer"></div></span></li><li><span class="inp_box"><label class="_loginBoxPasswordPlaceholder" for="u_pass">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.passwordPlaceholder", r) : o.call(t, "t", "auth.loginBox.passwordPlaceholder", r))) + '</label><input class="_loginBoxPasswordInput" name="password" type="password" id="u_pass" tabindex="2"></span></li></ul><div class="state_box"><input name="remember_me" type="checkbox" id="u_ot" tabindex="3" value="true"><label for="u_ot">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.keepLoginCheckbox", r) : o.call(t, "t", "auth.loginBox.keepLoginCheckbox", r))) + '</label></div><p class="_loginBoxErrorText error_txt" style="display:none"></p><button type="submit" class="_loginBoxLoginBtn btn_login" tabindex="4" data-kant-id="4"><span>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.loginBtn", r) : o.call(t, "t", "auth.loginBox.loginBtn", r))) + '</span></button><div class="mem_info"><div class="mem_wrap"><a href="#" class="_createAccountToggleBtn btn_mem" data-kant-id="5">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.registerBtn", r) : o.call(t, "t", "auth.loginBox.registerBtn", r))) + '</a><div class="_createAccountLayerContainer"></div></div><ul class="find_lst"><li><a href="#" class="_findEmailBtn" data-kant-id="6">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.findEmailBtn", r) : o.call(t, "t", "auth.loginBox.findEmailBtn", r))) + '</a><span class="bar"></span></li><li><a href="#" class="_findPasswordBtn" data-kant-id="7">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.findPasswordBtn", r) : o.call(t, "t", "auth.loginBox.findPasswordBtn", r))) + '</a></li></ul></div></fieldset></form><button class="_loginBoxCloseBtn bn_x" data-kant-id="8">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.closeBtn", r) : o.call(t, "t", "auth.loginBox.closeBtn", r))) + "</button>"
            });
            return a.wrap = '<div class="_loginBox login_box" data-kant-group="lgi">', a
        }(),
        emailTooltipLayer: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += "<p>" + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.emailTooltipText", r) : o.call(t, "t", "auth.loginBox.emailTooltipText", r))) + '</p><div class="bn_box"><a href="#" class="_findEmailBtn" data-kant-id="9">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.findEmailBtn", r) : o.call(t, "t", "auth.loginBox.findEmailBtn", r))) + '</a></div><span class="arr" style="right: 15px"></span>'
            });
            return a.wrap = '<div class="ly_tooltip" style="display:none">', a
        }(),
        createAccountLayer: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += "<p>" + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.registerTooltipText", r) : o.call(t, "t", "auth.loginBox.registerTooltipText", r))) + '</p><div class="bn_box"><a href="#" class="_findEmailBtn" data-kant-id="10">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.findEmailBtn", r) : o.call(t, "t", "auth.loginBox.findEmailBtn", r))) + '</a><a href="#" class="_createAccountBtn" data-kant-id="11">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.loginBox.registerBtn", r) : o.call(t, "t", "auth.loginBox.registerBtn", r))) + '</a></div><span class="arr" style="left:15px"></span>'
            });
            return a.wrap = '<div class="ly_tooltip" style="display:none">', a
        }(),
        footer: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += '<div class="com_info"><ul class="info_lst"><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="12">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.footer.about", r) : o.call(t, "t", "auth.footer.about", r))) + '</a><span class="bar"></span></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="13">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.footer.terms", r) : o.call(t, "t", "auth.footer.terms", r))) + '</a><span class="bar"></span></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="14">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.footer.privacy", r) : o.call(t, "t", "auth.footer.privacy", r))) + '</a><span class="bar"></span></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="15">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.footer.oppolicy", r) : o.call(t, "t", "auth.footer.oppolicy", r))) + '</a><span class="bar"></span></li><li class="app_lst"><a class="_loginFooterAppsBtn" href="#" data-kant-id="16">Apps</a><div class="_appsLayerContainer"></div></li></ul><p>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.footer.copyright", r) : o.call(t, "t", "auth.footer.copyright", r))) + ' <a href="http://www.kakao.com/" target="_blank" data-kant-id="17">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "auth.footer.kakao", r) : o.call(t, "t", "auth.footer.kakao", r))) + "</a></p></div>"
            });
            return a.wrap = '<div class="info_wrap">', a
        }(),
        appsLayer: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += '<ul><li><a href="' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "store.appStore", r) : o.call(t, "t", "store.appStore", r))) + '" target="_blank" data-kant-id="18"><span class="ico_ios"></span>App Store</a></li><li><a href="' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "store.googlePlay", r) : o.call(t, "t", "store.googlePlay", r))) + '" target="_blank" data-kant-id="19"><span class="ico_and"></span>Google Play</a></li></ul><span class="arr"></span>'
            });
            return a.wrap = '<div class="_loginFooterAppsLayer ly_apps" style="display:none">', a
        }(),
        registerView: function() {
            var a = t(function(a, t, l, i, s) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {}, '<div data-part="register"></div>'
            });
            return a.wrap = '<div class="_layerContainer">', a
        }(),
        loginLayer: function() {
            var a = t(function(a, t, l, i, s) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {}, '<div class="login_wrap _layerContainer"><div data-part="view"></div></div>'
            });
            return a.wrap = "<div>", a
        }(),
        miniProfileForm: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += '<div class="share_con"><div class="name_box"><p class="desc">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "miniRegister.description", r) : o.call(t, "t", "miniRegister.description", r))) + '</p><fieldset class="inp_name"><legend>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "miniRegister.nameLegend", r) : o.call(t, "t", "miniRegister.nameLegend", r))) + '</legend><div class="ui_left"><strong class="tit">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.name", r) : o.call(t, "t", "register.name.name", r))) + "</strong> " + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.required", r) : o.call(t, "t", "register.name.required", r))) + '</div><div class="ui_right"><div class="_firstNameMarker inp" data-id="_firstNameMarker"><label class="first_nm _firstNamePlaceHolder" for="mainname">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.firstName", r) : o.call(t, "t", "register.name.firstName", r))) + '</label><input type="text" class="type_txt _text _firstName _checkModified" id="mainname"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div><div class="_lastNameMarker inp" data-id="_lastNameMarker"><label class="last_nm _lastNamePlaceholder" for="subname">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.lastName", r) : o.call(t, "t", "register.name.lastName", r))) + '</label><input type="text" class="type_txt _text _lastName _checkModified" id="subname"> <span class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</span> <div class="ly_tooltip _tooltip"></div></div></div></fieldset><p class="agree"><input type="checkbox" id="chk_agree" class="_privacyCheck" title="' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.privacyTitle", r) : o.call(t, "t", "register.alt.privacyTitle", r))) + '">  <a href="/s/privacy" class="_privacyLink" target="_blank" data-kant-id="487"><strong>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.privacy.link", r) : o.call(t, "t", "register.privacy.link", r))) + "</strong></a>" + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.privacy.info", r) : o.call(t, "t", "register.privacy.info", r))) + '</p></div></div><div class="share_footer"><div class="btn_group"><button class="btn_com btn_wh _cancel" data-kant-id="488"><span>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.cancel", r) : o.call(t, "t", "register.cancel", r))) + '</span></button> <button class="btn_com btn_or _submit" data-kant-id="489"><span>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.submit", r) : o.call(t, "t", "register.submit", r))) + "</span></button></div></div>"
            });
            return a
        }(),
        profileForm: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = l.helperMissing,
                    c = this.escapeExpression;
                return n += '<div class="pr"><h1>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.profileImage.makeProfile", r) : o.call(t, "t", "register.profileImage.makeProfile", r))) + '</h1><p class="desc">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.profileImage.description", r) : o.call(t, "t", "register.profileImage.description", r))) + '</p><div class="profile_wrap"><div class="profile_box"><div class="thmb_box"><img src="" alt="" class="_profileImage">  <a href="#" class="bn_pedit _profileImageEditBtn" data-kant-id="20">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.profileImageEdit", r) : o.call(t, "t", "register.alt.profileImageEdit", r))) + '</a><ul class="ly_story_layer _profileImageEditLayer" style="display: none"><li><div class="add"><a href="#" data-kant-id="21">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.profileImage.upload", r) : o.call(t, "t", "register.profileImage.upload", r))) + '</a><form action="#" method="post" enctype="multipart/form-data"><input name="file_1" class="bg_file_upload _uploadInputForm" type="file" title="' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.profileImage.profileImageUpload", r) : o.call(t, "t", "register.profileImage.profileImageUpload", r))) + '" accept="image/png,image/bmp,image/jpeg"></form></div></li><li><a href="#" class="_btnDelete" style="display: none" data-kant-id="22">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.profileImage.deleteImage", r) : o.call(t, "t", "register.profileImage.deleteImage", r))) + '</a></li></ul></div></div><form class="_profileForm"><div class="profile_modify"><ul class="my_profile"><li><div class="ui_left"><strong class="tit">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.name", r) : o.call(t, "t", "register.name.name", r))) + " <em>" + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.required", r) : o.call(t, "t", "register.name.required", r))) + '</em></strong></div><div class="ui_right"><div class="user_name"><div class="fl _firstNameMarker" data-id="_firstNameMarker"><label class="first_nm _firstNamePlaceHolder" for="mainname">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.firstName", r) : o.call(t, "t", "register.name.firstName", r))) + '</label><input type="text" class="type_txt _text _firstName _checkModified" id="mainname"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div><div class="fl _lastNameMarker" data-id="_lastNameMarker"><label class="last_nm _lastNamePlaceholder" for="subname">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.name.lastName", r) : o.call(t, "t", "register.name.lastName", r))) + '</label><input type="text" class="type_txt _text _lastName _checkModified" id="subname"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div></div></div></li><li class="user_birth"><div class="ui_left"><strong class="tit">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.birth.birthday", r) : o.call(t, "t", "register.birth.birthday", r))) + '</strong></div><div class="ui_right"><div class="inp_box _yearMarker" data-id="_yearMarker"><label for="y" class="_yearPlaceholder">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.birth.year", r) : o.call(t, "t", "register.birth.year", r))) + '</label><input type="text" class="type_txt _birthYear _birthNo" id="y" value="" maxlength="4"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div><div class="inp_box _monthMarker" data-id="_monthMarker"><label for="m" class="_monthPlaceholder">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.birth.month", r) : o.call(t, "t", "register.birth.month", r))) + '</label><input type="text" class="type_txt _birthMonth _birthNo" id="m" value="" maxlength="2"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div><div class="inp_box _dateMarker" data-id="_dateMarker"><label for="d" class="_datePlaceholder">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.birth.date", r) : o.call(t, "t", "register.birth.date", r))) + '</label><input type="text" class="type_txt _birthDate _birthNo" id="d" value="" maxlength="2"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div><span class="chk_bx"><input type="checkbox" class="type_chk _birthType" id="chk"></span>  <label for="chk">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.birth.lunarCal", r) : o.call(t, "t", "register.birth.lunarCal", r))) + '</label></div></li><li class="user_birth url"><div class="ui_left"><strong class="tit">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.storyId.storyId", r) : o.call(t, "t", "register.storyId.storyId", r))) + '</strong></div><div class="ui_right"><span class="txt">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.storyId.storyUrl", r) : o.call(t, "t", "register.storyId.storyUrl", r))) + '</span> <div class="inp_box _storyIdMarker" data-id="_storyIdMarker"><label for="storyurl" class="_storyIdPlaceholder">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.storyId.placeholder", r) : o.call(t, "t", "register.storyId.placeholder", r))) + '</label><input type="text" class="type_txt _storyId" id="storyurl" value=""> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.warning", r) : o.call(t, "t", "register.alt.warning", r))) + '</button> <div class="ly_tooltip _tooltip"></div></div></div></li></ul></div><div class="agree"><input type="checkbox" id="chk_agree" class="_privacyCheck" title="' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.alt.privacyTitle", r) : o.call(t, "t", "register.alt.privacyTitle", r))) + '">  <a href="/s/privacy" class="_privacyLink" target="_blank" data-kant-id="29"><strong>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.privacy.link", r) : o.call(t, "t", "register.privacy.link", r))) + "</strong></a>" + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.privacy.info", r) : o.call(t, "t", "register.privacy.info", r))) + '</div></form></div><div class="btn_group"><button class="btn_com btn_wh _cancel" data-kant-id="30"><span>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.cancel", r) : o.call(t, "t", "register.cancel", r))) + '</span></button> <button class="btn_com btn_or _submit" data-kant-id="31"><span>' + c((e = l.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, e ? e.call(t, "register.submit", r) : o.call(t, "t", "register.submit", r))) + '</span></button></div> <div class="loading _inProgress" style="display:none">' + c((e = l.img || t && t.img, r = {
                    hash: {
                        src: "/img/loding_wave.gif",
                        alt: "register.alt.inProgress"
                    },
                    data: s
                }, e ? e.call(t, r) : o.call(t, "img", r))) + "</div></div>"
            });
            return a.wrap = '<div class="bx_profile" data-kant-group="join">', a
        }(),
        tooltip: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n = "",
                    o = "function",
                    c = this.escapeExpression;
                return n += "<p>", (r = l.message) ? e = r.call(t, {
                    hash: {},
                    data: s
                }) : (r = t && t.message, e = typeof r === o ? r.call(t, {
                    hash: {},
                    data: s
                }) : r), n += c(e) + '</p><span class="arr"></span>'
            });
            return a
        }(),
        registerBox: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n, o = "",
                    c = l.helperMissing,
                    d = this.escapeExpression,
                    p = "function";
                return o += '<div class="_loginViewTitleWrapper" style="display:none"><h1 class="login_tit"><span class="ic_story"></span> <span class="txt">' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.loginBox.registerDescription", n) : c.call(t, "t", "auth.loginBox.registerDescription", n))) + '</span></h1></div><div class="_loginPageTitleWrapper" style="display:none"><p class="marketing"><img class="_loginPageMessageImg login_message"></p></div><form action="#" class="_loginBoxForm"><fieldset class="login_inp"><a href="#" class="_loginBoxLoginBtn btn_start" data-kant-id="34"><strong>' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.loginBox.registerStoryBtn", n) : c.call(t, "t", "auth.loginBox.registerStoryBtn", n))) + "</strong><p>", (r = l.email) ? e = r.call(t, {
                    hash: {},
                    data: s
                }) : (r = t && t.email, e = typeof r === p ? r.call(t, {
                    hash: {},
                    data: s
                }) : r), o += d(e) + '</p><span class="arrow_right"></span></a><div class="mem_info"><div class="mem_wrap ar"><a href="#" class="_otherAccountLoginBtn btn_mem" data-kant-id="35">' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.loginBox.tryOtherAccount", n) : c.call(t, "t", "auth.loginBox.tryOtherAccount", n))) + "</a></div></div></fieldset></form>"
            });
            return a.wrap = '<div class="login_box register">', a
        }(),
        confirmPasswordLayer: function() {
            var a = t(function(a, t, l, i, s) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), s = s || {};
                var e, r, n, o = "",
                    c = l.helperMissing,
                    d = this.escapeExpression,
                    p = "function";
                return o += '<div class="login_wrap _layerContainer"><div class="login_box v2"><h1 class="login_tit">' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.confirmPassword.description", n) : c.call(t, "t", "auth.confirmPassword.description", n))) + '</h1><strong class="txt_id _email">', (r = l.email) ? e = r.call(t, {
                    hash: {},
                    data: s
                }) : (r = t && t.email, e = typeof r === p ? r.call(t, {
                    hash: {},
                    data: s
                }) : r), o += d(e) + '</strong><form class="_confirmPasswordForm" action="#"><fieldset><legend>' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.alt.confirmPasswordArea", n) : c.call(t, "t", "auth.alt.confirmPasswordArea", n))) + '</legend><input class="_confirmPasswordCallbackUrl" type="hidden" name="callback_url"> <input class="_confirmPasswordClientId" type="hidden" name="client_id"><ul class="login_lst"><li><div class="inp_box"><label class="_confirmPasswordPlaceholder" for="u_pass">' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.confirmPassword.placeholder", n) : c.call(t, "t", "auth.confirmPassword.placeholder", n))) + '</label><input class="_confirmPasswordInput" name="password" type="password" id="u_pass"></div></li></ul><p class="_confirmPasswordErrorText error_txt" style="display: none"></p><button type="submit" class="_confirmPasswordBtn btn_login" data-kant-id="36"><span>' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.confirmPassword.submitBtn", n) : c.call(t, "t", "auth.confirmPassword.submitBtn", n))) + '</span></button></fieldset></form><button class="_confirmPasswordCloseBtn bn_x" data-kant-id="37">' + d((r = l.t || t && t.t, n = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "auth.loginBox.closeBtn", n) : c.call(t, "t", "auth.loginBox.closeBtn", n))) + "</button></div></div>"
            });
            return a.wrap = '<div data-kant-group="acct">', a
        }()
    }
});
define("common/jaso", [], function() {
    var r = ["ㄱ", "ㄲ", "ㄴ", "ㄷ", "ㄸ", "ㄹ", "ㅁ", "ㅂ", "ㅃ", "ㅅ", "ㅆ", "ㅇ", "ㅈ", "ㅉ", "ㅊ", "ㅋ", "ㅌ", "ㅍ", "ㅎ"],
        n = ["ㅏ", "ㅐ", "ㅑ", "ㅒ", "ㅓ", "ㅔ", "ㅕ", "ㅖ", "ㅗ", "ㅗㅏ", "ㅗㅐ", "ㅗㅣ", "ㅛ", "ㅜ", "ㅜㅓ", "ㅜㅔ", "ㅜㅣ", "ㅠ", "ㅡ", "ㅡㅣ", "ㅣ"],
        t = ["", "ㄱ", "ㄲ", "ㄱㅅ", "ㄴ", "ㄴㅈ", "ㄴㅎ", "ㄷ", "ㄹ", "ㄹㄱ", "ㄹㅁ", "ㄹㅂ", "ㄹㅅ", "ㄹㅌ", "ㄹㅍ", "ㄹㅎ", "ㅁ", "ㅂ", "ㅂㅅ", "ㅅ", "ㅆ", "ㅇ", "ㅈ", "ㅊ", "ㅋ", "ㅌ", "ㅍ", "ㅎ"],
        e = 12593,
        a = 12633,
        o = 44032,
        i = 55203,
        u = function(r) {
            var n = r.charCodeAt(0);
            return n >= e && a >= n
        }, f = function(r) {
            var n = r.charCodeAt(0);
            return n >= o && i >= n
        }, c = function(e) {
            var a = [];
            if (!e) return "";
            var i = e.charCodeAt(0),
                u = i - o,
                f = u % 28,
                c = (u - f) / 28 % 21,
                h = ((u - f) / 28 - c) / 21;
            return a.push(r[h], n[c], t[f]), a.join("")
        }, h = function(r) {
            return c(r).charAt(0)
        };
    return {
        split: function(r) {
            for (var n, t = [], e = 0; e < r.length; e++) n = r.charAt(e), t.push(f(n) ? c(n) : n);
            return t.join("")
        },
        isMatch: function(r, n) {
            r = r.replace(/\s/g, "").toLowerCase(), n = n.replace(/\s/g, "").toLowerCase();
            var t, e, a, o, i = r.length,
                s = n.length,
                A = s - i,
                l = 0,
                v = 0;
            if (0 === i) return !0;
            if (0 > A) return !1;
            for (; A >= l; l++) {
                for (v = 0; i > v;) if (t = r.charAt(v), e = n.charAt(l + v), a = n.charAt(l + v + 1), u(t) && f(e)) {
                    if (t !== h(e)) break;
                    v++
                } else {
                    if (f(t) && f(e) && v === i - 1) return o = c(e) + c(a), 0 === o.indexOf(c(t));
                    if (t !== e) break;
                    v++
                }
                if (v === i) return !0
            }
            return !1
        }
    }
});
define("common/urlKey", [], function() {
    var n = ".",
        i = "@",
        r = "ch/";
    return {
        profile: {
            idToUrlKey: function(n) {
                return _.isString(n) && 0 === n.indexOf(i) ? r + n.substring(1) : n
            },
            urlKeyToId: function(n) {
                return _.isString(n) && 0 === n.indexOf(r) ? i + n.substring(r.length) : n
            }
        },
        activity: {
            idToUrlKey: function(i) {
                return _.isString(i) && i.indexOf(n) > -1 ? _.last(i.split(n)) : i
            },
            urlKeyToId: function(i, r) {
                return i ? i + n + r : ""
            }
        }
    }
});
define("model/Friend", ["common/api"], function(e) {
    return {
        url: "/friends/",
        deleteFriend: function(r) {
            var n = this;
            return e.request({
                url: this.url + r,
                type: "DELETE"
            }).then(function() {
                n._findFriendInMemory(r).spread(function(e, r) {
                    e.remove(r)
                })
            })
        },
        _findFriendInMemory: function(e) {
            var r = Q.defer();
            return require(["model/me"], function(n) {
                var t = n.get("friends"),
                    i = t.findWhere({
                        id: e
                    });
                i ? r.resolve([t, i]) : r.reject()
            }), r.promise
        },
        makeFavorite: function(r) {
            var n = this;
            return e.request({
                url: this.url + r + "/favorite",
                type: "POST"
            }).then(function() {
                n._updateFavoriteFriendInMemory(r, !0)
            })
        },
        makeUnfavorite: function(r) {
            var n = this;
            return e.request({
                url: this.url + r + "/favorite",
                type: "DELETE"
            }).then(function() {
                n._updateFavoriteFriendInMemory(r, !1)
            })
        },
        _updateFavoriteFriendInMemory: function(e, r) {
            this._findFriendInMemory(e).spread(function(e, n) {
                n.get("is_favorite") !== r && n.set("is_favorite", r)
            })
        }
    }
});
define("model/Invitation", ["common/api", "common/urlKey"], function(e, t) {
    var i = space.Model.extend({
        defaults: {
            id: null,
            type: null,
            user_id: null,
            display_name: null,
            has_profile: null,
            profile_thumbnamil_url: null,
            profile_image_url: null
        },
        virtuals: {
            isSent: function() {
                return this.get("type") === i.TYPE.SENT
            },
            isReceived: function() {
                return this.get("type") === i.TYPE.RECEIVED
            },
            urlKey: function() {
                return t.profile.idToUrlKey(this.get("user_id"))
            }
        },
        accept: function() {
            var e = this,
                t = this.get("user_id"),
                n = this.get("has_profile");
            return i.accept(t, n).then(function() {
                e.trigger("destroy", e)
            })
        },
        ignore: function() {
            var e = this,
                t = this.get("user_id");
            return i.ignore(t).then(function() {
                e.trigger("destroy", e)
            })
        },
        cancel: function() {
            var e = this,
                t = this.get("user_id"),
                n = this.get("has_profile");
            return i.cancel(t, n).then(function() {
                e.trigger("destroy", e)
            })
        }
    });
    return _.extend(i, {
        TYPE: {
            SENT: "sent",
            RECEIVED: "received"
        },
        url: {
            invite: "/invitations",
            accept: "/invitations/accept",
            ignore: "/invitations/ignore",
            cancel: "/invitations/cancel"
        },
        invite: function(t, n) {
            return e.request({
                url: i.url.invite,
                type: "POST",
                data: {
                    friend_id: t,
                    has_profile: n
                }
            }).then(function(e) {
                require(["model/me"], function(t) {
                    t.get("invitations").add(e)
                })
            })
        },
        accept: function(t, i) {
            return e.request({
                url: this.url.accept,
                type: "POST",
                data: {
                    inviter_id: t,
                    has_profile: i
                }
            }).then(function() {
                require(["model/Profiles", "model/me"], function(e, i) {
                    i.get("invitations").removeByUserId(t);
                    var n = new e({
                        id: t
                    });
                    n.fetch().then(function() {
                        var e = i.get("friends");
                        e.addNewFriend(n.get("profile"))
                    })
                })
            })
        },
        ignore: function(t) {
            return e.request({
                url: this.url.ignore,
                type: "POST",
                data: {
                    inviter_id: t
                }
            }).then(function() {
                require(["model/me"], function(e) {
                    e.get("invitations").removeByUserId(t)
                })
            })
        },
        cancel: function(t, i) {
            return e.request({
                url: this.url.cancel,
                type: "POST",
                data: {
                    user_id: t,
                    has_profile: i
                }
            }).then(function() {
                require(["model/me"], function(e) {
                    e.get("invitations").removeByUserId(t)
                })
            })
        }
    }), i
});
define("model/Friendship", ["common/api"], function(e) {
    var n = space.Model.extend({});
    return _.extend(n, {
        url: {
            follow: "/friendship/follow",
            unfollow: "/friendship/unfollow"
        },
        follow: function(n) {
            return e.request({
                url: this.url.follow,
                type: "POST",
                data: {
                    profile_id: n
                }
            }).then(function() {
                require(["model/Profiles", "model/me"], function(e, o) {
                    var r = new e({
                        id: n
                    });
                    r.fetch().then(function() {
                        var e = o.get("friends");
                        e.addNewFriend(r.get("profile"))
                    })
                })
            })
        },
        unfollow: function(n) {
            return e.request({
                url: this.url.unfollow,
                type: "POST",
                data: {
                    profile_id: n
                }
            }).then(function() {
                require(["model/me"], function(e) {
                    var o = e.get("friends"),
                        r = o.findWhere({
                            id: n
                        });
                    r && o.remove(r)
                })
            })
        }
    }), n
});
define("model/Profile", ["common/api", "common/jaso", "common/util", "common/urlKey", "model/Friend", "model/Invitation", "model/Friendship"], function(t, i, e, r, n, s, o) {
    var u = /public\/images\/wallpapers/i,
        a = {
            MUSIC: "music",
            TEXT: "text"
        }, h = "noti",
        l = space.Model.extend({
            urlRoot: "/profiles/",
            defaults: {
                id: null,
                display_name: "",
                profile_thumbnail_url: "",
                profile_image_url: "",
                activity_count: 0,
                friend_count: 0,
                follower_count: 0,
                relationship: "",
                bg_image_url: "",
                birthday: "",
                birth_type: "",
                is_birthday: !1,
                default_bg_id: "",
                status_message: "",
                status_objects: null,
                type: "",
                sharable: !0,
                comment_all_writable: !0,
                is_favorite: !1
            },
            TYPE: {
                OFFICIAL: "official"
            },
            RELATIONSHIP: {
                SELF: "S",
                FRIEND: "F",
                FRIEND_STORY_PLUS: "FE",
                FRIEND_REQUEST_SENT: "R",
                FRIEND_REQUEST_RECEIVED: "C",
                NONE: "N",
                NOT_SUPPORT_STORY_PLUS: "NA"
            },
            virtuals: {
                isStoryPlus: function() {
                    return this.get("type") === this.TYPE.OFFICIAL
                },
                statusMessage: function() {
                    var t = _.first(this.get("status_objects")),
                        i = "",
                        e = "";
                    if (t) switch (i = t.object_type) {
                        case a.MUSIC:
                            e = t.title;
                            break;
                        case a.TEXT:
                            e = t.message
                    }
                    return e
                },
                isMusicStatus: function() {
                    var t = _.first(this.get("status_objects"));
                    return t && t.object_type === a.MUSIC
                },
                birthdayText: function() {
                    var t = this.get("birthday"),
                        i = "-" === this.get("birth_type") ? intl.t("profile.birthdayLunar") : "";
                    return t ? intl.t("profile.birthday", {
                        month: parseInt(t.substr(0, 2), 10),
                        day: parseInt(t.substr(2, 2), 10)
                    }) + i : ""
                },
                canAddFriend: function() {
                    return this.get("relationship") === this.RELATIONSHIP.NONE
                },
                isRequestSent: function() {
                    return this.get("relationship") === this.RELATIONSHIP.FRIEND_REQUEST_SENT
                },
                isRequestReceived: function() {
                    return this.get("relationship") === this.RELATIONSHIP.FRIEND_REQUEST_RECEIVED
                },
                isFriend: function() {
                    return this.get("type") === this.TYPE.OFFICIAL ? this.get("relationship") === this.RELATIONSHIP.FRIEND_STORY_PLUS : this.get("relationship") === this.RELATIONSHIP.FRIEND
                },
                isMe: function() {
                    return this.get("relationship") === this.RELATIONSHIP.SELF
                },
                storyPlusDescription: function() {
                    return this.get("type") !== this.TYPE.OFFICIAL ? "" : intl.t("friend.paragraph.followerMessage", {
                        count: e.numberFormat(this.get("follower_count"))
                    })
                },
                urlKey: function() {
                    return r.profile.idToUrlKey(this.get("id"))
                }
            },
            isMatch: function(t) {
                return i.isMatch(t, this.get("display_name"))
            },
            deleteFriend: function() {
                var t = this;
                if (this.get("isStoryPlus")) throw new Error("스토리 플러스 계정은 친구 삭제를 할 수 없습니다.");
                return n.deleteFriend(this.get("id")).then(function() {
                    t.set("relationship", t.RELATIONSHIP.NONE), t.trigger("destroy", t)
                })
            },
            makeFavorite: function() {
                var t = this;
                return n.makeFavorite(this.get("id")).then(function() {
                    t.set("is_favorite", !0)
                })
            },
            makeUnfavorite: function() {
                var t = this;
                return n.makeUnfavorite(this.get("id")).then(function() {
                    t.set("is_favorite", !1)
                })
            },
            invite: function() {
                var t = this;
                if (this.get("isStoryPlus")) throw new Error("스토리 플러스 계정에는 친구 요청을 보낼 수 없습니다.");
                return s.invite(this.get("id"), !0).then(function() {
                    t.set("relationship", t.RELATIONSHIP.FRIEND_REQUEST_SENT)
                })
            },
            accept: function() {
                var t = this;
                if (this.get("isStoryPlus")) throw new Error("스토리 플러스 계정은 친구 요청 취소를 할 수 없습니다.");
                return s.accept(this.get("id"), !0).then(function() {
                    t.set("relationship", t.RELATIONSHIP.FRIEND)
                })
            },
            cancel: function() {
                var t = this;
                if (this.get("isStoryPlus")) throw new Error("스토리 플러스 계정은 친구 요청 취소를 할 수 없습니다.");
                return s.cancel(this.get("id"), !0).then(function() {
                    t.set("relationship", t.RELATIONSHIP.NONE)
                })
            },
            follow: function() {
                var t = this;
                if (!this.get("isStoryPlus")) throw new Error("스토리 플러스 계정에만 follow 할 수 있습니다.");
                return o.follow(this.get("id")).then(function() {
                    t.set("relationship", t.RELATIONSHIP.FRIEND_STORY_PLUS)
                })
            },
            unfollow: function() {
                var t = this;
                if (!this.get("isStoryPlus")) throw new Error("스토리 플러스 계정에만 follow 할 수 있습니다.");
                return o.unfollow(this.get("id")).then(function() {
                    t.set("relationship", t.RELATIONSHIP.NONE), t.trigger("destroy", t)
                })
            },
            isDefaultBgImage: function() {
                return u.test(this.get("bg_image_url"))
            },
            fetch: function(i) {
                var e = this,
                    r = {
                        profile_only: !0
                    };
                return i && (r.from = h), t.request({
                    url: _.result(this, "url"),
                    type: "GET",
                    data: r
                }).then(function(t) {
                    e.set(t)
                })
            }
        });
    return l.TYPE = l.prototype.TYPE, l.RELATIONSHIP = l.prototype.RELATIONSHIP, l
});
define("model/Friends", ["model/Profile", "common/util", "common/api"], function(e, t, i) {
    var n = 5;
    return space.Collection.extend({
        PERIODIC_FETCH_INTERVAL: 18e4,
        url: "/friends",
        model: e,
        comparator: "display_name",
        initialize: function() {
            var e = this;
            this._fetchTimer = null, this._newFriendIds = [], this._isFetched = !1, this._me = null, require(["model/me"], function(t) {
                e._me = t, e.listenTo(t, "logout", function() {
                    e.reset(), e.clearNewFriend(), e._clearTimer()
                })
            })
        },
        _filters: {
            people: function(e) {
                return !e.get("isStoryPlus")
            },
            storyPlus: function(e) {
                return e.get("isStoryPlus")
            }
        },
        _getPartialNameFilter: function(e) {
            return function(t) {
                return t.isMatch(e)
            }
        },
        _filterFriends: function() {
            var e = arguments,
                t = function(t) {
                    return _.every(e, function(e) {
                        return e(t)
                    })
                };
            return this.filter(t)
        },
        getStoryPlusInFriends: function(e) {
            return this._filterFriends(this._filters.storyPlus, this._getPartialNameFilter(e))
        },
        getPeopleInFriends: function(e) {
            return this._filterFriends(this._filters.people, this._getPartialNameFilter(e))
        },
        _checkDuplicateId: function(e, t) {
            return _.find(e, function(e) {
                return e.get("id") === t
            })
        },
        getFriendsForMentioning: function(e, t) {
            var i, r = this.getPeopleInFriends(e),
                s = [];
            t = _.defaults(t || {}, {
                maxCount: n,
                rejectList: [],
                prependList: []
            }), r = t.prependList.concat(r);
            for (var u = 0; u < r.length && (i = r[u], _.contains(t.rejectList, i.get("id")) || this._checkDuplicateId(s, i.get("id")) || (s.push(i), !(s.length >= t.maxCount))); u++);
            return s
        },
        getFriendById: function(e) {
            return this.find(function(t) {
                return t.id === e
            })
        },
        fetch: function() {
            var e = this;
            return this._fetchTimer && this._clearTimer(), this._fetchTimer = setTimeout(function() {
                e.fetch().fail(function(t) {
                    e.trigger("periodicFetchError", t)
                })
            }, this.PERIODIC_FETCH_INTERVAL), i.request({
                url: this.url,
                type: "GET"
            }).then(function(t) {
                e._isFetched = !0, e.set(t), e.trigger("fetched")
            }).fail(function(t) {
                return t && 401 === t.status && (e._clearTimer(), e._me && e._me.setLoggedIn(!1)), Q.reject(t)
            })
        },
        _clearTimer: function() {
            this._fetchTimer && (clearTimeout(this._fetchTimer), this._fetchTimer = null)
        },
        addNewFriend: function(e) {
            this._newFriendIds.push(e.get("id")), this.add(e, {
                merge: !0
            })
        },
        isNewFriend: function(e) {
            return _.contains(this._newFriendIds, e.get("id"))
        },
        clearNewFriend: function() {
            this._newFriendIds.length = 0
        },
        isFetched: function() {
            return this._isFetched
        }
    })
});
define("model/Invitations", ["common/api", "model/Invitation"], function(e, i) {
    return space.Collection.extend({
        url: "/invitations",
        model: i,
        getRecentReceivedInvitationId: function() {
            var e = "";
            return this.each(function(i) {
                i.get("isReceived") && i.get("id") > e && (e = i.get("id"))
            }), e
        },
        removeByUserId: function(e) {
            var i = this.findWhere({
                user_id: e
            });
            i && this.remove(i)
        }
    })
});
define("model/Notification", ["model/Profile", "common/urlUtil", "common/urlKey", "config"], function(t, e, i, n) {
    var r = space.Model.extend({
        collection: null,
        defaults: {
            id: 0,
            actor: t,
            message: null,
            created_at: null,
            is_new: !1,
            key: null,
            content: null,
            scheme: null,
            thumbnail_url: null,
            thumbnail_text: null
        },
        virtuals: {
            activityId: function() {
                return this._activityId
            },
            activityUrlKey: function() {
                return i.activity.idToUrlKey(this._activityId)
            },
            profileId: function() {
                return i.profile.idToUrlKey(this._profileId)
            },
            notificationType: function() {
                return this._schemeType
            },
            targetProfileId: function() {
                return this._profileId
            },
            hasThumbnail: function() {
                var t = this.get("thumbnail_url") || "";
                return t.length > 0 ? !0 : !1
            },
            hasEmoticon: function() {
                return this.get("emotion") ? !0 : !1
            },
            hasContent: function() {
                return this.get("content") ? !0 : !1
            },
            storyPlusUrl: function() {
                return n.serviceUrl.storyPlus
            }
        },
        TYPE: {
            ACTIVITIES: "activities",
            PROFILES: "profiles",
            FRIENDSHIP: "friendship",
            NOTIFICATIONS: "notifications",
            UPGRADE: "upgrade",
            STORYPLUS: "storychannel"
        },
        SCHEME: {
            STORY_PROTOCOL: "kakaostory://",
            STORYPLUS_PROTOCOL: "storychannel://"
        },
        initailize: function() {
            this._schemeType = null, this._activityId = null, this._profileId = null
        },
        parse: function(t) {
            var e = this._parseScheme(t.scheme);
            return e && (this._schemeType = e.type, this._activityId = e.activityId, this._profileId = e.profileId), t
        },
        _parseStoryPlusScheme: function() {
            return {
                type: this.TYPE.STORYPLUS
            }
        },
        _parseScheme: function(t) {
            return t ? 0 === t.indexOf(this.SCHEME.STORY_PROTOCOL) ? this._parseStoryScheme(t) : 0 === t.indexOf(this.SCHEME.STORYPLUS_PROTOCOL) ? this._parseStoryPlusScheme(t) : null : null
        },
        _parseStoryScheme: function(t) {
            var i = null,
                n = null,
                l = null;
            switch (i = t.substring(this.SCHEME.STORY_PROTOCOL.length), n = i.split("/"), n[0]) {
                case r.TYPE.ACTIVITIES:
                    l = {
                        type: n[0],
                        activityId: e.getLastPathFromUrl(t),
                        profileId: e.getQueryValueFromUrl(t, "profile_id")
                    };
                    break;
                case r.TYPE.PROFILES:
                    l = {
                        type: n[0],
                        profileId: n[1]
                    };
                    break;
                case r.TYPE.FRIENDSHIP:
                case r.TYPE.NOTIFICATIONS:
                case r.TYPE.UPGRADE:
                    l = {
                        type: n[0]
                    }
            }
            return l
        },
        makeOld: function() {
            this.set("is_new", !1)
        }
    });
    return r.TYPE = r.prototype.TYPE, r
});
define("model/Notifications", ["model/Notification", "common/api"], function(t, i) {
    return space.Collection.extend({
        url: "/notifications",
        model: t,
        initialize: function() {
            this._isFirstFetch = !0, this._idx = 0, this._readingMark = null
        },
        fetch: function() {
            var t = this;
            return this._idx = 0, i.request({
                url: _.result(this, "url"),
                type: "GET"
            }).then(function(i) {
                var e = t.parse(i);
                if (0 === t.length || t._isFirstFetch) t.set(e, {
                    merge: !1
                }), t._isFirstFetch = !1;
                else for (var n = e.length - 1; n >= 0; n--) {
                    var r = e[n].get("id"),
                        a = t.get(r);
                    a || t.add(e[n], {
                        at: 0
                    })
                }
            })
        },
        parse: function(i) {
            for (var e = [], n = 0, r = i.length; r > n; n++) e.push(new t(i[n], {
                parse: !0
            }));
            return e
        },
        setReadingMark: function(t) {
            var i = !1;
            this.each(function(e) {
                !e.get("is_new") || e.get("activityId") !== t && e.get("profileId") !== t || (i = !0)
            }), this._readingMark = i ? t : null
        },
        getReadingMark: function() {
            return this._readingMark
        },
        clearReadingMark: function(t) {
            t && this.each(function(i) {
                !i.get("is_new") || i.get("activityId") !== t && i.get("profileId") !== t || i.set({
                    is_new: !1
                })
            }), this._readingMark = null
        }
    })
});
define("model/NewCount", ["common/api"], function(e) {
    return space.Model.extend({
        PERIODIC_FETCH_INTERVAL: 6e4,
        url: "/notifications/new_count",
        defaults: {
            notice_count: 0,
            received_count: 0,
            has_new_notification: 0
        },
        initialize: function() {
            var e = this;
            this._fetchTimer = null, this._me = null, require(["model/me"], function(t) {
                e._me = t, e.listenTo(t, "logout", e._clearTimer)
            })
        },
        readReceivedInvitation: function(e) {
            return this.fetch({
                invitation_since: e
            })
        },
        fetch: function(t) {
            var i, n, r = this;
            return t = t || {}, this._me && (i = this._me.get("property"), n = i.get(i.TYPE.LAST_NOTICE_ID), t.notice_since = n), this._clearTimer(), this._fetchTimer = setTimeout(function() {
                r.fetch(t).fail(function(e) {
                    r.trigger("periodicFetchError", e)
                })
            }, this.PERIODIC_FETCH_INTERVAL), e.request({
                url: this.url,
                type: "GET",
                data: t
            }).then(function(e) {
                r.set(e)
            }).fail(function(e) {
                return e && 401 === e.status && (r._clearTimer(), r._me && r._me.setLoggedIn(!1)), Q.reject(e)
            })
        },
        _clearTimer: function() {
            this._fetchTimer && clearTimeout(this._fetchTimer)
        }
    })
});
define("model/Property", ["common/api"], function(t) {
    var e = "/",
        n = ",",
        r = ",",
        o = {
            TUTORIAL_INFO: "tut_info",
            PERMISSION: "act_perm",
            LAST_CAMPAIGN_ID_LIST: "last_cid",
            LAST_NOTICE_ID: "last_nid"
        }, i = space.Model.extend({
            TYPE: o,
            url: "/settings/property",
            defaults: {
                tut_info: null,
                act_perm: null,
                onoff: null,
                last_campaign_id_list: [],
                last_notice_id: null
            },
            initialize: function() {
                this._isFetched = !1
            },
            fetch: function() {
                var e = this;
                return t.request({
                    url: _.result(this, "url"),
                    type: "GET",
                    data: {
                        type: [o.TUTORIAL_INFO, o.PERMISSION, o.LAST_CAMPAIGN_ID_LIST, o.LAST_NOTICE_ID]
                    }
                }).then(function(t) {
                    return t = e.parse(t), e.set(t), e._isFetched = !0, e.trigger("fetched"), t
                })
            },
            parse: function(t) {
                var e;
                return t.onoff && (e = t.onoff.split(n), t.onoff = {}, _.each(e, function(e) {
                    t.onoff[e] = !0
                })), t[o.LAST_CAMPAIGN_ID_LIST] = t[o.LAST_CAMPAIGN_ID_LIST] ? _.map(t[o.LAST_CAMPAIGN_ID_LIST].split(r), function(t) {
                    return t.replace(/\s/g, "")
                }) : [], t
            },
            updateProperty: function(e, n) {
                var i = this;
                return e === o.LAST_CAMPAIGN_ID_LIST && _.isArray(n) && (n = n.join(r)), t.request({
                    url: _.result(this, "url"),
                    type: "PUT",
                    data: {
                        type: e,
                        value: n
                    }
                }).then(function(t) {
                    return "onoff" !== e && i.set(e, n), t
                })
            },
            updateOnOff: function(t, n) {
                var r = this,
                    o = t + e + (n ? "on" : "off");
                return this.updateProperty("onoff", o).then(function(e) {
                    var o = _.clone(r.get("onoff")) || {};
                    return n ? o[t] = !0 : o[t] && delete o[t], r.set("onoff", o), e
                })
            },
            isOn: function(t) {
                var e = this.get("onoff");
                return e && e[t] ? !0 : !1
            },
            get: function(t) {
                var e = space.Model.prototype.get.apply(this, arguments);
                return t === o.PERMISSION && "FX" === e ? "F" : e
            },
            isFetched: function() {
                return this._isFetched
            }
        });
    return i.TYPE = o, i
});
define("model/Account", ["common/api", "moment"], function(t, e) {
    var r = 20,
        s = 10,
        u = -1,
        n = {
            MUSIC: "music",
            TEXT: "text",
            NO_SETTING: "nosetting"
        }, i = space.Model.extend({
            url: "/settings/profile",
            defaults: {
                id: null,
                display_name: "",
                profile_thumbnail_url: "",
                profile_image_url: "",
                activity_count: 0,
                friend_count: 0,
                bg_image_url: "",
                birth: "",
                birth_type: "",
                default_bg_id: "",
                first_name: "",
                last_name: "",
                email: "",
                status_objects: null,
                profile_uri: "",
                uri_searchable: !1
            },
            STATUS: {
                NAME: {
                    ALREADY_ACCEPTED_CHANGE_NAME: -208,
                    CHANGE_NOT_AVAILABLE: -11001,
                    NOT_CHANGED_BY_USER: -11003,
                    PROFILE_FORBIDDEN_NAME_DETAIL: -31008,
                    PROFILE_FORBIDDEN_NAME: -31012,
                    PROFILE_NAME_REQUIRED: -31009,
                    PROFILE_WARNING_ACCEPTED_CHANGE_NAME: -31018
                },
                STORYID: {
                    FORBIDDEN_URI: -200,
                    NOT_FOUND_URI: -201,
                    URI_ALREADY_EXISTS: -202,
                    DUPLICATED_URI: -203,
                    INVALID_URI: -204,
                    INVALID_SERVER_RESPONSE: -12001,
                    NOT_TO_CHANGE: -12002
                },
                BIRTH: {
                    INVALID_FORMAT: -31004
                },
                ETC: {
                    INTERNAL_ERROR: -10003
                }
            },
            virtuals: {
                isSearchable: function() {
                    return this.get("uri_searchable")
                },
                birthday: function() {
                    var t = this.get("birth"),
                        r = null,
                        s = "",
                        u = "",
                        n = "";
                    return t && 8 === t.length && (r = e(t, "YYYYMMDD"), s = r.year(), u = r.month() + 1, n = r.date()), {
                        year: s,
                        month: u,
                        date: n
                    }
                },
                isLunar: function() {
                    return "-" === this.get("birth_type")
                },
                isTextStatus: function() {
                    var t = this._statusMatchedWith(n.TEXT),
                        e = 0;
                    return t ? (e = this.get("statusTextMsg").length, e > 0 ? !0 : !1) : !1
                },
                isMusicStatus: function() {
                    return this._statusMatchedWith(n.MUSIC)
                },
                isNoStatus: function() {
                    return !(this.get("isTextStatus") || this.get("isMusicStatus"))
                },
                statusMessage: function() {
                    var t = _.first(this.get("status_objects")),
                        e = "";
                    if (t) switch (t.object_type) {
                        case n.MUSIC:
                            e = t.title;
                            break;
                        case n.TEXT:
                            e = t.message
                    }
                    return e
                },
                statusTextMsg: function() {
                    var t = _.first(this.get("status_objects")),
                        e = "";
                    return t && t.message && (e = t.message), e
                },
                statusType: function() {
                    return this.get("isTextStatus") ? n.TEXT : this.get("isMusicStatus") ? n.MUSIC : n.NO_SETTING
                },
                trackId: function() {
                    var t = _.first(this.get("status_objects"));
                    return t && t.track_id ? t.track_id : u
                }
            },
            _statusMatchedWith: function(t) {
                var e = this._getCurrentStatus();
                return e ? e === t : !1
            },
            _getCurrentStatus: function() {
                var t = _.first(this.get("status_objects"));
                return t ? t.object_type : null
            },
            fetch: function() {
                var e = this;
                return t.request({
                    url: this.url,
                    type: "GET"
                }).then(function(t) {
                    return e.set(t), t
                })
            },
            updateName: function(e, r) {
                var s = this;
                return t.request({
                    url: this.url + "/name",
                    type: "POST",
                    data: {
                        first_name: e,
                        last_name: r
                    }
                }).then(function(t) {
                    return s.set(t), t
                })
            },
            checkName: function(e, r) {
                return this.get("last_name") === r && this.get("first_name") === e ? Q.resolve(null) : t.request({
                    url: this.url + "/name/check",
                    type: "POST",
                    data: {
                        first_name: e,
                        last_name: r
                    }
                }).then(function(t) {
                    return 0 === t.status || 1 === t.status ? t : Q.reject(i.NAME.CHANGE_NOT_AVAILABLE)
                })
            },
            updateStoryId: function(e, r) {
                var s = this;
                return r = !! r, t.request({
                    url: this.url + "/story_id",
                    type: "POST",
                    data: {
                        story_id: e
                    }
                }).then(function(t) {
                    return r || s.set(t), t
                })
            },
            checkStoryId: function(e) {
                return t.request({
                    url: this.url + "/story_id/check",
                    type: "GET",
                    data: {
                        story_id: e
                    }
                }).then(function(t) {
                    return 0 !== t.status ? Q.reject({
                        responseJSON: t
                    }) : t
                })
            },
            updateSearchable: function(e) {
                var r = this;
                return t.request({
                    url: this.url + "/story_id",
                    type: "PUT",
                    data: {
                        searchable: e.toString()
                    }
                }).then(function(t) {
                    return r.set(t), t
                })
            },
            updateBirth: function(e, r) {
                var s = this,
                    u = r ? "-" : "+";
                return this.get("birth") === e && this.get("birth_type") === u ? Q.resolve(null) : t.request({
                    url: this.url + "/birthday",
                    type: "PUT",
                    data: {
                        birth: e,
                        birth_type: u
                    }
                }).then(function(t) {
                    return s.set(t), t.birth || s.set("birth", ""), t
                })
            },
            updateStatusMessage: function(e) {
                var r = this;
                return t.request({
                    url: "/settings/profile/status_message",
                    type: "PUT",
                    data: {
                        status_message: e
                    }
                }).then(function(t) {
                    return r.set(t), t
                })
            },
            updateMusicStatusMessage: function(e) {
                var r = this;
                return t.request({
                    url: "/settings/profile/status_music",
                    type: "PUT",
                    data: {
                        track_id: e
                    }
                }).then(function(t) {
                    return r.set(t), t
                })
            },
            getRetireMsg: function() {
                return t.request({
                    url: "/profiles/retire_message",
                    type: "GET"
                })
            },
            withdraw: function(e) {
                return t.request({
                    url: "/profiles/me",
                    type: "DELETE",
                    data: {
                        confirm_token: e
                    }
                })
            },
            signIn: function(e) {
                var r = _.defaults({
                    terms_agreement: !0
                }, e);
                return t.request({
                    url: "/profiles",
                    type: "POST",
                    data: r
                })
            }
        });
    return i.requestEmail = function() {
        return t.request({
            url: "/settings/account/email",
            type: "GET"
        }).then(function(t) {
            return t.email
        })
    }, i.NAME = i.prototype.STATUS.NAME, i.STORYID = i.prototype.STATUS.STORYID, i.BIRTH = i.prototype.STATUS.BIRTH, i.ETC = i.prototype.STATUS.ETC, i.MAX_NAME_LENGTH = r, i.KOREAN_MAX_NAME_LENGTH = s, i.STATUS_OBJECT_TYPE = n, i
});
define("model/me", ["model/Profile", "model/Friends", "model/Invitations", "model/Notifications", "model/NewCount", "model/Property", "model/Account", "common/api", "common/util"], function(t, e, i, n, r, o, s, u, a) {
    var l = {
        INVALID_TOKEN: 401,
        FORBIDDEN: 403,
        INTERNAL_SERVER_ERROR: 500,
        SERVICE_UNAVAILABLE: 503
    }, g = {
        NOT_STORY_USER: -1,
        INVALID_PARAMETER: -3,
        OFFICIAL_STORY_USER_ACCESS_FORBIDDEN: -37001,
        STORY_PLUS_CLOSED: -37006
    }, d = t.extend({
        url: "/profiles/me",
        initialize: function() {
            t.prototype.initialize.call(this), this._isLoggedIn = !1, this._isRegistered = !1, this._isStoryPlus = !1
        },
        urls: {
            profileImage: "/settings/profile/image/profile",
            background: "/settings/profile/image/background"
        },
        defaults: _.extend({}, t.prototype.defaults, {
            friends: e,
            invitations: i,
            notifications: n,
            newCount: r,
            property: o,
            account: s
        }),
        parse: function(t) {
            return t.profile
        },
        logout: function(t, e) {
            a.clearSessionCookie(), t ? location.reload() : location.href = e || "/s/logout"
        },
        setLoggedIn: function(t) {
            this._isLoggedIn = t, this.trigger(t ? "login" : "logout")
        },
        isLoggedIn: function() {
            return this._isLoggedIn
        },
        isRegistered: function() {
            return this._isLoggedIn && this._isRegistered
        },
        isStoryPlus: function() {
            return this._isLoggedIn && this._isStoryPlus
        },
        fetch: function() {
            var t = this;
            return u.request({
                url: _.result(this, "url"),
                type: "GET"
            }).then(function(e) {
                t._isLoggedIn = !0, t._isRegistered = !0, t.set(t.parse(e))
            }).fail(function(e) {
                t._isLoggedIn = !1, t._isRegistered = !1;
                var i = e.responseJSON && e.responseJSON.error_code || 0;
                e.status === l.INTERNAL_SERVER_ERROR ? i === g.NOT_STORY_USER ? t._isLoggedIn = !0 : location.href = "/s/500" : e.status !== l.FORBIDDEN || i !== g.STORY_PLUS_CLOSED && i !== g.OFFICIAL_STORY_USER_ACCESS_FORBIDDEN ? e.status === l.SERVICE_UNAVAILABLE ? location.href = "/" : "timeout" === e.statusText && (location.href = "/s/500") : (t._isLoggedIn = !0, t._isStoryPlus = !0)
            })
        },
        deleteProfileImage: function() {
            var t = this;
            return u.request({
                url: this.urls.profileImage,
                type: "DELETE"
            }).then(function(e) {
                t.set(e)
            })
        },
        updateProfileImage: function(t) {
            var e = this;
            return u.request({
                url: this.urls.profileImage,
                type: "PUT",
                data: {
                    image_path: t
                }
            }).then(function(t) {
                e.set(t)
            })
        },
        updateProfileImageFromAlbum: function(t, e) {
            var i = this;
            return u.request({
                url: this.urls.profileImage,
                type: "PUT",
                data: {
                    activity_id: t,
                    image_index: e
                }
            }).then(function(t) {
                i.set(t)
            })
        },
        deleteBackgroundImage: function() {
            var t = this;
            return u.request({
                url: this.urls.background,
                type: "DELETE"
            }).then(function(e) {
                t.set(e)
            })
        },
        updateBackgroundImage: function(t) {
            var e = this;
            return u.request({
                url: this.urls.background,
                type: "PUT",
                data: {
                    image_path: t
                }
            }).then(function(t) {
                e.set(t)
            })
        },
        updateBackgroundImageFromAlbum: function(t, e) {
            var i = this;
            return u.request({
                url: this.urls.background,
                type: "PUT",
                data: {
                    activity_id: t,
                    image_index: e
                }
            }).then(function(t) {
                i.set(t)
            })
        },
        is: function(t) {
            return "undefined" != typeof t && String(this.get("id")) === String(t)
        },
        isProfileImageBlank: function() {
            return "" === this.get("profile_thumbnail_url")
        },
        getProperty: function(t) {
            return this.get("property").get(t)
        },
        setProperty: function(t, e) {
            return this.get("property").updateProperty(t, e)
        }
    });
    return new d
});
define("template/cover", ["Handlebars"], function(r) {
    var e = function(e) {
        var t = r.template(e);
        return function(r) {
            return t(r, {
                partials: n
            })
        }
    }, n = {
        __p__: ""
    };
    return {
        layout: function() {
            var r = e(function(r, e, n, t, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, r.helpers), i = i || {}, '<div class="_coverBgLayer dimmed"></div><div class="_container"></div>'
            });
            return r.wrap = '<div id="cover" class="cover">', r
        }()
    }
});
define("common/animate", [], function() {
    var e = agent.support.css3d,
        n = agent.getCssPrefix("transform", !0),
        t = function(e, n, t) {
            return Math.round(e + (n - e) * t / 100)
        }, r = function(r, f, o, d) {
            var a = {}, i = Q.defer();
            return d = _.extend(d || {}, {
                duration: o,
                done: function() {
                    i.resolve(r)
                },
                fail: function() {
                    i.reject(r)
                }
            }), "undefined" != typeof f.x && "undefined" != typeof f.fromX && "undefined" != typeof f.y && "undefined" != typeof f.fromY && (a.x = f.x, a.y = f.y, a.fromX = f.fromX, a.fromY = f.fromY, f.translate = 100, delete f.x, delete f.y, delete f.fromX, delete f.fromY, d.step = function(f, o) {
                if ("translate" === o.prop) {
                    var d = t(a.fromX, a.x, f),
                        i = t(a.fromY, a.y, f);
                    e ? r.css(n, "translate3d(" + d + "px, " + i + "px, 0)") : r.css({
                        left: d,
                        top: i
                    })
                }
            }), r.animate(f, d), i.promise
        };
    return r
});
define("common/domUtil", ["common/animate"], function(t) {
    var e = 300,
        n = String.fromCharCode(160),
        i = "⁠",
        o = "﻿",
        r = agent.isIe8AndBelow() || agent.browser.is.safari ? o : i;
    return {
        NBSP_CHAR: n,
        WORD_JOINER_CHAR: r,
        scrollTo: function(n, i, o) {
            return i ? t($("html, body"), {
                scrollTop: n
            }, o || e) : (agent.browser.is.ie || agent.browser.is.firefox ? $(window).scrollTop(n) : (document.body.scrollTop = 1, document.body.scrollTop = n), Q.resolve())
        },
        createWordJoinerTextNode: function() {
            return document.createTextNode(r)
        },
        createBrNode: function() {
            return document.createElement("BR")
        },
        getPosition: function(t) {
            for (var e = 0; t = t.previousSibling;) e += 1;
            return e
        },
        isTextNode: function(t) {
            return t && 3 === t.nodeType
        },
        isBrNode: function(t) {
            return t && $.nodeName(t, "BR")
        },
        isSpanNode: function(t) {
            return t && $.nodeName(t, "SPAN")
        },
        isWordJoinerTextNode: function(t) {
            return this.isTextNode(t) && t.nodeValue === r
        },
        isNbspTextNode: function(t) {
            return this.isTextNode(t) && t.nodeValue === n
        },
        isWhitespaceChar: function(t) {
            return " " === t || t === this.NBSP_CHAR
        },
        hasCharBoundaryPoint: function(t) {
            var e;
            return this.isTextNode(t && t.container) ? (e = t.container.nodeValue.charAt(t.offset - 1), e && !this.isWhitespaceChar(e)) : !1
        },
        isTextareaNode: function(t) {
            return t && $.nodeName(t, "TEXTAREA")
        },
        isInputNode: function(t) {
            return t && $.nodeName(t, "INPUT")
        },
        isImgNode: function(t) {
            return t && $.nodeName(t, "IMG")
        },
        isBlockNode: function(t) {
            return t && ($.nodeName(t, "BR") || $.nodeName(t, "IMG"))
        },
        hasChildren: function(t) {
            return !(!t || !this.getChildNodes(t).length)
        },
        getChildNodes: function(t) {
            var e = [];
            if (!t.firstChild) return e;
            if (agent.isIe10AndBelow()) {
                for (t = t.firstChild; t;) e.push(t), t = t.nextSibling;
                return e
            }
            return t.childNodes
        },
        getNodeLength: function(t) {
            return this.isTextNode(t) ? t.nodeValue.length : this.hasChildren(t) ? this.getChildNodes(t).length : this.isImgNode(t) ? 1 : 0
        },
        isEmptyInlineNode: function(t) {
            return this.isTextNode(t) ? !t.nodeValue.length : !(t.innerText || t.textContent).length
        },
        isSidePoint: function(t) {
            return this.isLeftSidePoint(t) || this.isRightSidePoint(t)
        },
        isLeftSidePoint: function(t) {
            return 0 === t.offset
        },
        isRightSidePoint: function(t) {
            return this.getNodeLength(t.container) === t.offset
        },
        closestAncestorOn: function(t, e) {
            for (; t;) {
                if (t.parentNode === e) return t;
                t = t.parentNode
            }
            return null
        },
        commonAncestor: function(t, e, n) {
            var i, o = [];
            for (i = t; i && (o.push(i), n !== i);) i = i.parentNode;
            for (i = e; i;) {
                if (_.contains(o, i)) return i;
                if (n === i) break;
                i = i.parentNode
            }
            return null
        },
        comparePoints: function(t, e, n) {
            var i, o, r;
            if (t.container === e.container) return t.offset === e.offset ? 0 : t.offset > e.offset ? 1 : -1;
            if (o = this.closestAncestorOn(e.container, t.container)) return t.offset <= this.getPosition(o) ? -1 : 1;
            if (i = this.closestAncestorOn(t.container, e.container)) return this.getPosition(i) < e.offset ? -1 : 1;
            for (n = this.commonAncestor(t.container, e.container, n), i = t.container === n ? n : this.closestAncestorOn(t.container, n), o = e.container === n ? n : this.closestAncestorOn(e.container, n), r = n.firstChild; r;) {
                if (r === i) return -1;
                if (r === o) return 1;
                r = r.nextSibling
            }
        },
        listPrev: function(t, e) {
            for (var n = []; t && (!e || !e(t));) n.push(t), t = t.previousSibling;
            return n
        },
        listNext: function(t, e) {
            for (var n = []; t && (!e || !e(t));) n.push(t), t = t.nextSibling;
            return n
        },
        listAncestor: function(t, e) {
            for (var n = []; t && t !== e;) n.push(t), t = t.parentNode;
            return n
        },
        closest: function(t, e) {
            for (; t;) {
                if (e(t)) return t;
                t = t.parentNode
            }
            return null
        },
        insertAfter: function(t, e) {
            var n = e.nextSibling,
                i = e.parentNode;
            return n ? i.insertBefore(t, n) : i.appendChild(t), t
        },
        appendChildNodes: function(t, e) {
            return _.each(t, function(t) {
                e.appendChild(t)
            }), e
        },
        splitNode: function(t) {
            var e, n = t.offset,
                i = t.container;
            return 0 === n ? i : n >= this.getNodeLength(i) ? i.nextSibling : this.isTextNode(i) ? i.splitText(n) : (e = this.getChildNodes(i)[n], i = this.insertAfter(i.cloneNode(!1), i), this.appendChildNodes(this.listNext(e), i))
        },
        splitTree: function(t, e) {
            var n = this,
                i = e.container,
                o = e.offset,
                r = _.rest(this.listAncestor(e.container, t));
            return e.container === t ? this.getChildNodes(t)[e.offset] : r.length ? _.reduce(r, function(t, e) {
                var r = e.cloneNode(!1);
                return n.insertAfter(r, e), t === i && (t = n.splitNode({
                    container: t,
                    offset: o
                })), n.appendChildNodes(n.listNext(t), r), r
            }, i) : this.splitNode(e)
        },
        needBogusBrPoint: function(t, e) {
            var n = this.getLeftNodeFromPoint(t, e),
                i = this.getRightNodeFromPoint(t, e);
            return this.isTextNode(e.container) && !this.isSidePoint(e) ? !1 : !this.isBlockNode(n) && !this.isBlockNode(i) && _.every(this.listNext(i, this.isBlockNode), _.bind(this.isEmptyInlineNode, this))
        },
        makeOffsetPath: function(t, e) {
            return _.map(this.listAncestor(e, t), this.getPosition).reverse()
        },
        fromOffsetPath: function(t, e) {
            for (var n = t, i = 0, o = e.length; o > i; i++) n = this.getChildNodes(n)[e[i]];
            return n
        },
        getBoundaryPoints: function(t, e) {
            return {
                startContainer: t.container,
                startOffset: t.offset,
                endContainer: e.container,
                endOffset: e.offset
            }
        },
        removeNode: function(t, e) {
            if (t && t.parentNode) {
                if (t.removeNode) return t.removeNode(e);
                var n = t.parentNode;
                if (!e) {
                    var i, o, r = [],
                        s = this.getChildNodes(t);
                    for (i = 0, o = s.length; o > i; i++) r.push(s[i]);
                    for (i = 0, o = r.length; o > i; i++) n.insertBefore(r[i], t)
                }
                n.removeChild(t)
            }
        },
        getCandidateRootChildPoint: function(t, e) {
            var n = this;
            return e.container === t ? e : (this.isLeftSidePoint(e) ? e = this.getPreviousBoundaryPointUntil(t, e, !1, function(e) {
                return !n.isLeftSidePoint(e) || e.container === t
            }) : this.isRightSidePoint(e) && (e = this.getNextBoundaryPointUntil(t, e, !1, function(e) {
                return !n.isRightSidePoint(e) || e.container === t
            })), e)
        },
        getLeftNodeFromPoint: function(t, e) {
            return e = this.getCandidateRootChildPoint(t, e), e && e.container === t ? this.getChildNodes(e.container)[e.offset - 1] : null
        },
        getRightNodeFromPoint: function(t, e) {
            return e = this.getCandidateRootChildPoint(t, e), e && e.container === t ? this.getChildNodes(e.container)[e.offset] : null
        },
        getPreviousBoundaryPointUntil: function(t, e, n, i) {
            for (; e;) {
                if (i(e)) return e;
                e = this.getPreviousBoundaryPoint(t, e, n)
            }
            return null
        },
        getNextBoundaryPointUntil: function(t, e, n, i) {
            for (; e;) {
                if (i(e)) return e;
                e = this.getNextBoundaryPoint(t, e, n)
            }
            return null
        },
        getPreviousBoundaryPoint: function(t, e, n) {
            var i, o;
            if (0 === e.offset) {
                if (e.container === t) return null;
                i = e.container.parentNode, o = this.getPosition(e.container)
            } else this.hasChildren(e.container) ? (i = this.getChildNodes(e.container)[e.offset - 1], o = this.getNodeLength(i)) : (i = e.container, o = n ? 0 : e.offset - 1);
            return {
                container: i,
                offset: o
            }
        },
        getNextBoundaryPoint: function(t, e, n) {
            var i, o;
            if (this.getNodeLength(e.container) === e.offset) {
                if (e.container === t) return null;
                i = e.container.parentNode, o = this.getPosition(e.container) + 1
            } else this.hasChildren(e.container) ? (i = this.getChildNodes(e.container)[e.offset], o = 0) : (i = e.container, o = n ? this.getNodeLength(e.container) : e.offset + 1);
            return {
                container: i,
                offset: o
            }
        }
    }
});
define("module/static/cover", ["template/cover", "common/domUtil"], function(t, s) {
    var i = 300,
        e = agent.browser.is.ie && agent.browser.version < 8;
    return new(space.StaticModule.extend({
        template: t.layout,
        skipGlobalEvents: !0,
        ui: {
            container: "._container",
            background: "._coverBgLayer"
        },
        styles: {
            dimmed: "dimmed",
            backgroundName: "_coverBgLayer"
        },
        initialize: function() {
            this._wrapCss = null, this._scrollTop = null, this._$content = null, this._$container = $(document.body), this._$wrap = $("#wrap"), this._$scroll = $(window), this._scrollResetRequired = !0
        },
        _setContent: function(t) {
            null !== this._$content && (this._$content.detach(), this._$content = null), this._$content = t, this._$content.appendTo(this.ui.container)
        },
        windowEvents: {
            resize: _.throttle(function() {
                this._$wrap.height(this._getScrollResetHeight())
            }, i)
        },
        show: function(t) {
            this._setContent(t), this.showDimmed(), this._isShown || (this._scrollTop = this._$scroll.scrollTop(), this._wrapCss = {
                overflow: "visible",
                height: "auto"
            }, "hidden" === this._$wrap.css("overflow") && (this._scrollResetRequired = !1), this._scrollResetRequired && (this._$wrap.css({
                overflow: "hidden",
                height: this._getScrollResetHeight()
            }), this.trigger("scrollFrozen")), e && s.scrollTo(0), this._scrollResetRequired && this._$wrap.scrollTop(this._scrollTop), this.$el.appendTo(this._$container), this._isShown = !0, this.attachGlobalEvents(), agent.os.is.mac && agent.browser.is.safari && this.$el.hide().show(), this.trigger("show", this._scrollTop))
        },
        _getScrollResetHeight: function() {
            return this._$scroll.height()
        },
        hide: function() {
            var t = this._scrollTop;
            this._isShown && (this.$el.detach(), this._$content.detach(), this._scrollResetRequired && (this._$wrap.css(this._wrapCss), this.trigger("scrollReleased"), this._$wrap.css("visibility", "hidden"), s.scrollTo(t), this._$wrap.css("visibility", "visible")), this._wrapCss = null, this._scrollTop = null, this._scrollResetRequired = !0, this.reset(), this._$content = null, this._isShown = !1, this.detachGlobalEvents(), this.trigger("hide"))
        },
        showDimmed: function() {
            this.ui.background.show()
        },
        hideDimmed: function() {
            this.ui.background.hide()
        },
        dimmed: function(t) {
            this.reset(), t && this.ui.background.addClass(t)
        },
        reset: function() {
            this.ui.background.attr("class", this.styles.backgroundName + " " + this.styles.dimmed)
        },
        isShown: function() {
            return this._isShown
        }
    }))
});
define("part/plugin/CoverLayerPart", ["module/static/cover", "common/util"], function(i, t) {
    var n = 300;
    return space.Part.extend({
        skipGlobalEvents: !0,
        ui: {
            container: "._layerContainer"
        },
        closeOnDocumentClick: !0,
        initialize: function() {
            this._$window = $(window), this._clickInfo = null, this._isShown = !1, this._closeOnDocumentClick = !0
        },
        onRoute: function() {
            this.hide()
        },
        show: function() {
            this.isShown() || (i.dimmed(), i.show(this.$el), this.attachGlobalEvents(), this._isShown = !0, this.resize(), this.trigger("show"))
        },
        resize: function() {
            var i;
            this.isShown() && (i = Math.round(Math.max(this._$window.height() / 2 - this.ui.container.height() / 2, 0)), this.ui.container.css("top", i))
        },
        hide: function(t) {
            i.hide(), this.detachGlobalEvents(), this._isShown = !1, t && t.silent || this.trigger("hide")
        },
        isShown: function() {
            return this._isShown
        },
        documentEvents: {
            "mousedown,touchstart": function(i) {
                i = agent.getTouchEvent(i), this._clickInfo = {
                    x: i.pageX,
                    y: i.pageY
                }
            },
            "mouseup,touchend": function(i) {
                i = agent.getTouchEvent(i), this._clickInfo && (agent.isClick(this._clickInfo.x, this._clickInfo.y, i.pageX, i.pageY) && this.onClick(i), this._clickInfo = null)
            },
            keydown: function(i) {
                i.keyCode === t.KEY.ESC && this.hide()
            }
        },
        windowEvents: {
            resize: _.throttle(function() {
                this.resize()
            }, n)
        },
        onClick: function(i) {
            var t = $(i.target);
            this.closeOnDocumentClick && (!this.$el || t.closest(this.$el).length || t.closest("#dialog").length || this.hide())
        }
    })
});
define("common/headerArea", [], function() {
    var t = "#header",
        e = 44,
        n = null;
    return {
        getBottom: function() {
            return this._ensureElement(), 0 === n.length ? e : this._isFixedPosition() ? this._getFixedTop() + this._getHeight() : this._getOffsetTop() + this._getHeight()
        },
        _ensureElement: function() {
            n || (n = $(t))
        },
        _isFixedPosition: function() {
            return "fixed" === n.css("position")
        },
        _getFixedTop: function() {
            return parseInt(n.css("top"), 10)
        },
        _getOffsetTop: function() {
            return n.offset().top
        },
        _getHeight: function() {
            return n.height() || e
        }
    }
});
define("part/plugin/LayerPart", ["common/util", "common/headerArea"], function(t, e) {
    var i = 300,
        s = [],
        o = space.Part.extend({
            skipGlobalEvents: !0,
            DEFAULT_EXCEPTION_CLASSES: ["_dialogOk", "_dialogCancel"],
            styles: {
                bottom: "al_bot"
            },
            options: {
                button: "setButton",
                category: "setCategory",
                exceptionClass: "addExceptionClass",
                useEscKeyToClose: "setUseEscKeyToClose"
            },
            ui: {},
            initialize: function() {
                this._category = null, this._exceptionClasses = _.clone(this.DEFAULT_EXCEPTION_CLASSES), this._isShown = !1, this._$button = null, this._$window = $(window), this._clickInfo = null, this._useEscKeyToClose = !0, this._repositionOptions = null
            },
            isShown: function() {
                return this._isShown
            },
            show: function() {
                this.$el && (this._isShown || (this._category ? _.each(s, function(t) {
                    t.getCategory() === this.getCategory() && t.hide()
                }, this) : o.hideAllLayers(), this.$el.show(), this.attachGlobalEvents(), s.push(this), this._isShown = !0, this.trigger("show")))
            },
            hide: function() {
                if (this._isShown) {
                    this._isShown = !1, this.detachGlobalEvents(), this.$el && this.$el.hide();
                    for (var t = 0, e = s.length; e > t; t++) if (s[t] === this) {
                        s.splice(t, 1);
                        break
                    }
                    this.trigger("hide")
                }
            },
            setButton: function(t) {
                this._$button = t
            },
            addExceptionClass: function(e) {
                var i;
                if (0 === e.indexOf(".") && (e = e.substr(1)), - 1 === e.indexOf(",")) _.contains(this._exceptionClasses, e) || this._exceptionClasses.push(e);
                else {
                    i = e.split(",");
                    for (var s = 0, o = i.length; o > s; s++) this.addExceptionClass(t.trim(i[s]))
                }
            },
            setCategory: function(t) {
                this._category = t
            },
            getCategory: function() {
                return this._category
            },
            setUseEscKeyToClose: function(t) {
                this._useEscKeyToClose = t
            },
            reposition: function(t) {
                var i, s, o, n, h, l, c, a, r;
                t && t.$baseElement && (t = _.defaults(t, {
                    topSideMargin: 0,
                    bottomSideMargin: 0
                }), i = this._$window.height(), s = this.$el.outerHeight(), o = t.$baseElement.get(0).getBoundingClientRect(), n = o.top - t.topSideMargin, h = o.bottom + t.bottomSideMargin, l = t.$baseElement.outerHeight(), c = n - e.getBottom(), a = i - h, r = s > a && c >= s ? -(s + t.topSideMargin) : l + t.bottomSideMargin, this.$el.css("top", r), this._repositionOptions = t)
            },
            documentEvents: {
                "mousedown,touchstart": function(t) {
                    t = agent.getTouchEvent(t), this._clickInfo = {
                        x: t.pageX,
                        y: t.pageY
                    }
                },
                "mouseup,touchend": function(t) {
                    t = agent.getTouchEvent(t), this._clickInfo && (agent.isClick(this._clickInfo.x, this._clickInfo.y, t.pageX, t.pageY) && this._onClick(t), this._clickInfo = null)
                },
                keyup: function(e) {
                    e.keyCode === t.KEY.ESC && this._useEscKeyToClose && this.hide()
                }
            },
            windowEvents: {
                resize: _.throttle(function() {
                    this.reposition(this._repositionOptions)
                }, i)
            },
            _onClick: function(t) {
                var e = $(t.target),
                    i = this._$button ? !! e.closest(this._$button).length : !1;
                i || e.closest(this.$el).length || this._exceptionClasses.length > 0 && e.closest("." + this._exceptionClasses.join(",.")).length > 0 || this.hide()
            }
        });
    return o.hideAllLayers = function() {
        _.invoke(s, "hide")
    }, o
});
var kakao = kakao || {};
kakao.weblogin = kakao.weblogin || {}, kakao.weblogin.messages = {
    en: {
        error: "An unexpected error has occurred.\nThe error might have been caused by temporary errors in the server or in the network connection.\nThe Kakao Team is currently identifying and solving the problem.",
        invalid_access: "Invalid access. Please try again.",
        invalid_email: "Email address or password is not in the correct format.",
        invalid_password: "Password is not in the correct format."
    },
    ko: {
        error: "예상하지 못한 오류가 발생했습니다.\n서버의 일시적인 장애이거나 네트워크 문제일 수 있습니다.\n해당 오류는 카카오팀에서 확인 및 대응 중입니다.",
        invalid_access: "정상적인 접근이 아닙니다. 경로를 확인해 주세요.",
        invalid_email: "카카오계정 이메일 형식이 올바르지 않습니다.",
        invalid_password: "비밀번호 형식이 올바르지 않습니다.\n(4~16자리 숫자/기호/대소문자 가능, 공백 불가)"
    },
    ja: {
        error: "予期しないエラーが発生しました。\nサーバーの一時的な障害またはネットワークの問題である場合があります。該当エラーはカカオチームで確認しており、対応中です。",
        invalid_access: "正常なアクセスではありません。もう一度お試しください。",
        invalid_email: "Eメールアドレスまたはパスワードの形式が正しくありません。",
        invalid_password: "パスワードの形式が正しくありません。"
    }
}, kakao.weblogin.utils = {
    getDoc: function(n) {
        var e = null,
            a = function(n) {
                window.console && console.log(n)
            };
        try {
            n.contentWindow && (e = n.contentWindow.document)
        } catch (o) {
            a("cannot get iframe.contentWindow document: " + o)
        }
        if (e) return e;
        try {
            e = n.contentDocument ? n.contentDocument : n.document
        } catch (o) {
            a("cannot get iframe.contentDocument: " + o), e = n.document
        }
        return e
    },
    parse: function(n) {
        var e = {};
        "?" === n.charAt(0) && (n = n.substr(1));
        var a = n.split("&");
        for (var o in a) {
            var r = decodeURIComponent(a[o]),
                t = r.indexOf("=");
            if (-1 !== t) {
                var i = r.substr(0, t),
                    l = r.substr(t + 1);
                e[i] = l
            }
        }
        return e
    },
    createIframe: function(n, e) {
        return $('<iframe name="' + n + '" src="about:blank" />').css({
            position: "absolute",
            top: "-1000px",
            left: "-1000px"
        }).appendTo("body").load(e)[0]
    },
    getAccountsDomain: function(n) {
        var e = function(n, e) {
            return -1 !== n.indexOf(e, n.length - e.length)
        }, a = ".kakao.com";
        return e(window.location.host, ".kakaocorp.cn") && (a = ".kakaocorp.cn"), (n ? n + "-" : "") + "accounts" + a
    }
},
function(n) {
    "function" == typeof define && define.amd ? define("kakaoLogin", ["jquery"], n) : n(window.jQuery)
}(function(n) {
    n.fn.verifyPassword = function(e, a) {
        var o, r;
        r = this;
        var t = jQuery.extend({
            url: "https://" + kakao.weblogin.utils.getAccountsDomain(a) + "/weblogin/verify_password",
            locale: "ko",
            before: function() {
                return !0
            },
            done: function() {},
            fail: function() {
                alert(i.error)
            },
            always: function() {}
        }, e),
            i = kakao.weblogin.messages[t.locale],
            l = function() {
                var e, a = kakao.weblogin.utils.getDoc(o);
                if (a && "about:blank" != a.location.href) try {
                    e = kakao.weblogin.utils.parse(a.location.search) || {}, 0 == e.status || e.message || (e.message = i.error), t.done(e)
                } catch (r) {
                    t.fail(r, r.message)
                } finally {
                    t.always(), n(o).remove()
                }
            }, c = function() {
                return t.before() || t.always(), o = kakao.weblogin.utils.createIframe("_ifr_kilo", l), r.attr("action", t.url), r.attr("target", o.name), r.attr("method", "POST"), !0
            };
        return r.submit(function(n) {
            return c(n)
        }), r
    }, n.fn.kakaoLogin = function(e, a) {
        var o, r, t, i, l = !1,
            c = null;
        _iframe_name = "_ifr_kilo";
        var u = function(n) {
            return !n || !n.length || /^\s*$/.test(n)
        }, s = function(n) {
            return (n || "").replace(/^\s+|\s+$/g, "")
        }, f = function() {
            var n = "string" == typeof r.password;
            return n ? o.find(r.password) : r.password
        }, d = function() {
            r.callback_url || (document.domain = "kakao.com");
            var e, a = kakao.weblogin.utils.getDoc(c);
            if (a && "about:blank" != a.location.href) try {
                if (r.callback_url) e = kakao.weblogin.utils.parse(a.location.search);
                else {
                    var o = a.body ? a.body : a.documentElement;
                    responseText = o ? o.innerHTML : null;
                    var e = n.parseJSON(responseText.trim())
                }
                if (-481 == e.status) return void(location.href = r.url_captcha + "?continue=" + encodeURIComponent(r.continue_url));
                r.done(e)
            } catch (t) {
                r.fail(t, t.message)
            } finally {
                m()
            }
        }, m = function() {
            r.always(), c && n(c).remove(), r.el_cb_url.remove(), l = !1, f().val("")
        }, k = function() {
            return r.login() && g() ? (c = kakao.weblogin.utils.createIframe("_ifr_kilo", d), o.attr("action", r.url), o.attr("target", c.name), o.attr("method", "POST"), r.callback_url && (r.el_cb_url.val(r.callback_url), o.append(r.el_cb_url)), !0) : (m(), !1)
        }, g = function() {
            for (var n in i) if (!i[n]()) return !1;
            return !0
        };
        o = this;
        var r = jQuery.extend({
            el_cb_url: n('<input type="hidden" name="callback_url" />'),
            locale: "ko",
            email: o.find('input[name="email"]'),
            password: 'input[name="password"]',
            continue_url: o.find('input[name="continue"]').val(),
            remember: o.find('input[name="remember"]'),
            url: "https://" + kakao.weblogin.utils.getAccountsDomain(a) + "/weblogin/authenticate",
            url_captcha: "https://" + kakao.weblogin.utils.getAccountsDomain(a) + "/weblogin/main_captcha",
            done: function(n) {
                0 == n.status ? location.href = r.continue_url : r.error(n.message)
            },
            fail: function() {
                alert(t.error)
            },
            always: function() {},
            error: function(n) {
                alert(n)
            },
            login: function() {
                return !0
            }
        }, e),
            t = kakao.weblogin.messages[r.locale],
            i = [function() {
                var n = /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/i,
                    e = f().val();
                return u(r.email.val()) || !r.email.val(s(r.email.val())).val().match(n) ? (r.error(t.invalid_email), !1) : e.length < 4 ? (r.error(t.invalid_password), !1) : -1 == r.continue_url.indexOf("kakao.com") && -1 == r.continue_url.indexOf("kakaocorp.cn") ? (r.error(t.invalid_access), !1) : !0
            }];
        return r.validator && i.push(r.validator), o.submit(function(n) {
            return l ? !1 : (l = !0, k(n))
        }), o
    }
});
define("part/auth/LoginBoxPart", ["template/auth", "part/plugin/LayerPart", "config", "common/urlUtil", "kakaoLogin"], function(t, i, e, o) {
    var n = {
        SUCCESS: 0
    }, l = {
        PAGE: "page",
        LAYER: "layer",
        POPUP: "popup"
    }, a = i.extend({
        template: t.emailTooltipLayer
    }),
        s = {
            DOWN: "down"
        }, r = i.extend({
            template: t.createAccountLayer,
            styles: {
                directionDown: "down"
            },
            setDirection: function(t) {
                this.$el.toggleClass(this.styles.directionDown, t === s.DOWN)
            }
        }),
        c = space.Part.extend({
            template: t.loginBox,
            ui: {
                form: "._loginBoxForm",
                emailInput: "._loginBoxEmailInput",
                emailPlaceholder: "._loginBoxEmailPlaceholder",
                emailTooltipBtn: "._loginBoxEmailTooltipBtn",
                passwordPlaceholder: "._loginBoxPasswordPlaceholder",
                errorText: "._loginBoxErrorText",
                loginBtn: "._loginBoxLoginBtn",
                loginViewTitleWrapper: "._loginViewTitleWrapper",
                loginPageTitleWrapper: "._loginPageTitleWrapper",
                loginPopupTitleWrapper: "._loginPopupTitleWrapper",
                closeBtn: "._loginBoxCloseBtn"
            },
            styles: {
                emailTooltipBtnClose: "close",
                loginBtnIng: "ing"
            },
            options: {
                display: "setDisplay",
                continueUrl: "setContinueUrl"
            },
            initialize: function() {
                this._display = l.PAGE, this._continueUrl = o.getOrigin()
            },
            onRender: function() {
                this.addPart("emailPlaceholder", "part/plugin/PlaceholderPart", {
                    selector: "._loginBoxEmailInput",
                    options: {
                        placeholder: this.ui.emailPlaceholder
                    }
                }), this.addPart("passwordPlaceholder", "part/plugin/PlaceholderPart", {
                    selector: "._loginBoxPasswordInput",
                    options: {
                        placeholder: this.ui.passwordPlaceholder
                    }
                }), this.show()
            },
            onDomReady: function() {
                var t = this;
                this.ui.form.kakaoLogin({
                    locale: "ko",
                    continue_url: this._continueUrl,
                    callback_url: o.getOrigin() + e.dummyPage,
                    login: function() {
                        return t.ui.loginBtn.addClass(t.styles.loginBtnIng), t.ui.loginBtn.attr("disabled", "disabled"), t.ui.loginBtn.text(intl.t("auth.loginBox.loginBtnIng")), !0
                    },
                    always: function() {
                        t.ui.loginBtn.removeClass(t.styles.loginBtnIng), t.ui.loginBtn.removeAttr("disabled")
                    },
                    error: function(i) {
                        t.ui.errorText.html(i).hide().fadeIn(), t.ui.loginBtn.text(intl.t("auth.loginBox.loginBtn"))
                    },
                    done: function(i) {
                        parseInt(i.status, 10) === n.SUCCESS ? t.trigger("loginComplete") : (t.ui.errorText.html(i.message).hide().fadeIn(), t.ui.loginBtn.text(intl.t("auth.loginBox.loginBtn")))
                    }
                }, e.kakaoLogin.phase)
            },
            events: {
                "click ._loginBoxEmailTooltipBtn": function(t) {
                    t.preventDefault(), this.addPart("emailTooltipLayer", a, {
                        selector: "._emailTooltipContainer",
                        options: {
                            exceptionClass: "_loginBoxEmailTooltipBtn"
                        },
                        listeners: {
                            show: function() {
                                this.ui.emailTooltipBtn.addClass(this.styles.emailTooltipBtnClose)
                            },
                            hide: function() {
                                this.ui.emailTooltipBtn.removeClass(this.styles.emailTooltipBtnClose)
                            }
                        }
                    }).next(function() {
                        this.childParts.emailTooltipLayer.toggle()
                    })
                },
                "click ._createAccountToggleBtn": function(t) {
                    t.preventDefault(), this.addPart("createAccountLayer", r, {
                        selector: "._createAccountLayerContainer",
                        options: {
                            exceptionClass: "_createAccountToggleBtn"
                        }
                    }).next(function() {
                        this._display !== l.POPUP && this.childParts.createAccountLayer.setDirection(s.DOWN), this.childParts.createAccountLayer.toggle()
                    })
                },
                "click ._createAccountBtn": function(t) {
                    t.preventDefault(), this._openKakaoAccountPage(e.kakaoLogin.createAccount)
                },
                "click ._findEmailBtn": function(t) {
                    t.preventDefault(), this._openKakaoAccountPage(e.kakaoLogin.findEmail)
                },
                "click ._findPasswordBtn": function(t) {
                    t.preventDefault(), this._openKakaoAccountPage(e.kakaoLogin.findPassword)
                },
                "click ._loginBoxLoginBtn": function(t) {
                    t.preventDefault(), this.ui.form.submit()
                },
                "click ._loginBoxCloseBtn": function(t) {
                    t.preventDefault(), this.trigger("close")
                }
            },
            show: function() {
                switch (this._display) {
                    case l.LAYER:
                        this.ui.loginViewTitleWrapper.show();
                        break;
                    case l.POPUP:
                        this.ui.loginPopupTitleWrapper.show();
                        break;
                    case l.PAGE:
                        this.ui.loginPageTitleWrapper.show()
                }
                this.ui.closeBtn.toggle(this._display === l.LAYER), this.$el.show(), this._resetForm(), this.ui.emailInput.focus(), this.trigger("show")
            },
            _resetForm: function() {
                this.isRendered() && this.ui.form[0].reset(), this.isAvailableChildPart("emailPlaceholder") && this.childParts.emailPlaceholder.update(), this.isAvailableChildPart("passwordPlaceholder") && this.childParts.passwordPlaceholder.update()
            },
            setDisplay: function(t) {
                this._display = t
            },
            setContinueUrl: function(t) {
                this._continueUrl = t
            },
            getOffsetTop: function() {
                return this.$el.offset().top
            },
            _openKakaoAccountPage: function(t) {
                var i = e.kakaoLogin.pageUrl + t + "?continue=" + this._continueUrl;
                this._display === l.POPUP ? window.open(i) : location.href = i
            }
        });
    return c.LOGIN_STATUS = n, c.LOGIN_DISPLAY_TYPE = l, c
});
define("module/static/confirmPasswordView", ["template/auth", "model/me", "model/Account", "part/plugin/CoverLayerPart", "part/auth/LoginBoxPart", "config", "common/util", "common/urlUtil", "kakaoLogin"], function(e, t, i, o, r, n, s, a) {
    var l = o.extend({
        template: e.confirmPasswordLayer,
        model: null,
        ui: _.defaults({
            form: "._confirmPasswordForm",
            input: "._confirmPasswordInput",
            placeholder: "._confirmPasswordPlaceholder",
            errorText: "._confirmPasswordErrorText",
            submitBtn: "._confirmPasswordBtn",
            clientId: "._confirmPasswordClientId",
            callbackUrl: "._confirmPasswordCallbackUrl",
            email: "._email"
        }, o.prototype.ui),
        onSetup: function() {
            this.model = t.get("account")
        },
        onRender: function() {
            var e = this;
            this.addPart("placeholder", "part/plugin/PlaceholderPart", {
                selector: "._confirmPasswordInput",
                options: {
                    placeholder: this.ui.placeholder
                }
            }), this.ui.input.focus(), this.ui.form.verifyPassword({
                locale: "ko",
                before: function() {
                    e.ui.clientId.val(n.kakaoLogin.clientId), e.ui.callbackUrl.val(a.getOrigin() + n.dummyPage)
                },
                login: function() {
                    return e.ui.submitBtn.attr("disabled", "disabled"), !0
                },
                always: function() {
                    e.ui.submitBtn.removeAttr("disabled")
                },
                fail: function(t) {
                    e.ui.errorText.html(t).hide().fadeIn()
                },
                done: function(t) {
                    parseInt(t.status, 10) === r.LOGIN_STATUS.SUCCESS ? e.trigger("verifyPasswordComplete", t.token) : e.ui.errorText.html(t.message).hide().fadeIn()
                }
            }, n.kakaoLogin.phase)
        },
        events: {
            "click ._confirmPasswordCloseBtn": function(e) {
                e.preventDefault(), this.trigger("hide")
            }
        },
        hide: function() {
            this.isRendered() && (this.ui.form[0].reset(), this.ui.errorText.hide()), o.prototype.hide.apply(this, arguments)
        },
        show: function() {
            this.ui.email.text(this.model.get("email")), o.prototype.show.apply(this, arguments)
        }
    });
    return new(space.StaticModule.extend({
        childParts: {
            layer: l
        },
        skipGlobalEvents: !0,
        documentEvents: {
            keydown: function(e) {
                e.keyCode === s.KEY.ESC && this.hide()
            }
        },
        show: function() {
            if (!this.isShown()) {
                var e = Q.defer();
                return this.attachGlobalEvents(), this.childParts.layer.show(), this.domReady(!0), this.listenTo(this.childParts.layer, {
                    hide: function() {
                        this.hide(), e.reject()
                    },
                    verifyPasswordComplete: function(t) {
                        this.hide({
                            silent: !0
                        }), e.resolve(t)
                    }
                }), e.promise
            }
            return Q.resolve()
        },
        hide: function(e) {
            this.isShown() && (this.detachGlobalEvents(), this.childParts.layer.hide(e), this.stopListening(this.childParts.layer))
        },
        isShown: function() {
            return this.childParts.layer.isShown()
        }
    }))
});
define("template/dialog", ["Handlebars"], function(a) {
    var n = function(n) {
        var s = a.template(n);
        return function(a) {
            return s(a, {
                partials: t
            })
        }
    }, t = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = n(function(a, n, t, s, o) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var r = "";
                return r += '<div class="dimmed"></div><div class="bx_pop _container"></div>'
            });
            return a.wrap = '<div id="dialog" class="dialog" tabindex="-1">', a
        }(),
        dialog: function() {
            var a = n(function(a, n, t, s, o) {
                function r(a, n) {
                    var s, o, r = "";
                    return r += ' <button class="btn_com ', s = t["if"].call(a, a && a.isUncoloredButton, {
                        hash: {},
                        inverse: u.program(4, i, n),
                        fn: u.program(2, e, n),
                        data: n
                    }), (s || 0 === s) && (r += s), r += ' _dialogOk" data-kant-id="false"><span>', (o = t.ok) ? s = o.call(a, {
                        hash: {},
                        data: n
                    }) : (o = a && a.ok, s = typeof o === f ? o.call(a, {
                        hash: {},
                        data: n
                    }) : o), r += v(s) + "</span></button> "
                }
                function e() {
                    return "btn_wh"
                }
                function i() {
                    return "btn_or"
                }
                function l(a, n) {
                    var s, o, r = "";
                    return r += ' <button class="btn_com btn_wh _dialogCancel" data-kant-id="false"><span>', (o = t.cancel) ? s = o.call(a, {
                        hash: {},
                        data: n
                    }) : (o = a && a.cancel, s = typeof o === f ? o.call(a, {
                        hash: {},
                        data: n
                    }) : o), r += v(s) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var c, d, h, p = "",
                    u = this,
                    f = "function",
                    v = this.escapeExpression,
                    g = t.helperMissing;
                return p += '<div class="inner"><span class="ic_caution">' + v((d = t.t || n && n.t, h = {
                    hash: {},
                    data: o
                }, d ? d.call(n, "dialog.ok", h) : g.call(n, "t", "dialog.ok", h))) + "</span><p>", (d = t.msg) ? c = d.call(n, {
                    hash: {},
                    data: o
                }) : (d = n && n.msg, c = typeof d === f ? d.call(n, {
                    hash: {},
                    data: o
                }) : d), (c || 0 === c) && (p += c), p += '</p><div class="bn_group">', c = t["if"].call(n, n && n.isReversedButton, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(1, r, o),
                    data: o
                }), (c || 0 === c) && (p += c), p += " ", c = t["if"].call(n, n && n.isConfirm, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(6, l, o),
                    data: o
                }), (c || 0 === c) && (p += c), p += " ", c = t.unless.call(n, n && n.isReversedButton, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(1, r, o),
                    data: o
                }), (c || 0 === c) && (p += c), p += "</div></div>"
            });
            return a
        }(),
        dialogNoIconBtnCenter: function() {
            var a = n(function(a, n, t, s, o) {
                function r(a, n) {
                    var s, o, r = "";
                    return r += ' <button class="btn_com ', s = t["if"].call(a, a && a.isUncoloredButton, {
                        hash: {},
                        inverse: p.program(4, i, n),
                        fn: p.program(2, e, n),
                        data: n
                    }), (s || 0 === s) && (r += s), r += ' _dialogOk" data-kant-id="false"><span>', (o = t.ok) ? s = o.call(a, {
                        hash: {},
                        data: n
                    }) : (o = a && a.ok, s = typeof o === u ? o.call(a, {
                        hash: {},
                        data: n
                    }) : o), r += f(s) + "</span></button> "
                }
                function e() {
                    return "btn_wh"
                }
                function i() {
                    return "btn_or"
                }
                function l(a, n) {
                    var s, o, r = "";
                    return r += ' <button class="btn_com btn_wh _dialogCancel" data-kant-id="false"><span>', (o = t.cancel) ? s = o.call(a, {
                        hash: {},
                        data: n
                    }) : (o = a && a.cancel, s = typeof o === u ? o.call(a, {
                        hash: {},
                        data: n
                    }) : o), r += f(s) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var c, d, h = "",
                    p = this,
                    u = "function",
                    f = this.escapeExpression;
                return h += '<div class="inner"><p>', (d = t.msg) ? c = d.call(n, {
                    hash: {},
                    data: o
                }) : (d = n && n.msg, c = typeof d === u ? d.call(n, {
                    hash: {},
                    data: o
                }) : d), (c || 0 === c) && (h += c), h += '</p><div class="bn_group">', c = t["if"].call(n, n && n.isReversedButton, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, r, o),
                    data: o
                }), (c || 0 === c) && (h += c), h += " ", c = t["if"].call(n, n && n.isConfirm, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(6, l, o),
                    data: o
                }), (c || 0 === c) && (h += c), h += " ", c = t.unless.call(n, n && n.isReversedButton, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, r, o),
                    data: o
                }), (c || 0 === c) && (h += c), h += "</div></div>"
            });
            return a
        }()
    }
});
define("module/static/dialog", ["module/static/cover", "template/dialog"], function(i, t) {
    var e = 300,
        n = 10;
    return new(i.constructor.extend({
        template: t.layout,
        initialize: function() {
            i.initialize.call(this), this._dialogDeferred = null, this._$originFocus = null
        },
        events: {
            "click ._dialogCancel": function(t) {
                this._dialogDeferred.reject(), this.hide(), i.isShown() && i.showDimmed(), this._restoreFocus(), t.preventDefault()
            },
            "click ._dialogOk": function(t) {
                this._dialogDeferred.resolve(), this.hide(), i.isShown() && i.showDimmed(), this._restoreFocus(), t.preventDefault()
            }
        },
        styles: {
            noIconBtnCenter: "v2"
        },
        windowEvents: {
            resize: _.throttle(function() {
                this._$wrap.height(this._$scroll.height()), this._adjustPosition()
            }, e)
        },
        confirm: function(i, t, e) {
            return this._showDialog(i, t, !0, e)
        },
        alert: function(i, t, e) {
            return this._showDialog(i, t, !1, e)
        },
        _showDialog: function(e, n, o, s) {
            var l, c;
            return this._dialogDeferred = Q.defer(), this._$originFocus = $(n), s = _.defaults(s || {}, {
                centerAlignment: !1
            }), s.centerAlignment ? (c = t.dialogNoIconBtnCenter, this.$el.find("._container").addClass(this.styles.noIconBtnCenter)) : (c = t.dialog, this.$el.find("._container").removeClass(this.styles.noIconBtnCenter)), l = $(c({
                msg: e,
                isConfirm: o,
                ok: s.ok ? s.ok : intl.t("dialog.ok"),
                cancel: s.cancel ? s.cancel : intl.t("dialog.cancel"),
                isReversedButton: s.reversedButton ? !0 : !1,
                isUncoloredButton: s.uncoloredButton ? !0 : !1
            })), i.isShown() && i.hideDimmed(), this.show(l), this._adjustPosition(), this._moveFocus(), this._registerHandler(l, s), this._dialogDeferred.promise
        },
        _registerHandler: function(i, t) {
            t && (t.onOk && _.isFunction(t.onOk) && i.find("._dialogOk").one("click", t.onOk), t.onCancel && _.isFunction(t.onCancel) && i.find("._dialogCancel").one("click", t.onCancel))
        },
        _adjustPosition: function() {
            var i = this.ui.container,
                t = i.width(),
                e = i.height(),
                o = this._$scroll.width(),
                s = this._$scroll.height();
            agent.type.is.mobile && (t = Math.min(t, $(window).width() - n), i.css("width", t)), i.css({
                top: (s - e) / 2,
                left: (o - t) / 2
            })
        },
        _moveFocus: function() {
            this.$el.focus()
        },
        _restoreFocus: function() {
            this._$originFocus && this._$originFocus.length && _.isFunction(this._$originFocus[0].focus) && (this._$originFocus[0].focus(), this._$originFocus = null)
        }
    }))
});
define("template/error", ["Handlebars"], function(a) {
    var r = function(r) {
        var e = a.template(r);
        return function(a) {
            return e(a, {
                partials: t
            })
        }
    }, t = {
        __p__: ""
    };
    return {
        notFound: function() {
            var a = r(function(a, r, t, e, o) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var l, s, n = "",
                    c = t.helperMissing,
                    i = this.escapeExpression;
                return n += '<div class="error_container"><div class="error_wrap"><span class="errorbx"><span class="sp_error im_error"></span> <strong class="tt">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.message", s) : c.call(r, "t", "error.error40x.message", s))) + '</strong> <span class="tx">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.title", s) : c.call(r, "t", "error.error40x.title", s))) + "<br>" + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.content", s) : c.call(r, "t", "error.error40x.content", s))) + '</span> <span class="tx2"><a href="#" onclick="history.back();return false" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.prevPage", s) : c.call(r, "t", "error.error40x.prevPage", s))) + '</a><a href="/" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.home", s) : c.call(r, "t", "error.error40x.home", s))) + '</a></span></span><span class="vgt"></span></div><div class="footer"><ul class="ftlink"><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.companyInfo", s) : c.call(r, "t", "gnb.footer.companyInfo", s))) + '</a></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.terms", s) : c.call(r, "t", "gnb.footer.terms", s))) + '</a></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.privacy", s) : c.call(r, "t", "gnb.footer.privacy", s))) + '</a></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.policy", s) : c.call(r, "t", "gnb.footer.policy", s))) + '</a></li></ul><address class="ftcopy" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.copyright", s) : c.call(r, "t", "gnb.footer.copyright", s))) + ' <a href="http://www.kakao.com" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.kakaoCorp", s) : c.call(r, "t", "gnb.footer.kakaoCorp", s))) + "</a></address></div></div>"
            });
            return a
        }(),
        notFoundMember: function() {
            var a = r(function(a, r, t, e, o) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var l, s, n = "",
                    c = t.helperMissing,
                    i = this.escapeExpression;
                return n += '<div class="error_container"><div class="error_wrap"><span class="errorbx"><span class="sp_error im_error"></span> <strong class="tt">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.message", s) : c.call(r, "t", "error.error40x.message", s))) + '</strong> <span class="tx">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.title", s) : c.call(r, "t", "error.error40x.title", s))) + "<br>" + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.content", s) : c.call(r, "t", "error.error40x.content", s))) + '</span> <span class="tx2"><a href="#" onclick="history.back();return false" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.prevPage", s) : c.call(r, "t", "error.error40x.prevPage", s))) + '</a><a href="/" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.home", s) : c.call(r, "t", "error.error40x.home", s))) + '</a></span></span><span class="vgt"></span></div><div class="footer"><ul class="ftlink"><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.companyInfo", s) : c.call(r, "t", "gnb.footer.companyInfo", s))) + '</a></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.terms", s) : c.call(r, "t", "gnb.footer.terms", s))) + '</a></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.privacy", s) : c.call(r, "t", "gnb.footer.privacy", s))) + '</a></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.policy", s) : c.call(r, "t", "gnb.footer.policy", s))) + '</a></li></ul><address class="ftcopy" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.copyright", s) : c.call(r, "t", "gnb.footer.copyright", s))) + ' <a href="http://www.kakao.com" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.kakaoCorp", s) : c.call(r, "t", "gnb.footer.kakaoCorp", s))) + "</a></address></div></div>"
            });
            return a
        }(),
        error50x: function() {
            var a = r(function(a, r, t, e, o) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var l, s, n = "",
                    c = t.helperMissing,
                    i = this.escapeExpression;
                return n += '<div class="error_container"><div class="error_wrap"><span class="errorbx"><span class="sp_error im_error"></span> <strong class="tt">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error50x.message", s) : c.call(r, "t", "error.error50x.message", s))) + '</strong> <span class="tx">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error50x.title", s) : c.call(r, "t", "error.error50x.title", s))) + "<br>" + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error50x.content", s) : c.call(r, "t", "error.error50x.content", s))) + '</span> <span class="tx2"><a href="#" onclick="history.back();return false" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error50x.prevPage", s) : c.call(r, "t", "error.error50x.prevPage", s))) + '</a><a href="/" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error50x.home", s) : c.call(r, "t", "error.error50x.home", s))) + '</a></span></span><span class="vgt"></span></div><div class="footer"><ul class="ftlink"><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.companyInfo", s) : c.call(r, "t", "gnb.footer.companyInfo", s))) + '</a></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.terms", s) : c.call(r, "t", "gnb.footer.terms", s))) + '</a></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.privacy", s) : c.call(r, "t", "gnb.footer.privacy", s))) + '</a></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.policy", s) : c.call(r, "t", "gnb.footer.policy", s))) + '</a></li></ul><address class="ftcopy" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.copyright", s) : c.call(r, "t", "gnb.footer.copyright", s))) + ' <a href="http://www.kakao.com" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.kakaoCorp", s) : c.call(r, "t", "gnb.footer.kakaoCorp", s))) + "</a></address></div></div>"
            });
            return a
        }(),
        error40x: function() {
            var a = r(function(a, r, t, e, o) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var l, s, n = "",
                    c = t.helperMissing,
                    i = this.escapeExpression;
                return n += '<div class="error_container"><div class="error_wrap"><span class="errorbx"><span class="sp_error im_error"></span> <strong class="tt">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.message", s) : c.call(r, "t", "error.error40x.message", s))) + '</strong> <span class="tx">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.title", s) : c.call(r, "t", "error.error40x.title", s))) + "<br>" + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.content", s) : c.call(r, "t", "error.error40x.content", s))) + '</span> <span class="tx2"><a href="#" onclick="history.back();return false" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.prevPage", s) : c.call(r, "t", "error.error40x.prevPage", s))) + '</a><a href="/" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "error.error40x.home", s) : c.call(r, "t", "error.error40x.home", s))) + '</a></span></span><span class="vgt"></span></div><div class="footer"><ul class="ftlink"><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.companyInfo", s) : c.call(r, "t", "gnb.footer.companyInfo", s))) + '</a></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.terms", s) : c.call(r, "t", "gnb.footer.terms", s))) + '</a></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.privacy", s) : c.call(r, "t", "gnb.footer.privacy", s))) + '</a></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.policy", s) : c.call(r, "t", "gnb.footer.policy", s))) + '</a></li></ul><address class="ftcopy" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.copyright", s) : c.call(r, "t", "gnb.footer.copyright", s))) + ' <a href="http://www.kakao.com" target="_blank" data-kant-id="false">' + i((l = t.t || r && r.t, s = {
                    hash: {},
                    data: o
                }, l ? l.call(r, "gnb.footer.kakaoCorp", s) : c.call(r, "t", "gnb.footer.kakaoCorp", s))) + "</a></address></div></div>"
            });
            return a
        }(),
        content: function() {
            var a = r(function(a, r, t, e, o) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, a.helpers), o = o || {};
                var l, s, n = "",
                    c = "function",
                    i = this.escapeExpression;
                return n += '<p class="txt">', (s = t.content) ? l = s.call(r, {
                    hash: {},
                    data: o
                }) : (s = r && r.content, l = typeof s === c ? s.call(r, {
                    hash: {},
                    data: o
                }) : s), n += i(l) + "</p>"
            });
            return a
        }()
    }
});
define("module/static/registerView", ["template/auth", "part/plugin/CoverLayerPart", "common/util"], function(t, e, i) {
    var s = e.extend({
        template: t.registerView,
        skipGlobalEvents: !0,
        closeOnDocumentClick: !1,
        events: {
            "click ._cancel": function(t) {
                t.preventDefault(), this.hide()
            }
        },
        show: function() {
            this.addPart("register", "part/auth/RegisterPart").next(function() {
                e.prototype.show.apply(this, arguments), this.childParts.register.reposition()
            })
        },
        hide: function() {
            this.isAvailableChildPart("register") && this.childParts.register.hide(), e.prototype.hide.apply(this, arguments)
        }
    });
    return new(space.StaticModule.extend({
        childParts: {
            storyProfileLayer: s
        },
        skipGlobalEvents: !0,
        documentEvents: {
            keydown: function(t) {
                t.keyCode === i.KEY.ESC && this.hide()
            }
        },
        show: function() {
            this.isShown() || (this.attachGlobalEvents(), this.childParts.storyProfileLayer.show(), this.domReady(!0))
        },
        hide: function() {
            this.isShown() && (this.detachGlobalEvents(), this.childParts.storyProfileLayer.hide())
        },
        isShown: function() {
            return this.childParts.storyProfileLayer.isShown()
        }
    }))
});
define("common/kantUtil", ["kant", "config"], function(e, t) {
    var n = "data-kant-group",
        a = 13,
        r = 32,
        T = ".",
        o = /[^0-9]+/,
        A = "other";
    $(document).on("mousedown keydown", "[" + e.DATA_ATTRIBUTE_ID_NAME + "]", function(t) {
        var T, o = $(t.currentTarget);
        "true" !== o.attr(e.DATA_ATTRIBUTE_IGNORE_NAME) && ("keydown" !== t.type || t.keyCode === a || t.keyCode === r) && (o.attr(n) || (T = o.closest("[" + n + "]").attr(n), o.attr(n, T)))
    }), e.on("beforeDomSend", function(e, t) {
        var a = $(e.currentTarget),
            r = a.attr(n);
        return r && "false" !== r ? (t.pageId = r + T + t.pageId, t) : o.test(t.pageId) ? void 0 : (t.pageId = A + T + t.pageId, t)
    }), e.on("beforeSend", function(e) {
        return e.additionalValue = _.defaults(e.additionalValue || {}, {
            type: agent.type.name,
            url: encodeURIComponent(location.href)
        }), e
    });
    var d = {
        DATA_ATTRIBUTE_ID_NAME: e.DATA_ATTRIBUTE_ID_NAME,
        DATA_ATTRIBUTE_OPTION_NAME: e.DATA_ATTRIBUTE_OPTION_NAME,
        DATA_ATTRIBUTE_IGNORE_NAME: e.DATA_ATTRIBUTE_IGNORE_NAME,
        DATA_ATTRIBUTE_GROUP_NAME: n,
        send: function(t, n, a) {
            var r = Q.defer(),
                T = function() {
                    return r.resolve()
                };
            return e.send(t, n, a, T), r.promise
        },
        sendPageView: function(e, n, a) {
            var r = agent.getScreen(),
                T = agent.getFlashVersion();
            return n = n || {}, r && (n.res = r.width + "x" + r.height, r.pixelDepth && (n.dep = r.pixelDepth)), T && (n.flash = T), this.send(e, n, _.defaults({
                trackId: t.kant.pageViewTrackId
            }, a || {}))
        }
    };
    return d
});
define("module/static/loginView", ["template/auth", "model/me", "module/static/registerView", "part/auth/LoginBoxPart", "part/plugin/CoverLayerPart", "common/util", "common/kantUtil"], function(t, i, e, n, o, s, a) {
    var r = o.extend({
        template: t.loginLayer,
        initialize: function() {
            o.prototype.initialize.call(this, arguments), this._part = null
        },
        onSetup: function() {
            var t = this;
            return i.fetch().then(function() {
                t._setLoginPart()
            })
        },
        _setLoginPart: function() {
            var t = this._part;
            this._part = i.isLoggedIn() && !i.isRegistered() ? "part/auth/RegisterBoxPart" : "part/auth/LoginBoxPart", t !== this._part && this.isRendered() && this.render()
        },
        show: function() {
            this._setLoginPart(), o.prototype.show.apply(this, arguments), this.isAvailableChildPart("view") && (this.childParts.view.show(), a.sendPageView("lgil"))
        },
        onRender: function() {
            this.addPart("view", this._part, {
                options: {
                    display: n.LOGIN_DISPLAY_TYPE.LAYER,
                    continueUrl: location.href
                },
                listeners: {
                    loginComplete: function() {
                        i.fetch().then(function() {
                            i.isRegistered() ? location.reload() : i.isLoggedIn() ? i.isStoryPlus() ? location.href = "/s/login" : (h.hide(), e.show()) : (s.clearSessionCookie(), location.reload())
                        })
                    },
                    close: function() {
                        this.trigger("close")
                    },
                    domReady: function() {
                        this.resize()
                    }
                }
            })
        }
    }),
        h = new(space.StaticModule.extend({
            childParts: {
                layer: r
            },
            skipGlobalEvents: !0,
            documentEvents: {
                keydown: function(t) {
                    t.keyCode === s.KEY.ESC && this.hide()
                }
            },
            onSetup: function() {
                this.listenTo(this.childParts.layer, {
                    close: function() {
                        this.hide()
                    }
                })
            },
            show: function() {
                agent.type.is.mobile ? location.href = "/s/login?continue=" + encodeURIComponent(location.href) : this.isShown() || (this.attachGlobalEvents(), this.childParts.layer.show(), this.domReady(!0))
            },
            hide: function() {
                this.isShown() && (this.detachGlobalEvents(), this.childParts.layer.hide())
            },
            isShown: function() {
                return this.childParts.layer.isShown()
            }
        }));
    return h
});
define("module/static/error", ["template/error", "module/static/dialog", "module/static/loginView", "model/me"], function(e, t, n, i) {
    var o = {
        ERROR_50X: "error50x",
        ERROR_40X: "error40x",
        NOT_FOUND: "notFound",
        NOT_FOUND_MEMBER: "notFoundMember"
    }, r = space.StaticModule.extend({
        PAGE: o,
        initialize: function() {
            this._$container = $("#container"), this._$window = $(window), this._isShownDialog = !1, this._isShown = !1
        },
        _getErrorObjectFromReason: function(e, t) {
            e = e || {};
            var n = 0,
                i = "",
                o = "",
                r = e.responseJSON,
                s = "",
                a = e.status || 0;
            return _.isObject(r) ? (i = r.error || "", n = r.error_code || 0, o = r.error_message || t.message) : o = e.error_message || e.message || t.message || r, _.isObject(o) && (o = this._getValueByStatus(o, a)), _.isFunction(o) && (o = o(a, n, s) || ""), o || (s = n || i, o = intl.t("error.unknown", {
                codeName: s ? "[" + s + "] " : ""
            })), _.isFunction(t.page) ? t.page = t.page(a, n, s) : _.isObject(t.page) && (t.page = this._getValueByStatus(t.page, a)), {
                code: n,
                status: a,
                message: o,
                errorName: i
            }
        },
        _getValueByStatus: function(e, t) {
            var n = "";
            return n = e[t] ? e[t] : "undefined" != typeof e["*"] ? e["*"] : ""
        },
        getHandler: function(e) {
            var t = this;
            return e = _.defaults(e || {}, {
                message: "",
                page: "",
                dialog: !0,
                loginRequired: !0,
                loginRedirect: !1
            }), e.page && (e.dialog = !1),
            function(n) {
                var i = t._getErrorObjectFromReason(n, e),
                    o = Q.resolve(i);
                return 503 === i.status && (location.href = "/"), e.loginRedirect && (o = o.then(function(n) {
                    return t._loginRedirectHandler(n, e)
                })), e.loginRequired !== !1 && 401 === i.status && (o = o.then(function(n) {
                    return t._loginHandler(n, e)
                })), e.page && (o = o.then(function(n) {
                    return t._pageHandler(n, e)
                })), e.dialog && (o = o.then(function(n) {
                    return t._dialogHandler(n, e)
                })), o.then(function() {
                    return Q.reject(n)
                })
            }
        },
        _pageHandler: function(t, n) {
            var i = "error." + n.page,
                o = intl.t(i + ".title"),
                r = intl.t(i + ".content"),
                s = e[n.page];
            r && (r = _.reduce(r.split("\n\n"), function(t, n) {
                return t + e.content({
                    content: n
                }, "")
            }));
            var a = $(s({
                title: o,
                content: r
            }));
            return this.setElement(a), this.show(), t
        },
        _dialogHandler: function(e) {
            return this._showDialog(e.message).then(function() {
                return e
            })
        },
        _loginHandler: function(e) {
            return this._isNotLoggedIn(e) ? space.Router.getCurrentRouter().isLoginRequired() ? (location.href = "/s/login", Q.reject()) : (i.setLoggedIn(!1), n.isShown() || n.show(), Q.reject()) : e
        },
        _loginRedirectHandler: function(e) {
            return this._isNotLoggedIn(e) && (i.setLoggedIn(!1), location.href = "/"), e
        },
        _isNotLoggedIn: function(e) {
            return 401 === e.status || !i.isRegistered()
        },
        _showDialog: function(e) {
            var n = this;
            return this._isShownDialog ? Q.resolve() : (this._isShownDialog = !0, t.alert(e).then(function() {
                n._isShownDialog = !1
            }))
        },
        show: function() {
            this.isShown() || (this._isShown = !0, this._$container.hide(), this.$el.appendTo(document.body), this.$el.css("paddingTop", this._$window.height() / 2 - this.$el.height() / 2))
        },
        hide: function() {
            this.$el.detach(), this._$container.css("display", ""), this._isShown = !1
        },
        isShown: function() {
            return this._isShown
        },
        onRoute: function(e) {
            var t;
            "error" === e ? (t = this.getHandler({
                page: o.NOT_FOUND
            }))() : this.hide()
        },
        events: {
            "click ._btnHome": function(e) {
                e.preventDefault(), location.href = "/"
            },
            "click ._btnBack": function(e) {
                e.preventDefault(), history.back()
            }
        }
    });
    return new r
});
define("template/familySite", ["Handlebars"], function(a) {
    var t = function(t) {
        var o = a.template(t);
        return function(a) {
            return o(a, {
                partials: l
            })
        }
    }, l = {
        __p__: ""
    };
    return {
        sites: function() {
            var a = t(function(a, t, l, o, i) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), i = i || {};
                var e, h, g, r = "",
                    k = l.helperMissing,
                    c = this.escapeExpression,
                    n = "function";
                return r += '<button class="bn_family _familyBtn" title="' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.alt.footerFamily", g) : k.call(t, "t", "gnb.alt.footerFamily", g))) + '" data-kant-id="58"><em>' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.title", g) : k.call(t, "t", "gnb.footer.title", g))) + '<span class="ic"></span></em></button><div class="ly_family _familySites" style="display: none"><ul class="site"><li><a href="', (h = l.talkUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.talkUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" class="_siteFirstLink" data-kant-id="59">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaotalk.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoTalk"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoTalk", g) : k.call(t, "t", "gnb.footer.kakaoTalk", g))) + '</a></li><li><a href="', (h = l.placeUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.placeUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="60">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaoplace.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoPlace"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoPlace", g) : k.call(t, "t", "gnb.footer.kakaoPlace", g))) + '</a></li><li><a href="', (h = l.groupUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.groupUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="61">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaogroup.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoGroup"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoGroup", g) : k.call(t, "t", "gnb.footer.kakaoGroup", g))) + '</a></li><li><a href="', (h = l.homeUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.homeUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="62">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaohome.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoHome"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoHome", g) : k.call(t, "t", "gnb.footer.kakaoHome", g))) + '</a></li><li><a href="', (h = l.musicUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.musicUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="63">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaomusic.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoMusic"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoMusic", g) : k.call(t, "t", "gnb.footer.kakaoMusic", g))) + '</a></li><li><a href="', (h = l.agitUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.agitUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="64">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaoagit.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoAgit"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoAgit", g) : k.call(t, "t", "gnb.footer.kakaoAgit", g))) + '</a></li><li><a href="', (h = l.pageUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.pageUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="65">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaopage.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoPage"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoPage", g) : k.call(t, "t", "gnb.footer.kakaoPage", g))) + '</a></li><li><a href="', (h = l.accountUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.accountUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="66">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaoaccount.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoAccount"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoAccount", g) : k.call(t, "t", "gnb.footer.kakaoAccount", g))) + '</a></li><li><a href="', (h = l.gameUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.gameUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="67">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaogame.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoGame"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoGame", g) : k.call(t, "t", "gnb.footer.kakaoGame", g))) + '</a></li><li><a href="', (h = l.linkUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.linkUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="68">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaolink.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoLink"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoLink", g) : k.call(t, "t", "gnb.footer.kakaoLink", g))) + '</a></li><li><a href="', (h = l.styleUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.styleUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="69">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaostyle.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoStyle"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoStyle", g) : k.call(t, "t", "gnb.footer.kakaoStyle", g))) + '</a></li><li><a href="', (h = l.developersUrl) ? e = h.call(t, {
                    hash: {},
                    data: i
                }) : (h = t && t.developersUrl, e = typeof h === n ? h.call(t, {
                    hash: {},
                    data: i
                }) : h), r += c(e) + '" target="_blank" data-kant-id="70">' + c((h = l.img || t && t.img, g = {
                    hash: {
                        src: "/img/logo_kakaodevelopers.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.footer.kakaoDev"
                    },
                    data: i
                }, h ? h.call(t, g) : k.call(t, "img", g))) + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoDev", g) : k.call(t, "t", "gnb.footer.kakaoDev", g))) + '</a></li></ul><ul class="info"><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="71">' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.companyInfo", g) : k.call(t, "t", "gnb.footer.companyInfo", g))) + '</a><span class="dash"></span></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="72">' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.terms", g) : k.call(t, "t", "gnb.footer.terms", g))) + '</a><span class="dash"></span></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="73">' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.privacy", g) : k.call(t, "t", "gnb.footer.privacy", g))) + '</a><span class="dash"></span></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="74">' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.policy", g) : k.call(t, "t", "gnb.footer.policy", g))) + "</a></li></ul><p>" + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.copyright", g) : k.call(t, "t", "gnb.footer.copyright", g))) + ' <a href="http://www.kakao.com" target="_blank" class="_siteLastLink" data-kant-id="75">' + c((h = l.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, h ? h.call(t, "gnb.footer.kakaoCorp", g) : k.call(t, "t", "gnb.footer.kakaoCorp", g))) + '</a></p><a href="#" class="_lastLinkMarker" data-kant-id="false"><div style="display:none"></div></a></div>'
            });
            return a.wrap = '<div data-kant-group="kko">', a
        }()
    }
});
define("module/static/familySite", ["template/familySite", "common/util", "config"], function(t, i, e) {
    var s = 50,
        l = ["main", "s/settings"],
        n = ["myStory/settings"],
        a = 48,
        o = 12,
        r = 768,
        c = 1024,
        f = 0,
        h = 398,
        u = 438,
        m = space.StaticModule.extend({
            template: t.sites,
            skipGlobalEvents: !0,
            ui: {
                familySiteBtn: "._familyBtn",
                siteFirstLink: "._siteFirstLink",
                siteLastLink: "._siteLastLink"
            },
            styles: {
                on: "on"
            },
            events: {
                "click ._familyBtn": function(t) {
                    t.preventDefault(), this.isAvailableChildPart("familySite") && this.childParts.familySite.toggle()
                },
                "click ._familySites": function(t) {
                    var i = $(t.target);
                    i.is("a") && this.childParts.familySite && this.childParts.familySite.hide()
                },
                "focusout ._siteLastLink": function(t) {
                    var i = $(t.relatedTarget);
                    i.hasClass("_lastLinkMarker") && this.ui.familySiteBtn.focus()
                },
                "keydown ._familyBtn": function(t) {
                    t.keyCode === i.KEY.TAB && t.shiftKey && this.ui.siteLastLink.focus()
                }
            },
            windowEvents: {
                "resize,scroll": _.throttle(function() {
                    this._adjustButtonPosition()
                }, s)
            },
            _adjustButtonPosition: function() {
                var t, i, e = this._$window.scrollTop(),
                    s = e + this._$window.height(),
                    l = this._$window.width(),
                    n = "auto";
                s - this._profileBottom <= a && (n = this._profileBottom + o - e), l = Math.max(l, r), i = Math.min(l, c), t = l / 2 + i / 2 - this._$familySite.width(), this._$familySite.css({
                    top: n,
                    left: t
                })
            },
            initialize: function() {
                this._$familySite = $("#familySite"), this._$window = $(window), this._profileBottom = 0
            },
            onRoute: function(t) {
                this._profileBottom = _.contains(l, t) ? f : _.contains(n, t) ? h : u, this._adjustButtonPosition()
            },
            onRender: function() {
                this.addPart("familySite", "part/plugin/LayerPart", {
                    selector: "._familySites",
                    options: {
                        exceptionClass: "_familyBtn"
                    },
                    listeners: {
                        show: function() {
                            this.ui.familySiteBtn.addClass(this.styles.on)
                        },
                        hide: function() {
                            this.ui.familySiteBtn.removeClass(this.styles.on)
                        }
                    }
                }), this.$el.appendTo(this._$familySite), this._adjustButtonPosition(), agent.type.is.mobile || this.attachGlobalEvents()
            },
            extendData: function() {
                return {
                    talkUrl: e.serviceUrl.talk,
                    groupUrl: e.serviceUrl.group,
                    musicUrl: e.serviceUrl.music,
                    pageUrl: e.serviceUrl.page,
                    gameUrl: e.serviceUrl.game,
                    styleUrl: e.serviceUrl.style,
                    placeUrl: e.serviceUrl.place,
                    homeUrl: e.serviceUrl.home,
                    agitUrl: e.serviceUrl.agit,
                    accountUrl: e.serviceUrl.account,
                    linkUrl: e.serviceUrl.link,
                    developersUrl: e.serviceUrl.developers
                }
            }
        });
    return new m
});
define("template/gnb", ["Handlebars"], function(a) {
    var t = function(t) {
        var l = a.template(t);
        return function(a) {
            return l(a, {
                partials: s
            })
        }
    }, s = {
        searchResultProfile: function() {
            return t(function(a, t, s, l, e) {
                function n() {
                    return "t:unfollowing"
                }
                function r(a, t) {
                    var l;
                    return l = s["if"].call(a, a && a.isStoryPlus, {
                        hash: {},
                        inverse: g.program(6, o, t),
                        fn: g.program(4, i, t),
                        data: t
                    }), l || 0 === l ? l : ""
                }
                function i() {
                    return "t:following"
                }
                function o() {
                    return "t:friend"
                }
                function c(a, t) {
                    var l, e, n, r = "";
                    return r += ' <img src="' + f((e = s.profileImage || a && a.profileImage, n = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "36"
                        },
                        data: t
                    }, e ? e.call(a, n) : u.call(a, "profileImage", n))) + '" class="_profileImage" alt="', (e = s.display_name) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.display_name, l = typeof e === v ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), r += f(l) + '"> '
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var h, d, p = "",
                    g = this,
                    u = s.helperMissing,
                    f = this.escapeExpression,
                    v = "function";
                return p += '<li class="alone"><a href="/', (d = s.urlKey) ? h = d.call(t, {
                    hash: {},
                    data: e
                }) : (d = t && t.urlKey, h = typeof d === v ? d.call(t, {
                    hash: {},
                    data: e
                }) : d), p += f(h) + '" class="_searchItem _searchLink" data-kant-id="194" data-kant-option="', h = s["if"].call(t, t && t.isSearchItem, {
                    hash: {},
                    inverse: g.program(3, r, e),
                    fn: g.program(1, n, e),
                    data: e
                }), (h || 0 === h) && (p += h), p += '"><span class="img_user">', h = s["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: g.noop,
                    fn: g.program(8, c, e),
                    data: e
                }), (h || 0 === h) && (p += h), p += ' <span class="line"></span></span> <strong class="_profileName">', (d = s.display_name) ? h = d.call(t, {
                    hash: {},
                    data: e
                }) : (d = t && t.display_name, h = typeof d === v ? d.call(t, {
                    hash: {},
                    data: e
                }) : d), p += f(h) + "</strong></a></li>"
            })
        }(),
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, s, l, e) {
                return this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {}, '<div data-part="gnbMenu"></div><div data-part="newFeed"></div>'
            });
            return a.wrap = '<div data-kant-group="gnb">', a
        }(),
        memberMenu: function() {
            var a = t(function(a, t, s, l, e) {
                function n(a, t) {
                    var l, e, n = "";
                    return n += '<div class="bn_wrap more"><a href="#" class="bn_plus _toggleWriteButton" data-kant-id="154"><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.alt.write", e) : m.call(a, "t", "gnb.alt.write", e))) + '</em></a></div><div class="ly_tooltip down toggle_write_tooltip _toggleWriteButtonTooltip" style="display:none"><p>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.toggleWriteTooltip", e) : m.call(a, "t", "gnb.toggleWriteTooltip", e))) + '</p><span class="arr"></span></div><div class="bn_wrap"><a href="/s/friends" class="bn_friend _friendButton" data-kant-id="155" data-skip-navigate="true"><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.alt.friends", e) : m.call(a, "t", "gnb.alt.friends", e))) + '</em> <span class="_newInvitationBadge ico_plus" style="display:none">' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.alt.news", e) : m.call(a, "t", "gnb.alt.news", e))) + "</span></a></div>"
                }
                function r(a, t) {
                    var l, e, n = "";
                    return n += '<div class="bn_wrap search"><a href="#" class="bn_search _suggestionToggleBtn" data-kant-id="534" data-kant-option="t:member">' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.btn.search", e) : m.call(a, "t", "search.btn.search", e))) + "</a> </div>"
                }
                function i(a, t) {
                    var l, e, n = "";
                    return n += '<div class="bn_wrap my"><a href="#" class="pf _profileButton" data-kant-id="157"><span><img src="' + b((l = s.profileImage || a && a.profileImage, e = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "32"
                        },
                        data: t
                    }, l ? l.call(a, e) : m.call(a, "profileImage", e))) + '" alt="" class="_profileImage"></span><span class="frame"></span></a></div>'
                }
                function o(a, t) {
                    var l, e, n = "";
                    return n += '<div class="type ly _writeButtons _ignoreScroll" style="display: none" data-part="writeButtons" data-kant-group="gnb.w"><div class="pr"><span class="bl_arrow_up"></span><ul><li><a href="#" class="_changeMode _firstFocusWriteButton" data-mode="text" data-kant-id="158"><span class="ic_pen"></span><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.mode.text", e) : m.call(a, "t", "writing.mode.text", e))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="photo" data-kant-id="159"><span class="ic_camera"></span><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.mode.photo", e) : m.call(a, "t", "writing.mode.photo", e))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="video" data-kant-id="160"><span class="ic_video"></span><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.mode.video", e) : m.call(a, "t", "writing.mode.video", e))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="music" data-kant-id="161"><span class="ic_music"></span><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.mode.music", e) : m.call(a, "t", "writing.mode.music", e))) + '</em></a></li><li><a href="#" class="_changeMode _lastFocusWriteButton" data-mode="link" data-kant-id="162"><span class="ic_link"></span><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.mode.link", e) : m.call(a, "t", "writing.mode.link", e))) + '</em></a></li></ul><span class="line"></span></div></div>'
                }
                function c(a, t) {
                    var l, e, n, r = "";
                    return r += '<li><a href="', (e = s.myStoryPlus) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.myStoryPlus, l = typeof e === y ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), r += b(l) + '" target="_blank" data-kant-id="535"><span class="ic_ch"></span><strong>' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.myStoryPlus", n) : m.call(a, "t", "gnb.profile.myStoryPlus", n))) + '</strong></a></li><li><a href="/s/settings" data-kant-id="164"><span class="ic_set"></span><strong>' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.settings", n) : m.call(a, "t", "gnb.profile.settings", n))) + "</strong></a></li>"
                }
                function h(a, t) {
                    var l, e, n, r = "";
                    return r += '<li class="border"><a href="', (e = s.inquiry) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.inquiry, l = typeof e === y ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), r += b(l) + '" target="_blank" data-kant-id="166"><span class="ic_report"></span><strong>' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.inquiry", n) : m.call(a, "t", "gnb.profile.inquiry", n))) + '</strong></a></li><li><a href="', (e = s.suggest) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.suggest, l = typeof e === y ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), r += b(l) + '" target="_blank" data-kant-id="519"><span class="ic_better"></span><strong>' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.suggest", n) : m.call(a, "t", "gnb.profile.suggest", n))) + '</strong></a></li><li class="border"><a href="/s/notice" class="_btnNotice" data-kant-id="168"><span class="ic_noti"></span><strong>' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.notice", n) : m.call(a, "t", "gnb.profile.notice", n))) + '</strong><span class="ic_new _newNoticeBadge" style="display:none">' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.alt.newNotice", n) : m.call(a, "t", "gnb.profile.alt.newNotice", n))) + '</span></a></li><li><a href="/s/about" target="_blank" data-kant-id="169"><span class="ic_about"></span><strong>' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "gnb.profile.aboutKakaoStory", n) : m.call(a, "t", "gnb.profile.aboutKakaoStory", n))) + "</strong></a></li>"
                }
                function d(a, t) {
                    var l, e, n = "";
                    return n += '<li class="border"><a href="/s/about" target="_blank" data-kant-id="169"><span class="ic_about"></span><strong>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.profile.aboutKakaoStory", e) : m.call(a, "t", "gnb.profile.aboutKakaoStory", e))) + "</strong></a></li>"
                }
                function p(a, t) {
                    var l, e, n = "";
                    return n += '<ul class="store"><li><a href="' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "store.appStore", e) : m.call(a, "t", "store.appStore", e))) + '" target="_blank" data-kant-id="170"><span class="ic_app"></span><strong>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.profile.appstore", e) : m.call(a, "t", "gnb.profile.appstore", e))) + '</strong></a></li><li><a href="' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "store.googlePlay", e) : m.call(a, "t", "store.googlePlay", e))) + '" target="_blank" class="_lastFocusProfileButton" data-kant-id="171"><span class="ic_google"></span><strong>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "gnb.profile.googlePlay", e) : m.call(a, "t", "gnb.profile.googlePlay", e))) + "</strong></a></li></ul>"
                }
                function g() {
                    return '<div data-part="snb"></div>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var u, f, v, _ = "",
                    m = s.helperMissing,
                    b = this.escapeExpression,
                    y = "function",
                    k = this;
                return _ += '<div id="header" class="_headBar"><div class="h_wrap _headWrap"><div class="logo"><a href="/" class="_btnHome" data-skip-navigate="true" data-kant-id="153">' + b((f = s.t || t && t.t, v = {
                    hash: {},
                    data: e
                }, f ? f.call(t, "gnb.alt.kakaostory", v) : m.call(t, "t", "gnb.alt.kakaostory", v))) + '</a></div><div data-part="suggestionArea"></div><div class="my_bx">', u = s.unless.call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(1, n, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += '<div class="bn_wrap"><a href="#" class="bn_feed _notifyButton" data-kant-id="156"><em>' + b((f = s.t || t && t.t, v = {
                    hash: {},
                    data: e
                }, f ? f.call(t, "gnb.alt.noti", v) : m.call(t, "t", "gnb.alt.noti", v))) + '</em> <span class="_newBadge">' + b((f = s.t || t && t.t, v = {
                    hash: {},
                    data: e
                }, f ? f.call(t, "gnb.alt.news", v) : m.call(t, "t", "gnb.alt.news", v))) + "</span></a></div>", u = s["if"].call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.program(5, i, e),
                    fn: k.program(3, r, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += "</div>", u = s.unless.call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(7, o, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += '<div data-part="friendLayer"></div><div class="f_ly recent_ly _notifyLayer _ignoreScroll" style="display:none" data-part="notifyLayer" data-kant-group="gnb.a"><div class="f_cont"><span class="bl_arrow_up"></span> <strong class="re_tit">' + b((f = s.t || t && t.t, v = {
                    hash: {},
                    data: e
                }, f ? f.call(t, "gnb.noti.recent", v) : m.call(t, "t", "gnb.noti.recent", v))) + '</strong><ul class="_notiList"></ul><span class="line"></span></div></div><div class="f_ly set_ly _profileLayer _ignoreScroll" style="display: none" data-part="profileLayer" data-kant-group="gnb.m"><div class="f_cont"><span class="bl_arrow_up"></span><ul class="my_setlst"><li><a href="/', (f = s.urlKey) ? u = f.call(t, {
                    hash: {},
                    data: e
                }) : (f = t && t.urlKey, u = typeof f === y ? f.call(t, {
                    hash: {},
                    data: e
                }) : f), _ += b(u) + '" data-kant-id="163"><span class="ic_my"></span><strong>' + b((f = s.t || t && t.t, v = {
                    hash: {},
                    data: e
                }, f ? f.call(t, "gnb.profile.myStory", v) : m.call(t, "t", "gnb.profile.myStory", v))) + "</strong></a></li>", u = s.unless.call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(9, c, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += '<li><a href="/s/logout" class="_logout" data-kant-id="165" data-kant-ignore="true"><span class="ic_logout"></span><strong>' + b((f = s.t || t && t.t, v = {
                    hash: {},
                    data: e
                }, f ? f.call(t, "gnb.profile.logout", v) : m.call(t, "t", "gnb.profile.logout", v))) + "</strong></a></li>", u = s.unless.call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.program(13, d, e),
                    fn: k.program(11, h, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += "</ul>", u = s.unless.call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(15, p, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += ' <span class="line"></span></div></div></div>', u = s["if"].call(t, t && t.isMobile, {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(17, g, e),
                    data: e
                }), (u || 0 === u) && (_ += u), _ += '<div class="bg _bgFilter"></div></div>'
            });
            return a.wrap = "<div>", a
        }(),
        snb: function() {
            var a = t(function(a, t, s, l, e) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var n, r, i, o = "",
                    c = s.helperMissing,
                    h = this.escapeExpression,
                    d = "function";
                return o += '<li class="_snbMenus _snbFeed"><a href="/" data-kant-id="536">' + h((r = s.t || t && t.t, i = {
                    hash: {},
                    data: e
                }, r ? r.call(t, "snb.menu.feed", i) : c.call(t, "t", "snb.menu.feed", i))) + '</a></li><li class="_snbMenus _snbMyStory"><a href="/', (r = s.urlKey) ? n = r.call(t, {
                    hash: {},
                    data: e
                }) : (r = t && t.urlKey, n = typeof r === d ? r.call(t, {
                    hash: {},
                    data: e
                }) : r), o += h(n) + '" data-kant-id="537">' + h((r = s.t || t && t.t, i = {
                    hash: {},
                    data: e
                }, r ? r.call(t, "snb.menu.myStory", i) : c.call(t, "t", "snb.menu.myStory", i))) + '</a></li><li class="_snbMenus _snbFriends"><a href="/s/friends" data-kant-id="538">' + h((r = s.t || t && t.t, i = {
                    hash: {},
                    data: e
                }, r ? r.call(t, "snb.menu.friends", i) : c.call(t, "t", "snb.menu.friends", i))) + '<span class="ico_dot _newInvitationBadge" style="display:none"></span></a></li><li class="_snbMenus _snbMore"><a href="/s/more" data-kant-id="539">' + h((r = s.t || t && t.t, i = {
                    hash: {},
                    data: e
                }, r ? r.call(t, "snb.menu.more", i) : c.call(t, "t", "snb.menu.more", i))) + "</a></li>"
            });
            return a.wrap = '<ul class="snb">', a
        }(),
        guestMenu: function() {
            var a = t(function(a, t, s, l, e) {
                function n(a, t) {
                    var l, e, n = "";
                    return n += '<div class="bn_wrap search"><a href="#" class="bn_search _suggestionToggleBtn" data-kant-id="534" data-kant-option="t:guest">' + d((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.btn.search", e) : h.call(a, "t", "search.btn.search", e))) + "</a> </div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var r, i, o, c = "",
                    h = s.helperMissing,
                    d = this.escapeExpression,
                    p = this;
                return c += '<div id="header" class="_headBar"><div class="h_wrap _headWrap"><div class="logo"><a href="/" class="_btnHome" data-kant-id="172">' + d((i = s.t || t && t.t, o = {
                    hash: {},
                    data: e
                }, i ? i.call(t, "gnb.alt.kakaostory", o) : h.call(t, "t", "gnb.alt.kakaostory", o))) + '</a></div><div data-part="suggestionArea"></div><div class="my_bx">', r = s["if"].call(t, t && t.isMobile, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, n, e),
                    data: e
                }), (r || 0 === r) && (c += r), c += '<div class="bn_wrap login"><a href="#" class="_loginBtn" data-kant-id="173">' + d((i = s.t || t && t.t, o = {
                    hash: {},
                    data: e
                }, i ? i.call(t, "gnb.menu.login", o) : h.call(t, "t", "gnb.menu.login", o))) + '</a></div><div class="ly_tooltip down _loginTooltip" style="display:none"><p class="_tooltipContent"></p><span class="arr"></span></div></div></div><div class="bg _bgFilter"></div></div>'
            });
            return a.wrap = "<div>", a
        }(),
        suggestionArea: function() {
            var a = t(function(a, t, s, l, e) {
                return this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {}, '<div data-part="suggestionInput"></div><div data-part="suggestionLayer"></div>'
            });
            return a.wrap = '<div data-kant-group="gnb.s">', a
        }(),
        suggestionInput: function() {
            var a = t(function(a, t, s, l, e) {
                function n(a, t) {
                    var l, e, n = "";
                    return n += " " + p((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.placeholder.member", e) : d.call(a, "t", "search.placeholder.member", e))) + " "
                }
                function r(a, t) {
                    var l, e, n = "";
                    return n += " " + p((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.placeholder.guest", e) : d.call(a, "t", "search.placeholder.guest", e))) + " "
                }
                function i(a, t) {
                    var l, e, n = "";
                    return n += ' <button class="_clearBtn _gnbClearBtn" data-kant-id="541">' + p((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.btn.clear", e) : d.call(a, "t", "search.btn.clear", e))) + "</button> "
                }
                function o(a, t) {
                    var l, e, n = "";
                    return n += ' <button data-kant-id="192" tabindex="-1" class="_searchBtn" disabled="disabled">' + p((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.btn.search", e) : d.call(a, "t", "search.btn.search", e))) + "</button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var c, h = "",
                    d = s.helperMissing,
                    p = this.escapeExpression,
                    g = this;
                return h += '<div class="in_srch"><label for="gnbSearchQuery" class="_queryPlaceholder">', c = s["if"].call(t, t && t.isAllPermission, {
                    hash: {},
                    inverse: g.program(3, r, e),
                    fn: g.program(1, n, e),
                    data: e
                }), (c || 0 === c) && (h += c), h += '</label><input type="text" id="gnbSearchQuery" class="_query _gnbQuery"> ', c = s["if"].call(t, t && t.isMobile, {
                    hash: {},
                    inverse: g.program(7, o, e),
                    fn: g.program(5, i, e),
                    data: e
                }), (c || 0 === c) && (h += c), h += "</div>"
            });
            return a.wrap = '<div class="srch_area _suggestionInputArea">', a
        }(),
        suggestionLayer: function() {
            var a = t(function(a, t, s, l, e) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var n, r, i = "",
                    o = s.helperMissing,
                    c = this.escapeExpression;
                return i += '<div class="f_cont"><span class="bl_arrow_up"></span><div data-part="suggestionList" style="display:none"></div><div class="loading _loading">' + c((n = s.img || t && t.img, r = {
                    hash: {
                        src: "/img/loading_circle.gif",
                        width: "24",
                        height: "24",
                        alt: "search.alt.loading"
                    },
                    data: e
                }, n ? n.call(t, r) : o.call(t, "img", r))) + '</div><div class="loading _errorMessage" style="display:none">' + c((n = s.t || t && t.t, r = {
                    hash: {},
                    data: e
                }, n ? n.call(t, "search.paragraph.error", r) : o.call(t, "t", "search.paragraph.error", r))) + '</div><span class="line"></span></div>'
            });
            return a.wrap = '<div class="f_ly srch_ly _ignoreScroll" style="display:none">', a
        }(),
        suggestionList: function() {
            var a = t(function(a, t, s, l, e) {
                function n(a, t) {
                    var l, e = "";
                    return e += " ", l = s["if"].call(a, a && a.total, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(2, r, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += " ", l = s["if"].call(a, a && a.isIdPattern, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(13, g, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += " "
                }
                function r(a, t) {
                    var l, e = "";
                    return e += " ", l = s["if"].call(a, (l = a && a.people, null == l || l === !1 ? l : l.length), {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(3, i, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += " ", l = s["if"].call(a, (l = a && a.storyPlus, null == l || l === !1 ? l : l.length), {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(6, c, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += " ", l = s["if"].call(a, (l = a && a.hashtags, null == l || l === !1 ? l : l.length), {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(8, h, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += " "
                }
                function i(a, t) {
                    var l, e, n, r = "";
                    return r += '<div class="f_article"><strong class="srch_tit">' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "search.title.people", n) : m.call(a, "t", "search.title.people", n))) + '</strong><div class="fake_scroll"><ul class="receive">', l = s.each.call(a, a && a.people, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(4, o, t),
                        data: t
                    }), (l || 0 === l) && (r += l), r += "</ul></div></div>"
                }
                function o(a, t) {
                    var e, n = "";
                    return n += " ", e = _.invokePartial(l.searchResultProfile, "searchResultProfile", a, s, l, t), (e || 0 === e) && (n += e), n += " "
                }
                function c(a, t) {
                    var l, e, n, r = "";
                    return r += '<div class="f_article"><strong class="srch_tit">' + b((e = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "search.title.storyPlus", n) : m.call(a, "t", "search.title.storyPlus", n))) + '</strong><div class="fake_scroll"><ul class="receive">', l = s.each.call(a, a && a.storyPlus, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(4, o, t),
                        data: t
                    }), (l || 0 === l) && (r += l), r += "</ul></div></div>"
                }
                function h(a, t) {
                    var l, e = "";
                    return e += '<div class="f_article">', l = s.unless.call(a, a && a.isHashtagSearch, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(9, d, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += '<div class="fake_scroll"><ul class="hash_list">', l = s.each.call(a, a && a.hashtags, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(11, p, t),
                        data: t
                    }), (l || 0 === l) && (e += l), e += "</ul></div></div>"
                }
                function d(a, t) {
                    var l, e, n = "";
                    return n += ' <strong class="srch_tit">' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.title.hashtag", e) : m.call(a, "t", "search.title.hashtag", e))) + "</strong> "
                }
                function p(a, t) {
                    var l, e, n = "";
                    return n += '<li><a href="/hashtag/', (e = s.tag) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.tag, l = typeof e === y ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), n += b(l) + '" class="_searchLink _searchItem" data-kant-id="194" data-kant-option="t:hashtag">#', (e = s.tag) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.tag, l = typeof e === y ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), n += b(l) + "</a></li>"
                }
                function g(a, t) {
                    var l, e, n = "";
                    return n += '<div class="search_area _idSearchResult"><p class="blind">' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.title.idSearch", e) : m.call(a, "t", "search.title.idSearch", e))) + '</p><a href="#" class="_searchId _searchItem" data-kant-id="193"><span class="ico_search"></span><em>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.btn.searchId", e) : m.call(a, "t", "search.btn.searchId", e))) + "</em></a></div>"
                }
                function u(a, t) {
                    var l, e, n = "";
                    return n += '<div class="art_wrap no_data"><div class="f_article"><ul class="receive"><li>' + b((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "search.paragraph.noSearchResult", e) : m.call(a, "t", "search.paragraph.noSearchResult", e))) + "</li></ul></div></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), l = this.merge(l, a.partials), e = e || {};
                var f, v = "",
                    _ = this,
                    m = s.helperMissing,
                    b = this.escapeExpression,
                    y = "function";
                return f = s["if"].call(t, t && t.hasResult, {
                    hash: {},
                    inverse: _.program(15, u, e),
                    fn: _.program(1, n, e),
                    data: e
                }), (f || 0 === f) && (v += f), v += ' <span class="line"></span>'
            });
            return a.wrap = '<div class="f_cont" style="display:none;">', a
        }(),
        searchResultProfile: function() {
            var a = t(function(a, t, s, l, e) {
                function n() {
                    return "t:unfollowing"
                }
                function r(a, t) {
                    var l;
                    return l = s["if"].call(a, a && a.isStoryPlus, {
                        hash: {},
                        inverse: g.program(6, o, t),
                        fn: g.program(4, i, t),
                        data: t
                    }), l || 0 === l ? l : ""
                }
                function i() {
                    return "t:following"
                }
                function o() {
                    return "t:friend"
                }
                function c(a, t) {
                    var l, e, n, r = "";
                    return r += ' <img src="' + f((e = s.profileImage || a && a.profileImage, n = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "36"
                        },
                        data: t
                    }, e ? e.call(a, n) : u.call(a, "profileImage", n))) + '" class="_profileImage" alt="', (e = s.display_name) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.display_name, l = typeof e === v ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), r += f(l) + '"> '
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var h, d, p = "",
                    g = this,
                    u = s.helperMissing,
                    f = this.escapeExpression,
                    v = "function";
                return p += '<li class="alone"><a href="/', (d = s.urlKey) ? h = d.call(t, {
                    hash: {},
                    data: e
                }) : (d = t && t.urlKey, h = typeof d === v ? d.call(t, {
                    hash: {},
                    data: e
                }) : d), p += f(h) + '" class="_searchItem _searchLink" data-kant-id="194" data-kant-option="', h = s["if"].call(t, t && t.isSearchItem, {
                    hash: {},
                    inverse: g.program(3, r, e),
                    fn: g.program(1, n, e),
                    data: e
                }), (h || 0 === h) && (p += h), p += '"><span class="img_user">', h = s["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: g.noop,
                    fn: g.program(8, c, e),
                    data: e
                }), (h || 0 === h) && (p += h), p += ' <span class="line"></span></span> <strong class="_profileName">', (d = s.display_name) ? h = d.call(t, {
                    hash: {},
                    data: e
                }) : (d = t && t.display_name, h = typeof d === v ? d.call(t, {
                    hash: {},
                    data: e
                }) : d), p += f(h) + "</strong></a></li>"
            });
            return a
        }(),
        idFound: function() {
            var a = t(function(a, t, s, l, e) {
                function n(a, t) {
                    var l, e, n, r = "";
                    return r += ' <img src="' + u((e = s.profileImage || a && a.profileImage, n = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "36"
                        },
                        data: t
                    }, e ? e.call(a, n) : g.call(a, "profileImage", n))) + '" class="_profileImage" alt="', (e = s.display_name) ? l = e.call(a, {
                        hash: {},
                        data: t
                    }) : (e = a && a.display_name, l = typeof e === f ? e.call(a, {
                        hash: {},
                        data: t
                    }) : e), r += u(l) + '"> '
                }
                function r(a, t) {
                    var l, e, n = "";
                    return n += ' <button class="btn_com btn_wh _invite" data-kant-id="196">' + u((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.invite", e) : g.call(a, "t", "friend.btn.invite", e))) + "</button> "
                }
                function i(a, t) {
                    var l, e, n = "";
                    return n += ' <button class="btn_com ing _inviting" data-kant-id="197">' + u((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.inviting", e) : g.call(a, "t", "friend.btn.inviting", e))) + '</button> <button class="btn_com ing _cancel" style="display:none" data-kant-id="197">' + u((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.cancel", e) : g.call(a, "t", "friend.btn.cancel", e))) + "</button> "
                }
                function o(a, t) {
                    var l, e, n = "";
                    return n += ' <button class="btn_com btn_or bn_accep _accept" data-kant-id="199">' + u((l = s.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.accept", e) : g.call(a, "t", "friend.btn.accept", e))) + "</button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var c, h, d, p = "",
                    g = s.helperMissing,
                    u = this.escapeExpression,
                    f = "function",
                    v = this;
                return p += '<p class="blind">' + u((h = s.t || t && t.t, d = {
                    hash: {},
                    data: e
                }, h ? h.call(t, "search.title.idSearch", d) : g.call(t, "t", "search.title.idSearch", d))) + '</p><ul class="receive"><li class="alone"><a href="/', (h = s.urlKey) ? c = h.call(t, {
                    hash: {},
                    data: e
                }) : (h = t && t.urlKey, c = typeof h === f ? h.call(t, {
                    hash: {},
                    data: e
                }) : h), p += u(c) + '" class="_searchLink _searchItem _idFound" data-kant-id="195"><span class="img_user">', c = s["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(1, n, e),
                    data: e
                }), (c || 0 === c) && (p += c), p += ' <span class="line"></span></span> <strong class="_profileName">', (h = s.display_name) ? c = h.call(t, {
                    hash: {},
                    data: e
                }) : (h = t && t.display_name, c = typeof h === f ? h.call(t, {
                    hash: {},
                    data: e
                }) : h), p += u(c) + "</strong></a> ", c = s["if"].call(t, t && t.canAddFriend, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(3, r, e),
                    data: e
                }), (c || 0 === c) && (p += c), p += " ", c = s["if"].call(t, t && t.isRequestSent, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(5, i, e),
                    data: e
                }), (c || 0 === c) && (p += c), p += " ", c = s["if"].call(t, t && t.isRequestReceived, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(7, o, e),
                    data: e
                }), (c || 0 === c) && (p += c), p += "</li></ul>"
            });
            return a.wrap = '<div class="search_area v2">', a
        }(),
        idNotFound: function() {
            var a = t(function(a, t, s, l, e) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var n, r, i = "",
                    o = s.helperMissing,
                    c = this.escapeExpression;
                return i += '<div class="search_area v2"><p class="tx_none">' + c((n = s.t || t && t.t, r = {
                    hash: {},
                    data: e
                }, n ? n.call(t, "search.paragraph.noIdSearchResult", r) : o.call(t, "t", "search.paragraph.noIdSearchResult", r))) + "</p></div>"
            });
            return a
        }(),
        newFeed: function() {
            var a = t(function(a, t, s, l, e) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var n, r, i = "",
                    o = s.helperMissing,
                    c = this.escapeExpression;
                return i += '<a href="#" class="_viewNewFeed" data-kant-id="152">' + c((n = s.t || t && t.t, r = {
                    hash: {},
                    data: e
                }, n ? n.call(t, "gnb.newFeed", r) : o.call(t, "t", "gnb.newFeed", r))) + ' <em class="_newFeedCount"></em></a>'
            });
            return a.wrap = '<div class="new_card" style="display:none;">', a
        }()
    }
});
define("template/writing", ["Handlebars"], function(a) {
    var t = function(t) {
        var e = a.template(t);
        return function(a) {
            return e(a, {
                partials: i
            })
        }
    }, i = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="inner_write"><div class="section _dropZone"><div class="pf"><span><img class="_profileImg" src="' + c((s = i.profileImage || t && t.profileImage, n = {
                    hash: {
                        url: t && t.profile_thumbnail_url,
                        size: "56"
                    },
                    data: l
                }, s ? s.call(t, n) : o.call(t, "profileImage", n))) + '" alt=""></span><span class="line"></span></div><div class="writing"><div data-part="editor"></div></div><div class="_mediaContainer media"><div class="type"><ul><li><a href="#" tabindex="-1" class="_changeModeBtn" data-mode="photo" data-kant-id="388" data-kant-ignore="true"><span class="ic_camera"></span><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.mode.photo", n) : o.call(t, "t", "writing.mode.photo", n))) + '</em></a><form method="post" enctype="multipart/form-data" class="_photoForm _swfUpload"><input name="file_1" class="_photoFileInputOutmost bg_file_upload" type="file" accept="image/gif, image/jpeg, image/png, image/bmp" multiple="multiple" data-kant-id="388"></form></li><li><a href="#" tabindex="-1" class="_changeModeBtn" data-mode="video" data-kant-id="389" data-kant-ignore="true"><span class="ic_video"></span><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.mode.video", n) : o.call(t, "t", "writing.mode.video", n))) + '</em></a><form method="post" enctype="multipart/form-data" class="_videoForm"><input name="file_1" class="_videoFileInputOutmost bg_file_upload" type="file" accept="video/*,video/mp4" data-kant-id="389"></form></li><li><a href="#" class="_changeModeBtn" data-mode="music" data-kant-id="390"><span class="ic_music"></span><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.mode.music", n) : o.call(t, "t", "writing.mode.music", n))) + '</em></a></li><li><a href="#" class="_changeModeBtn" data-mode="link" data-kant-id="391"><span class="ic_link"></span><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.mode.link", n) : o.call(t, "t", "writing.mode.link", n))) + '</em></a></li></ul></div><div class="_mediaModeContainer"></div></div><div class="dropzone _dropSign">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.action.dropzonePlaceholder", n) : o.call(t, "t", "writing.action.dropzonePlaceholder", n))) + '</div><div data-part="friendInput"></div><div class="inp_footer"><div class="bn_icon"><button class="_permissionBtn bn_open" title="' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.permission.title", n) : o.call(t, "t", "writing.permission.title", n))) + '" data-kant-id="501"><em class="_permissionIcon"></em><span class="arr"></span></button><div class="_permissionTooltip tooltip bot"><span class="_permissionTooltipText"></span> <span class="arr_down"></span></div><div class="_permissionLayer" style="display: none"></div><button class="_friendInputBtn bn_with" data-kant-id="502"><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.alt.friendInputBtn", n) : o.call(t, "t", "writing.alt.friendInputBtn", n))) + '</em></button> <button class="bn_emo _sticonInputBtn" data-kant-id="525"><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.sticon", n) : o.call(t, "t", "writing.sticon", n))) + '</em></button><div class="_sticonLayerContainer"></div></div><div class="bn_group"><button class="_cancelBtn btn_com btn_wh" data-kant-id="394"><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.action.cancel", n) : o.call(t, "t", "writing.action.cancel", n))) + '</em></button> <button class="_postBtn btn_com inactive" data-kant-id="395" data-kant-ignore="true"><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.action.post", n) : o.call(t, "t", "writing.action.post", n))) + '</em></button></div></div><span class="arrow_left"></span></div></div>'
            });
            return a.wrap = '<div class="write" data-kant-group="wrt">', a
        }(),
        writingView: function() {
            var a = t(function(a, t, i, e, l) {
                return this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {}, '<div data-part="view"></div>'
            });
            return a.wrap = '<div class="writing_view">', a
        }(),
        permissionLayer: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<ul><li class="_permisionItemAll _permissionItem" data-permission="A"><label for="rdo_all"><span class="ic_global"></span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.permission.all", n) : o.call(t, "t", "writing.permission.all", n))) + '</label><span class="bg_rdo _permissionRadioSpan"><input class="_permissionRadioInput" type="radio" id="rdo_all" name="open" data-kant-id="wpall" data-kant-ignore="true"></span></li><li class="_permissionItem" data-permission="F"><label for="rdo_friend"><span class="ic_friend"></span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.permission.friends", n) : o.call(t, "t", "writing.permission.friends", n))) + '</label><span class="bg_rdo _permissionRadioSpan"><input class="_permissionRadioInput" type="radio" id="rdo_friend" name="open" data-kant-id="wpfri" data-kant-ignore="true"></span></li><li class="_permissionItem" data-permission="M"><label for="rdo_me"><span class="ic_lock"></span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.permission.meOnly", n) : o.call(t, "t", "writing.permission.meOnly", n))) + '</label><span class="bg_rdo _permissionRadioSpan"><input class="_permissionRadioInput" type="radio" id="rdo_me" name="open" data-kant-id="wpme" data-kant-ignore="true"></span></li><li class="v2 _shareLayer"><span class="bg_chk _enableShareSpan"><input type="checkbox" id="chk_share" name="share" class="_enableShare" data-kant-id="wpenb" data-kant-ignore="true"></span><label for="chk_share">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.permission.allowShare", n) : o.call(t, "t", "writing.permission.allowShare", n))) + '</label></li><li class="v2 _commentLayer"><span class="bg_chk _enableAllCommentSpan"><input type="checkbox" id="chk_comment" name="comment" class="_enableAllComment" data-kant-id="wpcmt" data-kant-ignore="true"></span><label for="chk_comment">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.permission.allowComment", n) : o.call(t, "t", "writing.permission.allowComment", n))) + "</label></li></ul>"
            });
            return a.wrap = '<div class="ly open_layer">', a
        }(),
        overflowText: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = "function",
                    c = this.escapeExpression;
                return r += '<span class="overflow">', (n = i.value) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.value, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + "</span>"
            });
            return a
        }(),
        sticonRemoveBtn: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing;
                return o += '<button class="_removeSticonBtn bn_del" style="display:block;left:', (n = i.left) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.left, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + "px;top:", (n = i.top) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.top, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + 'px" tabindex="-1" data-kant-id="527">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.alt.removeSticonBtn", r) : p.call(t, "t", "writing.alt.removeSticonBtn", r))) + "</button>"
            });
            return a
        }(),
        editor: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="_editable_clone editable_clone" style="min-height: 130px;outline:none"></div><p class="_editorOverflowCount overflow_txt" style="display: none"></p><label class="_editorPlaceholder tit_label" for="contents_write">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.textInput.placeholder", n) : o.call(t, "t", "writing.textInput.placeholder", n))) + '</label><div id="contents_write" class="_editable editable" contenteditable="true" style="min-height:130px;outline:none"></div><div class="_editorFriendDropdownWrapper"></div><div class="_editorHashDropdownWrapper"></div><textarea class="_clipboard clipboard" tabindex="-1"></textarea><div class="_editorOverlay"></div>'
            });
            return a.wrap = '<div class="inp_contents">', a
        }(),
        friendInput: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="_friendInputWrapper inp"><label class="_friendInputPlaceholder" for="inp_who">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.friendInput.placeholder", n) : o.call(t, "t", "writing.friendInput.placeholder", n))) + '</label><input class="_friendInput" type="text" id="inp_who" style="width: 100px"><div class="_friendInputDropdownWrapper"></div></div>'
            });
            return a.wrap = '<div class="_friendInputArea with_friend" style="display: none">', a
        }(),
        friendTag: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing;
                return o += '<div class="_friendTag tag" data-id="', (n = i.id) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.id, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '"><em>', (n = i.display_name) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.display_name, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '</em> <button class="_removeFriendTagBtn bn_x" data-kant-id="397">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.alt.friendInputTagRemoveBtn", r) : p.call(t, "t", "writing.alt.friendInputTagRemoveBtn", r))) + "</button></div>"
            });
            return a
        }(),
        photoMode: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="_photofileInputWrapper upload"><div class="add _photofileBtn"><span class="ic"></span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.photoMode.uploadPhoto", n) : o.call(t, "t", "writing.photoMode.uploadPhoto", n))) + '<form method="post" enctype="multipart/form-data" class="_photoForm _swfUpload"><input name="file_1" class="_photoFileInput bg_file_upload" type="file" title="' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.alt.inputTitle", n) : o.call(t, "t", "writing.alt.inputTitle", n))) + '" accept="image/gif, image/jpeg, image/png, image/bmp" multiple="multiple" data-kant-id="513"></form><span class="cover"></span></div><button class="_removeMediaBtn bn_x" data-kant-id="503">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.action.removeMedia", n) : o.call(t, "t", "writing.action.removeMedia", n))) + '</button></div><div class="_photoPreview preview" style="display:none"><div data-part="previewList"></div><div class="_maxCountWarning tooltip_wrap"><div class="tooltip">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.photoMode.maxCountConfirm", n) : o.call(t, "t", "writing.photoMode.maxCountConfirm", n))) + '</div></div></div><div class="_gifPreview preview gif" style="display:none"></div>'
            });
            return a.wrap = '<div class="media_wrap photo" style="display:none">', a
        }(),
        gifPreview: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing;
                return o += '<img src="', (n = i.src) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.src, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '" alt=""> <button class="_removeMediaBtn bn_x" data-kant-id="504">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.photoMode.removePreview", r) : p.call(t, "t", "writing.photoMode.removePreview", r))) + "</button>"
            });
            return a.wrap = "<div>", a
        }(),
        photoPreviewList: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s = "";
                return s
            });
            return a.wrap = "<ul>", a
        }(),
        photoPreview: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<img class="_photoPreviewImg" style="display:none"> <span class="line"></span><div class="_photoPreviewProgress _photoPreviewControl cover" style="display:none">' + c((s = i.img || t && t.img, n = {
                    hash: {
                        src: "/img/loding_wave.gif",
                        widht: "20",
                        height: "16",
                        alt: "writing.alt.loading"
                    },
                    data: l
                }, s ? s.call(t, n) : o.call(t, "img", n))) + '</div><div class="bn_plus_c _photoPreviewFileInputWrapper _photoPreviewControl"><button class="bn_plus _photoPreviewPlusBtn" data-kant-id="398"><span class="ic_plus">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.photoMode.addPhoto", n) : o.call(t, "t", "writing.photoMode.addPhoto", n))) + '</span></button><form method="post" enctype="multipart/form-data" class="_swfUpload"><input name="file_1" class="_photoPreviewFileInput bg_file_upload" type="file" title="' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.photoMode.addPhotoTitle", n) : o.call(t, "t", "writing.photoMode.addPhotoTitle", n))) + '" accept="image/gif, image/jpeg, image/png, image/bmp" multiple="multiple"></form></div><div class="_photoPreviewRetry _photoPreviewControl cover"><button class="_photoPreviewRetryBtn" data-kant-id="399"><span class="ic_reload"></span><em>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.action.retry", n) : o.call(t, "t", "writing.action.retry", n))) + '</em></button></div><button class="_photoPreviewRemoveBtn _photoPreviewControl bn_x" data-kant-id="400">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.photoMode.removePreview", n) : o.call(t, "t", "writing.photoMode.removePreview", n))) + "</button>"
            });
            return a.wrap = '<li class="_photo">', a
        }(),
        videoMode: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="_videoFileInputWrapper upload"><div class="add"><p><span class="ic"></span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.videoMode.uploadVideo", n) : o.call(t, "t", "writing.videoMode.uploadVideo", n))) + '</p><form class="_videoFileInputForm" action="#" method="post" enctype="multipart/form-data"><input class="_videoFileInput bg_file_upload" name="file_1" type="file" title="' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.videoMode.addVideo", n) : o.call(t, "t", "writing.videoMode.addVideo", n))) + '" accept="video/*,video/mp4" data-kant-id="514"></form></div><button class="_removeVideoBtn bn_x" data-kant-id="505">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.alt.cancel", n) : o.call(t, "t", "writing.alt.cancel", n))) + '</button></div><div data-part="preview"></div>'
            });
            return a.wrap = '<div class="media_wrap movie" style="display:none;">', a
        }(),
        videoPreview: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing;
                return o += '<div class="_videoPreviewProgress loading" style="display:none"><span class="_videoPreviewProgressBar bar" style="width:0"></span><p class="txt"><span class="icon"></span> <span class="_videoPreviewFileName">', (n = i.fileName) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.fileName, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '</span> <em class="data _videoPreviewFile">- <span class="_videoPreviewFileSize">', (n = i.fileSize) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.fileSize, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + "</span>" + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.videoMode.fileSizeUnit", r) : p.call(t, "t", "writing.videoMode.fileSizeUnit", r))) + '</em></p><button class="_removeVideoBtn bn_x" data-kant-id="506">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.alt.cancel", r) : p.call(t, "t", "writing.alt.cancel", r))) + '</button></div><div class="preview _videoPreviewLoading" style="display:none"><span class="ic_movie"></span></div><div class="preview finish _videoPreviewComplete" style="display:none"><img class="_videoPreviewImg" src="', (n = i.previewPath) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.previewPath, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '" alt="', (n = i.title) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.title, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '"> <span class="line"></span> <a class="_videoPreviewPlayBtn bn_play" href="#" data-kant-id="402">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.alt.videoPlayBtn", r) : p.call(t, "t", "writing.alt.videoPlayBtn", r))) + '</a></div><div class="preview _videoPreviewReload" style="display:none"><div class="reload"><p>' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.videoMode.error.uploadError", r) : p.call(t, "t", "writing.videoMode.error.uploadError", r))) + '</p><button class="_videoPreviewRetryBtn btn_com btn_wh" data-kant-id="507"><span>' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.action.retry", r) : p.call(t, "t", "writing.action.retry", r))) + "</span></button></div></div>"
            });
            return a.wrap = '<div class="_videoPreview movie_loading" style="display:none">', a
        }(),
        musicMode: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="_musicListTitle loading"><p class="txt"><span class="icon"></span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.musicMode.myMusicRoom", n) : o.call(t, "t", "writing.musicMode.myMusicRoom", n))) + '</p><button class="_musicListCancelBtn bn_x" data-kant-id="508">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.alt.cancel", n) : o.call(t, "t", "writing.alt.cancel", n))) + '</button></div><div data-part="musicList"></div><div data-part="musicPreview"></div>'
            });
            return a.wrap = '<div class="media_wrap music" style="display: none">', a
        }(),
        musicList: function() {
            var a = t(function(a, t, i, e, l) {
                function s(a, t) {
                    var e, l, s, n = "";
                    return n += '<li class="_musicItem" data-id="', (l = i.track_id) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.track_id, e = typeof l === d ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += p(e) + '"><div class="fl"><a href="#" class="img _musicItemPlayBtn" data-kant-id="481"><img src="', (l = i.album_image) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.album_image, e = typeof l === d ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += p(e) + '" width="40" height="40" alt="' + p((l = i.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.alt.albumImage", s) : h.call(a, "t", "writing.alt.albumImage", s))) + '"></a><p class="tit"><a href="#" class="_musicItemPlayBtn" data-kant-id="482"><span class="ic_play"></span> ', (l = i.title) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.title, e = typeof l === d ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += p(e) + "</a></p><p>", (l = i.artist) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.artist, e = typeof l === d ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += p(e) + " | ", (l = i.album_title) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.album_title, e = typeof l === d ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += p(e) + '</p></div><button class="_musicItemSelectBtn btn_com btn_wh" data-kant-id="404"><span>' + p((l = i.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.alt.selectMusicBtn", s) : h.call(a, "t", "writing.alt.selectMusicBtn", s))) + "</span></button></li>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var n, r, o, c = "",
                    d = "function",
                    p = this.escapeExpression,
                    h = i.helperMissing,
                    m = this;
                return c += '<div class="_musicListWrapper lst"><ul class="_musicList" style="height: 190px"><li class="_musicListLoading loading">' + p((r = i.img || t && t.img, o = {
                    hash: {
                        src: "/img/loading_circle.gif",
                        width: "24",
                        height: "24",
                        alt: "writing.alt.loading"
                    },
                    data: l
                }, r ? r.call(t, o) : h.call(t, "img", o))) + "</li>", n = i.each.call(t, t && t.items, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(1, s, l),
                    data: l
                }), (n || 0 === n) && (c += n), c += '</ul></div><div class="_musicListEmpty no_list" style="display: none"><a href="', (r = i.serviceUrl) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.serviceUrl, n = typeof r === d ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), c += p(n) + '" target="_blank" data-kant-id="405"><strong>' + p((r = i.t || t && t.t, o = {
                    hash: {},
                    data: l
                }, r ? r.call(t, "writing.musicMode.kakaoMusic", o) : h.call(t, "t", "writing.musicMode.kakaoMusic", o))) + "</strong></a>" + p((r = i.t || t && t.t, o = {
                    hash: {},
                    data: l
                }, r ? r.call(t, "writing.musicMode.tryKakaoMusic", o) : h.call(t, "t", "writing.musicMode.tryKakaoMusic", o))) + "</div>"
            });
            return a.wrap = "<div>", a
        }(),
        musicPreview: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing;
                return o += '<a href="#" class="_musicPreviewPlayBtn img_album" data-kant-id="406"><img src="', (n = i.album_image) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.album_image, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '" alt="' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.alt.albumImage", r) : p.call(t, "t", "writing.alt.albumImage", r))) + '"> <span class="cover"></span></a><div class="txt"><p class="tit"><a href="#" class="_musicPreviewPlayBtn" data-kant-id="407">', (n = i.title) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.title, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + "</a></p><p>", (n = i.artist) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.artist, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + " - ", (n = i.album_title) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.album_title, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '</p><a href="#" target="_blank" class="_musicPreviewPlayBtn bn_play" data-kant-id="408">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.musicMode.playMusicBtn", r) : p.call(t, "t", "writing.musicMode.playMusicBtn", r))) + '</a><p class="agency"><a href="', (n = i.serviceUrl) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.serviceUrl, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), o += d(s) + '" target="_blank" data-kant-id="409">' + d((n = i.img || t && t.img, r = {
                    hash: {
                        src: "/img/logo_kakaomusic.png",
                        width: "56",
                        height: "8",
                        alt: "writing.alt.kakaoMusic"
                    },
                    data: l
                }, n ? n.call(t, r) : p.call(t, "img", r))) + '</a></p></div><button class="_musicPreviewCancelBtn bn_x" data-kant-id="509">' + d((n = i.t || t && t.t, r = {
                    hash: {},
                    data: l
                }, n ? n.call(t, "writing.alt.cancel", r) : p.call(t, "t", "writing.alt.cancel", r))) + "</button>"
            });
            return a.wrap = '<div class="preview" style="display:none">', a
        }(),
        linkMode: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = i.helperMissing,
                    c = this.escapeExpression;
                return r += '<div class="_linkInputWrapper loading"><p class="txt"><span class="icon"></span> <label class="_linkInputPlaceholder" for="inp_scrap">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.linkMode.placeholder", n) : o.call(t, "t", "writing.linkMode.placeholder", n))) + '</label><input class="_linkInput" type="text" id="inp_scrap" title="' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.linkMode.title", n) : o.call(t, "t", "writing.linkMode.title", n))) + '"></p><button class="_linkInputCancelBtn bn_x" data-kant-id="510,515" data-kant-ignore="true">' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.alt.cancel", n) : o.call(t, "t", "writing.alt.cancel", n))) + '</button></div><div class="_linkPreview preview"><span class="_linkPreviewReady ic_link"></span> <span class="_linkPreviewLoading" style="display:none">' + c((s = i.img || t && t.img, n = {
                    hash: {
                        src: "/img/loding_wave.gif",
                        "class": "img_loding",
                        alt: "writing.alt.loading"
                    },
                    data: l
                }, s ? s.call(t, n) : o.call(t, "img", n))) + '</span><div class="_linkPreviewRetry reload" style="display:none"><p>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.linkMode.fail", n) : o.call(t, "t", "writing.linkMode.fail", n))) + '</p><button class="_linkPreviewRetryBtn btn_com btn_wh" data-kant-id="511"><span>' + c((s = i.t || t && t.t, n = {
                    hash: {},
                    data: l
                }, s ? s.call(t, "writing.action.retry", n) : o.call(t, "t", "writing.action.retry", n))) + '</span></button></div><div data-part="defaultScrapPreview"></div><div data-part="magazineScrapPreview"></div><div data-part="videoScrapPreview"></div></div>'
            });
            return a.wrap = '<div class="media_wrap scrap">', a
        }(),
        defaultScrapPreview: function() {
            var a = t(function(a, t, i, e, l) {
                function s(a, t) {
                    var e, l, s, n = "";
                    return n += '<div class="img"><a href="', (l = i.url) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.url, e = typeof l === c ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += d(e) + '" target="_blank" data-kant-id="411"><img class="_defaultScrapPreviewImg" src="', (l = i.previewImage) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.previewImage, e = typeof l === c ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += d(e) + '" alt="' + d((l = i.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.alt.linkImage", s) : p.call(a, "t", "writing.alt.linkImage", s))) + '"></a> <button class="_defaultScrapPreviewImgRemoveBtn" data-kant-id="412"><span>' + d((l = i.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.linkMode.previewImgRemoveBtn", s) : p.call(a, "t", "writing.linkMode.previewImgRemoveBtn", s))) + "</span></button></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing,
                    h = this;
                return n = i["if"].call(t, t && t.previewImage, {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(1, s, l),
                    data: l
                }), (n || 0 === n) && (o += n), o += '<div class="txt"><a href="', (r = i.url) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.url, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '" target="_blank" class="cont" data-kant-id="413"><strong>', (r = i.title) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.title, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '</strong><p class="_defaultScrapDescription overflowedContent">', (r = i.description) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.description, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '</p></a><p class="link"><a href="', (r = i.hostWithProtocol) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.hostWithProtocol, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '" target="_blank" data-kant-id="414">', (r = i.scrapHost) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.scrapHost, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + "</a></p></div>"
            });
            return a.wrap = '<div class="inner_scrap" style="display:none">', a
        }(),
        magazineScrapPreview: function() {
            var a = t(function(a, t, i, e, l) {
                function s(a, t) {
                    var e, l, s, n = "";
                    return n += '<div class="img" style="width: 100%; left: 0; top: 0"><a href="', (l = i.url) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.url, e = typeof l === c ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += d(e) + '" target="_blank" data-kant-id="547"><img class="_magazineScrapPreviewImg" src="', (l = i.previewImage) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.previewImage, e = typeof l === c ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), n += d(e) + '" alt="' + d((l = i.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.alt.linkImage", s) : p.call(a, "t", "writing.alt.linkImage", s))) + '" style="left: 0; top: 0"> <span class="line"></span></a> <button class="_magazineScrapPreviewImgRemoveBtn" data-kant-id="548"><span>' + d((l = i.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "writing.linkMode.previewImgRemoveBtn", s) : p.call(a, "t", "writing.linkMode.previewImgRemoveBtn", s))) + "</span></button></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var n, r, o = "",
                    c = "function",
                    d = this.escapeExpression,
                    p = i.helperMissing,
                    h = this;
                return n = i["if"].call(t, t && t.previewImage, {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(1, s, l),
                    data: l
                }), (n || 0 === n) && (o += n), o += '<div class="txt"><div class="info"><a href="', (r = i.hostWithProtocol) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.hostWithProtocol, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '" class="site" target="_blank" data-kant-id="549">', (r = i.siteName) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.siteName, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '</a> <span class="cate">', (r = i.section) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.section, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '</span></div><a href="', (r = i.url) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.url, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '" target="_blank" class="cont" data-kant-id="550"><strong class="_magazineScrapTitle">', (r = i.title) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.title, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + '</strong><p class="_magazineScrapDescription">', (r = i.description) ? n = r.call(t, {
                    hash: {},
                    data: l
                }) : (r = t && t.description, n = typeof r === c ? r.call(t, {
                    hash: {},
                    data: l
                }) : r), o += d(n) + "</p></a></div>"
            });
            return a.wrap = '<div class="inner_scrap" style="display:none">', a
        }(),
        videoScrapPreview: function() {
            var a = t(function(a, t, i, e, l) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var s, n, r = "",
                    o = "function",
                    c = this.escapeExpression;
                return r += '<div class="movie_wrap"><iframe src="', (n = i.playUrl) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.playUrl, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + '" frameborder="0" style="width: 100%; height: 250px" title="', (n = i.title) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.title, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + '" allowfullscreen></iframe></div><div class="txt"><a href="', (n = i.url) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.url, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + '" target="_blank" data-kant-id="415"><p class="tit">', (n = i.title) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.title, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + '</p><p class="_videoScrapDescription overflowedContent">', (n = i.description) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.description, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + '</p></a><p class="link"><a href="', (n = i.hostWithProtocol) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.hostWithProtocol, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + '" target="_blank" data-kant-id="417">', (n = i.scrapHost) ? s = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.scrapHost, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), r += c(s) + "</a></p></div>"
            });
            return a.wrap = '<div class="inner_scrap" style="display:none">', a
        }(),
        shareMode: function() {
            var a = t(function(a, t, i, e, l) {
                return this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {}, '<div data-part="share"></div>'
            });
            return a.wrap = '<div class="media_wrap fd_cont">', a
        }(),
        modifyMode: function() {
            var a = t(function(a, t, i, e, l) {
                function s(a, t) {
                    var e, l, s = "";
                    return s += '<p class="txt_edit"><span class="ico_war"></span>', (l = i.description) ? e = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.description, e = typeof l === o ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), s += c(e) + "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {};
                var n, r = "",
                    o = "function",
                    c = this.escapeExpression,
                    d = this;
                return n = i["if"].call(t, t && t.description, {
                    hash: {},
                    inverse: d.noop,
                    fn: d.program(1, s, l),
                    data: l
                }), (n || 0 === n) && (r += n), r += '<div class="media_wrap fd_cont"><div data-part="media"></div></div>'
            });
            return a.wrap = "<div>", a
        }(),
        overflowArea: function() {
            var a = t(function(a, t, i, e, l) {
                return this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), l = l || {}, '<span class="overflow"></span>'
            });
            return a
        }()
    }
});
define("common/decoratorUtil", ["common/util", "common/domUtil"], function(e, t) {
    var i = 64,
        a = {
            STICON: "(Sticker) ",
            IMAGE: "(Image) "
        }, n = ["useRedirect", "activityId", "commentId"],
        o = {
            TEXT: "text",
            PROFILE: "profile",
            STICON: "sticon",
            HASHTAG: "hashtag",
            IMAGE: "image"
        }, r = [o.PROFILE, o.STICON, o.HASHTAG];
    return {
        DECORATOR_TEXT: a,
        DECORATOR_TYPE: o,
        isDecoratorNode: function(e) {
            return _.contains(r, e.attr("data-decorator"))
        },
        isStringNode: function(e) {
            return e && (t.isTextNode(e) || $.nodeName(e, "BR"))
        },
        needNewline: function(e, i) {
            return i ? e && !t.isBlockNode(e) : !0
        },
        markupToDecorator: function(e, i) {
            var n, r = [],
                d = [],
                c = 0,
                m = "";
            i = i || this.isStringNode, e.html(e.html().replace(/\r?\n/gi, "").replace(new RegExp(t.WORD_JOINER_CHAR, "g"), "")), d = t.getChildNodes(e[0]), c = d.length - 1;
            for (var s = 0; c >= s; s++) if (n = $(d[s]), this.isDecoratorNode(n)) switch (n.is("[data-decorator=" + o.STICON + "]") && s > 0 && this.needNewline(d[s - 1], !0) && (m += "\n"), m && m.length > 0 && (r.push({
                type: o.TEXT,
                text: m
            }), m = ""), n.attr("data-decorator")) {
                case o.STICON:
                    r.push({
                        type: o.STICON,
                        text: a.STICON,
                        category_id: n.data("category-id"),
                        id: n.data("id")
                    }), s !== c && this.needNewline(d[s + 1]) && (m += "\n");
                    break;
                case o.PROFILE:
                    r.push({
                        type: o.PROFILE,
                        text: n.text(),
                        id: n.data("id")
                    });
                    break;
                case o.HASHTAG:
                    r.push({
                        type: o.HASHTAG,
                        text: n.text()
                    })
            } else i(d[s]) && (m += $.nodeName(n.get(0), "BR") && c > s ? "\n" : n.text().replace(/\ /g, " "));
            return m.length > 0 && r.push({
                type: o.TEXT,
                text: m
            }), r
        },
        toMarkup: function(t, a, r) {
            var d, c, m, s, h = "",
                g = "",
                l = "";
            r = _.defaults(r || {}, {
                isComment: !1,
                useRedirect: !0
            }), s = _.pick(r, n), t = t || [];
            for (var u = 0, p = t.length; p > u; u++) switch (d = t[u], d.type) {
                case o.STICON:
                    d.url = e.getConvertedImagePath(d.url, i), g = a && "function" == typeof a.sticon ? a.sticon(d) : intl.t("common.alt.sticon"), r.isComment || (h += g, g = "");
                    break;
                case o.PROFILE:
                    h += a && "function" == typeof a.profile ? a.profile(d) : d.text;
                    break;
                case o.IMAGE:
                    a && "function" == typeof a.image ? (r.maxImageSize && d.media && (d.media.width || d.media.height ? d.media.width > d.media.height ? (c = r.maxImageSize, m = Math.round(d.media.height * (c / d.media.width))) : (m = r.maxImageSize, c = Math.round(d.media.width * (m / d.media.height))) : (c = r.maxImageSize, m = r.maxImageSize)), l = a.image(_.defaults(d, {
                        width: c,
                        height: m
                    }))) : l += d.text, r.isComment || (h += l, l = "");
                    break;
                case o.HASHTAG:
                    h += a && "function" == typeof a.hashtag ? a.hashtag(d) : d.text;
                    break;
                default:
                    h += r.isLinkUrl ? e.escapeHtmlStringWithUrlAnchor(d.text, s) : e.escapeHtmlString(d.text), 0 === u && (h = h.replace(/^<br>/, " <br>"))
            }
            return r.isComment && (h += g + l), h
        }
    }
});
define("model/Comment", ["moment", "common/api", "model/Profile"], function(t, e, o) {
    return space.Model.extend({
        collection: null,
        defaults: {
            id: 0,
            writer: o,
            text: "",
            created_at: "",
            decorators: null
        },
        save: function() {
            var t = this,
                o = {
                    text: this.get("text")
                };
            return _.isEmpty(this.get("decorators")) || (o.decorators = JSON.stringify(this.get("decorators"))), e.request({
                url: _.result(this.collection, "url"),
                type: "POST",
                data: o
            }).then(function(e) {
                e.comments = e.comments.slice(-1), t.collection && t.collection.parent && (t.collection.parent.set("comment_count", t.collection.parent.get("comment_count") + 1), t.collection.add(e.comments))
            })
        },
        destroy: function() {
            var t = this;
            return e.request({
                url: _.result(this.collection, "url") + "/" + this.get("id"),
                type: "DELETE"
            }).then(function() {
                t.collection && t.collection.parent && t.collection.parent.set("comment_count", t.collection.parent.get("comment_count") - 1), t.trigger("destroy", t)
            })
        }
    })
});
define("model/Comments", ["common/api", "model/Comment"], function(t, e) {
    return space.Collection.extend({
        parent: null,
        model: e,
        initialize: function() {
            this._isFetched = !1
        },
        url: function() {
            return "/activities/" + this.parent.get("id") + "/comments"
        },
        getWritersByPartialName: function(t) {
            return _.filter(this.pluck("writer"), function(e) {
                return e.isMatch(t)
            })
        },
        isFetched: function() {
            return this._isFetched
        },
        isFetchedAll: function() {
            return this.parent.get("comment_count") === this.length
        },
        fetch: function() {
            var e = this,
                i = null;
            return this.length && (i = _.first(this.models).get("id")), this._isFetched = !0, t.request({
                url: _.result(this, "url"),
                data: {
                    since: i
                }
            }).then(function(t) {
                e.add(t, {
                    at: 0
                })
            })
        },
        isCommentWritable: function() {
            return this.parent.isCommentWritable()
        }
    })
});
define("model/Like", ["model/Profile", "common/api"], function(t, e) {
    return space.Model.extend({
        collection: null,
        defaults: {
            id: 0,
            actor: t,
            emotion: "",
            created_at: ""
        },
        url: function() {
            return "/activities/" + this.collection.parent.get("id") + "/like"
        },
        getEmotionText: function() {
            return intl.t("activity.emotion." + this.get("emotion"))
        },
        destroy: function() {
            var t = this;
            return e.request({
                url: _.result(this, "url"),
                type: "DELETE",
                data: {
                    id: this.get("id")
                }
            }).then(function() {
                t.trigger("destroy", t)
            })
        }
    })
});
define("model/Likes", ["common/api", "model/Like"], function(e, t) {
    return space.Collection.extend({
        parent: null,
        model: t,
        url: function() {
            return "/activities/" + this.parent.get("id") + "/likes"
        },
        initialize: function() {
            this._isEnd = !1
        },
        fetch: function() {
            var t = null,
                i = this;
            return this.length && (t = _.last(this.models).get("id")), this._isEnd ? Q.resolve([]) : e.request({
                url: _.result(this, "url"),
                type: "GET",
                data: {
                    since: t
                }
            }).then(function(e) {
                return e.length ? i.add(e) : i._isEnd = !0, e
            })
        },
        like: function(t) {
            var i = this;
            return e.request({
                url: "/activities/" + this.parent.get("id") + "/like",
                type: "POST",
                data: {
                    emotion: t
                }
            }).then(function(e) {
                var n = i.parent.get("like_count");
                i.add(e.likes.slice(0, 1), {
                    at: 0
                }), i.parent.set({
                    like_count: n + 1,
                    liked_emotion: t,
                    liked: !0
                })
            })
        },
        unlike: function() {
            var t = this;
            return e.request({
                url: "/activities/" + this.parent.get("id") + "/like",
                type: "DELETE"
            }).then(function() {
                var e = t.parent.get("like_count");
                t.parent.set({
                    like_count: e - 1,
                    liked_emotion: "",
                    liked: !1
                }), t.some(function(e) {
                    return e.get("actor").get("isMe") ? (e.trigger("destroy", e), !0) : void 0
                })
            })
        }
    })
});
define("model/Scrap", ["config", "common/api", "common/urlUtil"], function(e, t, r) {
    var o = {
        "www.youtube.com": {
            getEmbedUrl: function(e, t) {
                var o = "//www.youtube.com/embed/{{videoCode}}?wmode=opaque";
                t && (o += "&autoplay=1");
                var i = r.getQueryValueFromUrl(e.dest_url, "v");
                return o.replace("{{videoCode}}", i)
            }
        },
        "tvpot.daum.net": {
            getEmbedUrl: function(e, t) {
                var o = "//videofarm.daum.net/controller/video/viewer/Video.html?vid={{videoCode}}&play_loc=kakao_story&alert=true&wmode=transparent";
                t && (o += "&autoplay=true");
                var i = r.getLastPathFromUrl(e.dest_url);
                return o.replace("{{videoCode}}", i)
            }
        },
        "vimeo.com": {
            getEmbedUrl: function(e, t) {
                var o = "//player.vimeo.com/video/{{videoCode}}";
                t && (o += "?autoplay=1");
                var i = r.getLastPathFromUrl(e.dest_url);
                return o.replace("{{videoCode}}", i)
            }
        },
        "www.dailymotion.com": {
            getEmbedUrl: function(e, t) {
                var o = "//www.dailymotion.com/embed/video/{{videoCode}}";
                t && (o += "?autoplay=1");
                var i = r.getLastPathFromUrl(e.dest_url),
                    a = i.indexOf("_"),
                    n = i.substring(0, a);
                return o.replace("{{videoCode}}", n)
            }
        }
    }, i = {
        VIDEO: "video",
        MUSIC: "music",
        BOOK: "book",
        ARTICLE: "article",
        PROFILE: "profile",
        WEBSITE: "website",
        APP: "app"
    };
    return space.Model.extend({
        defaults: {
            type: "",
            title: "",
            image: [],
            url: "",
            host: "",
            requested_url: "",
            description: "",
            is_opengraph: null,
            dest_url: "",
            section: "",
            site_name: ""
        },
        virtuals: {
            isMagazine: function() {
                return !(!this.get("section") || !this.get("site_name"))
            },
            siteName: function() {
                return this.get("site_name").toUpperCase()
            },
            previewImage: function() {
                var t = _.first(this.get("image")),
                    r = /(http:\/\/(dn-l[0-9]-story).kakao.co.kr)/i;
                return t && e.kage.scrapPreviewImageDnUrl && (t = t.replace(r, "https://$2." + e.kage.scrapPreviewImageDnUrl)), t
            },
            hostWithProtocol: function() {
                return r.getHostWithProtocol(this.get("dest_url"))
            },
            hostWithProtocolRedirect: function() {
                return r.getRedirectUrl(r.getHostWithProtocol(this.get("dest_url")))
            },
            playUrl: function() {
                var e = this.get("type"),
                    t = this.get("host");
                return e === i.VIDEO && o[t] ? o[t].getEmbedUrl(this.toJSON()) : ""
            }
        },
        TYPE: i,
        requestScrap: function(e) {
            var r = this;
            return t.request({
                url: "/scraper",
                data: {
                    url: e
                }
            }).then(function(e) {
                e.dest_url || (e.dest_url = e.url), r.set(e)
            })
        },
        isScraped: function() {
            return !!this.get("type")
        },
        getEmbedUrl: function() {
            var e = o[this.get("host")];
            return e ? e.getEmbedUrl(this.attributes, !0) : null
        },
        isSupportEmbeddingPlay: function() {
            return this.get("type") === i.VIDEO && "undefined" != typeof o[this.get("host")]
        },
        hasPreviewImage: function() {
            var e = this.get("image");
            return e && e.length
        },
        toFilteredData: function() {
            return this.pick(_.difference(_.keys(this.defaults), "dest_url"))
        }
    })
});
define("model/Application", [], function() {
    return space.Model.extend({
        parent: null,
        defaults: {
            action_url: {
                android: "",
                ios: ""
            },
            install_url: {
                android: "",
                ios: ""
            },
            icon: "",
            name: "",
            title: ""
        },
        virtuals: {
            hasLink: function() {
                var i = this.get("action_url"),
                    n = this.get("install_url"),
                    t = agent.os.name;
                return !agent.type.is.desktop && (agent.os.is.ios || agent.os.is.android) && i[t] && n[t] ? !0 : !1
            },
            openAppOptions: function() {
                var i = this.get("action_url"),
                    n = this.get("install_url");
                return {
                    ios: {
                        store: n.ios,
                        app: i.ios
                    },
                    android: {
                        store: n.android,
                        app: i.android
                    }
                }
            }
        }
    })
});
define("model/WithTags", ["model/Profile"], function(e) {
    var t = space.Collection.extend({
        parent: null,
        url: function() {
            return "/activities/" + this.parent.get("id") + "/with_tags"
        },
        model: e
    });
    return t
});
define("model/Share", ["model/Profile", "common/urlKey"], function(t, e) {
    return space.Model.extend({
        collection: null,
        defaults: {
            id: 0,
            activity_id: "",
            actor: t,
            content: "",
            like_count: 0,
            comment_count: 0,
            created_at: ""
        },
        virtuals: {
            activityUrlKey: function() {
                return e.activity.idToUrlKey(this.get("activity_id"))
            }
        }
    })
});
define("model/Shares", ["common/api", "model/Share"], function(e, t) {
    return space.Collection.extend({
        parent: null,
        model: t,
        url: function() {
            return "/activities/" + this.parent.get("id") + "/shares"
        },
        initialize: function() {
            this._isEnd = !1
        },
        fetch: function() {
            var t = null,
                n = this;
            return this.length && (t = _.last(this.models).get("id")), this._isEnd ? Q.resolve([]) : e.request({
                url: _.result(this, "url"),
                type: "GET",
                data: {
                    since: t
                }
            }).then(function(e) {
                return e.length ? n.add(e) : n._isEnd = !0, e
            })
        }
    })
});
define("model/Activity", ["common/api", "common/util", "common/urlUtil", "common/urlKey", "common/decoratorUtil", "moment", "model/Profile", "model/Comments", "model/Likes", "model/Scrap", "model/Application", "model/WithTags", "model/Shares"], function(t, e, i, n, r, s, o, a, l, u, E, c, h) {
    var I = space.Model.extend({
        MEDIA_TYPE: {
            IMAGE: "image",
            SCRAP: "scrap",
            VIDEO: "video"
        },
        DISPLAY_MEDIA_TYPE: {
            NONE: "",
            PHOTO: "photo",
            VIDEO: "video",
            MUSIC: "music",
            LINK: "link",
            SHARE: "share"
        },
        OBJECT_TYPE: {
            MUSIC: "music",
            TEXT: "text",
            GAME: "game",
            TODAY_AD: "toay_ad",
            PROPAGATION: "propagation",
            ACTIVITY: "activity",
            UPDATE_PROFILE_BG_IMAGE: "profile.bg_image_path",
            UPDATE_PROFILE_IMAGE: "profile.profile_image_path"
        },
        VERB: {
            POST: "post",
            JOIN: "join",
            BE_BORN: "be_born",
            SHARE: "share",
            UPDATE: "update",
            PROPAGATE: "propagate",
            PLAY: "game"
        },
        PERMISSION: {
            ALL: "A",
            FRIENDS: "F",
            ME_ONLY: "M"
        },
        FROM: {
            NOTIFICATION: "noti",
            FEED: "feed",
            HASHTAG: "hashtag",
            MYSTORY: "home"
        },
        urlRoot: "/activities",
        defaults: {
            id: null,
            feed_id: null,
            verb: "",
            content: "",
            content_decorators: [],
            media_type: null,
            created_at: "",
            updated_at: "",
            comment_count: 0,
            like_count: 0,
            permission: "",
            required: null,
            has_unread_reaction: null,
            blinded: null,
            deleted: null,
            downloadable: null,
            comment_all_writable: !0,
            actor: o,
            object: null,
            media: null,
            scrap: u,
            comments: a,
            likes: l,
            liked: null,
            liked_emotion: null,
            application: E,
            with_me: null,
            with_tag_count: 0,
            closest_with_tags: null,
            sharable: null,
            share_count: 0,
            plus_subscribed: null,
            share_friends: null,
            withTags: c,
            shares: h
        },
        virtuals: {
            escapedContent: function() {
                return e.escapeHtmlString(this.get("content"))
            },
            escapedTextContent: function() {
                var t = this.get("content").replace(r.DECORATOR_TEXT.STICON, "").replace(r.DECORATOR_TEXT.IMAGE, "").replace(/^[\s\n\r]+/, "");
                return e.escapeHtmlString(t)
            },
            permissionText: function() {
                return this.getPermissionText(this.get("permission"))
            },
            urlKey: function() {
                return n.activity.idToUrlKey(this.get("id"))
            }
        },
        fetch: function(e) {
            var i = this,
                n = {};
            return e && (n.from = e), t.request({
                url: _.result(this, "url"),
                type: "GET",
                data: n
            }).then(function(t) {
                return i.set(t), t
            })
        },
        destroy: function() {
            var e = this;
            return t.request({
                url: _.result(this, "url"),
                type: "DELETE"
            }).then(function() {
                e.trigger("destroy", e)
            })
        },
        hide: function() {
            var e = this;
            return t.request({
                url: "/feeds/" + this.get("feed_id"),
                type: "DELETE"
            }).then(function() {
                e.trigger("destroy", e)
            })
        },
        changePermission: function(e, i, n) {
            var r = this;
            return e === I.PERMISSION.ME_ONLY && (i = !1, n = !0), t.request({
                url: _.result(this, "url"),
                type: "PUT",
                data: {
                    permission: e,
                    enable_share: i,
                    comment_all_writable: n
                }
            }).then(function() {
                r.set({
                    permission: e,
                    sharable: !! i,
                    comment_all_writable: !! n
                })
            })
        },
        requestPosting: function(e, i) {
            var n = this,
                r = _.result(this, "url");
            return e.track_id ? r += "/music" : i && (r += "/" + i + "/share"), t.request({
                url: r,
                type: "POST",
                data: e
            }).then(function(t) {
                return n.set(t), t
            })
        },
        requestUpdating: function(e) {
            var i = this,
                n = _.result(this, "url");
            return t.request({
                url: n + "/content",
                type: "PUT",
                data: e
            }).then(function(t) {
                return i.set(t), t
            })
        },
        getObjectAsActivity: function() {
            return this.get("object") && this.get("object").object_type === this.OBJECT_TYPE.ACTIVITY ? new this.constructor(this.get("object")) : null
        },
        getWithTag: function() {
            var t = null,
                e = this.get("with_tag_count"),
                i = this.get("closest_with_tags");
            return e && i && (t = {
                totalCount: e,
                tags: _.map(i, function(t) {
                    return new o(t)
                })
            }), t
        },
        getMediaCount: function() {
            return this.get("media") ? this.get("media").length : 0
        },
        getShareActivity: function() {
            return this.get("verb") === this.VERB.SHARE ? new I(this.get("object")) : this
        },
        hasScrapData: function() {
            return !!this.get("scrap")
        },
        getSharable: function() {
            var t, e = this.get("sharable"),
                i = this.get("blinded"),
                n = this.get("deleted");
            return this.get("verb") === this.VERB.SHARE && (t = this.getShareActivity(), i = t.get("blinded"), n = t.get("deleted"), t.get("permission") !== this.PERMISSION.ALL && (e = t.get("sharable"))), !e || i || n ? !1 : !0
        },
        getPermissionText: function(t) {
            var e;
            switch (t) {
                case this.PERMISSION.ALL:
                    e = "activity.permission.all";
                    break;
                case this.PERMISSION.FRIENDS:
                    e = "activity.permission.friends";
                    break;
                case this.PERMISSION.ME_ONLY:
                    e = "activity.permission.meOnly";
                    break;
                default:
                    e = "activity.permission.all"
            }
            return e ? intl.t(e) : ""
        },
        isMeOnlyPermission: function() {
            return this.get("permission") === this.PERMISSION.ME_ONLY
        },
        isFriendsPermission: function() {
            return this.get("permission") === this.PERMISSION.FRIENDS
        },
        isCommentWritable: function() {
            var t = this.get("actor").get("relationship"),
                e = t === o.RELATIONSHIP.FRIEND_REQUEST_SENT || t === o.RELATIONSHIP.FRIEND_REQUEST_RECEIVED || t === o.RELATIONSHIP.NONE;
            return this.get("permission") === this.PERMISSION.ALL ? !(e && !this.get("comment_all_writable")) : !0
        },
        getHashtags: function() {
            var t = this.get("content_decorators"),
                e = [],
                i = /^#/;
            return _.isArray(t) && _.each(t, function(t) {
                t.type === r.DECORATOR_TYPE.HASHTAG && e.push(t.text.replace(i, ""))
            }), _.unique(e)
        },
        getDisplayMediaType: function() {
            var t = this.get("media_type") || (this.get("object") ? this.get("object").object_type : null);
            if (this.get("blinded") || this.get("deleted")) return this.DISPLAY_MEDIA_TYPE.NONE;
            switch (t) {
                case this.MEDIA_TYPE.IMAGE:
                    return this.DISPLAY_MEDIA_TYPE.PHOTO;
                case this.MEDIA_TYPE.VIDEO:
                    return this.DISPLAY_MEDIA_TYPE.VIDEO;
                case this.MEDIA_TYPE.SCRAP:
                    return this.DISPLAY_MEDIA_TYPE.LINK;
                case this.OBJECT_TYPE.MUSIC:
                    return this.DISPLAY_MEDIA_TYPE.MUSIC;
                case this.OBJECT_TYPE.ACTIVITY:
                    return this.DISPLAY_MEDIA_TYPE.SHARE;
                default:
                    return this.DISPLAY_MEDIA_TYPE.NONE
            }
        }
    });
    return I.PERMISSION = I.prototype.PERMISSION, I.MEDIA_TYPE = I.prototype.MEDIA_TYPE, I.OBJECT_TYPE = I.prototype.OBJECT_TYPE, I.VERB = I.prototype.VERB, I.FROM = I.prototype.FROM, I.DISPLAY_MEDIA_TYPE = I.prototype.DISPLAY_MEDIA_TYPE, I
});
define("model/WritingSetting", ["common/api"], function(t) {
    var e = space.Model.extend({
        url: "/settings/activity",
        defaults: {
            act_perm: null,
            comment_all_writable: null,
            sharable: null,
            hashtags: []
        },
        fetch: function() {
            var e = this;
            return t.request({
                url: _.result(this, "url"),
                type: "GET"
            }).then(function(t) {
                return e.set(t), e.trigger("fetched"), t
            })
        }
    });
    return e
});
define("model/SticonCategory", [], function() {
    return space.Model.extend({
        defaults: {
            id: 0,
            items: null,
            icon_on_url: null,
            icon_off_url: null,
            active: !1
        }
    })
});
define("model/sticonCategories", ["model/SticonCategory", "common/api"], function(t, e) {
    var n = space.Collection.extend({
        model: t,
        url: "/sticons",
        fetch: function() {
            var t = this;
            return e.request({
                url: this.url,
                type: "GET"
            }).then(function(e) {
                return t.set(e), e
            })
        },
        getSticon: function(t) {
            var e = this.get(_.first(t.split(".")));
            return _.find(e.get("items"), function(e) {
                return e.id === t
            })
        }
    });
    return new n
});
define("common/storage", ["common/util"], function(e) {
    var t, n = "_ksd",
        o = "_ksdet",
        r = 31536e6,
        i = 2048,
        c = {
            _storage: null,
            KEY: {
                HIDE_MOBILE_APP_LINK_BANNER: "hideBanner",
                USED_STICON: "usedSticon"
            },
            EXPIRES: {
                HIDE_MOBILE_APP_LINK_BANNER: 288e5,
                USED_STICON: 2592e6
            },
            init: function() {
                var n = !1,
                    o = "__kakao__";
                try {
                    n = !! window.localStorage, localStorage.setItem(o, !0), localStorage.removeItem(o)
                } catch (c) {
                    n = !1
                }
                t = n ? {
                    get: function(e) {
                        return JSON.parse(localStorage.getItem(e) || "{}")
                    },
                    set: function(e, t) {
                        localStorage.setItem(e, JSON.stringify(t))
                    },
                    clear: function(e) {
                        localStorage.removeItem(e)
                    }
                } : {
                    get: function(t) {
                        return JSON.parse(e.getCookie(t) || "{}")
                    },
                    set: function(t, n) {
                        if (n = JSON.stringify(n), !(n.length < i)) throw new Error("저장 가능한 쿠키 크기를 초과하였습니다.");
                        e.setCookie(t, n, _.now() + r, location.hostname)
                    },
                    clear: function(t) {
                        e.clearCookie(t)
                    }
                }
            },
            get: function(e) {
                return e && this._checkExpiresTime(e) ? t.get(n)[e] : null
            },
            set: function(e, r, i) {
                if (e && null !== r) {
                    var c = t.get(n),
                        a = t.get(o);
                    c[e] = r, t.set(n, c), i > 0 ? a[e] = _.now() + i : delete a[e], t.set(o, a)
                }
            },
            clear: function(e) {
                var r = t.get(n),
                    i = t.get(o);
                r && delete r[e], i && delete i[e], t.set(n, r), t.set(o, i)
            },
            _checkExpiresTime: function(e) {
                var n = t.get(o);
                return !n[e] || n[e] > _.now() ? !0 : (this.clear(e), !1)
            }
        };
    return c.init(), c
});
var CryptoJS = CryptoJS || function(t, n) {
        var i = {}, r = i.lib = {}, e = function() {}, s = r.Base = {
            extend: function(t) {
                e.prototype = this;
                var n = new e;
                return t && n.mixIn(t), n.hasOwnProperty("init") || (n.init = function() {
                    n.$super.init.apply(this, arguments)
                }), n.init.prototype = n, n.$super = this, n
            },
            create: function() {
                var t = this.extend();
                return t.init.apply(t, arguments), t
            },
            init: function() {},
            mixIn: function(t) {
                for (var n in t) t.hasOwnProperty(n) && (this[n] = t[n]);
                t.hasOwnProperty("toString") && (this.toString = t.toString)
            },
            clone: function() {
                return this.init.prototype.extend(this)
            }
        }, o = r.WordArray = s.extend({
            init: function(t, i) {
                t = this.words = t || [], this.sigBytes = i != n ? i : 4 * t.length
            },
            toString: function(t) {
                return (t || c).stringify(this)
            },
            concat: function(t) {
                var n = this.words,
                    i = t.words,
                    r = this.sigBytes;
                if (t = t.sigBytes, this.clamp(), r % 4) for (var e = 0; t > e; e++) n[r + e >>> 2] |= (i[e >>> 2] >>> 24 - 8 * (e % 4) & 255) << 24 - 8 * ((r + e) % 4);
                else if (65535 < i.length) for (e = 0; t > e; e += 4) n[r + e >>> 2] = i[e >>> 2];
                else n.push.apply(n, i);
                return this.sigBytes += t, this
            },
            clamp: function() {
                var n = this.words,
                    i = this.sigBytes;
                n[i >>> 2] &= 4294967295 << 32 - 8 * (i % 4), n.length = t.ceil(i / 4)
            },
            clone: function() {
                var t = s.clone.call(this);
                return t.words = this.words.slice(0), t
            },
            random: function(n) {
                for (var i = [], r = 0; n > r; r += 4) i.push(4294967296 * t.random() | 0);
                return new o.init(i, n)
            }
        }),
            a = i.enc = {}, c = a.Hex = {
                stringify: function(t) {
                    var n = t.words;
                    t = t.sigBytes;
                    for (var i = [], r = 0; t > r; r++) {
                        var e = n[r >>> 2] >>> 24 - 8 * (r % 4) & 255;
                        i.push((e >>> 4).toString(16)), i.push((15 & e).toString(16))
                    }
                    return i.join("")
                },
                parse: function(t) {
                    for (var n = t.length, i = [], r = 0; n > r; r += 2) i[r >>> 3] |= parseInt(t.substr(r, 2), 16) << 24 - 4 * (r % 8);
                    return new o.init(i, n / 2)
                }
            }, h = a.Latin1 = {
                stringify: function(t) {
                    var n = t.words;
                    t = t.sigBytes;
                    for (var i = [], r = 0; t > r; r++) i.push(String.fromCharCode(n[r >>> 2] >>> 24 - 8 * (r % 4) & 255));
                    return i.join("")
                },
                parse: function(t) {
                    for (var n = t.length, i = [], r = 0; n > r; r++) i[r >>> 2] |= (255 & t.charCodeAt(r)) << 24 - 8 * (r % 4);
                    return new o.init(i, n)
                }
            }, u = a.Utf8 = {
                stringify: function(t) {
                    try {
                        return decodeURIComponent(escape(h.stringify(t)))
                    } catch (n) {
                        throw Error("Malformed UTF-8 data")
                    }
                },
                parse: function(t) {
                    return h.parse(unescape(encodeURIComponent(t)))
                }
            }, f = r.BufferedBlockAlgorithm = s.extend({
                reset: function() {
                    this._data = new o.init, this._nDataBytes = 0
                },
                _append: function(t) {
                    "string" == typeof t && (t = u.parse(t)), this._data.concat(t), this._nDataBytes += t.sigBytes
                },
                _process: function(n) {
                    var i = this._data,
                        r = i.words,
                        e = i.sigBytes,
                        s = this.blockSize,
                        a = e / (4 * s),
                        a = n ? t.ceil(a) : t.max((0 | a) - this._minBufferSize, 0);
                    if (n = a * s, e = t.min(4 * n, e), n) {
                        for (var c = 0; n > c; c += s) this._doProcessBlock(r, c);
                        c = r.splice(0, n), i.sigBytes -= e
                    }
                    return new o.init(c, e)
                },
                clone: function() {
                    var t = s.clone.call(this);
                    return t._data = this._data.clone(), t
                },
                _minBufferSize: 0
            });
        r.Hasher = f.extend({
            cfg: s.extend(),
            init: function(t) {
                this.cfg = this.cfg.extend(t), this.reset()
            },
            reset: function() {
                f.reset.call(this), this._doReset()
            },
            update: function(t) {
                return this._append(t), this._process(), this
            },
            finalize: function(t) {
                return t && this._append(t), this._doFinalize()
            },
            blockSize: 16,
            _createHelper: function(t) {
                return function(n, i) {
                    return new t.init(i).finalize(n)
                }
            },
            _createHmacHelper: function(t) {
                return function(n, i) {
                    return new l.HMAC.init(t, i).finalize(n)
                }
            }
        });
        var l = i.algo = {};
        return i
    }(Math);
(function(t) {
    for (var n = CryptoJS, i = n.lib, r = i.WordArray, e = i.Hasher, i = n.algo, s = [], o = [], a = function(t) {
        return 4294967296 * (t - (0 | t)) | 0
    }, c = 2, h = 0; 64 > h;) {
        var u;
        t: {
            u = c;
            for (var f = t.sqrt(u), l = 2; f >= l; l++) if (!(u % l)) {
                u = !1;
                break t
            }
            u = !0
        }
        u && (8 > h && (s[h] = a(t.pow(c, .5))), o[h] = a(t.pow(c, 1 / 3)), h++),
        c++
    }
    var p = [],
        i = i.SHA256 = e.extend({
            _doReset: function() {
                this._hash = new r.init(s.slice(0))
            },
            _doProcessBlock: function(t, n) {
                for (var i = this._hash.words, r = i[0], e = i[1], s = i[2], a = i[3], c = i[4], h = i[5], u = i[6], f = i[7], l = 0; 64 > l; l++) {
                    if (16 > l) p[l] = 0 | t[n + l];
                    else {
                        var d = p[l - 15],
                            g = p[l - 2];
                        p[l] = ((d << 25 | d >>> 7) ^ (d << 14 | d >>> 18) ^ d >>> 3) + p[l - 7] + ((g << 15 | g >>> 17) ^ (g << 13 | g >>> 19) ^ g >>> 10) + p[l - 16]
                    }
                    d = f + ((c << 26 | c >>> 6) ^ (c << 21 | c >>> 11) ^ (c << 7 | c >>> 25)) + (c & h ^ ~c & u) + o[l] + p[l], g = ((r << 30 | r >>> 2) ^ (r << 19 | r >>> 13) ^ (r << 10 | r >>> 22)) + (r & e ^ r & s ^ e & s), f = u, u = h, h = c, c = a + d | 0, a = s, s = e, e = r, r = d + g | 0
                }
                i[0] = i[0] + r | 0, i[1] = i[1] + e | 0, i[2] = i[2] + s | 0, i[3] = i[3] + a | 0, i[4] = i[4] + c | 0, i[5] = i[5] + h | 0, i[6] = i[6] + u | 0, i[7] = i[7] + f | 0
            },
            _doFinalize: function() {
                var n = this._data,
                    i = n.words,
                    r = 8 * this._nDataBytes,
                    e = 8 * n.sigBytes;
                return i[e >>> 5] |= 128 << 24 - e % 32, i[(e + 64 >>> 9 << 4) + 14] = t.floor(r / 4294967296), i[(e + 64 >>> 9 << 4) + 15] = r, n.sigBytes = 4 * i.length, this._process(), this._hash
            },
            clone: function() {
                var t = e.clone.call(this);
                return t._hash = this._hash.clone(), t
            }
        });
    n.SHA256 = e._createHelper(i), n.HmacSHA256 = e._createHmacHelper(i)
})(Math), define("cryptojs", [], function() {
    return CryptoJS
});
define("model/usedSticon", ["model/sticonCategories", "model/SticonCategory", "common/storage", "cryptojs"], function(t, e, i, s) {
    var o = 24,
        n = "recently",
        h = "^",
        r = e.extend({
            ID: n,
            defaults: _.defaults({
                hashed_profile_id: null,
                id: n,
                items: []
            }, e.prototype.defaults),
            addUsedSticon: function(t) {
                this._removeDuplicated(t), this.get("items").unshift(t), this.get("items").length > o && this.get("items").pop(), this._save()
            },
            _removeDuplicated: function(t) {
                for (var e = 0, i = this.get("items").length; i > e; e++) if (this.get("items")[e].id === t.id) {
                    this.get("items").splice(e, 1);
                    break
                }
            },
            loadUsedSticon: function(t) {
                var e = s.SHA256(t).toString();
                this._fetch(), e !== this.get("hashed_profile_id") && this._reset(e)
            },
            _fetch: function() {
                var e = i.get(i.KEY.USED_STICON) || "",
                    s = e.split(h),
                    o = _.first(s),
                    n = _.rest(s),
                    r = _.compact(_.map(n, function(e) {
                        return t.getSticon(e)
                    }));
                this.set({
                    hashed_profile_id: o,
                    items: r
                })
            },
            _reset: function(t) {
                this._clear(), this.set("hashed_profile_id", t)
            },
            _clear: function() {
                this.set("items", []), i.clear(i.KEY.USED_STICON)
            },
            _save: function() {
                var t = _.pluck(this.get("items"), "id");
                t.unshift(this.get("hashed_profile_id")), i.set(i.KEY.USED_STICON, t.join(h), i.EXPIRES.USED_STICON)
            }
        });
    return new r
});
define("template/toastPopup", ["Handlebars"], function(t) {
    var a = function(a) {
        var e = t.template(a);
        return function(t) {
            return e(t, {
                partials: s
            })
        }
    }, s = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = a(function(t, a, s, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, t.helpers), n = n || {};
                var i = "";
                return i
            });
            return t.wrap = '<div class="bx_info">', t
        }(),
        fail: function() {
            var t = a(function(t, a, s, e, n) {
                function i(t, a) {
                    var e, n, i = "";
                    return i += ' <span class="img"><img src="', (n = s.image) ? e = n.call(t, {
                        hash: {},
                        data: a
                    }) : (n = t && t.image, e = typeof n === u ? n.call(t, {
                        hash: {},
                        data: a
                    }) : n), i += d(e) + '" width="50" height="50" alt=""></span> '
                }
                function o(t, a) {
                    var e, n, i = "";
                    return i += ' <span class="icon"><span class="ic ', (n = s.icon) ? e = n.call(t, {
                        hash: {},
                        data: a
                    }) : (n = t && t.icon, e = typeof n === u ? n.call(t, {
                        hash: {},
                        data: a
                    }) : n), i += d(e) + '"></span></span> '
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, t.helpers), n = n || {};
                var l, c, p, r = "",
                    u = "function",
                    d = this.escapeExpression,
                    h = this,
                    f = s.helperMissing;
                return l = s["if"].call(a, a && a.image, {
                    hash: {},
                    inverse: h.program(3, o, n),
                    fn: h.program(1, i, n),
                    data: n
                }), (l || 0 === l) && (r += l), r += '<p class="txt">' + d((c = s.t || a && a.t, p = {
                    hash: {},
                    data: n
                }, c ? c.call(a, "toastPopup.fail.message", p) : f.call(a, "t", "toastPopup.fail.message", p))) + '</p><div class="bn_action" data-kant-group="wrt.f"><button class="bn_reload _btnRetryWriting" data-kant-id="375">' + d((c = s.t || a && a.t, p = {
                    hash: {},
                    data: n
                }, c ? c.call(a, "toastPopup.fail.reloadButton", p) : f.call(a, "t", "toastPopup.fail.reloadButton", p))) + '</button> <button class="bn_x8 _btnHide" data-kant-id="376">' + d((c = s.t || a && a.t, p = {
                    hash: {},
                    data: n
                }, c ? c.call(a, "toastPopup.fail.cancelButton", p) : f.call(a, "t", "toastPopup.fail.cancelButton", p))) + "</button></div>"
            });
            return t
        }(),
        success: function() {
            var t = a(function(t, a, s, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, t.helpers), n = n || {};
                var i, o, l = "",
                    c = s.helperMissing,
                    p = this.escapeExpression;
                return l += '<span class="txt"><span class="ic_check2"></span></span><p class="txt">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.success.message", o) : c.call(a, "t", "toastPopup.success.message", o))) + '</p><div class="bn_action" data-kant-group="wrt.f"><button class="btn_com btn_wh _btnViewFeed" data-kant-id="377"><span>' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.success.viewButton", o) : c.call(a, "t", "toastPopup.success.viewButton", o))) + "</span></button></div>"
            });
            return t
        }(),
        searchFail: function() {
            var t = a(function(t, a, s, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, t.helpers), n = n || {};
                var i, o, l = "",
                    c = s.helperMissing,
                    p = this.escapeExpression;
                return l += '<div class="v2"><p class="txt">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.searchFail.message", o) : c.call(a, "t", "toastPopup.searchFail.message", o))) + '</p><div class="bn_action"><button class="btn_com btn_wh _btnHide" data-kant-id="493">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.searchFail.close", o) : c.call(a, "t", "toastPopup.searchFail.close", o))) + "</button></div></div>"
            });
            return t
        }(),
        profileEdited: function() {
            var t = a(function(t, a, s, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, t.helpers), n = n || {};
                var i, o, l = "",
                    c = s.helperMissing,
                    p = this.escapeExpression;
                return l += '<div class="v2"><p class="txt">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.profileEdited.message", o) : c.call(a, "t", "toastPopup.profileEdited.message", o))) + '</p><div class="bn_action"><button class="btn_com btn_wh _btnHide" data-kant-id="379">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.profileEdited.close", o) : c.call(a, "t", "toastPopup.profileEdited.close", o))) + "</button></div></div>"
            });
            return t
        }(),
        activityHidden: function() {
            var t = a(function(t, a, s, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, t.helpers), n = n || {};
                var i, o, l = "",
                    c = s.helperMissing,
                    p = this.escapeExpression;
                return l += '<div class="v2"><p class="txt">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.activityHidden.message", o) : c.call(a, "t", "toastPopup.activityHidden.message", o))) + '</p><div class="bn_action"><button class="btn_com btn_wh _btnHide" data-kant-id="494">' + p((i = s.t || a && a.t, o = {
                    hash: {},
                    data: n
                }, i ? i.call(a, "toastPopup.activityHidden.close", o) : c.call(a, "t", "toastPopup.activityHidden.close", o))) + "</button></div></div>"
            });
            return t
        }()
    }
});
define("module/static/toastPopup", ["template/toastPopup", "model/me", "common/animate"], function(t, i, e) {
    var s = 500,
        n = 2500,
        o = 70,
        h = 26,
        a = agent.type.is.mobile ? h : o,
        l = {
            FAIL: "fail",
            SUCCESS: "success",
            SEARCH_FAIL: "searchFail",
            PROFILE_EDITED: "profileEdited",
            ACTIVITY_HIDDEN: "activityHidden"
        };
    return new(space.StaticModule.extend({
        template: t.layout,
        skipGlobalEvents: !0,
        TYPE: l,
        styles: {
            icons: {
                text: "ic_txt",
                photo: "ic_photo",
                video: "ic_movie",
                music: "ic_music",
                link: "ic_link"
            }
        },
        initialize: function() {
            this._isShown = !1, this._type = null, this._options = null, this._data = null, this._$container = $("#container"), this._timer = null, this._fHide = _.bind(this.hide, this, !1)
        },
        onStop: function() {
            this._stopHideTimer()
        },
        show: function(i, o) {
            var h = {
                opacity: 0,
                top: a
            };
            this._isShown && this.hide(!0), this._type = i, this._options = o, this._data = this._getData(), this.$el.html(t[i](this._data)), this.$el.appendTo(this._$container), this.domReady(!0), this._isShown = !0, agent.type.is.mobile || _.extend(h, {
                marginLeft: this.$el.outerWidth() / 2 * -1
            }), e(this.$el.show().css(h), {
                opacity: 1
            }, s), this._type !== l.FAIL && this._type !== l.NEW_FEED && (this._timer = setTimeout(this._fHide, n))
        },
        hide: function(t) {
            var i = this;
            this._stopHideTimer(), this._isShown && (this._type = null, this._options = null, this._data = null, this._isShown = !1, this.$el.stop(), t ? this.$el.detach() : e(this.$el, {
                opacity: 0
            }).then(function() {
                i._isShown || i.$el.detach()
            }))
        },
        isShown: function() {
            return this._isShown
        },
        _getData: function() {
            switch (this._type) {
                case l.SUCCESS:
                    return {
                        link: "/" + i.get("urlKey") + "/" + this._options.activityUrlKey
                    };
                case l.FAIL:
                    return {
                        image: "",
                        icon: this._options.mode
                    }
            }
        },
        _stopHideTimer: function() {
            null !== this._timer && (clearTimeout(this._timer), this._timer = null)
        },
        events: {
            "click ._btnRetryWriting": function(t) {
                t.preventDefault(), this._isShown && this._options.writingPart.postActivity(this._options.requestData, this._options.mode)
            },
            "click ._btnHide": function(t) {
                t.preventDefault(), this._isShown && this.hide(!0)
            },
            "click ._btnViewFeed": function(t) {
                t.preventDefault(), this._isShown && (space.Router.navigate(this._data.link), this.hide(!0))
            }
        }
    }))
});
define("part/writing/PermissionLayerPart", ["template/writing", "model/Activity", "part/plugin/LayerPart", "kant"], function(e, t, i, n) {
    var a = "wrt.wpcmt",
        s = "wrt.wpenb",
        r = {};
    r[t.PERMISSION.ALL] = "wrt.wpall", r[t.PERMISSION.FRIENDS] = "wrt.wpfri", r[t.PERMISSION.ME_ONLY] = "wrt.wpme";
    var l = 4,
        o = 4,
        c = i.extend({
            template: e.permissionLayer,
            ui: {
                items: "._permissionItem",
                itemAll: "._permisionItemAll",
                radioSpan: "._permissionRadioSpan",
                shareLayer: "._shareLayer",
                commentLayer: "._commentLayer",
                enableShare: "._enableShare",
                enableShareSpan: "._enableShareSpan",
                enableAllComment: "._enableAllComment",
                enableAllCommentSpan: "._enableAllCommentSpan"
            },
            styles: {
                checked: "checked"
            },
            initialize: function() {
                i.prototype.initialize.apply(this, arguments), this._isUseReposition = !0
            },
            events: {
                "click ._permissionItem": function(e) {
                    var t = $(e.currentTarget).data("permission");
                    e.preventDefault(), this.setPermission(t), n.send(r[t]), this.trigger("change", t)
                },
                "click ._enableAllCommentSpan": function(e) {
                    var t, i = $(e.target).find("input");
                    e.currentTarget === e.target && (t = i.is(":checked") ? !1 : !0, i.prop("checked", t), this._changedCommentWritable(!t))
                },
                "click ._enableAllComment": function(e) {
                    this._changedCommentWritable(!$(e.target).is(":checked"))
                },
                "click ._enableShareSpan": function(e) {
                    var t, i = $(e.target).find("input");
                    e.currentTarget === e.target && (t = i.is(":checked") ? !1 : !0, i.prop("checked", t), this._changedSharable(t))
                },
                "click ._enableShare": function(e) {
                    this._changedSharable($(e.target).is(":checked"))
                }
            },
            _changedCommentWritable: function(e) {
                this.setEnableAllCommentWritable(e), n.send(a), this.trigger("changeCommentWritable", e)
            },
            _changedSharable: function(e) {
                this.setEnableShare(e), n.send(s), this.trigger("changeSharable", e)
            },
            setPermission: function(e) {
                var i = this.ui.items.filter("[data-permission=" + e + "]"),
                    n = i.find("._permissionRadioSpan"),
                    a = i.find("._permissionRadioInput");
                this.ui.radioSpan.removeClass(this.styles.checked), n.addClass(this.styles.checked), a.prop("checked", "true"), this.ui.commentLayer.toggle(e === t.PERMISSION.ALL), this.ui.shareLayer.toggle(e === t.PERMISSION.FRIENDS), this._isUseReposition && this.reposition({
                    $baseElement: this._$button,
                    topSideMargin: o,
                    bottomSideMargin: l
                })
            },
            setUseReposition: function(e) {
                this._isUseReposition = e
            },
            setEnableAllCommentWritable: function(e) {
                this.ui.enableAllCommentSpan.toggleClass(this.styles.checked, !e).find("input").prop("checked", !e)
            },
            setEnableShare: function(e) {
                this.ui.enableShareSpan.toggleClass(this.styles.checked, e).find("input").prop("checked", e)
            },
            toggleAllItem: function(e) {
                this.ui.itemAll.toggle(e)
            }
        });
    return c
});
define("template/decorator", ["Handlebars"], function(a) {
    var t = function(t) {
        var s = a.template(t);
        return function(a) {
            return s(a, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        profile: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<a href="/', (i = e.urlKey) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.urlKey, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-id="', (i = e.id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-profile-popup="', (i = e.id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-kant-id="49" class="_decoratedProfile">', (i = e.text) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.text, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + "</a>"
            });
            return a
        }(),
        sticon: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<span class="emoticon _sticonContainer"><img src="', (i = e.url) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.url, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" height="64px" alt=""></span>'
            });
            return a
        }(),
        sticonCover: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = e.helperMissing,
                    n = this.escapeExpression;
                return n((h = e.img || t && t.img, i = {
                    hash: {
                        src: "/img/space.png",
                        style: "width:100%;height:64px;position:absolute;left:0;top:0;",
                        "class": "_sticonCover",
                        "data-retina": "false"
                    },
                    data: l
                }, h ? h.call(t, i) : r.call(t, "img", i)))
            });
            return a
        }(),
        image: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<div><span class="pic"><a href="#" class="_viewCommentImage" data-kant-id="486"><img src="' + c((h = t && t.media, h = null == h || h === !1 ? h : h.thumbnail_url, typeof h === n ? h.apply(t) : h)) + '" width="', (i = e.width) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.width, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" height="', (i = e.height) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.height, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" alt=""><span class="line"></span></a></span></div>'
            });
            return a
        }(),
        contentProfile: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<a href="/', (i = e.urlKey) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.urlKey, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-id="', (i = e.id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-profile-popup="', (i = e.id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" class="_decoratedProfile" data-kant-id="516"><strong>', (i = e.text) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.text, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + "</strong></a>"
            });
            return a
        }(),
        contentSticon: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<div class="inp_emoticon _sticonContainer"><img src="', (i = e.url) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.url, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" height="64"></div>'
            });
            return a
        }(),
        hashtag: function() {
            var a = t(function(a, t, e, s, l) {
                function h() {
                    return "<strong>"
                }
                function i() {
                    return "</strong>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var r, n, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = this;
                return c += '<a href="/hashtag/', (n = e.tag) ? r = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.tag, r = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), c += d(r) + "/", (n = e.profileUrlKey) ? r = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.profileUrlKey, r = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), c += d(r) + "/", (n = e.activityUrlKey) ? r = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.activityUrlKey, r = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), c += d(r) + '" class="_decoratedHashtag" data-kant-id="517">', r = e["if"].call(t, t && t.isCurrentTag, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, h, l),
                    data: l
                }), (r || 0 === r) && (c += r), (n = e.text) ? r = n.call(t, {
                    hash: {},
                    data: l
                }) : (n = t && t.text, r = typeof n === o ? n.call(t, {
                    hash: {},
                    data: l
                }) : n), c += d(r), r = e["if"].call(t, t && t.isCurrentTag, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(3, i, l),
                    data: l
                }), (r || 0 === r) && (c += r), c += "</a>"
            });
            return a
        }(),
        writeSticon: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<img src="', (i = e.url) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.url, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" height="64" class="sticon _sticon" data-category-id="', (i = e.category_id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.category_id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-id="', (i = e.id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-node-id="', (i = e.nodeId) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.nodeId, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" tabindex="-1" unselectable="on" data-decorator="', (i = e.type) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.type, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '">'
            });
            return a
        }(),
        writeProfile: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<span class="profile _profile" data-id="', (i = e.id) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.id, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-decorator="', (i = e.type) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.type, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-display-name="', (i = e.text) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.text, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '">', (i = e.text) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.text, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + "</span>"
            });
            return a
        }(),
        writeHashtag: function() {
            var a = t(function(a, t, e, s, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var h, i, r = "",
                    n = "function",
                    c = this.escapeExpression;
                return r += '<span class="hashtag _hashtag" data-id="', (i = e.text) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.text, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '" data-decorator="', (i = e.type) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.type, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + '">#', (i = e.text) ? h = i.call(t, {
                    hash: {},
                    data: l
                }) : (i = t && t.text, h = typeof i === n ? i.call(t, {
                    hash: {},
                    data: l
                }) : i), r += c(h) + "</span>"
            });
            return a
        }()
    }
});
define("model/HashtagSuggestion", ["common/api", "common/jaso"], function(t, s) {
    var e = 10,
        i = 6e4;
    return space.Model.extend({
        url: "/hashtags/suggestions",
        defaults: {
            suggestions: []
        },
        initialize: function() {
            this._usedHashtagList = [], this._parsedHashtagList = []
        },
        setUsedHashtagList: function(t) {
            this._usedHashtagList = t || [], this._parsedHashtagList = this._parseHashtagList(this._usedHashtagList)
        },
        _parseHashtagList: function(t) {
            return _.map(t, function(t) {
                return s.split(t)
            })
        },
        _fetch: function(s, e, n) {
            var a = this;
            return t.request({
                url: _.result(this, "url"),
                data: {
                    text: s
                },
                responseCacheTimeout: i
            }).then(function(t) {
                return e = a._applyQueryOption(e.concat(t && t.suggestions || []), n), a.set("suggestions", e), e
            })
        },
        getSuggestionList: function(t, i) {
            var n = this,
                a = [],
                u = s.split(t);
            return i = _.defaults(i || {}, {
                maxCount: e,
                rejectList: [],
                prependList: []
            }), _.each(this._parsedHashtagList, function(t, s) {
                0 === t.indexOf(u) && a.push(n._usedHashtagList[s])
            }), a.length >= i.maxCount ? (a = this._applyQueryOption(a, i), this.set("suggestions", a), Q.resolve(a)) : this._fetch(t, a, i)
        },
        _applyQueryOption: function(t, s) {
            return t = _.union(s.prependList, t), t = _.difference(t, s.rejectList), t = _.first(t, s.maxCount), _.map(t, function(t) {
                return {
                    tag: t
                }
            })
        }
    })
});
define("common/rangeUtil", ["common/util", "common/domUtil"], function(t, e) {
    var n = function(t) {
        var e, n;
        if (arguments.length) e = document.createRange(), e.setStart(t.startContainer, t.startOffset), e.setEnd(t.endContainer, t.endOffset);
        else {
            if (n = document.getSelection(), 0 === n.rangeCount) return null;
            e = n.getRangeAt(0)
        }
        return e
    }, o = function(t, n) {
        var o, r, i, a, s, f, d = t.parentElement(),
            c = document.body.createTextRange(),
            u = e.getChildNodes(d);
        for (o = 0; o < u.length; o++) if (!e.isTextNode(u[o])) {
            if (c.moveToElementText(u[o]), c.compareEndPoints("StartToStart", t) >= 0) break;
            r = u[o]
        }
        if (0 !== o && e.isTextNode(u[o - 1])) {
            for (i = document.body.createTextRange(), i.moveToElementText(r || d), i.collapse(!r), a = r ? r.nextSibling : d.firstChild, s = t.duplicate(), s.setEndPoint("StartToStart", i), f = s.text.replace(/[\r\n]/g, "").length; f > a.nodeValue.length && a.nextSibling;) f -= a.nodeValue.length, a = a.nextSibling; {
                a.nodeValue
            }
            n && a.nextSibling && e.isTextNode(a.nextSibling) && f === a.nodeValue.length && (f -= a.nodeValue.length, a = a.nextSibling), d = a, o = f
        }
        return {
            container: d,
            offset: o
        }
    }, r = function(n, o) {
        var i, a, s;
        if (e.isTextNode(n)) a = e.listPrev(n, function(t) {
            return !e.isTextNode(t)
        }), s = _.last(a).previousSibling, n = s || n.parentNode, o += t.sum(_.tail(a), _.bind(e.getNodeLength, e)), i = !s;
        else {
            if (n = n.childNodes[o] || n, e.isTextNode(n)) return r(n, 0);
            o = 0, i = !1
        }
        return {
            container: n,
            collapseToStart: i,
            offset: o
        }
    }, i = function(t) {
        var e = document.body.createTextRange(),
            n = r(t.container, t.offset);
        return e.moveToElementText(n.container), e.collapse(n.collapseToStart), e.moveStart("character", n.offset), e
    }, a = function(t) {
        var e;
        return arguments.length ? (e = i({
            container: t.startContainer,
            offset: t.startOffset
        }), e.setEndPoint("EndToEnd", i({
            container: t.endContainer,
            offset: t.endOffset
        })), e) : document.selection.createRange()
    }, s = agent.support.w3cRange ? n : a,
        f = function() {
            var t, r, i, a, s, f;
            return agent.support.w3cRange ? (t = n(), {
                startContainer: t.startContainer,
                startOffset: t.startOffset,
                endContainer: t.endContainer,
                endOffset: t.endOffset
            }) : (r = document.selection.createRange(), a = r.duplicate(), a.collapse(!1), i = r, i.collapse(!0), s = o(i, !0), f = o(a, !1), e.isTextNode(s.container) && e.isLeftSidePoint(s) && e.isTextNode(f.container) && e.isRightSidePoint(f) && f.container.nextSibling === s.container && (s = f), {
                startContainer: s.container,
                startOffset: s.offset,
                endContainer: f.container,
                endOffset: f.offset
            })
        }, d = function(t, n) {
            this.setBoundaryPoint = function(t) {
                n.startContainer = t.container, n.startOffset = t.offset, n.endContainer = t.container, n.endOffset = t.offset
            }, this.setBoundaryPoints = function(t) {
                n.startContainer = t.startContainer, n.startOffset = t.startOffset, n.endContainer = t.endContainer, n.endOffset = t.endOffset
            }, this.getStartBoundaryPoint = function() {
                return {
                    container: n.startContainer,
                    offset: n.startOffset
                }
            }, this.getEndBoundaryPoint = function() {
                return {
                    container: n.endContainer,
                    offset: n.endOffset
                }
            }, this.sort = function() {
                var o = this.getStartBoundaryPoint(),
                    r = this.getEndBoundaryPoint(),
                    i = 1 === e.comparePoints(o, r, t);
                i && (n = {
                    startContainer: r.container,
                    startOffset: r.offset,
                    endContainer: o.container,
                    endOffset: o.offset
                })
            }, this.getStartContainer = function() {
                return n.startContainer
            }, this.getEndContainer = function() {
                return n.endContainer
            }, this.getStartOffset = function() {
                return n.startOffset
            }, this.getEndOffset = function() {
                return n.endOffset
            }, this.isCollapsed = function() {
                return n.startContainer === n.endContainer && n.startOffset === n.endOffset
            }, this.htmlText = function() {
                var t = s(n);
                return agent.support.w3cRange ? $("<div>").append(t.cloneContents()).html() : t.htmlText
            }, this.splitText = function() {
                var o = n.startContainer,
                    r = n.startOffset,
                    i = n.endContainer,
                    a = n.endOffset,
                    s = _.clone(n);
                return e.isTextNode(i) && !e.isSidePoint(this.getEndBoundaryPoint()) && i.splitText(a), e.isTextNode(o) && !e.isSidePoint(this.getStartBoundaryPoint()) && (s.startContainer = o.splitText(r), s.startOffset = 0, o === i && (s.endContainer = s.startContainer, s.endOffset = a - r), o.parentNode === t && t === i && (s.endOffset += 1)), new d(t, s)
            }, this.getNodes = function() {
                var n = [],
                    o = this.getStartBoundaryPoint(),
                    r = this.getEndBoundaryPoint(),
                    i = [];
                for (e.isLeftSidePoint(o) && (o = e.getPreviousBoundaryPointUntil(t, o, !1, function(n) {
                    return !e.isLeftSidePoint(n) || n.container === t
                })); o && (0 === o.offset && i.push(o.container), o.container !== t && e.isRightSidePoint(o) && _.contains(i, o.container) && n.push(o.container), o.container !== r.container || o.offset !== r.offset);) o = e.getNextBoundaryPoint(t, o, o.container !== r.container);
                return n
            }, this.deleteContents = function() {
                var n, o, r, i, a, s;
                return this.isCollapsed() ? this : (this.sort(), n = this.splitText(), a = n.getNodes(), s = e.listAncestor(n.getStartContainer(), t), i = -1, r = _.find(s, function(t, e) {
                    return i = e, !_.contains(a, t)
                }), o = n.getStartContainer() === r ? n.getStartBoundaryPoint() : r ? e.getPreviousBoundaryPoint(t, {
                    container: r,
                    offset: e.getPosition(s[i - 1])
                }) : n.getStartContainer() === t ? n.getStartBoundaryPoint() : {
                    container: t,
                    offset: _.last(s) ? e.getPosition(_.last(s)) : 0
                }, o || (o = {
                    container: t,
                    offset: 0
                }), _.each(a, function(t) {
                    return e.removeNode(t)
                }), new d(t, {
                    startContainer: o.container,
                    startOffset: o.offset,
                    endContainer: o.container,
                    endOffset: o.offset
                }))
            }, this.insertNode = function(n, o) {
                var r = e.splitTree(t, o ? this.getEndBoundaryPoint() : this.getStartBoundaryPoint());
                return r ? r.parentNode.insertBefore(n, r) : t.appendChild(n), n
            }, this.select = function() {
                var t, e = s(n);
                agent.support.w3cRange ? (t = document.getSelection(), t.rangeCount > 0 && t.removeAllRanges(), t.addRange(e)) : e.select()
            }, this.normalize = function() {
                var o, r = n.endContainer,
                    i = n.endOffset,
                    a = r,
                    s = r,
                    f = [],
                    d = 0,
                    c = "";
                for (r === t && (a = t.childNodes[i - 1], s = t.childNodes[i]); a && e.isTextNode(a);) f.unshift(a), c = a.nodeValue + c, d += a === r ? i : a.length, a = a.previousSibling;
                for (; s && e.isTextNode(s);) s !== r && (f.push(s), c += s.nodeValue), s = s.nextSibling;
                return f.length && (o = document.createTextNode(c), $(f[0]).before(o), _.each(f, function(t) {
                    e.removeNode(t)
                }), n = {
                    startContainer: o,
                    endContainer: o,
                    startOffset: d,
                    endOffset: d
                }, this.select()), this
            }, this.getCurrentWord = function(n) {
                var o, r, i = this.getEndContainer(),
                    a = this.getEndOffset(),
                    s = i,
                    f = i,
                    d = [],
                    c = [],
                    u = !1,
                    l = "";
                for (i === t && (s = t.childNodes[a - 1], f = t.childNodes[a]); s && e.isTextNode(s);) {
                    for (r = s === i ? a : s.nodeValue.length, o = r - 1; o >= 0; o--) {
                        if (l = s.nodeValue.charAt(o), e.isWhitespaceChar(l)) {
                            u = !0;
                            break
                        }
                        d.unshift(l)
                    }
                    if (u) break;
                    s = s.previousSibling
                }
                if (d.length || n) for (u = !1; f && e.isTextNode(f);) {
                    for (r = f === i ? a : 0, o = r; o < f.nodeValue.length; o++) {
                        if (l = f.nodeValue.charAt(o), e.isWhitespaceChar(l)) {
                            u = !0;
                            break
                        }
                        c.push(l)
                    }
                    if (u) break;
                    f = f.nextSibling
                }
                return n ? {
                    leftWord: d.join(""),
                    rightWord: c.join(""),
                    word: d.length ? d.concat(c).join("") : ""
                } : d.concat(c).join("")
            }, this.getPreviousWord = function() {
                var n, o = this.getEndBoundaryPoint(),
                    r = [];
                return e.hasCharBoundaryPoint(o) ? "" : (n = e.getPreviousBoundaryPointUntil(t, o, !1, function(n) {
                    return e.hasCharBoundaryPoint(n) && !e.hasCharBoundaryPoint(e.getNextBoundaryPoint(t, n))
                }), e.hasCharBoundaryPoint(n) ? (e.getPreviousBoundaryPointUntil(t, n, !1, function(t) {
                    var n = e.hasCharBoundaryPoint(t);
                    return n && r.unshift(t.container.nodeValue.charAt(t.offset - 1)), !n
                }), r.join("")) : "")
            }, this.getBoundingClientRect = function() {
                var t, o, r;
                return this.isCollapsed() ? (t = document.createElement("span"), t.innerHTML = e.WORD_JOINER_CHAR, this.insertNode(t), o = t.getBoundingClientRect(), t.parentNode.removeChild(t)) : (r = s(n), o = r.getBoundingClientRect()), o
            }, this.bookmark = function(t) {
                return {
                    s: {
                        path: e.makeOffsetPath(t, this.getStartContainer()),
                        offset: this.getStartOffset()
                    },
                    e: {
                        path: e.makeOffsetPath(t, this.getEndContainer()),
                        offset: this.getEndOffset()
                    }
                }
            }, this.inspect = function() {
                var t = this.getStartContainer(),
                    n = this.getStartOffset(),
                    o = this.getEndContainer(),
                    r = this.getEndOffset();
                e.isTextNode(t) ? console.log(t.nodeValue, "[" + n + "]") : console.log(t.nodeName + "." + t.className, "[" + n + "]"), e.isTextNode(o) ? console.log(o.nodeValue, "[" + r + "]") : console.log(o.nodeName + "." + o.className, "[" + r + "]")
            }
        };
    return {
        create: function(t, e) {
            return new d(t, e)
        },
        createFromPoint: function(t, e) {
            return new d(t, {
                startContainer: e.container,
                startOffset: e.offset,
                endContainer: e.container,
                endOffset: e.offset
            })
        },
        createFromSelection: function(t, e) {
            return e && t.focus(), new d(t, f())
        },
        createFromNode: function(t, n) {
            var o, r;
            return e.isImgNode(n) ? (r = e.getPosition(n), o = {
                startContainer: t,
                startOffset: r,
                endContainer: t,
                endOffset: r + 1
            }) : o = {
                startContainer: n,
                startOffset: 0,
                endContainer: n,
                endOffset: e.getNodeLength(n)
            }, new d(t, o)
        },
        createFromBookmark: function(t, n) {
            var o, r = {
                startContainer: e.fromOffsetPath(t, n.s.path),
                startOffset: n.s.offset,
                endContainer: e.fromOffsetPath(t, n.e.path),
                endOffset: n.e.offset
            };
            return r.startContainer && r.endContainer || (o = e.getNodeLength(t), r = {
                startContainer: t,
                startOffset: o,
                endContainer: t,
                endOffset: o
            }), new d(t, r)
        },
        createAfterNode: function(t, n, o) {
            var r;
            return o = o || 0, r = e.isTextNode(n) ? {
                container: n,
                offset: e.getNodeLength(n) + o
            } : {
                container: t,
                offset: e.getPosition(n) + 1
            }, agent.isIe8AndBelow() && e.isBlockNode(n) && (r.offset -= 1), new d(t, {
                startContainer: r.container,
                startOffset: r.offset,
                endContainer: r.container,
                endOffset: r.offset
            })
        },
        selectAll: function(t) {
            this.createFromNode(t, t).select()
        }
    }
});
define("common/editorUtil", ["common/domUtil", "common/rangeUtil"], function(e, r) {
    var n = "RANGE_START_MARKER_TEXT",
        t = "RANGE_END_MARKER_TEXT";
    return {
        normalize: function(e, o) {
            var a, i = r.createFromSelection(e);
            return i.insertNode(document.createTextNode(t), !0), i.insertNode(document.createTextNode(n)), e.innerHTML = e.innerHTML, a = e.innerHTML, o || this.restoreRangeAfterNormalize(e), a
        },
        removeRangeMarkerText: function(e) {
            return (e || "").replace(n, "").replace(t, "")
        },
        restoreRangeAfterNormalize: function(o) {
            for (var a, i, c = o.childNodes, d = {}, l = -1, s = -1, f = "nodeValue", m = 0, T = c.length; T > m; m++) if (i = c[m], a = i[f]) {
                if (l = a.replace(t, "").indexOf(n), s = a.replace(n, "").indexOf(t), l > -1 && (d.startContainer = i, d.startOffset = l, i[f] = i[f].replace(n, "")), s > -1 && (d.endContainer = i, d.endOffset = s, i[f] = i[f].replace(t, "")), d.startContainer && d.endContainer) break
            } else agent.browser.is.chrome && e.isTextNode(i) && o.removeChild(i);
            d.startContainer && r.create(o, d).select()
        }
    }
});
define("part/writing/EditorPart", ["template/writing", "template/decorator", "model/me", "model/HashtagSuggestion", "common/util", "common/domUtil", "common/urlUtil", "common/rangeUtil", "common/editorUtil", "common/decoratorUtil", "common/headerArea", "kant", "base64url"], function(e, t, i, o, n, r, a, s, d, l, c, h, u) {
    var g = "wrt",
        f = agent.browser.is.ie || agent.browser.is.safari,
        b = !agent.browser.is.ie,
        p = !agent.isIe10AndBelow(),
        m = agent.isIe10AndBelow() ? "" : "<br>",
        N = 100,
        C = [n.KEY.B, n.KEY.U, n.KEY.I],
        v = ["BR", "DIV", "P", "TR"],
        S = 2048,
        y = "@",
        P = "#",
        E = 20,
        w = l.DECORATOR_TEXT.STICON.length,
        A = 1,
        R = {
            START: "start",
            END: "end"
        }, T = "[KAKAO-STORY-STICON-IMAGE-{{sticonId}}]",
        x = space.Part.extend({
            template: e.editor,
            ui: {
                editable: "._editable",
                editableClone: "._editable_clone",
                placeholder: "._editorPlaceholder",
                overflowCount: "._editorOverflowCount",
                overlay: "._editorOverlay",
                clipboard: "._clipboard"
            },
            collection: null,
            initialize: function() {
                var e = "\x00-/:-@[-^`{-",
                    t = "(^|(?:\\s| |" + r.WORD_JOINER_CHAR + "|<img[^>]*?>|<br[^>]*?>)+)";
                this._hashtagPattern = new RegExp(t + "#([^" + e + "]+)", "gi"), this._hashtagSuggestion = null, this._editable = null, this._range = null, this._lastHtml = "", this._dummyTextNode = null, this._dummyChar = r.WORD_JOINER_CHAR, this._removedDummyTextNode = !1, this._isShowHashtagGuide = !1
            },
            onSetup: function() {
                this._hashtagSuggestion = new o
            },
            onRender: function() {
                this._editable = this.ui.editable[0], this.ui.editable.html(m), this.addPart("history", "part/plugin/EditorHistoryPart", {
                    selector: "._editable"
                }), this.addPart("hashtagLayer", "part/writing/HashtagLayerPart", {
                    selector: "._editorHashDropdownWrapper",
                    options: {
                        model: this._hashtagSuggestion
                    },
                    listeners: {
                        selectItem: function(e) {
                            var t;
                            e && e.tag ? (h.send(g + ".523"), this.restoreRange(), this._addHashtag(e)) : (t = document.createTextNode(r.NBSP_CHAR), s.createFromSelection(this._editable).insertNode(t), s.createAfterNode(this._editable, t).select()), this.childParts.hashtagLayer.hide()
                        }
                    }
                }), this.addPart("friendMentionLayer", "part/writing/FriendMentionLayerPart", {
                    selector: "._editorFriendDropdownWrapper",
                    options: {
                        collection: i.get("friends")
                    },
                    listeners: {
                        selectItem: function(e) {
                            h.send(g + ".149"), this.restoreRange(), this._addMention(e), this.childParts.friendMentionLayer.hide()
                        }
                    }
                }), this.addPart("placeholder", "part/plugin/PlaceholderPart", {
                    selector: "._editable",
                    options: {
                        placeholder: this.ui.placeholder
                    }
                })
            },
            events: {
                "input ._editable": function() {
                    f || this._watchContentsHandler()
                },
                "keydown ._editable": function(e) {
                    var t = this,
                        i = agent.os.is.mac ? e.metaKey : e.ctrlKey;
                    this._addDummyTextAfterSpan(e), this.childParts.friendMentionLayer.isVisible() ? e.keyCode === n.KEY.LEFT || e.keyCode === n.KEY.RIGHT ? _.defer(function() {
                        t._toggleSuggestionLayer()
                    }) : this.childParts.friendMentionLayer.handleKeydown(e.keyCode) && e.preventDefault() : this.childParts.hashtagLayer.isVisible() ? e.keyCode === n.KEY.LEFT || e.keyCode === n.KEY.RIGHT ? _.defer(function() {
                        "" === s.createFromSelection(t._editable).getCurrentWord() && t.childParts.hashtagLayer.hide()
                    }) : this.childParts.hashtagLayer.handleKeydown(e.keyCode) && e.preventDefault() : i && e.keyCode === n.KEY.ENTER ? (e.preventDefault(), this.trigger("post")) : e.keyCode === n.KEY.ENTER ? (e.preventDefault(), this._addNewline()) : e.keyCode === n.KEY.BACKSPACE ? this._backspace() && e.preventDefault() : e.keyCode === n.KEY.DELETE ? this._delete() && e.preventDefault() : i && (e.keyCode === n.KEY.Y || e.shiftKey && e.keyCode === n.KEY.Z) ? (e.preventDefault(), this.childParts.history.redo(), this._watchContentsHandler(!0), this._updateScroll()) : i && e.keyCode === n.KEY.Z ? (e.preventDefault(), this.childParts.history.undo(), this._watchContentsHandler(!0), this._updateScroll()) : i && _.contains(C, e.keyCode) ? e.preventDefault() : !b && i ? e.keyCode === n.KEY.C ? this._handleCopy().then(function(e) {
                        e.select(), t.ui.clipboard.val("")
                    }) : e.keyCode === n.KEY.X ? this._handleCopy().then(function(e) {
                        t._removeNodesOnRange(e).select(), t.ui.clipboard.val(""), t._watchContentsHandler(), t.childParts.history.record()
                    }) : e.keyCode === n.KEY.V && (this._handlePaste(), this.childParts.history.record()) : (e.keyCode === n.KEY.LEFT || e.keyCode === n.KEY.UP || e.keyCode === n.KEY.RIGHT || e.keyCode === n.KEY.DOWN) && (this._handleArrowKey(e), _.defer(function() {
                        t._toggleSuggestionLayer()
                    }))
                },
                "keypress ._editable": function(e) {
                    e.keyCode === n.KEY.SPACE && this.childParts.history.record()
                },
                "keyup ._editable": function(e) {
                    var t = this.ui.editable.html(),
                        i = this._lastHtml.length !== t.length,
                        o = [n.KEY.BACKSPACE, n.KEY.DELETE];
                    _.contains(o, e.keyCode) && i && (this.childParts.history.record(), this.saveRange()), f && i && this._watchContentsHandler(), this._addDummyTextAfterSpan(e), this._lastHtml = t
                },
                "paste ._editable": function(e) {
                    b && (this._handlePasteClipboard(e), this.childParts.history.record())
                },
                "copy ._editable": function(e) {
                    b && this._handleCopyClipboard(e)
                },
                "cut ._editable": function(e) {
                    var t = this;
                    b && this._handleCopyClipboard(e).then(function(e) {
                        e = t._removeNodesOnRange(e), e.select(), t._watchContentsHandler(), t.childParts.history.record(), t._updateScroll()
                    })
                },
                "mousedown ._editable": function(e) {
                    var t, i, o = this;
                    !agent.isIe8AndBelow() && agent.isIe10AndBelow() && (t = document.elementFromPoint(e.clientX, e.clientY), r.isImgNode(t) ? (e.preventDefault(), s.createAfterNode(o._editable, t).select()) : t === this._editable && (i = _.find(r.getChildNodes(this._editable), function(t) {
                        var i, a;
                        return r.isTextNode(t) && !n.trim(t.nodeValue) && r.isImgNode(t.previousSibling) && r.isImgNode(t.nextSibling) && (i = s.createFromNode(o._editable, t), a = i.getBoundingClientRect(), a.top <= e.clientY && e.clientY <= a.bottom && a.right < e.clientX) ? !0 : !1
                    }), i && (e.preventDefault(), s.createFromPoint(this._editable, {
                        container: i,
                        offset: r.getNodeLength(i) - 1
                    }).select())))
                },
                "controlselect,mscontrolselect ._editable": function(e) {
                    e.preventDefault()
                },
                "contextmenu ._editable": function(e) {
                    agent.browser.is.ie && e.preventDefault()
                },
                "beforedeactivate ._editable": function() {
                    agent.browser.is.ie && this.saveRange()
                },
                "focus ._editable": function() {
                    agent.browser.is.ie && !agent.isIe8AndBelow() && document.execCommand("AutoUrlDetect", !1, !1)
                },
                "click ._removeSticonBtn": function(e) {
                    var t, i = $(e.currentTarget).data("node-id"),
                        o = _.find(this._getSticonElement(), function(e) {
                            return $(e).data("node-id") === i
                        }),
                        n = o && o.previousSibling;
                    e.preventDefault(), o && ($(o).replaceWith("<br/>"), t = n ? s.createAfterNode(this._editable, n) : s.createFromPoint(this._editable, {
                        container: this._editable,
                        offset: 0
                    }), t.select(), this._displayHashtag(), this._updateOverflow(), this._updateSticonCloseBtn(), this.childParts.placeholder.update(), this.trigger("change"))
                }
            },
            _handleArrowKey: function(e) {
                var t, i, o, a, d, l, c = 0;
                !agent.isIe8AndBelow() && agent.isIe10AndBelow() && (t = s.createFromSelection(this._editable), i = t.getStartBoundaryPoint(), o = r.getLeftNodeFromPoint(this._editable, i), d = o && o.previousSibling, a = r.getRightNodeFromPoint(this._editable, i), l = a && a.nextSibling, (e.keyCode === n.KEY.LEFT || e.keyCode === n.KEY.UP) && r.isImgNode(o) && d && (e.preventDefault(), r.isTextNode(d) && (_.last(d.nodeValue) !== r.WORD_JOINER_CHAR && (d.nodeValue += r.WORD_JOINER_CHAR), c = -1), s.createAfterNode(this._editable, d, c).select()), e.keyCode !== n.KEY.RIGHT && e.keyCode !== n.KEY.DOWN || !r.isBrNode(a) || (e.preventDefault(), s.createAfterNode(this._editable, a).select()), e.keyCode !== n.KEY.RIGHT && e.keyCode !== n.KEY.DOWN || a || (a = i.container, a.nodeValue.charAt(i.offset) === r.WORD_JOINER_CHAR && s.createAfterNode(this._editable, a).select()))
            },
            _addDummyTextAfterSpan: function(e) {
                var t = s.createFromSelection(),
                    i = t.getStartBoundaryPoint(),
                    o = r.closest(i.container, r.isSpanNode),
                    a = _.bind(function() {
                        var e = !1;
                        if (this._dummyTextNode) {
                            try {
                                e = !this._dummyTextNode.parentNode || this._dummyTextNode.nodeValue.substr(0, 1) === this._dummyChar
                            } catch (t) {}
                            e && (r.removeNode(this._dummyTextNode), this._dummyTextNode = null, this._removedDummyTextNode = !0)
                        }
                    }, this);
                if ("keydown" === e.type) switch (e.keyCode) {
                    case n.KEY.ENTER:
                    case n.KEY.SPACE:
                    case n.KEY.UP:
                    case n.KEY.DOWN:
                    case n.KEY.LEFT:
                    case n.KEY.BACKSPACE:
                    case n.KEY.DELETE:
                    case n.KEY.RIGHT:
                        a();
                        break;
                    default:
                        t.isCollapsed() && a()
                }
                "keyup" === e.type && r.isRightSidePoint(i) && o && !this._removedDummyTextNode && (this._dummyTextNode = document.createTextNode(this._dummyChar), r.insertAfter(this._dummyTextNode, o), t.setBoundaryPoints({
                    startContainer: this._dummyTextNode,
                    startOffset: 0,
                    endContainer: this._dummyTextNode,
                    endOffset: 1
                }), t.select()), "keyup" === e.type && (this._removedDummyTextNode = !1)
            },
            _handlePaste: function() {
                var e = this,
                    t = s.createFromSelection(this._editable);
                this.ui.clipboard.val("").focus(), _.defer(function() {
                    t.select(), e._pasteData()
                })
            },
            _handlePasteClipboard: function(e) {
                var t = e.originalEvent.clipboardData;
                t && (e.preventDefault(), this.ui.clipboard.val(t.getData("text/plain")), this._pasteData())
            },
            _handleCopy: function() {
                var e = Q.defer(),
                    t = s.createFromSelection(this._editable),
                    i = this._replaceTextForCopy(t.htmlText());
                return this.ui.clipboard.val(i).focus(), s.selectAll(this.ui.clipboard.get(0)), _.defer(function() {
                    e.resolve(t)
                }), e.promise
            },
            _handleCopyClipboard: function(e) {
                var t, i, o = Q.defer(),
                    n = e.originalEvent.clipboardData;
                return n && (t = s.createFromSelection(this._editable), i = this._replaceTextForCopy(t.htmlText()), n.setData("text/plain", i), n.setData("text/html", i), e.preventDefault()), _.defer(function() {
                    o.resolve(t)
                }), o.promise
            },
            _pasteData: function() {
                var e, t, i = [],
                    o = s.createFromSelection(this._editable),
                    n = r.getChildNodes(this._editable),
                    a = $("<div>");
                o = this._removeNodesOnRange(o), e = o.getStartBoundaryPoint(), (agent.browser.is.chrome || agent.browser.is.firefox) && n.length <= e.offset && (e.offset = e.offset > 0 ? e.offset - 1 : e.offset, t = r.getLeftNodeFromPoint(this._editable, e), t && (o = s.createAfterNode(this._editable, t), o.select())), a.html(this._replaceTextForPaste(this.ui.clipboard.val())), this.ui.clipboard.val(""), _.each(a.find(v.join(",")), function(e) {
                    $(e).after(r.createBrNode()), r.removeNode(e, !1)
                }), _.each(a.contents(), function(e) {
                    var t, o = $(e);
                    o.hasClass("sticon") && E > this._getSticonCount() ? (t = this._getSticonSrc(o.attr("data-category-id"), o.attr("data-id")), t && o.attr("src", t), i.push(e)) : (i.push(document.createTextNode(o.text())), r.isBrNode(e) && i.push(r.createBrNode()))
                }, this), _.each(i.reverse(), function(e) {
                    o.insertNode(e)
                }), i.length ? s.createAfterNode(this._editable, _.first(i)).select() : s.createFromSelection(this._editable).select(), this._watchContentsHandler(), this._updateScroll()
            },
            _replaceTextForCopy: function(e) {
                return e.replace(/<img[^>]*?data-id=\"(.*?)\"[^>]*?>/gi, function(e, t) {
                    return T.replace("{{sticonId}}", u.encode(t))
                }).replace(/<br[^>]*>/gi, "\n")
            },
            _replaceTextForPaste: function(e) {
                var i = new RegExp("\\" + T.replace("{{sticonId}}", "(.*?)\\"), "gi");
                return e.replace(/\t/g, "    ").replace(/  /g, "  ").replace(/\r?\n/g, "<br>").replace(i, function(e, i) {
                    var o = u.decode(i),
                        n = o ? o.split(".")[0] : "";
                    return o && n ? t.writeSticon({
                        id: o,
                        category_id: n,
                        type: l.DECORATOR_TYPE.STICON,
                        nodeId: _.uniqueId("sticon-")
                    }) : ""
                })
            },
            _getSticonSrc: function(e, t) {
                var i = this.collection.get(e);
                return _.find(i.get("items"), function(e) {
                    return e.id === t
                }).url
            },
            _getSticonCount: function() {
                return this._getSticonElement().length
            },
            _getSticonElement: function(e) {
                return e = e || this.ui.editable, e.find("[data-decorator=" + l.DECORATOR_TYPE.STICON + "]")
            },
            saveRange: function(e) {
                this._range = e || s.createFromSelection(this._editable)
            },
            restoreRange: function() {
                this._range || (s.createAfterNode(this._editable, _.last(r.getChildNodes(this._editable))).select(), this._range = s.createFromSelection(this._editable)), this._range.select(), this._range = null
            },
            focus: function() {
                this.ui.editable.focus()
            },
            isFocusEditor: function() {
                return document.activeElement === this._editable
            },
            isProgress: function() {
                return this._isOverflow()
            },
            hasContent: function() {
                return this.isDomReady() && !(this.ui.editable && !this.ui.editable.text().length && 0 === this._getSticonCount())
            },
            setContent: function(e, i) {
                var o, n = /^<img/,
                    a = /(<img[^>]*>)(?:\r?\n)*(<img[^>]*>)/i,
                    d = function(e, t, i) {
                        return t + r.NBSP_CHAR + i
                    }, c = i && i.caretPosition || R.END;
                if (e = e || [], _.each(e, function(e) {
                    e.type === l.DECORATOR_TYPE.STICON && (e.nodeId = _.uniqueId("sticon-"))
                }), o = l.toMarkup(e, {
                    sticon: t.writeSticon,
                    profile: t.writeProfile
                }), o = o.replace(/(<br[^>]*>)?(<img[^>]*>)(<br[^>]*>)?/gi, function(e, t, i) {
                    return n.test(t) ? t : i
                }), agent.browser.is.ie) for (; a.test(o);) o = o.replace(a, d);
                switch (/<img[^>]*>$/g.test(o) && (o += agent.browser.is.ie ? r.NBSP_CHAR : "<br>"), this.ui.editable.html(o).focus(), this.childParts.history.setDefaultSnapshot(o), c) {
                    case R.END:
                        r.isTextNode(this._editable.lastChild) ? s.createFromPoint(this._editable, {
                            container: this._editable.lastChild,
                            offset: this._editable.lastChild.nodeValue.length
                        }).select() : s.createFromPoint(this._editable, {
                            container: this._editable,
                            offset: this._editable.childNodes.length
                        }).select();
                        break;
                    case R.START:
                        s.createFromPoint(this._editable, {
                            container: this._editable,
                            offset: 0
                        }).select()
                }
                this._watchContentsHandler(), this._updateScroll()
            },
            getContent: function() {
                return JSON.stringify(this.getDecorator())
            },
            clearContent: function() {
                this.ui.editable.html(m), this.ui.editableClone.html(""), this.childParts.placeholder.update(), this.ui.overflowCount.text("").hide(), this.ui.overlay.html(""), this.isAvailableChildPart("history") && this.childParts.history.reset()
            },
            getDecorator: function() {
                return this._displayHashtag(), l.markupToDecorator(this.ui.editableClone)
            },
            hasSticon: function() {
                return !!this._getSticonCount()
            },
            isMaxSticonCount: function() {
                return this._getSticonCount() >= E
            },
            addSticon: function(e, i) {
                var o, n, a, d, c = s.createFromSelection(this._editable);
                c = this._removeNodesOnRange(c), c.select(), this.isMaxSticonCount() || (o = c.getStartBoundaryPoint(), a = $(t.writeSticon(_.defaults(e, {
                    url: i,
                    type: l.DECORATOR_TYPE.STICON,
                    nodeId: _.uniqueId("sticon-")
                })))[0], this._deleteBr(o), this._insertNode(a), agent.browser.is.ie && r.isImgNode(a.previousSibling) && a.parentNode.insertBefore(document.createTextNode(r.NBSP_CHAR), a), c = s.createAfterNode(this._editable, a), c.select(), n = a.nextSibling, p && !r.isBlockNode(n) && _.every(r.listNext(n, r.isBlockNode), _.bind(r.isEmptyInlineNode, r)) && (d = r.createBrNode(), this._insertNode(d), agent.browser.is.ie && 11 === agent.browser.version && s.createFromPoint(this._editable, {
                    container: this._editable,
                    offset: r.getPosition(d)
                }).select()), agent.browser.is.ie && (r.insertAfter(document.createTextNode(r.NBSP_CHAR), a), c = s.createAfterNode(this._editable, a), c.select()), this.childParts.history.record(), this._watchContentsHandler())
            },
            setHashtags: function(e) {
                this._hashtagSuggestion.setUsedHashtagList(e)
            },
            setIsShowHashtagGuide: function(e) {
                this._isShowHashtagGuide = e
            },
            getAddedFriends: function() {
                var e = "[data-decorator=" + l.DECORATOR_TYPE.PROFILE + "]";
                return _.map(this.ui.editable.find(e), function(e) {
                    return $(e).attr("data-id")
                })
            },
            getAddedHashtags: function() {
                var e = "[data-decorator=" + l.DECORATOR_TYPE.HASHTAG + "]";
                return _.map(this.ui.editableClone.find(e), function(e) {
                    return $(e).attr("data-id")
                })
            },
            _insertNode: function(e) {
                this._insertNodes([e])
            },
            _insertNodes: function(e) {
                var t;
                this.isFocusEditor() || this._editable.focus(), t = s.createFromSelection(this._editable), _.each(e.reverse(), function(e) {
                    t.insertNode(e)
                }), s.createAfterNode(this._editable, _.first(e)).select()
            },
            _addNewline: function() {
                var e, t = s.createFromSelection(this._editable),
                    i = r.createBrNode();
                t = this._removeNodesOnRange(t), e = p && r.needBogusBrPoint(this._editable, t.getStartBoundaryPoint()), t.insertNode(i), s.createAfterNode(this._editable, i).select(), e && this._insertNode(r.createBrNode()), this.childParts.history.record(), this._watchContentsHandler(), this._updateScroll()
            },
            _backspace: function() {
                var e = s.createFromSelection(this._editable),
                    t = e.getStartBoundaryPoint(),
                    i = !1,
                    o = r.getLeftNodeFromPoint(this._editable, t);
                return e.isCollapsed() ? r.isSpanNode(o) ? (r.removeNode(o, !0), i = !0) : agent.browser.is.chrome ? r.isImgNode(o) && (o.parentNode.removeChild(o), i = !0) : agent.browser.is.ie && (agent.isIe10AndBelow() && !agent.isIe8AndBelow() && r.isTextNode(t.container) && r.isImgNode(t.container.previousSibling) && 1 === t.offset && (t.container.nodeValue.substring(0, 1) === r.WORD_JOINER_CHAR ? (r.removeNode(t.container.previousSibling), t.container.nodeValue = t.container.nodeValue.substring(1)) : (t.container.nodeValue = t.container.nodeValue.length > 1 ? t.container.nodeValue.substring(1) : r.NBSP_CHAR, r.isWhitespaceChar(t.container.nodeValue.substring(0, 1)) && (this._insertNode(r.createWordJoinerTextNode()), s.createAfterNode(this._editable, t.container.previousSibling))), i = !0), agent.isIe10AndBelow() && !agent.isIe8AndBelow() && r.isTextNode(t.container) && t.container.nodeValue.charAt(t.offset - 1) === r.WORD_JOINER_CHAR && (t.container.nodeValue = t.container.nodeValue.substring(0, t.offset - 1), s.createAfterNode(this._editable, t.container.nodeValue)), r.isNbspTextNode(o) && r.isImgNode(o.previousSibling) && (o.parentNode.removeChild(o.previousSibling), o.parentNode.removeChild(o), i = !0)) : (e = this._removeNodesOnRange(e), e.select(), i = !0), i && (this.childParts.history.record(), this._watchContentsHandler()), i
            },
            _delete: function() {
                var e = s.createFromSelection(this._editable),
                    t = e.getStartBoundaryPoint(),
                    i = !1,
                    o = r.getRightNodeFromPoint(this._editable, t);
                return e.isCollapsed() ? r.isSpanNode(o) ? (r.removeNode(o, !0), i = !0) : agent.browser.is.chrome || agent.browser.is.firefox ? r.isImgNode(o) && (o.parentNode.removeChild(o), i = !0) : agent.browser.is.ie && (r.isImgNode(o) && r.isNbspTextNode(o.nextSibling) && (o.parentNode.removeChild(o.nextSibling), o.parentNode.removeChild(o), i = !0), agent.isIe10AndBelow() && !agent.isIe8AndBelow() && r.isTextNode(t.container) && t.container.nodeValue.charAt(t.offset) === r.WORD_JOINER_CHAR && (t.container.nodeValue = t.container.nodeValue.substring(0, t.offset), s.createAfterNode(this._editable, t.container.nodeValue))) : (e = this._removeNodesOnRange(e), e.select(), i = !0), i && (this.childParts.history.record(), this._watchContentsHandler()), this._updateScroll(), i
            },
            _removeNodesOnRange: function(e) {
                var t, i, o = e.getStartBoundaryPoint(),
                    n = e.getEndBoundaryPoint(),
                    a = !1;
                return t = r.closest(o.container, r.isSpanNode), !r.isSidePoint(o) && t && (r.removeNode(t), a = !0), i = r.closest(n.container, r.isSpanNode), !r.isSidePoint(n) && i && (t === i && a || r.removeNode(i)), e = e.deleteContents(), this.ui.editable.html() || this.ui.editable.html(m), e
            },
            _updateScroll: function() {
                var e = s.createFromSelection(this._editable),
                    t = e.getBoundingClientRect(),
                    i = $(window),
                    o = i.scrollTop(),
                    n = i.height(),
                    a = c.getBottom();
                t.bottom > n ? r.scrollTo(o + t.bottom - n / 2) : t.top <= a && r.scrollTo(o - n / 2 + a)
            },
            _addMention: function(e) {
                var i, o, n, a, c = $(t.writeProfile({
                    id: e.get("id"),
                    text: e.get("display_name"),
                    type: l.DECORATOR_TYPE.PROFILE
                })),
                    h = c[0],
                    u = !1,
                    _ = "";
                d.normalize(this._editable), this._insertNode(h), i = h.previousSibling, o = h.nextSibling, i && r.isTextNode(i) && (n = i.nodeValue, i.nodeValue = n.substring(0, n.lastIndexOf(y))), o && r.isTextNode(o) ? (a = o.nodeValue, o.nodeValue = a.replace(new RegExp("^[^\\s" + r.NBSP_CHAR + "]+"), ""), _ = o.nodeValue.charAt(0), u = !r.isWhitespaceChar(_)) : u = !0, u && r.insertAfter(document.createTextNode(r.NBSP_CHAR), h), r.isTextNode(h.nextSibling) && s.createFromPoint(this._editable, {
                    container: h.nextSibling,
                    offset: 1
                }).select(), this.childParts.history.record(), this._watchContentsHandler(!1, !0)
            },
            _addHashtag: function(e) {
                var t, i, o, n, a, l, c = !1,
                    h = this,
                    u = function(e, t) {
                        s.createFromPoint(this._editable, {
                            container: e,
                            offset: t
                        }).select(), h.childParts.history.record(), h._watchContentsHandler()
                    };
                this.isFocusEditor() || this._editable.focus(), d.normalize(this._editable), t = s.createFromSelection(this._editable), i = t.getEndContainer(), o = t.getEndOffset(), n = i.nodeValue, n && (a = n.substring(0, o), l = n.substring(o), a = a.substring(0, a.lastIndexOf(P)), l ? (l = l.replace(new RegExp("^[^\\s" + r.NBSP_CHAR + "]+"), ""), c = !r.isWhitespaceChar(l.charAt(0))) : c = !0, i.nodeValue = a + "#" + e.tag + (c ? r.NBSP_CHAR : "") + l, o = i.nodeValue.length - l.length + (!c && l ? 1 : 0), agent.isNativeAndroidBrowser() ? _.delay(function() {
                    u(i, o)
                }, 100) : u(i, o))
            },
            _displayHashtag: function() {
                var e, i = this.ui.editable.html();
                this._hashtagPattern.lastIndex = 0, e = i.replace(this._hashtagPattern, function(e, i, o) {
                    var n;
                    return o && /[^\d]/.test(o) ? (n = o.substring(0, N), (i || "") + t.writeHashtag({
                        text: n,
                        type: l.DECORATOR_TYPE.HASHTAG
                    }) + o.substring(N)) : e
                }), agent.isIe8AndBelow() && (e = e.replace(/<br(?:[\s\/][^>]*)?>/gi, "<br/>" + r.WORD_JOINER_CHAR)), this.ui.editableClone.html(e), agent.isIe10AndBelow() && !agent.isIe8AndBelow() && (_.each(this._getSticonElement(this.ui.editableClone), function(e) {
                    r.isBrNode(e.previousSibling) && e.parentNode.insertBefore(r.createBrNode(), e)
                }), r.isBrNode(_.last(r.getChildNodes(this.ui.editableClone[0]))) && this.ui.editableClone[0].appendChild(r.createWordJoinerTextNode()))
            },
            _toggleSuggestionLayer: function(e) {
                var t, i, o = s.createFromSelection(this._editable),
                    n = o.getCurrentWord(!0),
                    a = n.leftWord.charAt(0),
                    d = o.getStartBoundaryPoint(),
                    l = d.container && 1 === d.offset && r.isSpanNode(d.container.previousSibling);
                l || a !== P && a !== y ? (this.childParts.friendMentionLayer.hide(), this.childParts.hashtagLayer.hide()) : (this.saveRange(o), i = agent.isNativeAndroidBrowser() ? {
                    isFixed: !0,
                    containerHeight: this.$el.height()
                } : {
                    range: o,
                    containerTop: this._getEditorTop()
                }, a === y ? (t = n.leftWord.length > 1 ? n.leftWord.substring(1) : "", this.childParts.friendMentionLayer.show(t, {
                    rejectList: this.getAddedFriends(),
                    layerPosition: i
                })) : e && (t = n.word.length > 1 ? n.word.substring(1) : "", this.childParts.hashtagLayer.show(t, {
                    rejectList: this.getAddedHashtags(),
                    layerPosition: i,
                    isShowGuide: this._isShowHashtagGuide
                })))
            },
            _watchContentsHandler: function(e) {
                var t = s.createFromSelection(this._editable),
                    i = t.getPreviousWord();
                this._removeLinkNode(), a.hasUrl(i) && this.trigger("detectUrl", i), this._checkAndRemoveProfileDecorator(t), this._displayHashtag(), this._updateOverflow(), this._updateSticonCloseBtn(), this.childParts.placeholder.update(), e || this._toggleSuggestionLayer(!0), this.trigger("change")
            },
            _removeLinkNode: function() {
                agent.isIe8AndBelow() && _.each(this.ui.editable.find("a"), function(e) {
                    r.removeNode(e, !1)
                })
            },
            _checkAndRemoveProfileDecorator: function(e) {
                var t, i = e.getStartBoundaryPoint(),
                    o = r.closest(i.container, r.isSpanNode);
                !r.isLeftSidePoint(i) && o && (t = $(o), t.text() !== t.attr("data-display-name") && (r.removeNode(o), e.select()))
            },
            _isOverflow: function() {
                return this._getOverflowCount() > 0
            },
            _getStringCount: function() {
                var e = this.ui.editable.contents(),
                    t = e[e.length - 1],
                    i = e[e.length - 2],
                    o = n.replaceAll(this.ui.editable.text(), r.WORD_JOINER_CHAR, "").length,
                    a = this.ui.editable.find("br").length * A,
                    s = n.sum(this._getSticonElement(this.ui.editable), function(e) {
                        var t = 0;
                        return l.needNewline(e.previousSibling, !0) && (t += A), l.needNewline(e.nextSibling) && (t += A), t + w
                    });
                return r.isBrNode(t) && (a -= A), (r.isImgNode(t) || (r.isBrNode(t) || r.isWordJoinerTextNode(t)) && r.isImgNode(i)) && (s -= A), o + a + s
            },
            _getOverflowCount: function() {
                return Math.max(this._getStringCount() - S)
            },
            _updateOverflow: function() {
                var t, i, o, a, s, d = 0,
                    c = [],
                    h = !1;
                if (this._isOverflow()) {
                    i = this._getOverflowCount(), this.ui.overflowCount.text(-1 * i).show(), o = this.ui.editableClone.contents(), s = o.length - 1;
                    for (var u = s; u >= 0; u--) {
                        if (t = $(o[u]), h = u === s && r.isBrNode(o[u]), r.isTextNode(o[u])) d = n.replaceAll(t.text(), r.WORD_JOINER_CHAR, "").length, a = d > i ? o[u].splitText(d - i) : o[u];
                        else switch (o[u].nodeName.toUpperCase()) {
                            case "IMG":
                                d = w, l.needNewline(o[u].previousSibling, !0) && (d += A), u !== s && h && u !== s - 1 && l.needNewline(o[u].nextSibling) && (d += A), i = d >= i ? 0 : i, a = o[u];
                                break;
                            case "BR":
                                u !== s && (d = A, a = o[u]);
                                break;
                            case "SPAN":
                                d = t.text().length, a = o[u], t.hasClass(l.DECORATOR_TYPE.PROFILE) ? i = d >= i ? 0 : i : t.hasClass(l.DECORATOR_TYPE.HASHTAG) && d > i && (a = t.contents().length > 0 ? t.contents()[0].splitText(d - i) : null)
                        }
                        if (i -= d, a && (c.push(a), a = null), 0 >= i) break
                    }
                    $(c).wrap(e.overflowArea())
                } else this.ui.overflowCount.hide()
            },
            _getEditorTop: function() {
                return this.$el[0].getBoundingClientRect().top
            },
            _addSticonCloseBtn: function(t) {
                var i = $(e.sticonRemoveBtn({
                    top: t.position().top,
                    left: t.width()
                }));
                i.attr("data-node-id", t.data("node-id")).appendTo(this.ui.overlay)
            },
            _updateSticonCloseBtn: function() {
                var e = this;
                this.ui.overlay.html(""), _.each(this._getSticonElement(), function(t) {
                    var i = $(t);
                    i.width() ? e._addSticonCloseBtn(i) : i.one("load", function() {
                        e._addSticonCloseBtn(i)
                    })
                })
            },
            _deleteBr: function(e) {
                var t = [],
                    i = this,
                    o = r.getChildNodes(this._editable),
                    n = r.getLeftNodeFromPoint(this._editable, e),
                    a = r.getRightNodeFromPoint(this._editable, e),
                    d = n && n.previousSibling;
                r.isTextNode(e.container) ? (agent.isIe8AndBelow() && (d = n && n.previousSibling, r.isBrNode(d) && r.isBrNode(n) && t.push(d)), r.isBrNode(n) && t.push(n)) : ((agent.browser.is.chrome || agent.browser.is.firefox) && o.length <= e.offset && (e.offset = e.offset > 0 ? e.offset - 1 : e.offset, n = r.getLeftNodeFromPoint(this._editable, e), n && (s.createAfterNode(this._editable, n).select(), d = n && n.previousSibling)), agent.isIe10AndBelow() ? r.isBrNode(n) && t.push(n) : !r.isBlockNode(d) && r.isBrNode(n) && t.push(n)), r.isBrNode(a) && t.push(a), _.each(t, function(e) {
                    i._editable.removeChild(e)
                })
            }
        });
    return x.CARET_POSITION = R, x
});
define("common/imgUtil", [], function() {
    var t = /(\/public\/images\/default\/not_supported_image|\/img\/img_failed)/i;
    return {
        resize: function(t, i, e) {
            var a, r = Q.defer(),
                h = this,
                o = "";
            i = i || t.parent() || t, e = _.defaults(e || {}, {
                url: null,
                isCrop: !0,
                target: t,
                verticalAlign: "middle",
                horizontalAlign: "center",
                autoResizeHeight: !1,
                fitWidth: !1,
                expand: !0,
                longHeightRatio: 0
            });
            var n = function(a, o) {
                var n;
                a && o && (e.width = a, e.height = o), n = h._resize(t, i, e), r.resolve(n)
            };
            return o = null !== e.url ? e.url : t.attr("src"), a = t.attr("src"), t.attr("data-src") && o === t.attr("data-src") ? n(t.attr("data-width"), t.attr("data-height")) : a && "about:blank" !== a || e.url ? (t.hide().css({
                width: "auto",
                height: "auto"
            }).one("load", function(i) {
                var e, a;
                t.off("abort error"), agent.isIe10AndBelow() ? (e = t.width(), a = t.height()) : (e = i.target.width, a = i.target.height), n(e, a)
            }).one("abort error", function(i) {
                t.off("load"), r.reject(i)
            }), e.url && a !== e.url && t.css({
                width: "auto",
                height: "auto"
            }).attr("src", e.url)) : (t.css("display", "none"), r.reject()), r.promise
        },
        _resize: function(i, e, a) {
            var r, h, o, n, d, g, s, l, c = a.width || i.width(),
                u = a.height || i.height(),
                f = a.containerWidth || e.width(),
                p = a.containerHeight || e.height(),
                w = a.target,
                m = !1;
            switch (a.longHeightRatio && u / c >= a.longHeightRatio && u > p && (a.isCrop = !0, m = !0), g = f / c, s = p / u, d = a.fitWidth ? !0 : a.isCrop ? g >= s : s >= g, d ? (r = a.expand ? f : Math.min(c, f), h = u * r / c) : (h = a.expand ? p : Math.min(u, p), r = c * h / u), r = Math.round(r), h = Math.round(h), a.autoResizeHeight && p > h && (e.height(h), p = h), n = m || "top" === a.verticalAlign ? 0 : "bottom" === a.verticalAlign ? p - h : p / 2 - h / 2, a.horizontalAlign) {
                case "left":
                    o = 0;
                    break;
                case "center":
                    o = f / 2 - r / 2;
                    break;
                case "right":
                    o = f - r
            }
            return n = Math.round(n), o = Math.round(o), w && i.css("display", ""), i.css("position", "absolute"), l = i.attr("src"), c && u && i.attr({
                "data-src": l,
                "data-width": c,
                "data-height": u
            }), t.test(l) && (r = c / 2, h = u / 2, n = p / 2 - h / 2, o = f / 2 - r / 2), a.target !== !1 && w.css({
                width: r,
                height: h,
                top: n,
                left: o
            }), {
                width: r,
                height: h,
                originalWidth: c,
                originalHeight: u,
                isLongHeight: m
            }
        }
    }
});
var SWFUpload;
void 0 == SWFUpload && (SWFUpload = function(t) {
    this.initSWFUpload(t)
}), SWFUpload.prototype.initSWFUpload = function(t) {
    try {
        this.customSettings = {}, this.settings = t, this.eventQueue = [], this.movieName = "SWFUpload_" + SWFUpload.movieCount++, this.movieElement = null, SWFUpload.instances[this.movieName] = this, this.initSettings(), this.loadFlash(), this.displayDebugInfo()
    } catch (e) {
        throw delete SWFUpload.instances[this.movieName], e
    }
}, SWFUpload.instances = {}, SWFUpload.movieCount = 0, SWFUpload.version = "2.2.0 2009-03-25", SWFUpload.QUEUE_ERROR = {
    QUEUE_LIMIT_EXCEEDED: -100,
    FILE_EXCEEDS_SIZE_LIMIT: -110,
    ZERO_BYTE_FILE: -120,
    INVALID_FILETYPE: -130
}, SWFUpload.UPLOAD_ERROR = {
    HTTP_ERROR: -200,
    MISSING_UPLOAD_URL: -210,
    IO_ERROR: -220,
    SECURITY_ERROR: -230,
    UPLOAD_LIMIT_EXCEEDED: -240,
    UPLOAD_FAILED: -250,
    SPECIFIED_FILE_ID_NOT_FOUND: -260,
    FILE_VALIDATION_FAILED: -270,
    FILE_CANCELLED: -280,
    UPLOAD_STOPPED: -290
}, SWFUpload.FILE_STATUS = {
    QUEUED: -1,
    IN_PROGRESS: -2,
    ERROR: -3,
    COMPLETE: -4,
    CANCELLED: -5
}, SWFUpload.BUTTON_ACTION = {
    SELECT_FILE: -100,
    SELECT_FILES: -110,
    START_UPLOAD: -120
}, SWFUpload.CURSOR = {
    ARROW: -1,
    HAND: -2
}, SWFUpload.WINDOW_MODE = {
    WINDOW: "window",
    TRANSPARENT: "transparent",
    OPAQUE: "opaque"
}, SWFUpload.completeURL = function(t) {
    if ("string" != typeof t || t.match(/^https?:\/\//i) || t.match(/^\//)) return t;
    var e = (window.location.protocol + "//" + window.location.hostname + (window.location.port ? ":" + window.location.port : ""), window.location.pathname.lastIndexOf("/"));
    return path = 0 >= e ? "/" : window.location.pathname.substr(0, e) + "/", path + t
}, SWFUpload.prototype.initSettings = function() {
    this.ensureDefault = function(t, e) {
        this.settings[t] = void 0 == this.settings[t] ? e : this.settings[t]
    }, this.ensureDefault("upload_url", ""), this.ensureDefault("preserve_relative_urls", !1), this.ensureDefault("file_post_name", "Filedata"), this.ensureDefault("post_params", {}), this.ensureDefault("use_query_string", !1), this.ensureDefault("requeue_on_error", !1), this.ensureDefault("http_success", []), this.ensureDefault("assume_success_timeout", 0), this.ensureDefault("file_types", "*.*"), this.ensureDefault("file_types_description", "All Files"), this.ensureDefault("file_size_limit", 0), this.ensureDefault("file_upload_limit", 0), this.ensureDefault("file_queue_limit", 0), this.ensureDefault("flash_url", "swfupload.swf"), this.ensureDefault("prevent_swf_caching", !0), this.ensureDefault("button_image_url", ""), this.ensureDefault("button_width", 1), this.ensureDefault("button_height", 1), this.ensureDefault("button_text", ""), this.ensureDefault("button_text_style", "color: #000000; font-size: 16pt;"), this.ensureDefault("button_text_top_padding", 0), this.ensureDefault("button_text_left_padding", 0), this.ensureDefault("button_action", SWFUpload.BUTTON_ACTION.SELECT_FILES), this.ensureDefault("button_disabled", !1), this.ensureDefault("button_placeholder_id", ""), this.ensureDefault("button_placeholder", null), this.ensureDefault("button_cursor", SWFUpload.CURSOR.ARROW), this.ensureDefault("button_window_mode", SWFUpload.WINDOW_MODE.WINDOW), this.ensureDefault("debug", !1), this.settings.debug_enabled = this.settings.debug, this.settings.return_upload_start_handler = this.returnUploadStart, this.ensureDefault("swfupload_loaded_handler", null), this.ensureDefault("file_dialog_start_handler", null), this.ensureDefault("file_queued_handler", null), this.ensureDefault("file_queue_error_handler", null), this.ensureDefault("file_dialog_complete_handler", null), this.ensureDefault("upload_start_handler", null), this.ensureDefault("upload_progress_handler", null), this.ensureDefault("upload_error_handler", null), this.ensureDefault("upload_success_handler", null), this.ensureDefault("upload_complete_handler", null), this.ensureDefault("debug_handler", this.debugMessage), this.ensureDefault("custom_settings", {}), this.customSettings = this.settings.custom_settings, this.settings.prevent_swf_caching && (this.settings.flash_url = this.settings.flash_url + (this.settings.flash_url.indexOf("?") < 0 ? "?" : "&") + "preventswfcaching=" + (new Date).getTime()), this.settings.preserve_relative_urls || (this.settings.upload_url = SWFUpload.completeURL(this.settings.upload_url), this.settings.button_image_url = SWFUpload.completeURL(this.settings.button_image_url)), delete this.ensureDefault
}, SWFUpload.prototype.loadFlash = function() {
    var t, e;
    if (null !== document.getElementById(this.movieName)) throw "ID " + this.movieName + " is already in use. The Flash Object could not be added";
    if (t = document.getElementById(this.settings.button_placeholder_id) || this.settings.button_placeholder, void 0 == t) throw "Could not find the placeholder element: " + this.settings.button_placeholder_id;
    e = document.createElement("div"), e.innerHTML = this.getFlashHTML(), t.parentNode.replaceChild(e.firstChild, t), void 0 == window[this.movieName] && (window[this.movieName] = this.getMovieElement())
}, SWFUpload.prototype.getFlashHTML = function() {
    return ['<object id="', this.movieName, '" type="application/x-shockwave-flash" data="', this.settings.flash_url, '" width="', this.settings.button_width, '" height="', this.settings.button_height, '" class="swfupload">', '<param name="wmode" value="', this.settings.button_window_mode, '" />', '<param name="movie" value="', this.settings.flash_url, '" />', '<param name="quality" value="high" />', '<param name="menu" value="false" />', '<param name="allowScriptAccess" value="always" />', '<param name="flashvars" value="' + this.getFlashVars() + '" />', "</object>"].join("")
}, SWFUpload.prototype.getFlashVars = function() {
    var t = this.buildParamString(),
        e = this.settings.http_success.join(",");
    return ["movieName=", encodeURIComponent(this.movieName), "&uploadURL=", encodeURIComponent(this.settings.upload_url), "&useQueryString=", encodeURIComponent(this.settings.use_query_string), "&requeueOnError=", encodeURIComponent(this.settings.requeue_on_error), "&httpSuccess=", encodeURIComponent(e), "&assumeSuccessTimeout=", encodeURIComponent(this.settings.assume_success_timeout), "&params=", encodeURIComponent(t), "&filePostName=", encodeURIComponent(this.settings.file_post_name), "&fileTypes=", encodeURIComponent(this.settings.file_types), "&fileTypesDescription=", encodeURIComponent(this.settings.file_types_description), "&fileSizeLimit=", encodeURIComponent(this.settings.file_size_limit), "&fileUploadLimit=", encodeURIComponent(this.settings.file_upload_limit), "&fileQueueLimit=", encodeURIComponent(this.settings.file_queue_limit), "&debugEnabled=", encodeURIComponent(this.settings.debug_enabled), "&buttonImageURL=", encodeURIComponent(this.settings.button_image_url), "&buttonWidth=", encodeURIComponent(this.settings.button_width), "&buttonHeight=", encodeURIComponent(this.settings.button_height), "&buttonText=", encodeURIComponent(this.settings.button_text), "&buttonTextTopPadding=", encodeURIComponent(this.settings.button_text_top_padding), "&buttonTextLeftPadding=", encodeURIComponent(this.settings.button_text_left_padding), "&buttonTextStyle=", encodeURIComponent(this.settings.button_text_style), "&buttonAction=", encodeURIComponent(this.settings.button_action), "&buttonDisabled=", encodeURIComponent(this.settings.button_disabled), "&buttonCursor=", encodeURIComponent(this.settings.button_cursor)].join("")
}, SWFUpload.prototype.getMovieElement = function() {
    if (void 0 == this.movieElement && (this.movieElement = document.getElementById(this.movieName)), null === this.movieElement) throw "Could not find Flash element";
    return this.movieElement
}, SWFUpload.prototype.buildParamString = function() {
    var t = this.settings.post_params,
        e = [];
    if ("object" == typeof t) for (var s in t) t.hasOwnProperty(s) && e.push(encodeURIComponent(s.toString()) + "=" + encodeURIComponent(t[s].toString()));
    return e.join("&")
}, SWFUpload.prototype.destroy = function() {
    try {
        this.cancelUpload(null, !1);
        var t = null;
        if (t = this.getMovieElement(), t && "unknown" == typeof t.CallFunction) {
            for (var e in t) try {
                "function" == typeof t[e] && (t[e] = null)
            } catch (s) {}
            try {
                t.parentNode.removeChild(t)
            } catch (n) {}
        }
        return window[this.movieName] = null, SWFUpload.instances[this.movieName] = null, delete SWFUpload.instances[this.movieName], this.movieElement = null, this.settings = null, this.customSettings = null, this.eventQueue = null, this.movieName = null, !0
    } catch (i) {
        return !1
    }
}, SWFUpload.prototype.displayDebugInfo = function() {
    this.debug(["---SWFUpload Instance Info---\n", "Version: ", SWFUpload.version, "\n", "Movie Name: ", this.movieName, "\n", "Settings:\n", "	", "upload_url:               ", this.settings.upload_url, "\n", "	", "flash_url:                ", this.settings.flash_url, "\n", "	", "use_query_string:         ", this.settings.use_query_string.toString(), "\n", "	", "requeue_on_error:         ", this.settings.requeue_on_error.toString(), "\n", "	", "http_success:             ", this.settings.http_success.join(", "), "\n", "	", "assume_success_timeout:   ", this.settings.assume_success_timeout, "\n", "	", "file_post_name:           ", this.settings.file_post_name, "\n", "	", "post_params:              ", this.settings.post_params.toString(), "\n", "	", "file_types:               ", this.settings.file_types, "\n", "	", "file_types_description:   ", this.settings.file_types_description, "\n", "	", "file_size_limit:          ", this.settings.file_size_limit, "\n", "	", "file_upload_limit:        ", this.settings.file_upload_limit, "\n", "	", "file_queue_limit:         ", this.settings.file_queue_limit, "\n", "	", "debug:                    ", this.settings.debug.toString(), "\n", "	", "prevent_swf_caching:      ", this.settings.prevent_swf_caching.toString(), "\n", "	", "button_placeholder_id:    ", this.settings.button_placeholder_id.toString(), "\n", "	", "button_placeholder:       ", this.settings.button_placeholder ? "Set" : "Not Set", "\n", "	", "button_image_url:         ", this.settings.button_image_url.toString(), "\n", "	", "button_width:             ", this.settings.button_width.toString(), "\n", "	", "button_height:            ", this.settings.button_height.toString(), "\n", "	", "button_text:              ", this.settings.button_text.toString(), "\n", "	", "button_text_style:        ", this.settings.button_text_style.toString(), "\n", "	", "button_text_top_padding:  ", this.settings.button_text_top_padding.toString(), "\n", "	", "button_text_left_padding: ", this.settings.button_text_left_padding.toString(), "\n", "	", "button_action:            ", this.settings.button_action.toString(), "\n", "	", "button_disabled:          ", this.settings.button_disabled.toString(), "\n", "	", "custom_settings:          ", this.settings.custom_settings.toString(), "\n", "Event Handlers:\n", "	", "swfupload_loaded_handler assigned:  ", ("function" == typeof this.settings.swfupload_loaded_handler).toString(), "\n", "	", "file_dialog_start_handler assigned: ", ("function" == typeof this.settings.file_dialog_start_handler).toString(), "\n", "	", "file_queued_handler assigned:       ", ("function" == typeof this.settings.file_queued_handler).toString(), "\n", "	", "file_queue_error_handler assigned:  ", ("function" == typeof this.settings.file_queue_error_handler).toString(), "\n", "	", "upload_start_handler assigned:      ", ("function" == typeof this.settings.upload_start_handler).toString(), "\n", "	", "upload_progress_handler assigned:   ", ("function" == typeof this.settings.upload_progress_handler).toString(), "\n", "	", "upload_error_handler assigned:      ", ("function" == typeof this.settings.upload_error_handler).toString(), "\n", "	", "upload_success_handler assigned:    ", ("function" == typeof this.settings.upload_success_handler).toString(), "\n", "	", "upload_complete_handler assigned:   ", ("function" == typeof this.settings.upload_complete_handler).toString(), "\n", "	", "debug_handler assigned:             ", ("function" == typeof this.settings.debug_handler).toString(), "\n"].join(""))
}, SWFUpload.prototype.addSetting = function(t, e, s) {
    return this.settings[t] = void 0 == e ? s : e
}, SWFUpload.prototype.getSetting = function(t) {
    return void 0 != this.settings[t] ? this.settings[t] : ""
}, SWFUpload.prototype.callFlash = function(functionName, argumentArray) {
    argumentArray = argumentArray || [];
    var movieElement = this.getMovieElement(),
        returnValue, returnString;
    try {
        returnString = movieElement.CallFunction('<invoke name="' + functionName + '" returntype="javascript">' + __flash__argumentsToXML(argumentArray, 0) + "</invoke>"), returnValue = eval(returnString)
    } catch (ex) {
        throw "Call to " + functionName + " failed"
    }
    return void 0 != returnValue && "object" == typeof returnValue.post && (returnValue = this.unescapeFilePostParams(returnValue)), returnValue
}, SWFUpload.prototype.selectFile = function() {
    this.callFlash("SelectFile")
}, SWFUpload.prototype.selectFiles = function() {
    this.callFlash("SelectFiles")
}, SWFUpload.prototype.startUpload = function(t) {
    this.callFlash("StartUpload", [t])
}, SWFUpload.prototype.cancelUpload = function(t, e) {
    e !== !1 && (e = !0), this.callFlash("CancelUpload", [t, e])
}, SWFUpload.prototype.stopUpload = function() {
    this.callFlash("StopUpload")
}, SWFUpload.prototype.getStats = function() {
    return this.callFlash("GetStats")
}, SWFUpload.prototype.setStats = function(t) {
    this.callFlash("SetStats", [t])
}, SWFUpload.prototype.getFile = function(t) {
    return "number" == typeof t ? this.callFlash("GetFileByIndex", [t]) : this.callFlash("GetFile", [t])
}, SWFUpload.prototype.addFileParam = function(t, e, s) {
    return this.callFlash("AddFileParam", [t, e, s])
}, SWFUpload.prototype.removeFileParam = function(t, e) {
    this.callFlash("RemoveFileParam", [t, e])
}, SWFUpload.prototype.setUploadURL = function(t) {
    this.settings.upload_url = t.toString(), this.callFlash("SetUploadURL", [t])
}, SWFUpload.prototype.setPostParams = function(t) {
    this.settings.post_params = t, this.callFlash("SetPostParams", [t])
}, SWFUpload.prototype.addPostParam = function(t, e) {
    this.settings.post_params[t] = e, this.callFlash("SetPostParams", [this.settings.post_params])
}, SWFUpload.prototype.removePostParam = function(t) {
    delete this.settings.post_params[t], this.callFlash("SetPostParams", [this.settings.post_params])
}, SWFUpload.prototype.setFileTypes = function(t, e) {
    this.settings.file_types = t, this.settings.file_types_description = e, this.callFlash("SetFileTypes", [t, e])
}, SWFUpload.prototype.setFileSizeLimit = function(t) {
    this.settings.file_size_limit = t, this.callFlash("SetFileSizeLimit", [t])
}, SWFUpload.prototype.setFileUploadLimit = function(t) {
    this.settings.file_upload_limit = t, this.callFlash("SetFileUploadLimit", [t])
}, SWFUpload.prototype.setFileQueueLimit = function(t) {
    this.settings.file_queue_limit = t, this.callFlash("SetFileQueueLimit", [t])
}, SWFUpload.prototype.setFilePostName = function(t) {
    this.settings.file_post_name = t, this.callFlash("SetFilePostName", [t])
}, SWFUpload.prototype.setUseQueryString = function(t) {
    this.settings.use_query_string = t, this.callFlash("SetUseQueryString", [t])
}, SWFUpload.prototype.setRequeueOnError = function(t) {
    this.settings.requeue_on_error = t, this.callFlash("SetRequeueOnError", [t])
}, SWFUpload.prototype.setHTTPSuccess = function(t) {
    "string" == typeof t && (t = t.replace(" ", "").split(",")), this.settings.http_success = t, this.callFlash("SetHTTPSuccess", [t])
}, SWFUpload.prototype.setAssumeSuccessTimeout = function(t) {
    this.settings.assume_success_timeout = t, this.callFlash("SetAssumeSuccessTimeout", [t])
}, SWFUpload.prototype.setDebugEnabled = function(t) {
    this.settings.debug_enabled = t, this.callFlash("SetDebugEnabled", [t])
}, SWFUpload.prototype.setButtonImageURL = function(t) {
    void 0 == t && (t = ""), this.settings.button_image_url = t, this.callFlash("SetButtonImageURL", [t])
}, SWFUpload.prototype.setButtonDimensions = function(t, e) {
    this.settings.button_width = t, this.settings.button_height = e;
    var s = this.getMovieElement();
    void 0 != s && (s.style.width = t + "px", s.style.height = e + "px"), this.callFlash("SetButtonDimensions", [t, e])
}, SWFUpload.prototype.setButtonText = function(t) {
    this.settings.button_text = t, this.callFlash("SetButtonText", [t])
}, SWFUpload.prototype.setButtonTextPadding = function(t, e) {
    this.settings.button_text_top_padding = e, this.settings.button_text_left_padding = t, this.callFlash("SetButtonTextPadding", [t, e])
}, SWFUpload.prototype.setButtonTextStyle = function(t) {
    this.settings.button_text_style = t, this.callFlash("SetButtonTextStyle", [t])
}, SWFUpload.prototype.setButtonDisabled = function(t) {
    this.settings.button_disabled = t, this.callFlash("SetButtonDisabled", [t])
}, SWFUpload.prototype.setButtonAction = function(t) {
    this.settings.button_action = t, this.callFlash("SetButtonAction", [t])
}, SWFUpload.prototype.setButtonCursor = function(t) {
    this.settings.button_cursor = t, this.callFlash("SetButtonCursor", [t])
}, SWFUpload.prototype.queueEvent = function(t, e) {
    void 0 == e ? e = [] : e instanceof Array || (e = [e]);
    var s = this;
    if ("function" == typeof this.settings[t]) this.eventQueue.push(function() {
        this.settings[t].apply(this, e)
    }), setTimeout(function() {
        s.executeNextEvent()
    }, 0);
    else if (null !== this.settings[t]) throw "Event handler " + t + " is unknown or is not a function"
}, SWFUpload.prototype.executeNextEvent = function() {
    var t = this.eventQueue ? this.eventQueue.shift() : null;
    "function" == typeof t && t.apply(this)
}, SWFUpload.prototype.unescapeFilePostParams = function(t) {
    var e, s = /[$]([0-9a-f]{4})/i,
        n = {};
    if (void 0 != t) {
        for (var i in t.post) if (t.post.hasOwnProperty(i)) {
            e = i;
            for (var o; null !== (o = s.exec(e));) e = e.replace(o[0], String.fromCharCode(parseInt("0x" + o[1], 16)));
            n[e] = t.post[i]
        }
        t.post = n
    }
    return t
}, SWFUpload.prototype.testExternalInterface = function() {
    try {
        return this.callFlash("TestExternalInterface")
    } catch (t) {
        return !1
    }
}, SWFUpload.prototype.flashReady = function() {
    var t = this.getMovieElement();
    return t ? (this.cleanUp(t), void this.queueEvent("swfupload_loaded_handler")) : void this.debug("Flash called back ready but the flash movie can't be found.")
}, SWFUpload.prototype.cleanUp = function(t) {
    try {
        if (this.movieElement && "unknown" == typeof t.CallFunction) {
            this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");
            for (var e in t) try {
                "function" == typeof t[e] && !HTMLObjectElement.prototype[e] && e.chatAt(0) >= "A" && e.chatAt(0) <= "Z" && (t[e] = null)
            } catch (s) {}
        }
    } catch (n) {}
    window.__flash__removeCallback = function(t, e) {
        try {
            t && (t[e] = null)
        } catch (s) {}
    }
}, SWFUpload.prototype.fileDialogStart = function() {
    this.queueEvent("file_dialog_start_handler")
}, SWFUpload.prototype.fileQueued = function(t) {
    t = this.unescapeFilePostParams(t), this.queueEvent("file_queued_handler", t)
}, SWFUpload.prototype.fileQueueError = function(t, e, s) {
    t = this.unescapeFilePostParams(t), this.queueEvent("file_queue_error_handler", [t, e, s])
}, SWFUpload.prototype.fileDialogComplete = function(t, e, s) {
    this.queueEvent("file_dialog_complete_handler", [t, e, s])
}, SWFUpload.prototype.uploadStart = function(t) {
    t = this.unescapeFilePostParams(t), this.queueEvent("return_upload_start_handler", t)
}, SWFUpload.prototype.returnUploadStart = function(t) {
    var e;
    if ("function" == typeof this.settings.upload_start_handler) t = this.unescapeFilePostParams(t), e = this.settings.upload_start_handler.call(this, t);
    else if (void 0 != this.settings.upload_start_handler) throw "upload_start_handler must be a function";
    void 0 === e && (e = !0), e = !! e, this.callFlash("ReturnUploadStart", [e])
}, SWFUpload.prototype.uploadProgress = function(t, e, s) {
    t = this.unescapeFilePostParams(t), this.queueEvent("upload_progress_handler", [t, e, s])
}, SWFUpload.prototype.uploadError = function(t, e, s) {
    t = this.unescapeFilePostParams(t), this.queueEvent("upload_error_handler", [t, e, s])
}, SWFUpload.prototype.uploadSuccess = function(t, e, s) {
    t = this.unescapeFilePostParams(t), this.queueEvent("upload_success_handler", [t, e, s])
}, SWFUpload.prototype.uploadComplete = function(t) {
    t = this.unescapeFilePostParams(t), this.queueEvent("upload_complete_handler", t)
}, SWFUpload.prototype.debug = function(t) {
    this.queueEvent("debug_handler", t)
}, SWFUpload.prototype.debugMessage = function(t) {
    if (this.settings.debug) {
        var e, s = [];
        if ("object" == typeof t && "string" == typeof t.name && "string" == typeof t.message) {
            for (var n in t) t.hasOwnProperty(n) && s.push(n + ": " + t[n]);
            e = s.join("\n") || "", s = e.split("\n"), e = "EXCEPTION: " + s.join("\nEXCEPTION: "), SWFUpload.Console.writeLine(e)
        } else SWFUpload.Console.writeLine(t)
    }
}, SWFUpload.Console = {}, SWFUpload.Console.writeLine = function(t) {
    var e, s;
    try {
        e = document.getElementById("SWFUpload_Console"), e || (s = document.createElement("form"), document.getElementsByTagName("body")[0].appendChild(s), e = document.createElement("textarea"), e.id = "SWFUpload_Console", e.style.fontFamily = "monospace", e.setAttribute("wrap", "off"), e.wrap = "off", e.style.overflow = "auto", e.style.width = "700px", e.style.height = "350px", e.style.margin = "5px", s.appendChild(e)), e.value += t + "\n", e.scrollTop = e.scrollHeight - e.clientHeight
    } catch (n) {
        alert("Exception: " + n.name + " Message: " + n.message)
    }
}, "function" == typeof SWFUpload && (SWFUpload.onload = function() {}, swfobject.addDomLoadEvent(function() {
    "function" == typeof SWFUpload.onload && SWFUpload.onload.call(window)
}), SWFUpload.prototype.initSettings = function(t) {
    return function() {
        "function" == typeof t && t.call(this), this.ensureDefault = function(t, e) {
            this.settings[t] = void 0 == this.settings[t] ? e : this.settings[t]
        }, this.ensureDefault("minimum_flash_version", "9.0.28"), this.ensureDefault("swfupload_pre_load_handler", null), this.ensureDefault("swfupload_load_failed_handler", null), delete this.ensureDefault
    }
}(SWFUpload.prototype.initSettings), SWFUpload.prototype.loadFlash = function(t) {
    return function() {
        var e = swfobject.hasFlashPlayerVersion(this.settings.minimum_flash_version);
        e ? (this.queueEvent("swfupload_pre_load_handler"), "function" == typeof t && t.call(this)) : this.queueEvent("swfupload_load_failed_handler")
    }
}(SWFUpload.prototype.loadFlash), SWFUpload.prototype.displayDebugInfo = function(t) {
    return function() {
        "function" == typeof t && t.call(this), this.debug(["SWFUpload.SWFObject Plugin settings:", "\n", "	", "minimum_flash_version:                      ", this.settings.minimum_flash_version, "\n", "	", "swfupload_pre_load_handler assigned:     ", ("function" == typeof this.settings.swfupload_pre_load_handler).toString(), "\n", "	", "swfupload_load_failed_handler assigned:     ", ("function" == typeof this.settings.swfupload_load_failed_handler).toString(), "\n"].join(""))
    }
}(SWFUpload.prototype.displayDebugInfo));
var SWFUpload;
"function" == typeof SWFUpload && (SWFUpload.prototype.initSettings = function(t) {
    return function() {
        "function" == typeof t && t.call(this), this.refreshCookies(!1)
    }
}(SWFUpload.prototype.initSettings), SWFUpload.prototype.refreshCookies = function(t) {
    void 0 === t && (t = !0), t = !! t;
    var e, s, n, i, o, a = this.settings.post_params,
        l = document.cookie.split(";"),
        u = l.length;
    for (e = 0; u > e; e++) {
        for (s = l[e];
        " " === s.charAt(0);) s = s.substring(1, s.length);
        n = s.indexOf("="), n > 0 && (i = s.substring(0, n), o = s.substring(n + 1), a[i] = o)
    }
    t && this.setPostParams(a)
}), define("swfupload", [], function() {
    return SWFUpload
});
define("common/kage", ["config", "swfupload", "common/api", "common/urlUtil", "common/util"], function(e, t, n, i, r) {
    var o = {
        XHR: "xhr",
        IFRAME: "iframe",
        SWF: "swf"
    }, a = "file_1",
        c = {
            OK: 200,
            BAD_REQUEST: 400,
            UNAUTHORIZED: 401,
            ENTITY_TOO_LARGE: 413,
            UNSUPPORTED_MEDIA_TYPE: 415,
            INTERNAL_SERVER_ERROR: 500,
            FATAL_ERROR: 1e4
        }, u = {
            OK: 200,
            UNAUTHORIZED: 401,
            UNSUPPORTED_MEDIA_TYPE: 500,
            FATAL_ERROR: 1e4
        }, l = 1e3,
        s = 10,
        d = 104857600,
        f = 18e4,
        R = function() {
            return i.getOrigin() + e.dummyPage
        }, m = {
            video: {
                upload: function(t) {
                    return e.kage.videoUpUrl + "/web/" + e.kage.videoConfigNumber + (t ? "/?continue=" + R() : "/")
                },
                thumbnail: function(t, n) {
                    return e.kage.videoThumbnailUrl + "/dn/" + t + "/" + n
                },
                play: function(t, n) {
                    return e.kage.videoPlayUrl + "/dn/" + t + "/" + n
                }
            },
            picture: {
                upload: function(t) {
                    return e.kage.imageUpUrl + "/web/" + e.kage.imageConfigNumber + (t ? "/?continue=" + R() : "/")
                },
                swfupload: function() {
                    return e.kage.imageUpUrl + "/web/" + e.kage.imageConfigNumber
                },
                download: function(t, n) {
                    return e.kage.imageDnUrl + "/dn/" + t + "/" + n
                }
            }
        }, p = {}, A = function(e, t) {
            p[e] = t
        }, T = function(e) {
            clearTimeout(p[e]), p[e] = null, delete p[e]
        }, g = {}, E = function(e, t) {
            g[e] = t
        }, h = function(e) {
            clearTimeout(g[e]), g[e] = null, delete g[e]
        }, O = function(e, t) {
            var n = e.closest("form"),
                o = Q.defer(),
                a = _.uniqueId("uploadIframe"),
                u = 0,
                f = !0,
                R = r.getFileSize(e),
                m = R > d ? Math.round(s / (R / d) * 10) / 10 : s,
                p = $('<iframe name="' + a + '" style="display: none" />');
            return p.insertAfter(n), p.one("load", function() {
                var e, t, n = p[0].contentWindow.location.href,
                    r = i.getObjectFromQueryString(decodeURIComponent(i.getQueryString(n)));
                if (r || (t = c.FATAL_ERROR), t = parseInt(r.c, 10), isNaN(t) && (t = c.FATAL_ERROR), t === c.OK && r.m) try {
                    e = JSON.parse(r.m), e.access_key ? o.resolve(e) : o.reject(c.FATAL_ERROR)
                } catch (a) {
                    o.reject(c.FATAL_ERROR)
                } else o.reject(t);
                p.remove(), f = !1
            }),
            function T() {
                var t;
                f && (u = Math.min(Math.round(m * _.random(.5, 1.5)) + u, 100), o.notify(u), t = setTimeout(T, l), A(e.data("id"), t))
            }(), n.attr({
                action: t,
                target: a
            }).submit(), o.promise
        }, U = function(e, t) {
            var n = Q.defer(),
                i = new FormData;
            return i.append(a, e), $.ajax({
                url: t,
                method: "POST",
                crossDomain: !0,
                xhrFields: {
                    withCredentials: !0
                },
                processData: !1,
                contentType: !1,
                data: i
            }).then(function(e) {
                e.access_key ? n.resolve(e) : n.reject(c.FATAL_ERROR)
            }).fail(function(e) {
                var t = c.FATAL_ERROR;
                _.some(c, function(n) {
                    return n === e.status ? (t = e.status, !0) : !1
                }), n.reject(t)
            }), n.promise
        }, v = {}, F = {
            set: function(e) {
                return v[e] = Q.defer(), v[e]
            },
            get: function(e) {
                return v[e]
            },
            remove: function(e) {
                delete v[e]
            }
        }, k = function(e, n, i) {
            var r = F.set(n);
            return e.setUploadURL(i), e.setFilePostName(a), e.settings.upload_error_handler = function(e, t, n) {
                F.get(e.id).reject(parseInt(n, 10)), F.remove(e.id)
            }, e.settings.upload_success_handler = function(e, n, i) {
                var r, o = F.get(e.id);
                if (i) switch (e.filestatus) {
                    case t.FILE_STATUS.COMPLETE:
                        try {
                            r = JSON.parse(n), r.access_key ? o.resolve(r) : o.reject(c.FATAL_ERROR)
                        } catch (a) {
                            o.reject(c.FATAL_ERROR)
                        }
                        break;
                    case t.FILE_STATUS.ERROR:
                    case t.FILE_STATUS.CANCELLED:
                        o.reject(c.FATAL_ERROR)
                } else o.reject(c.FATAL_ERROR);
                F.remove(e.id)
            }, e.startUpload(n), r.promise
        }, w = function(e) {
            return n.request({
                url: "/kage/video/dn/" + e + "/meta.json"
            }).then(function(t) {
                var n = _.object(_.pluck(t, "type"), t);
                return {
                    kageAccessKey: e,
                    mediaPath: e,
                    downloadPath: m.video.play(e, n.video.filename),
                    previewPath: m.video.thumbnail(e, n.preview.filename)
                }
            })
        };
    return {
        requestPictureFileUpload: function(e) {
            var t;
            switch (e.method) {
                case o.XHR:
                    t = U(e.file, m.picture.upload(!1));
                    break;
                case o.SWF:
                    t = k(e.swfupload, e.fileId, m.picture.upload(!1));
                    break;
                case o.IFRAME:
                    t = O($(e.input), m.picture.upload(!0))
            }
            return t.then(function(e) {
                var t = i.getQueryStringFromObject({
                    width: e.info.original.width,
                    height: e.info.original.height
                });
                return {
                    kageAccessKey: e.access_key,
                    mediaPath: e.access_key + "/" + e.info.original.filename + "?" + t,
                    previewPath: m.picture.download(e.access_key, e.info.small.filename),
                    downloadPath: m.picture.download(e.access_key + "/" + e.info.original.filename + "?" + t),
                    contentType: e.info.original.content_type,
                    fileSize: e.info.original.length,
                    isAnimated: 1 === e.info.original.ani
                }
            })
        },
        requestVideoFileUpload: function(e) {
            switch (e.method) {
                case o.XHR:
                    return U(e.file, m.video.upload(!1));
                case o.IFRAME:
                    return O($(e.input), m.video.upload(!0))
            }
        },
        requestCheckVideoTranscoding: function(e) {
            var t = Q.defer(),
                i = (new Date).getTime(),
                r = 0;
            return function o() {
                n.request({
                    url: "/kage/video/wcheck/" + e + "/?_t=" + _.now(),
                    forceRequest: !0
                }).then(function(n) {
                    var a;
                    return n ? n.code !== u.OK ? t.reject(c.UNSUPPORTED_MEDIA_TYPE) : 100 === n.percent ? w(e).then(t.resolve) : new Date - i > f ? t.reject(u.FATAL_ERROR) : (r = Math.min(Math.round(s * _.random(.5, 1.5)) + r, 100), t.notify(r), a = setTimeout(o, l), void E(e, a)) : t.reject(u.FATAL_ERROR)
                }).fail(function(e) {
                    return t.reject(e.status === u.UNAUTHORIZED ? u.UNAUTHORIZED : u.FATAL_ERROR)
                })
            }(), t.promise
        },
        clearTranscodingTimer: function(e) {
            h(e)
        },
        clearFileUploadTimer: function(e) {
            T(e)
        },
        UPLOAD_METHOD: o,
        UPLOAD_STATUS_CODE: c
    }
});
define("template/comment", ["Handlebars"], function(t) {
    var a = function(a) {
        var i = t.template(a);
        return function(t) {
            return i(t, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r = "",
                    s = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<p class="more _commentMoreBtnContainer"><a href="#" class="_btnCommentMore" data-kant-id="38">' + o((n = e.t || a && a.t, c = {
                    hash: {},
                    data: l
                }, n ? n.call(a, "activity.comment.more", c) : s.call(a, "t", "activity.comment.more", c))) + '</a><span class="loading _commentLoading" style="display:none">' + o((n = e.img || a && a.img, c = {
                    hash: {
                        src: "/img/loading_reply.gif",
                        width: "12",
                        height: "12"
                    },
                    data: l
                }, n ? n.call(a, c) : s.call(a, "img", c))) + '</span></p><div data-part="list"></div><div data-part="write"></div>'
            });
            return t.wrap = "<div>", t
        }(),
        commentList: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n = "";
                return n
            });
            return t.wrap = '<ul class="list _listContainer">', t
        }(),
        commentWrite: function() {
            var t = a(function(t, a, e, i, l) {
                function n(t, a) {
                    var i, l, n, c = "";
                    return c += '<label for="comt_', (l = e.cid) ? i = l.call(t, {
                        hash: {},
                        data: a
                    }) : (l = t && t.cid, i = typeof l === p ? l.call(t, {
                        hash: {},
                        data: a
                    }) : l), c += m(i) + '" class="_commentWritingPlaceholder">' + m((l = e.t || t && t.t, n = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, "activity.comment.placeholder", n) : u.call(t, "t", "activity.comment.placeholder", n))) + "</label>"
                }
                function c(t, a) {
                    var i, l, n, c = "";
                    return c += '<label for="comt_', (l = e.cid) ? i = l.call(t, {
                        hash: {},
                        data: a
                    }) : (l = t && t.cid, i = typeof l === p ? l.call(t, {
                        hash: {},
                        data: a
                    }) : l), c += m(i) + '"><span class="ic_rock"></span>' + m((l = e.t || t && t.t, n = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, "activity.comment.commentAllowedForFriend", n) : u.call(t, "t", "activity.comment.commentAllowedForFriend", n))) + "</label>"
                }
                function r(t, a) {
                    var i, l, n = "";
                    return n += '<div class="_photo bn_photo" data-kant-id="495"><form method="post" enctype="multipart/form-data" class="_photoForm"><input name="file_1" class="_photoFileInput bg_file_upload" type="file" title="' + m((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.image.text", l) : u.call(t, "t", "activity.comment.image.text", l))) + '" accept="image/jpeg, image/jpg, image/png, image/bmp"></form>' + m((i = e.img || t && t.img, l = {
                        hash: {
                            src: "/img/loding_wave_upload.gif",
                            width: "20",
                            height: "16",
                            alt: "activity.alt.imageSaving",
                            "class": "_photoLoading",
                            style: "display:none"
                        },
                        data: a
                    }, i ? i.call(t, l) : u.call(t, "img", l))) + '</div><div class="_photoUploadError ly_tooltip" style="display:none">' + m((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.image.uploadError", l) : u.call(t, "t", "activity.comment.image.uploadError", l))) + '<span class="arr"></span></div>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var s, o, d, h = "",
                    p = "function",
                    m = this.escapeExpression,
                    u = e.helperMissing,
                    v = this;
                return h += '<div class="_commentWriting inp_write"> ', s = e["if"].call(a, a && a.isCommentWritable, {
                    hash: {},
                    inverse: v.program(3, c, l),
                    fn: v.program(1, n, l),
                    data: l
                }), (s || 0 === s) && (h += s), h += '<div class="txt_copy _decoratorLayer" style="min-height: 19px"></div><p class="_commentWritingOverflowCount overflow_txt" style="display: none"></p><textarea title="' + m((o = e.t || a && a.t, d = {
                    hash: {},
                    data: l
                }, o ? o.call(a, "activity.alt.commentWriteTitle", d) : u.call(a, "t", "activity.alt.commentWriteTitle", d))) + '" class="_text" style="height:16px;width:100%"></textarea><div class="inp_graphic inp_emoticon _sticonDecoratorLayer" style="display:none"></div><div class="inp_graphic inp_photo _imageDecoratorLayer" style="display:none"></div> ', s = e.unless.call(a, a && a.isStoryPlus, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(5, r, l),
                    data: l
                }), (s || 0 === s) && (h += s), h += '  <button class="bn_emoti _btnShowSticon" data-kant-id="39">' + m((o = e.t || a && a.t, d = {
                    hash: {},
                    data: l
                }, o ? o.call(a, "activity.alt.openSticon", d) : u.call(a, "t", "activity.alt.openSticon", d))) + '</button><div class="_sticonLayerContainer"></div><div class="_dropdownWrapper"></div></div><button type="submit" class="_btnCommentSubmit btn_com inactive" style="display:none" data-kant-id="40" data-kant-ignore="true"><span>' + m((o = e.t || a && a.t, d = {
                    hash: {},
                    data: l
                }, o ? o.call(a, "activity.comment.save", d) : u.call(a, "t", "activity.comment.save", d))) + "</span></button>"
            });
            return t.wrap = '<div class="comt_write">', t
        }(),
        sticonDecorator: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r, s = "",
                    o = "function",
                    d = this.escapeExpression,
                    h = e.helperMissing;
                return s += '<div class="bx_ic"><img src="', (c = e.src) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.src, n = typeof c === o ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), s += d(n) + '" style="height:64px" alt="' + d((c = e.t || a && a.t, r = {
                    hash: {},
                    data: l
                }, c ? c.call(a, "activity.alt.sticonImage", r) : h.call(a, "t", "activity.alt.sticonImage", r))) + '"><button class="bn_x6 _closeSticonPreview" data-kant-id="41">' + d((c = e.t || a && a.t, r = {
                    hash: {},
                    data: l
                }, c ? c.call(a, "activity.alt.sticonDelete", r) : h.call(a, "t", "activity.alt.sticonDelete", r))) + "</button></div>"
            });
            return t
        }(),
        image: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r, s = "",
                    o = "function",
                    d = this.escapeExpression,
                    h = e.helperMissing;
                return s += '<div class="bx_ic"><img src="', (c = e.previewPath) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.previewPath, n = typeof c === o ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), s += d(n) + '" class="_image" alt="' + d((c = e.t || a && a.t, r = {
                    hash: {},
                    data: l
                }, c ? c.call(a, "activity.alt.image", r) : h.call(a, "t", "activity.alt.image", r))) + '"> <span class="line"></span> <button class="bn_x6 _closeImagePreview" data-kant-id="496">' + d((c = e.t || a && a.t, r = {
                    hash: {},
                    data: l
                }, c ? c.call(a, "activity.alt.imageDelete", r) : h.call(a, "t", "activity.alt.imageDelete", r))) + "</button></div>"
            });
            return t
        }(),
        sticon: function() {
            var t = a(function(t, a, e, i, l) {
                function n(t, a) {
                    var i, l, n = "";
                    return n += '<li><a class="_sticonCategory" href="#" data-id="', (l = e.id) ? i = l.call(t, {
                        hash: {},
                        data: a
                    }) : (l = t && t.id, i = typeof l === d ? l.call(t, {
                        hash: {},
                        data: a
                    }) : l), n += h(i) + '" data-kant-id="483" data-kant-option="t:', (l = e.id) ? i = l.call(t, {
                        hash: {},
                        data: a
                    }) : (l = t && t.id, i = typeof l === d ? l.call(t, {
                        hash: {},
                        data: a
                    }) : l), n += h(i) + '"><img src="" alt="" style="width:28px;height:28px"></a></li>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var c, r, s, o = "",
                    d = "function",
                    h = this.escapeExpression,
                    p = e.helperMissing,
                    m = this;
                return o += '<ul class="_sticonCategoryTabContainer emoticon_tab"><li><a class="_usedSticon _sticonCategory" data-id="', (r = e.recentlyUsed) ? c = r.call(a, {
                    hash: {},
                    data: l
                }) : (r = a && a.recentlyUsed, c = typeof r === d ? r.call(a, {
                    hash: {},
                    data: l
                }) : r), o += h(c) + '" href="#" data-kant-option="t:', (r = e.recentlyUsed) ? c = r.call(a, {
                    hash: {},
                    data: l
                }) : (r = a && a.recentlyUsed, c = typeof r === d ? r.call(a, {
                    hash: {},
                    data: l
                }) : r), o += h(c) + '" data-kant-id="483"><span class="ic_recent">' + h((r = e.t || a && a.t, s = {
                    hash: {},
                    data: l
                }, r ? r.call(a, "activity.comment.sticon.recentlyUsed", s) : p.call(a, "t", "activity.comment.sticon.recentlyUsed", s))) + "</span></a></li>", c = e.each.call(a, a && a.items, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(1, n, l),
                    data: l
                }), (c || 0 === c) && (o += c), o += '</ul><div class="lst_emoticon"><div class="_sticonContainer" style="height: 265px"></div></div><span class="ly_arr"></span>'
            });
            return t.wrap = '<div class="ly emoticon_layer">', t
        }(),
        sticonCategoryItems: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r = "",
                    s = "function",
                    o = this.escapeExpression;
                return r += '<ul data-id="', (c = e.id) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.id, n = typeof c === s ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), r += o(n) + '"></ul>'
            });
            return t
        }(),
        noSticon: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r = "",
                    s = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<li class="txt_info">' + o((n = e.t || a && a.t, c = {
                    hash: {},
                    data: l
                }, n ? n.call(a, "activity.comment.sticon.noRecentlyUsed", c) : s.call(a, "t", "activity.comment.sticon.noRecentlyUsed", c))) + "</li>"
            });
            return t
        }(),
        sticonItem: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r, s = "",
                    o = "function",
                    d = this.escapeExpression,
                    h = e.helperMissing;
                return s += '<li><a class="_sticonAnchor" href="#" data-id="', (c = e.id) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.id, n = typeof c === o ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), s += d(n) + '" data-kant-id="485" data-kant-option="t:', (c = e.categoryId) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.categoryId, n = typeof c === o ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), s += d(n) + '"><img src="', (c = e.url) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.url, n = typeof c === o ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), s += d(n) + '" alt="' + d((c = e.t || a && a.t, r = {
                    hash: {},
                    data: l
                }, c ? c.call(a, "activity.alt.sticonSelectImage", r) : h.call(a, "t", "activity.alt.sticonSelectImage", r))) + '">' + d((c = e.img || a && a.img, r = {
                    hash: {
                        src: "/img/space.png",
                        style: "width:100%;height:50px;position:absolute;left:0;top:0;",
                        "class": "_sticonCover",
                        "data-retina": "false"
                    },
                    data: l
                }, c ? c.call(a, r) : h.call(a, "img", r))) + "</a></li>"
            });
            return t
        }(),
        profileDecorator: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r = "",
                    s = "function",
                    o = this.escapeExpression;
                return r += '<span class="name">', (c = e.text) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.text, n = typeof c === s ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), r += o(n) + "</span>"
            });
            return t
        }(),
        overflowDecorator: function() {
            var t = a(function(t, a, e, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var n, c, r = "",
                    s = "function",
                    o = this.escapeExpression;
                return r += '<span class="overflow">', (c = e.text) ? n = c.call(a, {
                    hash: {},
                    data: l
                }) : (c = a && a.text, n = typeof c === s ? c.call(a, {
                    hash: {},
                    data: l
                }) : c), r += o(n) + "</span>"
            });
            return t
        }(),
        item: function() {
            var t = a(function(t, a, e, i, l) {
                function n(t) {
                    var a, e = "";
                    return e += '<a href="#" class="name _name _namePlaceholder" data-kant-id="497">' + k((a = t && t.writer, a = null == a || a === !1 ? a : a.display_name, typeof a === w ? a.apply(t) : a)) + "</a>"
                }
                function c(t) {
                    var a, e = "";
                    return e += '<a href="/' + k((a = t && t.writer, a = null == a || a === !1 ? a : a.urlKey, typeof a === w ? a.apply(t) : a)) + '" data-profile-popup="' + k((a = t && t.writer, a = null == a || a === !1 ? a : a.id, typeof a === w ? a.apply(t) : a)) + '" class="name _namePlaceholder" data-kant-id="44">' + k((a = t && t.writer, a = null == a || a === !1 ? a : a.display_name, typeof a === w ? a.apply(t) : a)) + "</a>"
                }
                function r(t, a) {
                    var i, l, n = "";
                    return n += '<span class="ic_birthday">' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "profile.alt.birthdayTitle", l) : I.call(t, "t", "profile.alt.birthdayTitle", l))) + "</span>"
                }
                function s(t, a) {
                    var i, l, n = "";
                    return n += '<span class="time" title="' + k((i = e.dateFormat || t && t.dateFormat, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, t && t.created_at, "all", l) : I.call(t, "dateFormat", t && t.created_at, "all", l))) + '" data-tooltip="true">' + k((i = e.dateFormat || t && t.dateFormat, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, t && t.created_at, l) : I.call(t, "dateFormat", t && t.created_at, l))) + "</span>"
                }
                function o(t, a) {
                    var i, l, n, c = "";
                    return c += '<a href="', (l = e.linkViewComment) ? i = l.call(t, {
                        hash: {},
                        data: a
                    }) : (l = t && t.linkViewComment, i = typeof l === w ? l.call(t, {
                        hash: {},
                        data: a
                    }) : l), c += k(i) + '" data-kant-id="45" class="time" title="' + k((l = e.dateFormat || t && t.dateFormat, n = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, t && t.created_at, "all", n) : I.call(t, "dateFormat", t && t.created_at, "all", n))) + '" data-tooltip="true">' + k((l = e.dateFormat || t && t.dateFormat, n = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, t && t.created_at, n) : I.call(t, "dateFormat", t && t.created_at, n))) + "</a>"
                }
                function d(t, a) {
                    var i, l, n, c = "";
                    return c += ' <button class="bn_setup _btnCommentTool" style="', i = e["if"].call(t, t && t.hideButtton, {
                        hash: {},
                        inverse: C.noop,
                        fn: C.program(12, h, a),
                        data: a
                    }), (i || 0 === i) && (c += i), c += '" data-kant-id="46">' + k((l = e.t || t && t.t, n = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, "activity.alt.commentSetting", n) : I.call(t, "t", "activity.alt.commentSetting", n))) + '</button><ul class="ly other_layer" data-part="layer" style="display:none">', i = e["if"].call(t, t && t.canDelete, {
                        hash: {},
                        inverse: C.noop,
                        fn: C.program(14, p, a),
                        data: a
                    }), (i || 0 === i) && (c += i), c += " ", i = e.unless.call(t, t && t.isMine, {
                        hash: {},
                        inverse: C.noop,
                        fn: C.program(16, m, a),
                        data: a
                    }), (i || 0 === i) && (c += i), c += "</ul>"
                }
                function h() {
                    return "display:none;"
                }
                function p(t, a) {
                    var i, l, n = "";
                    return n += '<li><a href="#" class="_btnCommentDelete" data-kant-id="47">' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.delete", l) : I.call(t, "t", "activity.comment.delete", l))) + "</a></li>"
                }
                function m(t, a) {
                    var i, l, n = "";
                    return n += '<li><a href="#" class="_btnCommentReport" data-kant-id="48">' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.report", l) : I.call(t, "t", "activity.comment.report", l))) + "</a></li>"
                }
                function u(t, a) {
                    var i, l = "";
                    return l += '<div class="cmt_setup _btnCommentTool">', i = e.unless.call(t, t && t.isMine, {
                        hash: {},
                        inverse: C.noop,
                        fn: C.program(19, v, a),
                        data: a
                    }), (i || 0 === i) && (l += i), l += " ", i = e["if"].call(t, t && t.canDelete, {
                        hash: {},
                        inverse: C.noop,
                        fn: C.program(21, f, a),
                        data: a
                    }), (i || 0 === i) && (l += i), l += " ", i = e.unless.call(t, t && t.isMine, {
                        hash: {},
                        inverse: C.noop,
                        fn: C.program(23, y, a),
                        data: a
                    }), (i || 0 === i) && (l += i), l += "</div>"
                }
                function v(t, a) {
                    var i, l, n = "";
                    return n += '<div class="bn_report"><button class="_btnCommentReport" data-kant-id="48" data-tooltip="true" title="' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.report", l) : I.call(t, "t", "activity.comment.report", l))) + '">' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.report", l) : I.call(t, "t", "activity.comment.report", l))) + "</button></div>"
                }
                function f(t, a) {
                    var i, l, n = "";
                    return n += '<div class="bn_del"><button class="_btnCommentDelete" data-kant-id="47" data-tooltip="true" title="' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.delete", l) : I.call(t, "t", "activity.comment.delete", l))) + '">' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.delete", l) : I.call(t, "t", "activity.comment.delete", l))) + "</button></div>"
                }
                function y(t, a) {
                    var i, l, n = "";
                    return n += '<div class="bn_comment"><button class="_btnCommentReply" data-tooltip="true" title="' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.reply", l) : I.call(t, "t", "activity.comment.reply", l))) + '" data-kant-id="498">' + k((i = e.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "activity.comment.reply", l) : I.call(t, "t", "activity.comment.reply", l))) + "</button></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, t.helpers), l = l || {};
                var g, _, b, x = "",
                    w = "function",
                    k = this.escapeExpression,
                    I = e.helperMissing,
                    C = this;
                return x += '<div class="pf"><a href="/' + k((g = a && a.writer, g = null == g || g === !1 ? g : g.urlKey, typeof g === w ? g.apply(a) : g)) + '" data-profile-popup="' + k((g = a && a.writer, g = null == g || g === !1 ? g : g.id, typeof g === w ? g.apply(a) : g)) + '" data-kant-id="43" class="_profileImageLink"><img src="' + k((_ = e.profileImage || a && a.profileImage, b = {
                    hash: {
                        url: (g = a && a.writer, null == g || g === !1 ? g : g.profile_thumbnail_url),
                        size: "36"
                    },
                    data: l
                }, _ ? _.call(a, b) : I.call(a, "profileImage", b))) + '" class="_profileImage" alt=""><span class="line"></span></a></div><div class="txt"><p>', g = e["if"].call(a, a && a.isMobile, {
                    hash: {},
                    inverse: C.program(3, c, l),
                    fn: C.program(1, n, l),
                    data: l
                }), (g || 0 === g) && (x += g), g = e["if"].call(a, (g = a && a.writer, null == g || g === !1 ? g : g.is_birthday), {
                    hash: {},
                    inverse: C.noop,
                    fn: C.program(5, r, l),
                    data: l
                }), (g || 0 === g) && (x += g), g = e["if"].call(a, a && a.isPost, {
                    hash: {},
                    inverse: C.program(9, o, l),
                    fn: C.program(7, s, l),
                    data: l
                }), (g || 0 === g) && (x += g), x += "</p>", (_ = e.decoratedText) ? g = _.call(a, {
                    hash: {},
                    data: l
                }) : (_ = a && a.decoratedText, g = typeof _ === w ? _.call(a, {
                    hash: {},
                    data: l
                }) : _), (g || 0 === g) && (x += g), x += "</div>", g = e["if"].call(a, a && a.isMobile, {
                    hash: {},
                    inverse: C.program(18, u, l),
                    fn: C.program(11, d, l),
                    data: l
                }), (g || 0 === g) && (x += g), x
            });
            return t.wrap = "<li>", t
        }()
    }
});
define("part/sticon/SticonPart", ["template/comment", "model/me", "model/usedSticon", "common/util", "common/decoratorUtil", "common/headerArea", "part/plugin/LayerPart", "module/static/error"], function(t, e, i, n, o, r, s, c) {
    var a = 28,
        l = 50,
        h = 64,
        u = 6,
        d = 40,
        g = i.ID,
        f = 500,
        p = "";
    return s.extend({
        template: t.sticon,
        ui: _.defaults({
            sticonCategoryTabContainer: "._sticonCategoryTabContainer",
            sticonContainer: "._sticonContainer",
            sticonAnchors: "._sticonAnchor"
        }, s.prototype.ui),
        styles: _.defaults({
            sticonTabSelected: "on",
            sitconLayerBottom: "al_bot"
        }, s.prototype.styles),
        options: _.defaults({
            writingArea: "setWritingArea",
            usedSticon: "setUsedSticon"
        }, s.prototype.options),
        setWritingArea: function(t) {
            this._$writingArea = t
        },
        setUsedSticon: function(t) {
            this._usedSticon = t
        },
        collection: null,
        initialize: function() {
            s.prototype.initialize.apply(this, arguments), this._decorator = null, this._usedSticon = null
        },
        extendData: function() {
            return {
                recentlyUsed: g
            }
        },
        onSetup: function() {
            var t = this;
            return this.collection.length ? Q.resolve() : this.collection.fetch().fail(c.getHandler()).then(function() {
                t._usedSticon.loadUsedSticon(e.get("id"))
            })
        },
        onRender: function() {
            this.addPart("scroll", "part/plugin/ScrollPart", {
                selector: this.ui.sticonContainer
            }).next(function() {
                this.show()
            })
        },
        show: function() {
            var t, e = p;
            if (!e) {
                if (t = this.collection.at(0), !t) return;
                e = t.get("id")
            }
            this._selectSticonCategory(e), this._setDirection(), s.prototype.show.apply(this, arguments)
        },
        hide: function() {
            s.prototype.hide.apply(this, arguments)
        },
        _setDirection: function() {
            var t, e, i;
            this._$writingArea && this._$writingArea.length > 0 ? (e = this._$writingArea[0].getBoundingClientRect().bottom, i = e - r.getBottom() - d, t = i < this.$el.height(), this.$el.css("top", t ? this._$writingArea.height() + u : "")) : t = this.$el.offset().top - r.getBottom() - $(window).scrollTop() < this.$el.height(), this.$el.toggleClass(this.styles.sitconLayerBottom, t)
        },
        isEmpty: function() {
            return !this._decorator
        },
        getDecorator: function() {
            return this._decorator
        },
        _getSelectedSticon: function(t) {
            var e = this._getSticonCategory(p);
            return _.find(e.get("items"), function(e) {
                return e.id === t
            })
        },
        _addSticon: function(t) {
            var e = this._getSelectedSticon(t);
            e && (this.trigger("addSticon", {
                id: t,
                type: o.DECORATOR_TYPE.STICON,
                text: o.DECORATOR_TEXT.STICON,
                category_id: e.category_id
            }, n.getConvertedImagePath(e.url, h)), this._usedSticon.addUsedSticon(e), agent.os.is.android ? _.delay(_.bind(this.hide, this), f) : this.hide())
        },
        events: {
            "click ._sticonAnchor": function(t) {
                var e = $(t.currentTarget).data("id");
                t.preventDefault(), this._addSticon(e)
            },
            "click ._sticonCategory": function(t) {
                t.preventDefault(), this._selectSticonCategory($(t.currentTarget).data("id"))
            },
            "wheel,mousewheel,DOMMouseScroll ._sticonContainer": function(t) {
                t.preventDefault()
            },
            "contextmenu ._sticonAnchor": function(t) {
                t.preventDefault()
            },
            "contextmenu ._sticonCategory": function(t) {
                t.preventDefault()
            }
        },
        _getSticonItemsMarkup: function(e) {
            return 0 === e.get("items").length ? t.noSticon() : _.map(e.get("items"), function(e) {
                return t.sticonItem({
                    id: e.id,
                    url: n.getConvertedImagePath(e.url, l),
                    categoryId: e.category_id
                })
            }).join("")
        },
        _selectSticonCategory: function(t) {
            this._highlightCategoryTab(t), this._showCategoryItems(t), this.isAvailableChildPart("scroll") && this.childParts.scroll.scrollTo(0), p = t
        },
        _highlightCategoryTab: function(t) {
            var e = this.ui.sticonCategoryTabContainer.find("._sticonCategory").not("._usedSticon"),
                i = this;
            _.each(e, function(e) {
                var o = $(e),
                    r = o.attr("data-id"),
                    s = r === t,
                    c = i.collection.get(r),
                    l = c.get(s ? "icon_on_url" : "icon_off_url");
                l = n.getConvertedImagePath(l, a), o.parent().toggleClass(i.styles.sticonTabSelected, s), o.find("img").attr("src", l)
            }), this.ui.sticonCategoryTabContainer.find("._usedSticon").parent().toggleClass(this.styles.sticonTabSelected, t === g)
        },
        _showCategoryItems: function(e) {
            var i = this._getSticonCategory(e),
                n = this.ui.sticonContainer.find("ul[data-id=" + e + "]");
            n.length ? e === g && n.html(this._getSticonItemsMarkup(i)) : (n = $(t.sticonCategoryItems({
                id: e
            })), n.html(this._getSticonItemsMarkup(i)).appendTo(this.ui.sticonContainer)), this.ui.sticonContainer.children().hide(), n.show()
        },
        _getSticonCategory: function(t) {
            var e = this.collection.get(t);
            return t === g && (e = this._usedSticon), e
        }
    })
});
define("part/writing/WritingPart", ["template/writing", "model/me", "model/Property", "model/Activity", "model/Scrap", "model/WritingSetting", "model/sticonCategories", "model/usedSticon", "module/static/dialog", "module/static/toastPopup", "module/static/error", "part/writing/PermissionLayerPart", "part/writing/EditorPart", "common/animate", "common/util", "common/imgUtil", "common/domUtil", "common/decoratorUtil", "common/profileImage", "common/kage", "config", "swfupload", "part/sticon/SticonPart", "kant", "common/kantUtil"], function(t, i, e, s, n, o, r, a, h, d, l, c, u, p, g, m, f, P, M, S, I, y, E, v, T) {
    var w = "395",
        O = "wrt",
        C = "edt",
        A = ".",
        D = "on",
        b = {
            READY: "ready",
            TEXT: "text",
            PHOTO: "photo",
            VIDEO: "video",
            MUSIC: "music",
            LINK: "link",
            SHARE: "share",
            MODIFY: "modify"
        }, R = {
            photo: "part/writing/PhotoModePart",
            video: "part/writing/VideoModePart",
            music: "part/writing/MusicModePart",
            link: "part/writing/LinkModePart",
            share: "part/writing/ShareModePart",
            modify: "part/writing/ModifyModePart"
        }, B = 1500,
        F = 150,
        k = 300,
        x = 56,
        W = 200,
        U = 300,
        L = 100,
        N = agent.support.cors && agent.support.xhrUpload,
        H = !! agent.getFlashVersion(),
        Y = !N && H,
        K = space.Part.extend({
            template: t.layout,
            ui: {
                profileImg: "._profileImg",
                permissionBtn: "._permissionBtn",
                permissionIcon: "._permissionIcon",
                permissionTooltip: "._permissionTooltip",
                permissionTooltipText: "._permissionTooltipText",
                permissionLayer: "._permissionLayer",
                mediaContainer: "._mediaContainer",
                photoFileInput: "._photoFileInputOutmost",
                photoForm: "._photoForm",
                friendInputBtn: "._friendInputBtn",
                postBtn: "._postBtn",
                dropZone: "._dropZone",
                dropSign: "._dropSign",
                sticonBtn: "._sticonInputBtn"
            },
            styles: {
                mediaOpen: "open",
                permissionIconFriend: "friend",
                permissionIconMeOnly: "lock",
                permissionIconAll: "global",
                friendInputOn: "on",
                friendInputClick: "click",
                friendInputSelected: "selected",
                activePostBtn: "btn_or",
                inactivePostBtn: "inactive",
                activePermissionBtn: "on",
                sticonOn: "on",
                sticonDisable: "dis",
                focus: "focus",
                goaway: "goaway"
            },
            childParts: {
                editor: "part/writing/EditorPart",
                friendInput: "part/writing/FriendInputPart",
                titleRecover: "part/plugin/TitleRecoveryPart"
            },
            model: null,
            initialize: function() {
                this._postPromise = Q.resolve(), this._scrapPromise = Q.resolve(), this._mode = b.READY, this._permission = null, this._sharable = !0, this._commentWritable = !0, this._pendedScrapUrl = null, this._isMyStoryOfMe = !1, this._isHashtagWriting = !1, this._isFriendsPermissionShare = !1, this._isExternalShareWriting = !1, this._originalModel = null, this._mediaType = null, this._showDropSign = _.debounce(function() {
                    var t = this.ui.dropZone.innerHeight(),
                        i = intl.t("writing.action.dropzonePlaceholder");
                    switch (this._mode) {
                        case b.PHOTO:
                            i = intl.t("writing.action.dropzonePhoto");
                            break;
                        case b.VIDEO:
                            i = intl.t("writing.action.dropzoneVideo")
                    }
                    this.ui.dropSign.text(i).css({
                        height: t + "px",
                        lineHeight: t + "px"
                    }).show()
                }, W, !0), this._hideDropSign = _.debounce(function() {
                    this.ui.dropSign.hide()
                }, W)
            },
            _hasMediaContent: function() {
                return this.isAvailableChildPart("mediaMode") && this.childParts.mediaMode.hasContent()
            },
            _initiateSwfUpload: function() {
                var t = this.$el.find("._swfUpload"),
                    i = this;
                t.length && (this._isSetSwfUpload = !0, this.ui.photoFileInput.hide(), this.initiateSwfUpload(t, {
                    file_dialog_complete_handler: function(t) {
                        var e = {
                            method: S.UPLOAD_METHOD.SWF,
                            files: this.customSettings.files,
                            swfupload: this,
                            removeGif: !1,
                            onlyOne: !1
                        };
                        t > 0 && e.files.length > 0 && i.changeMode(b.PHOTO).next(function() {
                            var t = this.childParts.mediaMode;
                            this.listenTo(t, {
                                domready: function() {
                                    t.postPhoto(e)
                                }
                            })
                        })
                    }
                }))
            },
            initiateSwfUpload: function(t, i) {
                new y(_.extend({
                    button_window_mode: y.WINDOW_MODE.OPAQUE,
                    button_cursor: y.CURSOR.HAND,
                    button_width: U,
                    button_height: L,
                    file_types: ["*.jpg", "*.jpeg", "*.png", "*.gif", "*.bmp"].join(";"),
                    custom_settings: {
                        files: []
                    },
                    flash_url: I.uploader.path,
                    button_placeholder: t[0],
                    requeue_on_error: !0,
                    swfupload_loaded_handler: function() {
                        this.refreshCookies(), $(this.getMovieElement()).addClass("_swfUpload")
                    },
                    file_queued_handler: function(t) {
                        this.customSettings.files.push(t)
                    },
                    file_dialog_start_handler: function() {
                        this.customSettings.files.length = 0
                    }
                }, i))
            },
            onSetup: function() {
                this._isSetSwfUpload = !1, this.childParts.editor.collection = r, this.listenTo(this.childParts.editor, {
                    change: function() {
                        this._updatePostBtnState(), this._updateSticonBtn(), this.trigger("change")
                    },
                    detectUrl: function(t) {
                        this._isExternalShareWriting || this._isModifyMode() || this._scrapPromise.isPending() || (this._scrapPromise = this.scrap(t))
                    },
                    post: function() {
                        this._isPostAvailable() && this.postActivity()
                    }
                }), this.listenTo(this.childParts.friendInput, {
                    change: function() {
                        this._updateFriendInputBtn()
                    },
                    complete: function() {
                        this._isPostAvailable() && this.postActivity()
                    }
                }), this.listenTo(this, {
                    changeMode: function(t) {
                        this._pendedScrapUrl && t === b.LINK && (this.childParts.mediaMode.scrap(this._pendedScrapUrl), this._pendedScrapUrl = null)
                    },
                    activateFriendInput: function() {
                        this.childParts.friendInput.isShown() || this.childParts.friendInput.show(), this._updateFriendInputBtn()
                    }
                }), this._writingSettingModel = new o
            },
            onRender: function() {
                this.$el.addClass(this.styles.goaway)
            },
            events: {
                "change ._photoFileInputOutmost": function(t) {
                    var i = $(t.currentTarget);
                    i.val() && this.changeMode(b.PHOTO).next(function() {
                        var t = this.childParts.mediaMode;
                        this.listenTo(t, {
                            domready: function() {
                                t.changeFileInput(i)
                            }
                        })
                    })
                },
                "keydown ._photoFileInputOutmost": function(t) {
                    agent.browser.is.ie && t.keyCode === g.KEY.ENTER && t.preventDefault()
                },
                "change ._videoFileInputOutmost": function(t) {
                    var i = $(t.currentTarget);
                    i.val() && this.changeMode(b.VIDEO).next(function() {
                        var t = this.childParts.mediaMode;
                        this.listenTo(t, {
                            domready: function() {
                                t.postVideoByFileInput(i)
                            }
                        })
                    })
                },
                "keydown ._videoFileInputOutmost": function(t) {
                    agent.browser.is.ie && t.keyCode === g.KEY.ENTER && t.preventDefault()
                },
                "click ._changeModeBtn": function(t) {
                    var i = $(t.currentTarget).data("mode");
                    t.preventDefault(), this.changeMode(i)
                },
                "click ._permissionBtn": function(t) {
                    t.preventDefault(), this.addPart("permissionLayer", c, {
                        selector: "._permissionLayer",
                        options: {
                            button: this.ui.permissionBtn,
                            exceptionClass: "_permissionBtn"
                        },
                        listeners: {
                            show: function() {
                                this.ui.permissionTooltip.hide(), this.childParts.permissionLayer.setUseReposition(!this._isExternalShareWriting), this.childParts.permissionLayer.setPermission(this._permission), this.childParts.permissionLayer.setEnableShare(this._sharable), this.childParts.permissionLayer.setEnableAllCommentWritable(this._commentWritable), this.childParts.permissionLayer.toggleAllItem(!this._isFriendsPermissionShare), this.ui.permissionBtn.addClass(this.styles.activePermissionBtn)
                            },
                            hide: function() {
                                this.ui.permissionBtn.removeClass(this.styles.activePermissionBtn)
                            },
                            change: function(t) {
                                this._setPermission(t)
                            },
                            changeCommentWritable: function(t) {
                                this._setCommentWritable(t)
                            },
                            changeSharable: function(t) {
                                this._setEnableShare(t)
                            }
                        }
                    }).next(function() {
                        this.childParts.permissionLayer.toggle()
                    })
                },
                "click ._friendInputBtn": function(t) {
                    t.preventDefault(), this.childParts.friendInput.toggle(), this.childParts.friendInput.isShown() && this.childParts.friendInput.focus(), this._updateFriendInputBtn()
                },
                "click ._cancelBtn": function(t) {
                    t.preventDefault(), this.cancel()
                },
                "click ._postBtn": function(t) {
                    t.preventDefault(), this._isPostAvailable() && this.postActivity()
                },
                "mousedown ._sticonInputBtn": function(t) {
                    t.preventDefault(), this._toggleSticonLayer()
                },
                "dragenter ._dropZone": function(t) {
                    $(t.target).closest(this.ui.dropSign).length && this.ui.dropSign.addClass(this.styles.focus)
                },
                "dragleave ._dropZone": function(t) {
                    $(t.target).closest(this.ui.dropSign).length && this.ui.dropSign.removeClass(this.styles.focus)
                },
                "drop ._dropZone": function(t) {
                    var i, e = this,
                        s = t.originalEvent.dataTransfer.files,
                        n = this._mode,
                        o = this._mode;
                    switch (n === b.TEXT && (o = this._getSuitableModeByDroppedFiles(s)), i = _.filter(s, function(t) {
                        return e._getSuitableModeByFile(t) === o
                    }), n) {
                        case b.TEXT:
                            if (!o) return void h.alert(intl.t("writing.textMode.error.invalidFile"));
                            o !== n && this.changeMode(o).next(function() {
                                var t = this.childParts.mediaMode;
                                this.listenTo(t, {
                                    domready: function() {
                                        t.dropFiles(i)
                                    }
                                })
                            });
                            break;
                        case b.PHOTO:
                            if (!i.length) return void h.alert(intl.t("writing.photoMode.error.invalidFile"));
                            this.childParts.mediaMode.dropFiles(i);
                            break;
                        case b.VIDEO:
                            if (!i.length) return void h.alert(intl.t("writing.videoMode.error.invalidFile"));
                            this.childParts.mediaMode.dropFiles(i)
                    }
                }
            },
            windowEvents: {
                beforeunload: function(t) {
                    var i;
                    if (this._hasContentWhenCancel()) {
                        if (i = intl.t(this._isModifyMode() ? "writing.modifyDialog.reloadWarningPlainText" : "writing.postDialog.reloadWarningPlainText"), !agent.isIe8AndBelow()) return i;
                        t.originalEvent.returnValue = i
                    }
                }
            },
            documentEvents: {
                dragstart: function(t) {
                    t.preventDefault()
                },
                dragover: function(t) {
                    t.preventDefault(), this._isDroppable() && (this._showDropSign(), this._hideDropSign())
                },
                drop: function(t) {
                    t.preventDefault(), this.ui.dropSign.hide()
                }
            },
            focus: function() {
                this.childParts.editor.focus()
            },
            changeMode: function(t, i) {
                var e = this._mode === b.READY && t !== b.READY,
                    s = i && i.isHideFriendInput;
                return this._mode !== t ? (this._isExternalShareWriting = i && i.isExternalShareWriting ? !0 : !1, this._originalModel = null, this._mediaType = t, t === b.MODIFY ? (this._changeModifyMode(t, i), this._setKantGroup(C)) : this._setKantGroup(O), Y && (t !== b.READY ? (this.childParts.titleRecover.startCheck(), this._isSetSwfUpload || this._initiateSwfUpload()) : (this._isSetSwfUpload = !1, this.childParts.titleRecover.stopCheck())), this.$el.toggleClass(this.styles.goaway, t === b.READY), e && this._prepareWriting(t, i), this.ui.friendInputBtn.toggle(!s), this._isMediaMode(this._mediaType) ? this._addMediaMode(t, i) : (this._removeMediaMode(t, i), this.flow.fork())) : void 0
            },
            _setKantGroup: function(t) {
                var i = this.$el.attr(T.DATA_ATTRIBUTE_GROUP_NAME);
                this.$el.attr(T.DATA_ATTRIBUTE_GROUP_NAME, t), this.$("[" + T.DATA_ATTRIBUTE_GROUP_NAME + '="' + i + '"]').attr(T.DATA_ATTRIBUTE_GROUP_NAME, t)
            },
            _prepareWriting: function(t, s) {
                var n, o = !1;
                switch (t) {
                    case b.SHARE:
                        n = s.sharedModel.get("permission");
                        break;
                    case b.MODIFY:
                        n = this._originalModel.get("permission");
                        break;
                    default:
                        n = i.getProperty(e.TYPE.PERMISSION)
                }(t === b.SHARE || this._mediaType === b.SHARE) && (o = s.sharedModel.isFriendsPermission()), this._fetchSticonCategories(), this.flow.forkWith(this._writingSettingModel.fetch(), "writingSetting").next(function() {
                    var t = this._writingSettingModel.get("sharable"),
                        i = this._writingSettingModel.get("comment_all_writable");
                    this.childParts.editor.setHashtags(this._writingSettingModel.get("hashtags")), this._isModifyMode() && (t = this._originalModel.get("sharable"), i = this._originalModel.get("comment_all_writable")), this._setEnableShare(t), this._setCommentWritable(i)
                }), this._setPermission(n), this._isFriendsPermissionShare = o, this._resizeProfile(), this._isExternalShareWriting || this._isModifyMode() || this._showPermissionTooltip()
            },
            _changeModifyMode: function(t, i) {
                this._originalModel = i.originalModel, this._mediaType = this._originalModel.getDisplayMediaType() || b.TEXT, this._mode = t, i.sharedModel = this._mediaType === b.SHARE && this._originalModel.getShareActivity(), this.ui.mediaContainer.addClass(this.styles.mediaOpen), this.flow.forkWith(this._originalModel.get("withTags").fetch().fail(l.getHandler())).next(function() {
                    this._originalModel.get("withTags").length && (this.childParts.friendInput.setWithTags(this._originalModel.get("withTags")), this.childParts.friendInput.show(), this._updateFriendInputBtn()), this.childParts.editor.setContent(this._originalModel.get("content_decorators"))
                })
            },
            _addMediaMode: function(t, i) {
                return this.isAvailableChildPart("mediaMode") && this.removePart("mediaMode"), this.flow.fork().next(function() {
                    return this.addPart("mediaMode", R[t], {
                        selector: "._mediaModeContainer",
                        options: {
                            modeOptions: _.defaults({
                                originalModel: this._originalModel
                            }, i)
                        }
                    }).next(function() {
                        this._isModifyMode() || (this.childParts.mediaMode.show(), this.listenTo(this.childParts.mediaMode, {
                            change: function() {
                                this._updatePostBtnState(), this.trigger("change")
                            },
                            cancel: function() {
                                this.changeMode(b.TEXT)
                            },
                            domReady: function() {
                                this._afterChangeMode(t, i)
                            },
                            activateFriendInput: function() {
                                this.trigger("activateFriendInput")
                            },
                            initiateSwfUpload: function() {
                                this.initiateSwfUpload.apply(this, arguments)
                            }
                        }), this.childParts.mediaMode.isDomReady() && this._afterChangeMode(t, i))
                    })
                })
            },
            _removeMediaMode: function(t, i) {
                this.removePart("mediaMode"), this._isModifyMode() || (this.ui.mediaContainer.removeClass(this.styles.mediaOpen), this._afterChangeMode(t, i))
            },
            _toggleSticonLayer: function() {
                var t = this;
                this.childParts.editor.isMaxSticonCount() || this._fetchSticonCategories().then(function() {
                    t.addPart("sticon", E, {
                        selector: "._sticonLayerContainer",
                        options: {
                            collection: r,
                            exceptionClass: "_sticonInputBtn",
                            writingArea: t.ui.sticonBtn,
                            usedSticon: a
                        },
                        listeners: {
                            addSticon: function(i, e) {
                                t.childParts.editor.restoreRange(), t.childParts.editor.addSticon(i, e)
                            }
                        }
                    }).next(function(i) {
                        i || t.childParts.sticon.toggle(), (i || t.childParts.sticon.isShown()) && t.childParts.editor.isFocusEditor() && t.childParts.editor.saveRange()
                    })
                })
            },
            _fetchSticonCategories: function() {
                return r.length ? Q.resolve() : this.flow.forkWith(r.fetch().fail(l.getHandler()).then(function() {
                    a.loadUsedSticon(i.get("id"))
                })).getPromise()
            },
            _afterChangeMode: function(t, i) {
                var e, s = this._isMediaMode(this._mediaType),
                    n = i && i.isSkipLinkFocus,
                    o = i && i.hashtag;
                s && this.ui.mediaContainer.addClass(this.styles.mediaOpen), t !== b.LINK || n ? (this.childParts.editor.focus(), o && (e = [{
                    type: P.DECORATOR_TYPE.TEXT,
                    text: "\n"
                }, {
                    type: P.DECORATOR_TYPE.HASHTAG,
                    text: i.hashtag
                }], this.childParts.editor.setContent(e, {
                    caretPosition: u.CARET_POSITION.START
                }))) : this.childParts.mediaMode.focus(), this._mode = t, this.trigger("changeMode", t), this._updatePostBtnState()
            },
            cancel: function(t) {
                var i = this,
                    e = this.childParts.editor,
                    s = t && t.beforeUnload,
                    n = Q.resolve(),
                    o = this._isModifyMode() ? "writing.modifyDialog" : "writing.postDialog";
                return t && _.isBoolean(t.focus) && !t.focus && (e = null), this._hasContentWhenCancel() && (n = n.then(function() {
                    return h.confirm(intl.t(s ? o + ".reloadWarning" : o + ".cancelWarning"), e, {
                        cancel: intl.t(s ? "writing.stayHere" : "writing.continueWriting"),
                        ok: intl.t(s ? "writing.leavePage" : o + ".cancelWriting"),
                        reversedButton: !0
                    })
                })), n.then(function() {
                    i._clearContent(), i.changeMode(b.READY), i.trigger("close")
                })
            },
            scrap: function(t) {
                var i = this,
                    e = this._hasMediaContent();
                return e || this._isProgress() ? Q.reject() : this._mode === b.LINK ? this.childParts.mediaMode.scrap(t) : this.changeMode(b.LINK, {
                    isSkipLinkFocus: !0
                }).next(function() {
                    i._pendedScrapUrl = t
                })
            },
            _resizeProfile: function() {
                m.resize(this.ui.profileImg, this.ui.profileImg.parent(), {
                    url: M.getUrl(i.get("profile_thumbnail_url"), x)
                })
            },
            _clearContent: function() {
                this.childParts.editor.clearContent(), this._updateSticonBtn(), this.childParts.friendInput.clearContent(), this.ui.permissionTooltip.stop().hide(), this._updateFriendInputBtn(), this._updateSticonBtn(), this._updatePostBtnState()
            },
            _isMediaMode: function(t) {
                return _.contains([b.PHOTO, b.VIDEO, b.MUSIC, b.LINK, b.SHARE], t)
            },
            _isProgressableMode: function(t) {
                return _.contains([b.PHOTO, b.VIDEO, b.LINK], t)
            },
            _isDroppable: function() {
                return _.contains([b.TEXT, b.PHOTO, b.VIDEO], this._mode)
            },
            _isPhotoFile: function(t) {
                return /^image\/(jpe?g|bmp|png|gif)$/.test(t.type)
            },
            _isVideoFile: function(t) {
                return /^video\/.*/.test(t.type)
            },
            _isModifyMode: function() {
                return this._mode === b.MODIFY && this._originalModel ? !0 : !1
            },
            _getSuitableModeByFile: function(t) {
                return this._isPhotoFile(t) ? b.PHOTO : this._isVideoFile(t) ? b.VIDEO : null
            },
            _getSuitableModeByDroppedFiles: function(t) {
                var i = null;
                return _.some(t, function(t) {
                    return i = this._getSuitableModeByFile(t), i ? !0 : void 0
                }, this), i
            },
            _getContentParts: function() {
                var t = [this.childParts.editor, this.childParts.friendInput];
                return this.isAvailableChildPart("mediaMode") && t.push(this.childParts.mediaMode), t
            },
            _hasContent: function() {
                return _.some(this._getContentParts(), function(t) {
                    return t && t.hasContent()
                })
            },
            _isProgress: function() {
                return this.childParts.editor.isProgress() || this._isProgressableMode(this._mode) && this.isAvailableChildPart("mediaMode") && this.childParts.mediaMode.isProgress()
            },
            _hasContentWhenCancel: function() {
                return this._getDisplayMode() === b.SHARE ? this.childParts.editor.hasContent() : this._hasContent()
            },
            _setPermission: function(t) {
                this.ui.permissionIcon.removeClass([this.styles.permissionIconFriend, this.styles.permissionIconMeOnly, this.styles.permissionIconAll].join(" ")), t === s.PERMISSION.FRIENDS ? (this.ui.permissionIcon.addClass(this.styles.permissionIconFriend).text(intl.t("writing.permission.friends")), this._permission = s.PERMISSION.FRIENDS) : t === s.PERMISSION.ME_ONLY ? (this.ui.permissionIcon.addClass(this.styles.permissionIconMeOnly).text(intl.t("writing.permission.meOnly")), this._permission = s.PERMISSION.ME_ONLY) : (this.ui.permissionIcon.addClass(this.styles.permissionIconAll).text(intl.t("writing.permission.all")), this._permission = s.PERMISSION.ALL), this.childParts.editor.setIsShowHashtagGuide(this._permission !== s.PERMISSION.ALL)
            },
            _setCommentWritable: function(t) {
                this._commentWritable = t
            },
            _setEnableShare: function(t) {
                this._sharable = t
            },
            _showPermissionTooltip: function() {
                var t;
                switch (this._permission) {
                    case s.PERMISSION.ALL:
                        t = intl.t("writing.permission.tooltipAll");
                        break;
                    case s.PERMISSION.FRIENDS:
                        t = intl.t("writing.permission.tooltipFriend")
                }
                this.ui.permissionTooltipText.html(t), this.ui.permissionTooltip.stop(!0, !0).fadeIn(F).delay(B).fadeOut(F)
            },
            _updateFriendInputBtn: function() {
                var t = this.childParts.friendInput.hasWithTags(),
                    i = this.childParts.friendInput.isShown();
                this.ui.friendInputBtn.toggleClass(this.styles.friendInputOn, t).toggleClass(this.styles.friendInputClick, t && i).toggleClass(this.styles.friendInputSelected, !t && i)
            },
            _isPostAvailable: function() {
                return !this._isProgress() && this._hasContent()
            },
            _updatePostBtnState: function() {
                this._isPostAvailable() ? (this.ui.postBtn.addClass(this.styles.activePostBtn), this.ui.postBtn.removeClass(this.styles.inactivePostBtn)) : (this.ui.postBtn.addClass(this.styles.inactivePostBtn), this.ui.postBtn.removeClass(this.styles.activePostBtn))
            },
            _updateSticonBtn: function() {
                var t = this.childParts.editor.isMaxSticonCount();
                this.ui.sticonBtn.toggleClass(this.styles.sticonDisable, t), this.ui.sticonBtn.toggleClass(this.styles.sticonOn, !t && this.childParts.editor.hasSticon())
            },
            _hasMediaPath: function() {
                return (this._mode === b.PHOTO || this._mode === b.VIDEO) && this.childParts.mediaMode.hasContent()
            },
            _hasScrapContent: function() {
                return this._mode === b.LINK && this.childParts.mediaMode.hasContent()
            },
            _hasShareId: function() {
                return this._mode === b.SHARE && this.childParts.mediaMode.hasContent()
            },
            _hasTrackId: function() {
                return this._mode === b.MUSIC && this.childParts.mediaMode.hasContent()
            },
            _getDisplayMode: function() {
                return this._isModifyMode() && this._originalModel ? this._originalModel.getDisplayMediaType() || b.TEXT : this._mode
            },
            _buildRequestData: function() {
                var t, i = {
                    content: this.childParts.editor.getContent(),
                    permission: this._permission,
                    comment_all_writable: this._commentWritable,
                    enable_share: this._sharable
                };
                return this.childParts.friendInput.hasWithTags() && (i.with_tags = this.childParts.friendInput.getWithTags()), this._hasMediaPath() ? (i.media_type = this._mode === b.PHOTO ? s.MEDIA_TYPE.IMAGE : s.MEDIA_TYPE.VIDEO, i.media_path = this.childParts.mediaMode.getMediaPath()) : this._hasScrapContent() ? (i.media_type = s.MEDIA_TYPE.SCRAP, i.scrap_content = this.childParts.mediaMode.getScrapContent()) : this._hasTrackId() ? i.track_id = this.childParts.mediaMode.getTrackId() : this._hasShareId() && (t = this.childParts.mediaMode.getShareId()), {
                    params: i,
                    shareId: t
                }
            },
            isFeedWriting: function() {
                return "feed" === this.parent.name && "writing" === this.name
            },
            setIsMyStoryOfMe: function(t) {
                this._isMyStoryOfMe = t
            },
            setIsHashtagWriting: function(t) {
                this._isHashtagWriting = t
            },
            postActivity: function(t, n) {
                var o, r, a = this._isExternalShareWriting,
                    c = !1,
                    u = this._isModifyMode(),
                    p = n || this._getDisplayMode(),
                    g = this.flow.fork("post");
                return this.flow.isChildFlowPending("post") ? Q.reject() : p === b.SHARE && this._permission === s.PERMISSION.ALL && this.childParts.mediaMode.getPermission() === s.PERMISSION.FRIENDS ? h.alert(intl.t("writing.sharePermissionError")).then(function() {
                    return Q.reject()
                }) : (t = t || this._buildRequestData(), n = n || this._mode, o = u ? this._originalModel : new s, g.next(function() {
                    return p === b.SHARE || t.params.permission === s.PERMISSION.ME_ONLY ? Q.resolve() : i.setProperty(e.TYPE.PERMISSION, t.params.permission)
                }).next(function() {
                    return u ? o.requestUpdating({
                        content: t.params.content,
                        permission: t.params.permission,
                        with_tags: t.params.with_tags,
                        enable_share: t.params.enable_share,
                        comment_all_writable: t.params.comment_all_writable
                    }) : o.requestPosting(t.params, t.shareId)
                }).next(function() {
                    var t = !1;
                    n === b.SHARE && this.childParts.mediaMode.model.set("share_count", this.childParts.mediaMode.model.get("share_count") + 1), this.changeMode(b.READY), this._clearContent(), t = !u && (this.isFeedWriting() || this._isHashtagWriting), t && (f.scrollTo(0, !0, k), c = !0)
                }).next(function() {
                    return a || t.params.permission !== s.PERMISSION.ME_ONLY || this._isMyStoryOfMe ? void 0 : (c = !0, h.confirm(intl.t("writing.permission.meOnlyLayer"), null, {
                        cancel: intl.t("writing.permission.meOnlyLayerMoveNow"),
                        ok: intl.t("writing.permission.meOnlyLayerLater"),
                        reversedButton: !0,
                        uncoloredButton: !0
                    }).fail(function() {
                        space.Router.navigate("/" + i.get("urlKey") + "/" + o.get("urlKey"))
                    }))
                }).next(function() {
                    var i = {}, e = u ? C : O;
                    this.trigger("close", !0), a || (c || u || d.show(d.TYPE.SUCCESS, {
                        activityUrlKey: o.get("urlKey")
                    }), this._hasMediaContent() || (n = b.TEXT), u ? o.trigger("update") : this.trigger("post", o, n), r = _.pluck(JSON.parse(t.params.content), "type"), _.some(r, function(t) {
                        switch (t) {
                            case P.DECORATOR_TYPE.STICON:
                                i.stc = D;
                                break;
                            case P.DECORATOR_TYPE.PROFILE:
                                i.men = D;
                                break;
                            case P.DECORATOR_TYPE.HASHTAG:
                                i.hst = D
                        }
                        return i.stc && i.men && i.hst
                    }), t.params.with_tags && (i.wth = D), v.send(e + A + w, i))
                }).stopped(l.getHandler()), g.getPromise())
            }
        });
    return K.MODE = b, K
});
define("module/static/writingView", ["template/writing", "module/static/cover", "common/util", "common/kantUtil", "part/writing/WritingPart"], function(t, e, i, s, o) {
    return new(space.StaticModule.extend({
        template: t.writingView,
        skipGlobalEvents: !0,
        styles: {
            dimmedWrite: "write"
        },
        childParts: {
            view: o,
            titleRecover: "part/plugin/TitleRecoveryPart"
        },
        onSetup: function() {
            this.listenTo(this.childParts.view, {
                post: function(t, e) {
                    this.trigger("post", t, e)
                },
                close: function() {
                    this.hide()
                }
            })
        },
        initialize: function() {
            this._isShown = !1, this._isBeforeUnload = !1, this._prevBeforeUnload = null, this._mode = null, this._options = null
        },
        documentEvents: {
            keydown: function(t) {
                t.keyCode === i.KEY.ESC && this.childParts.view.cancel()
            }
        },
        setIsMyStoryOfMe: function(t) {
            this.childParts.view.setIsMyStoryOfMe(t)
        },
        setIsHashtagWriting: function(t) {
            this.childParts.view.setIsHashtagWriting(t)
        },
        show: function(t, e) {
            var i, n = this,
                h = e && e.hashtag,
                r = space.Router.getCurrentRouter().getResolver().getName(),
                a = !1;
            e && (e.sharedModel || e.originalModel) && (i = e.sharedModel ? e.sharedModel.get("actor") : e.originalModel.get("actor"), a = "myStory/feed" === r || "post" === r && i.get("isMe")), this.setIsMyStoryOfMe(a), this.setIsHashtagWriting( !! h), this._mode = t, this._options = e, t !== o.MODE.MODIFY && s.sendPageView("new"), n._show()
        },
        _show: function() {
            var t = this;
            this.childParts.titleRecover.startCheck(), e.dimmed(this.styles.dimmedWrite), e.show(this.childParts.view.$el), this.childParts.view.changeMode(this._mode, this._options), this.attachGlobalEvents(), this._isShown = !0, this._prevBeforeUnload = space.Router.onBeforeUnload, space.Router.onBeforeUnload = function() {
                return t._isBeforeUnload = !0, t.childParts.view.cancel({
                    beforeUnload: !0
                })
            }, this.domReady(!0)
        },
        hide: function() {
            this._isBeforeUnload = !1, this._mode = null, this._options = null, this._isShown && (e.hide(), this.detachGlobalEvents(), this._isShown = !1, space.Router.onBeforeUnload = this._prevBeforeUnload, this.childParts.titleRecover.stopCheck())
        },
        onRoute: function() {
            this.hide()
        }
    }))
});
define("template/gnbFriend", ["Handlebars"], function(a) {
    var t = function(t) {
        var e = a.template(t);
        return function(a) {
            return e(a, {
                partials: n
            })
        }
    }, n = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i, r, l = "",
                    c = n.helperMissing,
                    d = this.escapeExpression;
                return l += '<span class="bl_arrow_up"></span><div tabindex="0" class="_friendLayerFirstShadow blind"></div><div class="f_cont"><div data-part="menu"></div><div data-part="list"></div><div class="_gnbFriendLoading loading" style="display:none">' + d((i = n.img || t && t.img, r = {
                    hash: {
                        src: "/img/loading_circle.gif",
                        width: "24",
                        height: "24",
                        alt: "friend.alt.loading"
                    },
                    data: s
                }, i ? i.call(t, r) : c.call(t, "img", r))) + '</div><span class="line"></span></div><div tabindex="0" class="_friendLayerLastShadow blind"></div>'
            });
            return a.wrap = '<div class="f_ly _friendLayer _ignoreScroll" style="display:none" data-kant-group="gnb.f">', a
        }(),
        friendMenuLayout: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i, r, l = "",
                    c = n.helperMissing,
                    d = this.escapeExpression;
                return l += '<li class="_gnbFriendMenu" data-type="friends"><a href="#" data-kant-id="174">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.title.gnbFriendTab", r) : c.call(t, "t", "friend.title.gnbFriendTab", r))) + '</a></li><li class="_gnbFriendMenu" data-type="requests"><a href="#" data-kant-id="175">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.title.gnbRequestsTab", r) : c.call(t, "t", "friend.title.gnbRequestsTab", r))) + ' <span class="ico_dot _newBadge" style="display:none">new</span></a></li>'
            });
            return a.wrap = '<ul class="f_tab">', a
        }(),
        friendListLayout: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i, r, l = "",
                    c = n.helperMissing,
                    d = this.escapeExpression;
                return l += '<div class="_gnbFriendLayout"><div class="art_wrap _gnbFriendLayout"><div class="f_article"><div data-part="newList"></div><a href="/s/friends" class="bn_flst _gnbFriendLink" data-kant-id="176">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.title.gnbFriendList", r) : c.call(t, "t", "friend.title.gnbFriendList", r))) + ' <strong class="_gnbFriendCount">' + d((i = n.numberFormat || t && t.numberFormat, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, t && t.total, r) : c.call(t, "numberFormat", t && t.total, r))) + '</strong></a><div class="_listWrap"><div data-part="favoriteList"></div><div data-part="unfavoriteList"></div></div></div></div><a href="/s/friends" class="bn_fradmin _gnbFriendLink" data-kant-id="177">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.link.manageFriend", r) : c.call(t, "t", "friend.link.manageFriend", r))) + ' <span class="ico_arr"></span></a></div><div class="_gnbNoFriend" style="display:none"><div class="art_wrap no_data"><div class="f_article"><ul class="receive"><li>' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.paragraph.gnbNoFriend", r) : c.call(t, "t", "friend.paragraph.gnbNoFriend", r))) + '</li></ul></div></div><a href="/s/friends/recommend" class="bn_fradmin _gnbFriendLink" data-kant-id="178">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.link.showAllRecommend", r) : c.call(t, "t", "friend.link.showAllRecommend", r))) + ' <span class="ico_arr"></span></a></div>'
            });
            return a.wrap = "<div>", a
        }(),
        newList: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i, r, l, c = "",
                    d = n.helperMissing,
                    o = this.escapeExpression,
                    h = "function";
                return c += '<a href="/s/friends" class="bn_flst _gnbFriendLink" data-kant-id="179">' + o((r = n.t || t && t.t, l = {
                    hash: {},
                    data: s
                }, r ? r.call(t, "friend.title.gnbNewList", l) : d.call(t, "t", "friend.title.gnbNewList", l))) + " <strong>" + o((i = t && t.items, i = null == i || i === !1 ? i : i.length, typeof i === h ? i.apply(t) : i)) + '</strong></a><ul class="receive _list"></ul>'
            });
            return a.wrap = "<div>", a
        }(),
        favoriteList: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i = "";
                return i
            });
            return a.wrap = '<ul class="receive">', a
        }(),
        unfavoriteList: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i = "";
                return i
            });
            return a.wrap = '<ul class="receive v2">', a
        }(),
        friendItem: function() {
            var a = t(function(a, t, n, e, s) {
                function i(a, t) {
                    var e, s, i, r = "";
                    return r += ' <img src="' + u((s = n.profileImage || a && a.profileImage, i = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "36"
                        },
                        data: t
                    }, s ? s.call(a, i) : f.call(a, "profileImage", i))) + '" class="_profileImage" alt="', (s = n.display_name) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.display_name, e = typeof s === m ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), r += u(e) + '"> '
                }
                function r(a, t) {
                    var e, s, i = "";
                    return i += ' <span class="ic_birthday">' + u((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.alt.birthday", s) : f.call(a, "t", "friend.alt.birthday", s))) + "</span> "
                }
                function l(a, t) {
                    var e, s, i = "";
                    return i += ' <span class="ico_music">' + u((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.alt.music", s) : f.call(a, "t", "friend.alt.music", s))) + "</span> "
                }
                function c(a, t) {
                    var e, s, i = "";
                    return i += ' <button class="_makeUnfav bn_inter on" data-kant-id="181">' + u((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.btn.makeUnfav", s) : f.call(a, "t", "friend.btn.makeUnfav", s))) + "</button> "
                }
                function d(a, t) {
                    var e, s, i = "";
                    return i += ' <button class="_makeFav bn_inter" data-kant-id="182">' + u((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.btn.makeFav", s) : f.call(a, "t", "friend.btn.makeFav", s))) + "</button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var o, h, p = "",
                    f = n.helperMissing,
                    u = this.escapeExpression,
                    m = "function",
                    g = this;
                return p += '<a href="/', (h = n.urlKey) ? o = h.call(t, {
                    hash: {},
                    data: s
                }) : (h = t && t.urlKey, o = typeof h === m ? h.call(t, {
                    hash: {},
                    data: s
                }) : h), p += u(o) + '" class="_gnbFriendLink" data-kant-id="180"><span class="img_user">', o = n["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: g.noop,
                    fn: g.program(1, i, s),
                    data: s
                }), (o || 0 === o) && (p += o), p += ' <span class="line"></span></span> <strong class="_profileName">', (h = n.display_name) ? o = h.call(t, {
                    hash: {},
                    data: s
                }) : (h = t && t.display_name, o = typeof h === m ? h.call(t, {
                    hash: {},
                    data: s
                }) : h), p += u(o) + "</strong> ", o = n["if"].call(t, t && t.is_birthday, {
                    hash: {},
                    inverse: g.noop,
                    fn: g.program(3, r, s),
                    data: s
                }), (o || 0 === o) && (p += o), p += "<p>", o = n["if"].call(t, t && t.isMusicStatus, {
                    hash: {},
                    inverse: g.noop,
                    fn: g.program(5, l, s),
                    data: s
                }), (o || 0 === o) && (p += o), p += " ", (h = n.statusMessage) ? o = h.call(t, {
                    hash: {},
                    data: s
                }) : (h = t && t.statusMessage, o = typeof h === m ? h.call(t, {
                    hash: {},
                    data: s
                }) : h), p += u(o) + "</p></a> ", o = n["if"].call(t, t && t.is_favorite, {
                    hash: {},
                    inverse: g.program(9, d, s),
                    fn: g.program(7, c, s),
                    data: s
                }), (o || 0 === o) && (p += o), p
            });
            return a.wrap = "<li>", a
        }(),
        friendRequestsLayout: function() {
            var a = t(function(a, t, n, e, s) {
                function i(a, t) {
                    var e, s = "";
                    return s += '<div class="art_wrap _listWrap"><div data-part="receivedList"></div><div data-part="friendRecommendList"></div><div data-part="storyPlusRecommendList"></div>', e = n["if"].call(a, a && a.recommendsCount, {
                        hash: {},
                        inverse: h.noop,
                        fn: h.program(2, r, t),
                        data: t
                    }), (e || 0 === e) && (s += e), s += "</div>"
                }
                function r(a, t) {
                    var e, s, i = "";
                    return i += ' <a href="/s/friends/recommend" class="bn_all _gnbFriendLink" data-kant-id="178">' + o((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.link.showAllRecommend", s) : d.call(a, "t", "friend.link.showAllRecommend", s))) + "</a> "
                }
                function l(a, t) {
                    var e, s, i = "";
                    return i += '<div class="art_wrap no_data"><div class="f_article"><ul class="receive"><li>' + o((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.paragraph.gnbNoRequests", s) : d.call(a, "t", "friend.paragraph.gnbNoRequests", s))) + "</li></ul></div></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var c, d = n.helperMissing,
                    o = this.escapeExpression,
                    h = this;
                return c = n["if"].call(t, t && t.total, {
                    hash: {},
                    inverse: h.program(4, l, s),
                    fn: h.program(1, i, s),
                    data: s
                }), c || 0 === c ? c : ""
            });
            return a.wrap = "<div>", a
        }(),
        invitationList: function() {
            var a = t(function(a, t, n, e, s) {
                function i(a, t) {
                    var e, s, i, r = "";
                    return r += ' <a href="/s/friends/requests" class="bn_flst _gnbFriendLink" data-kant-id="184">' + c((s = n.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.title.gnbReceivedList", i) : l.call(a, "t", "friend.title.gnbReceivedList", i))) + ' <strong class="_count">' + c((s = n.numberFormat || a && a.numberFormat, i = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, (e = a && a.items, null == e || e === !1 ? e : e.length), i) : l.call(a, "numberFormat", (e = a && a.items, null == e || e === !1 ? e : e.length), i))) + '</strong></a><ul class="receive _list"></ul>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var r, l = n.helperMissing,
                    c = this.escapeExpression,
                    d = this;
                return r = n["if"].call(t, (r = t && t.items, null == r || r === !1 ? r : r.length), {
                    hash: {},
                    inverse: d.noop,
                    fn: d.program(1, i, s),
                    data: s
                }), r || 0 === r ? r : ""
            });
            return a.wrap = '<div class="f_article">', a
        }(),
        invitationItem: function() {
            var a = t(function(a, t, n, e, s) {
                function i(a, t) {
                    var e, s, i, r = "";
                    return r += ' <img src="' + h((s = n.profileImage || a && a.profileImage, i = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "36"
                        },
                        data: t
                    }, s ? s.call(a, i) : o.call(a, "profileImage", i))) + '" class="_profileImage" alt="', (s = n.display_name) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.display_name, e = typeof s === p ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), r += h(e) + '"> '
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var r, l, c, d = "",
                    o = n.helperMissing,
                    h = this.escapeExpression,
                    p = "function",
                    f = this;
                return d += '<a href="/', (l = n.urlKey) ? r = l.call(t, {
                    hash: {},
                    data: s
                }) : (l = t && t.urlKey, r = typeof l === p ? l.call(t, {
                    hash: {},
                    data: s
                }) : l), d += h(r) + '" class="_gnbFriendLink" data-kant-id="185"><span class="img_user">', r = n["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: f.noop,
                    fn: f.program(1, i, s),
                    data: s
                }), (r || 0 === r) && (d += r), d += ' <span class="line"></span></span> <strong class="_profileName">', (l = n.display_name) ? r = l.call(t, {
                    hash: {},
                    data: s
                }) : (l = t && t.display_name, r = typeof l === p ? l.call(t, {
                    hash: {},
                    data: s
                }) : l), d += h(r) + '</strong></a> <button class="btn_com btn_or bn_accep _accept" data-kant-id="186"><span>' + h((l = n.t || t && t.t, c = {
                    hash: {},
                    data: s
                }, l ? l.call(t, "friend.btn.accept", c) : o.call(t, "t", "friend.btn.accept", c))) + "</span></button>"
            });
            return a.wrap = '<li class="addbtn">', a
        }(),
        storyRecommendList: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i, r, l = "",
                    c = n.helperMissing,
                    d = this.escapeExpression;
                return l += '<a href="/s/friends/recommend" class="bn_flst _gnbFriendLink" data-kant-id="187">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.title.gnbRecommendList", r) : c.call(t, "t", "friend.title.gnbRecommendList", r))) + '</a><ul class="receive _list"></ul>'
            });
            return a.wrap = '<div class="f_article">', a
        }(),
        storyPlusRecommendList: function() {
            var a = t(function(a, t, n, e, s) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var i, r, l = "",
                    c = n.helperMissing,
                    d = this.escapeExpression;
                return l += '<a href="/s/friends/recommend" class="bn_flst _gnbFriendLink" data-kant-id="478">' + d((i = n.t || t && t.t, r = {
                    hash: {},
                    data: s
                }, i ? i.call(t, "friend.title.gnbStoryPlusRecommendList", r) : c.call(t, "t", "friend.title.gnbStoryPlusRecommendList", r))) + '</a><ul class="receive _list"></ul>'
            });
            return a.wrap = '<div class="f_article">', a
        }(),
        storyRecommendItem: function() {
            var a = t(function(a, t, n, e, s) {
                function i(a, t) {
                    var e, s, i, r = "";
                    return r += ' <img src="' + m((s = n.profileImage || a && a.profileImage, i = {
                        hash: {
                            url: a && a.profile_image_url,
                            size: "36"
                        },
                        data: t
                    }, s ? s.call(a, i) : u.call(a, "profileImage", i))) + '" class="_profileImage" alt="', (s = n.display_name) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.display_name, e = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), r += m(e) + '"> '
                }
                function r(a, t) {
                    var e, s, i = "";
                    return i += " ", (s = n.recommend_type_msg) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.recommend_type_msg, e = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), i += m(e) + " "
                }
                function l(a, t) {
                    var e, s, i = "";
                    return i += " ", e = n["if"].call(a, a && a.isMusicStatus, {
                        hash: {},
                        inverse: v.noop,
                        fn: v.program(6, c, t),
                        data: t
                    }), (e || 0 === e) && (i += e), i += " ", (s = n.statusMessage) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.statusMessage, e = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), i += m(e) + " "
                }
                function c(a, t) {
                    var e, s, i = "";
                    return i += ' <span class="ico_music">' + m((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.alt.music", s) : u.call(a, "t", "friend.alt.music", s))) + "</span> "
                }
                function d(a, t) {
                    var e, s, i = "";
                    return i += ' <button class="btn_com ing _inviting" data-kant-id="189"><span>' + m((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.btn.inviting", s) : u.call(a, "t", "friend.btn.inviting", s))) + '</span></button> <button class="btn_com ing _cancel" style="display:none" data-kant-id="189"><span>' + m((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.btn.cancel", s) : u.call(a, "t", "friend.btn.cancel", s))) + "</span></button> "
                }
                function o(a, t) {
                    var e, s, i = "";
                    return i += ' <button class="btn_com btn_wh _invite" data-kant-id="191"><span>' + m((e = n.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.btn.invite", s) : u.call(a, "t", "friend.btn.invite", s))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var h, p, f = "",
                    u = n.helperMissing,
                    m = this.escapeExpression,
                    g = "function",
                    v = this;
                return f += '<a href="/', (p = n.urlKey) ? h = p.call(t, {
                    hash: {},
                    data: s
                }) : (p = t && t.urlKey, h = typeof p === g ? p.call(t, {
                    hash: {},
                    data: s
                }) : p), f += m(h) + '" class="_gnbFriendLink" data-kant-id="188"><span class="img_user">', h = n["if"].call(t, t && t.profile_image_url, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(1, i, s),
                    data: s
                }), (h || 0 === h) && (f += h), f += ' <span class="line"></span></span> <strong class="_profileName">', (p = n.display_name) ? h = p.call(t, {
                    hash: {},
                    data: s
                }) : (p = t && t.display_name, h = typeof p === g ? p.call(t, {
                    hash: {},
                    data: s
                }) : p), f += m(h) + "</strong><p>", h = n["if"].call(t, t && t.recommend_type_msg, {
                    hash: {},
                    inverse: v.program(5, l, s),
                    fn: v.program(3, r, s),
                    data: s
                }), (h || 0 === h) && (f += h), f += "</p></a> ", h = n["if"].call(t, t && t.sent, {
                    hash: {},
                    inverse: v.program(10, o, s),
                    fn: v.program(8, d, s),
                    data: s
                }), (h || 0 === h) && (f += h), f
            });
            return a.wrap = '<li class="addbtn">', a
        }(),
        storyPlusRecommendItem: function() {
            var a = t(function(a, t, n, e, s) {
                function i(a, t) {
                    var e, s, i, r = "";
                    return r += ' <img src="' + f((s = n.profileImage || a && a.profileImage, i = {
                        hash: {
                            url: a && a.profile_image_url,
                            size: "36"
                        },
                        data: t
                    }, s ? s.call(a, i) : p.call(a, "profileImage", i))) + '" class="_profileImage" alt="', (s = n.display_name) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.display_name, e = typeof s === u ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), r += f(e) + '"> '
                }
                function r(a, t) {
                    var e, s, i = "";
                    return i += " ", (s = n.recommend_type_msg) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.recommend_type_msg, e = typeof s === u ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), i += f(e) + " "
                }
                function l(a, t) {
                    var e, s, i = "";
                    return i += " ", (s = n.statusMessage) ? e = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.statusMessage, e = typeof s === u ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), i += f(e) + " "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = s || {};
                var c, d, o, h = "",
                    p = n.helperMissing,
                    f = this.escapeExpression,
                    u = "function",
                    m = this;
                return h += '<a href="/', (d = n.urlKey) ? c = d.call(t, {
                    hash: {},
                    data: s
                }) : (d = t && t.urlKey, c = typeof d === u ? d.call(t, {
                    hash: {},
                    data: s
                }) : d), h += f(c) + '" class="_gnbFriendLink" data-kant-id="479"><span class="img_user">', c = n["if"].call(t, t && t.profile_image_url, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(1, i, s),
                    data: s
                }), (c || 0 === c) && (h += c), h += ' <span class="line"></span></span> <strong class="_profileName">', (d = n.display_name) ? c = d.call(t, {
                    hash: {},
                    data: s
                }) : (d = t && t.display_name, c = typeof d === u ? d.call(t, {
                    hash: {},
                    data: s
                }) : d), h += f(c) + "</strong><p>", c = n["if"].call(t, t && t.recommend_type_msg, {
                    hash: {},
                    inverse: m.program(5, l, s),
                    fn: m.program(3, r, s),
                    data: s
                }), (c || 0 === c) && (h += c), h += '</p></a> <button class="btn_com ing _follow" data-kant-id="480"><span>' + f((d = n.t || t && t.t, o = {
                    hash: {},
                    data: s
                }, d ? d.call(t, "friend.btn.follow", o) : p.call(t, "t", "friend.btn.follow", o))) + "</span></button>"
            });
            return a.wrap = '<li class="addbtn">', a
        }()
    }
});
define("part/gnb/FriendMenuPart", ["template/gnbFriend", "model/me"], function(e, t) {
    var n = space.Part.extend({
        template: e.friendMenuLayout,
        TYPE: {
            FRIENDS: "friends",
            REQUESTS: "requests"
        },
        styles: {
            selected: "selected"
        },
        ui: {
            menus: "._gnbFriendMenu",
            newBadge: "._newBadge"
        },
        events: {
            "click ._gnbFriendMenu": function(e) {
                e.preventDefault();
                var t = $(e.currentTarget),
                    n = t.data("type");
                this._selectMenu(n)
            }
        },
        initialize: function() {
            this._currentMenuType = "", this._menuTypeBeforeClear = ""
        },
        onSetup: function() {
            this.listenTo(t.get("newCount"), "change:received_count", function() {
                this._updateNewInvitationBadge()
            })
        },
        onRender: function() {
            this._updateNewInvitationBadge()
        },
        _updateNewInvitationBadge: function() {
            var e = t.get("newCount").get("received_count") ? "" : "none";
            this.ui.newBadge.css({
                display: e
            })
        },
        selectFriendsMenu: function() {
            this._selectMenu(this.TYPE.FRIENDS)
        },
        selectRequestsMenu: function() {
            this._selectMenu(this.TYPE.REQUESTS)
        },
        _selectMenu: function(e, t) {
            var n;
            this._currentMenuType !== e && (this.ui.menus.removeClass(this.styles.selected), n = this.ui.menus.filter("[data-type=" + e + "]"), n.addClass(this.styles.selected), t || this.trigger("change", e), this._currentMenuType = e)
        },
        clearSelection: function() {
            this.ui.menus.removeClass(this.styles.selected), this._currentMenuType && (this._menuTypeBeforeClear = this._currentMenuType), this._currentMenuType = ""
        },
        restoreSelection: function() {
            this._menuTypeBeforeClear && (this._selectMenu(this._menuTypeBeforeClear, !0), this.trigger("restore"))
        },
        focusFirstTab: function() {
            this.ui.menus.children("a").first().focus()
        }
    });
    return n.TYPE = n.prototype.TYPE, n
});
define("common/favicon", ["config"], function(n) {
    var o = {
        DEFAULT: "DEFAULT",
        UNREAD: "UNREAD"
    }, i = {
        DEFAULT: n.staticRoot + "/img/favicon.ico",
        UNREAD: n.staticRoot + "/img/favicon_unread.ico"
    }, c = null;
    return {
        STATUS: o,
        change: function(n) {
            c && c.detach(), c = $('<link rel="shortcut icon" href="' + i[n] + '" type="image/x-icon" />'), c.appendTo($("head"))
        }
    }
});
define("part/gnb/MemberPart", ["model/me", "template/gnb", "module/static/writingView", "part/plugin/LayerPart", "part/writing/WritingPart", "part/gnb/FriendMenuPart", "common/animate", "common/favicon", "common/imgUtil", "common/kantUtil", "common/profileImage", "module/static/dialog", "module/static/error", "config"], function(t, e, i, n, o, s, r, a, u, l, c, g, h, d) {
    var f = -31021,
        _ = "text",
        p = /^\(\N\) /,
        B = {
            HAS_NEW_NOTIFICATION: "newnoti:true",
            HAS_NO_NEW_NOTIFICATION: "newnoti:false"
        }, y = 32,
        m = 1e3;
    return space.Part.extend({
        template: e.memberMenu,
        model: null,
        ui: {
            headBar: "._headBar",
            headWrap: "._headWrap",
            bgFilter: "._bgFilter",
            toggleWriteButton: "._toggleWriteButton",
            toggleWriteButtonTooltip: "._toggleWriteButtonTooltip",
            friendButton: "._friendButton",
            newInvitationBadge: "._newInvitationBadge",
            newNoticeBadge: "._newNoticeBadge",
            firstFocusWriteButton: "._firstFocusWriteButton",
            lastFocusWriteButton: "._lastFocusWriteButton",
            notifyItems: "._notiList",
            notifyButton: "._notifyButton",
            newBadge: "._newBadge",
            profileButton: "._profileButton",
            profileImage: "._profileImage",
            lastFocusProfileButton: "._lastFocusProfileButton",
            suggestionToggleBtn: "._suggestionToggleBtn"
        },
        styles: {
            newBadge: "ico_plus",
            iconOn: "on",
            suggestionAreaOn: "search_on",
            suggestionBtnOn: "on"
        },
        modelEvents: {
            "change:profile_thumbnail_url": "_updateProfileImage",
            logout: function() {
                a.change(a.STATUS.DEFAULT), this._setTitle()
            }
        },
        events: {
            "wheel,mousewheel,DOMMouseScroll": function(t) {
                $(t.target).closest("._ignoreScroll").length && t.preventDefault()
            },
            "click ._toggleWriteButton": function(t) {
                return t.preventDefault(), this._feedWritingMode !== o.MODE.READY ? (this._$window.scrollTop() || this.ui.toggleWriteButtonTooltip.stop(!0).fadeIn().delay(m).fadeOut(), void this.trigger("focusFeedWriting")) : void this.addPart("writeButtons", "part/plugin/LayerPart", {
                    options: {
                        exceptionClass: "_toggleWriteButton"
                    },
                    listeners: {
                        show: function() {
                            this.ui.toggleWriteButton.addClass(this.styles.iconOn)
                        },
                        hide: function() {
                            this.ui.toggleWriteButton.removeClass(this.styles.iconOn), this.removePart("writeButtons")
                        }
                    }
                }).next(function(t) {
                    t ? this.childParts.writeButtons.show() : this.childParts.writeButtons.toggle()
                })
            },
            "focusout ._toggleWriteButton": function(t) {
                var e = $(t.relatedTarget);
                this.childParts.writeButtons && (e.hasClass("_friendButton") ? this._moveFocus(this.ui.firstFocusWriteButton) : e.hasClass("_btnHome") && this._moveFocus(this.ui.lastFocusWriteButton))
            },
            "focusout ._firstFocusWriteButton": function(t) {
                var e = $(t.relatedTarget);
                e.hasClass("_profileButton") && this._moveFocus(this.ui.toggleWriteButton)
            },
            "focusout ._lastFocusWriteButton": function(t) {
                var e = $(t.relatedTarget);
                "music" !== e.data("mode") && this._moveFocus(this.ui.toggleWriteButton)
            },
            "click ._changeMode": function(t) {
                t.preventDefault();
                var e = $(t.currentTarget).data("mode");
                "" === space.Router.getPath() ? this.trigger("feedWritingChangeMode", e) : i.show(e), this.childParts.writeButtons.hide()
            },
            "click ._notifyButton": function(e) {
                return e.preventDefault(), agent.type.is.mobile && this._toggleSuggestion(!1), this.isAvailableChildPart("notifyLayer") ? void this.childParts.notifyLayer.toggle() : void this.addPart("notifyLayer", "part/notification/NotificationListPart", {
                    options: {
                        collection: t.get("notifications"),
                        exceptionClass: "_notifyButton"
                    },
                    listeners: {
                        show: function() {
                            this.ui.notifyButton.addClass(this.styles.iconOn), l.sendPageView("alt"), this.childParts.notifyLayer.fetchNewNotification().then(function() {
                                t.get("newCount").set("has_new_notification", !1)
                            }).fail(h.getHandler())
                        },
                        hide: function() {
                            this.ui.notifyButton.removeClass(this.styles.iconOn)
                        }
                    }
                }).next(function() {
                    this.childParts.notifyLayer.toggle()
                })
            },
            "click ._friendButton": function(t) {
                t.preventDefault(), agent.type.is.mobile ? space.Router.navigate($(t.target).attr("href")) : this.showFriendLayer()
            },
            "focusout ._friendButton": function() {
                this.childParts.friendLayer && this.childParts.friendLayer.isShown() && this.childParts.friendLayer.focus()
            },
            "click ._btnNotice": function(e) {
                e.preventDefault(), window.open("/s/notice", "notice", "width=718,height=500,resizable=1,scrollbars=1");
                var i = t.get("property");
                i.updateProperty(i.TYPE.LAST_NOTICE_ID, t.get("newCount").get("last_notice_id")), t.get("newCount").set("notice_count", 0)
            },
            "focusout ._notifyButton": function(t) {
                var e = $(t.relatedTarget),
                    i = null;
                this.childParts.notifyLayer && (e.hasClass("_profileButton") ? (i = this.ui.notifyItems.children("li:first-child").children("a"), i.length ? this._moveFocus(i) : this.childParts.notifyLayer.hide()) : e.hasClass("_friendButton") && (i = this.ui.notifyItems.children("li:last-child").children("a"), i.length ? this._moveFocus(i) : this.childParts.notifyLayer.hide()))
            },
            "focusout ._notiList li:first": function(t) {
                var e = $(t.relatedTarget);
                e.hasClass("_profileButton") && this._moveFocus(this.ui.notifyButton)
            },
            "focusout ._notiList li:last": function(t) {
                var e = $(t.relatedTarget);
                e.data("mode") === _ && this._moveFocus(this.ui.notifyButton)
            },
            "click ._profileButton": function(t) {
                t.preventDefault(), this.addPart("profileLayer", "part/plugin/LayerPart", {
                    options: {
                        exceptionClass: "_profileButton"
                    }
                }).next(function() {
                    this.childParts.profileLayer.toggle()
                })
            },
            "click ._profileLayer": function() {
                this.childParts.profileLayer && this.childParts.profileLayer.hide()
            },
            "focusout ._lastFocusProfileButton": function(t) {
                var e = $(t.relatedTarget);
                e.hasClass("_changeMode") && this._moveFocus(this.ui.profileButton)
            },
            "focusout ._profileButton": function(t) {
                var e = $(t.relatedTarget);
                e.hasClass("_notifyButton") && this._moveFocus(this.ui.lastFocusProfileButton)
            },
            "click ._logout": function(e) {
                var i = Q.resolve();
                e.preventDefault(), space.Router.onBeforeUnload && (i = space.Router.onBeforeUnload()), i.then(function() {
                    l.send("gnb.m.165").then(function() {
                        t.logout(!0)
                    })
                })
            },
            "click ._btnHelp": function(t) {
                g.alert("준비 중 입니다."), t.preventDefault()
            },
            "click ._suggestionToggleBtn": function(t) {
                var e = !this.ui.suggestionToggleBtn.hasClass(this.styles.suggestionBtnOn);
                this._toggleSuggestion(e), t.preventDefault()
            }
        },
        setFeedWritingMode: function(t) {
            this._feedWritingMode = t
        },
        _moveFocus: function(t) {
            t.focus()
        },
        extendData: function() {
            return {
                isMobile: agent.type.is.mobile,
                myStoryPlus: d.storyPlus.list,
                inquiry: d.customer.request,
                suggest: d.customer.suggest
            }
        },
        initialize: function() {
            this._$window = $(window), this._feedWritingMode = o.MODE.READY, this._isBlockedUser = !1, this._isBlockedUserMsg = null
        },
        onSetup: function() {
            var e = this;
            this.model = t, this.listenTo(t.get("newCount"), {
                "change:received_count": function() {
                    this._updateNewInvitationBadge()
                },
                "change:notice_count": function() {
                    this._updateNewNoticeBadge()
                }
            }), t.get("invitations").fetch().fail(h.getHandler()), t.get("friends").fetch().fail(function(t) {
                return t && t.responseJSON && t.responseJSON.error_code === f ? (e._isBlockedUser = !0, e._isBlockedUserMsg = t.responseJSON.error_message, e.trigger("blockedUser", t.responseJSON.error_message), Q.resolve()) : Q.reject(t)
            }).fail(h.getHandler()), t.get("property").fetch().then(function() {
                return t.get("newCount").fetch()
            }).fail(h.getHandler()), t.get("account").fetch().fail(h.getHandler())
        },
        onStart: function() {
            this.listenTo(t.get("newCount"), "change:has_new_notification", this._applyNotificationMenu)
        },
        onRender: function() {
            this._addSuggestionArea(), this._applyNotificationMenu(), this._updateNewInvitationBadge(), agent.type.is.mobile && this._addSnbPart(), this._updateProfileImage()
        },
        _addSuggestionArea: function() {
            this.addPart("suggestionArea", "part/gnb/SuggestionAreaPart", {
                listeners: {
                    close: function() {
                        agent.type.is.mobile && this._toggleSuggestion(!1)
                    }
                }
            })
        },
        _updateProfileImage: function() {
            u.resize(this.ui.profileImage, this.ui.profileImage.parent(), {
                url: c.getUrl(this.model.get("profile_thumbnail_url"), y)
            })
        },
        _applyNotificationMenu: function() {
            t.get("newCount").get("has_new_notification") ? (this.ui.newBadge.addClass(this.styles.newBadge), a.change(a.STATUS.UNREAD), this._setNotificationBtnKantOption(B.HAS_NEW_NOTIFICATION), this._setTitle(!0)) : (this.ui.newBadge.removeClass(this.styles.newBadge), a.change(a.STATUS.DEFAULT), this._setNotificationBtnKantOption(B.HAS_NO_NEW_NOTIFICATION), this._setTitle(!1))
        },
        _setNotificationBtnKantOption: function(t) {
            this.ui.notifyButton.attr(l.DATA_ATTRIBUTE_OPTION_NAME, t)
        },
        _updateNewInvitationBadge: function() {
            var e = !1;
            this.ui.newInvitationBadge && (e = !! t.get("newCount").get("received_count"), this.ui.newInvitationBadge.toggle(e))
        },
        _updateNewNoticeBadge: function() {
            var e = !1;
            this.ui.newNoticeBadge && (e = !! t.get("newCount").get("notice_count"), this.ui.newNoticeBadge.toggle(e))
        },
        _addSnbPart: function() {
            this.addPart("snb", "part/gnb/SnbPart")
        },
        _setTitle: function(t) {
            var e = document.title;
            e = e.replace(p, ""), t && (e = "(N) " + e), document.title = e
        },
        showFriendLayer: function(e) {
            return this.addPart("friendLayer", "part/gnb/FriendLayerPart", {
                options: {
                    openType: e,
                    collection: t.get("friends"),
                    exceptionClass: "_friendButton, _btnFindFriend",
                    layerOpenerButton: this.ui.friendButton
                },
                listeners: {
                    show: function() {
                        this.ui.friendButton.addClass(this.styles.iconOn)
                    },
                    hide: function() {
                        this.ui.friendButton.removeClass(this.styles.iconOn)
                    }
                }
            }).next(function(t) {
                var e = this.childParts.friendLayer;
                return t ? (e.show(), t) : (e.isShown() ? e.hide() : (e.show(), e.refreshList()), t)
            })
        },
        hideFriendLayer: function() {
            this.isAvailableChildPart("friendLayer") && this.childParts.friendLayer.hide()
        },
        toggleFriendRequestsLayer: function() {
            var t = this.childParts.friendLayer;
            return agent.type.is.mobile ? void space.Router.navigate("s/friends/recommend") : void(this.isAvailableChildPart("friendLayer") ? t.isShown() ? t.hide() : (t.show(), t.selectRequestsMenu()) : this.showFriendLayer(s.TYPE.REQUESTS))
        },
        getBlockedUserMsg: function() {
            return this._isBlockedUser ? this._isBlockedUserMsg : null
        },
        isBlockedUser: function() {
            return this._isBlockedUser
        },
        _toggleSuggestion: function(t) {
            this.ui.suggestionToggleBtn.toggleClass(this.styles.suggestionBtnOn, t), this.ui.headWrap.toggleClass(this.styles.suggestionAreaOn, t), this.childParts.suggestionArea.toggleSuggestionInput(t)
        }
    })
});
define("model/Activities", ["common/api", "model/Activity"], function(e, t) {
    var n = 20,
        i = "x-kakao-eos",
        r = {
            FEED: "feed",
            MY_STORY: "mystory",
            HASHTAG: "hashtag"
        }, s = space.Collection.extend({
            url: "/feeds",
            model: t,
            type: r.FEED,
            initialize: function() {
                this._isEnd = !1, this._newFeed = null, this._type = this.type
            },
            fetch: function() {
                var t = null,
                    n = this;
                return this.length && (t = _.last(this.models).get("id")), this._isEnd ? Q.resolve([]) : e.request({
                    url: _.result(this, "url"),
                    type: "GET",
                    data: {
                        comment_count: s.PAYLOAD_COMMENT_COUNT,
                        like_count: s.PAYLOAD_LIKE_COUNT,
                        since: t
                    },
                    extraData: !0
                }).then(function(e) {
                    n.addActivities(e)
                })
            },
            addActivities: function(e) {
                var t = this.parse(e),
                    n = e._extra.responseHeaders;
                "true" === n[i] && (this._isEnd = !0), t && t.length && this.add(t)
            },
            parse: function(e) {
                return this.filterSupportedFeedType(e.feeds)
            },
            filterSupportedFeedType: function(e, n) {
                return _.filter(e, function(e) {
                    if (n && _.isEmpty(e.media) && _.isEmpty(e.object)) return !1;
                    switch (e.verb) {
                        case t.VERB.POST:
                        case t.VERB.BE_BORN:
                        case t.VERB.SHARE:
                        case t.VERB.UPDATE:
                        case t.VERB.JOIN:
                            return !0
                    }
                    return !1
                })
            },
            getMediaCount: function() {
                return _.reduce(this.models, function(e, t) {
                    return e + t.getMediaCount()
                }, 0)
            },
            checkNewFeed: function() {
                var t = this;
                return e.request({
                    url: _.result(this, "url"),
                    type: "GET",
                    data: {
                        comment_count: s.PAYLOAD_COMMENT_COUNT,
                        like_count: s.PAYLOAD_LIKE_COUNT
                    }
                }).then(function(e) {
                    var i, r = t.parse(e),
                        s = t.head(n),
                        u = -1;
                    return s && s.length ? (i = _.map(s, function(e) {
                        return e.get("id")
                    }), _.some(r, function(e, t) {
                        return _.contains(i, e.id) ? (u = t, !0) : void 0
                    }), t._newFeed = u > -1 ? r.slice(0, u) : r, t._newFeed) : (t._newFeed = r, r)
                })
            },
            getNewFeed: function() {
                return this._newFeed
            },
            isEnd: function() {
                return this._isEnd
            },
            getType: function() {
                return this._type
            }
        });
    return s.PAYLOAD_COMMENT_COUNT = 2, s.PAYLOAD_LIKE_COUNT = 4, s.TYPE = r, s
});
define("model/MyStoryActivities", ["model/Activities", "model/me"], function(e, t) {
    var i = e.extend({
        type: e.TYPE.MY_STORY,
        url: function() {
            return "/profiles/" + this.parent.get("id") + "/activities"
        },
        parse: function(e) {
            return this.filterSupportedFeedType(e)
        },
        isMine: function() {
            return this.parent.get("id") === t.get("id")
        }
    });
    return i
});
define("model/Profiles", ["common/api", "model/Profile", "model/MyStoryActivities"], function(e, i, t) {
    return space.Model.extend({
        urlRoot: "/profiles/",
        defaults: {
            id: null,
            profile: i,
            activities: t,
            photoSection: null,
            videoSection: null,
            musicSection: null
        },
        parse: function(e) {
            var i = {};
            return _.isArray(e.sections) && _.each(e.sections, function(e) {
                switch (e.type) {
                    case "photos":
                        i.photoSection = e;
                        break;
                    case "videos":
                        i.videoSection = e;
                        break;
                    case "music":
                        i.musicSection = e
                }
            }), _.extend(i, {
                profile: e.profile,
                activities: e.activities
            })
        },
        fetch: function() {
            var i = this;
            return e.request({
                url: _.result(this, "url"),
                type: "GET"
            }).then(function(e) {
                i.set(i.parse(e))
            })
        }
    })
});
define("part/gnb/GuestPart", ["model/me", "model/Profiles", "template/gnb", "common/animate", "common/util", "module/static/loginView", "common/urlKey"], function(t, i, o, e, n, s, l) {
    var g = 3500,
        u = 1170,
        a = 100;
    return space.Part.extend({
        template: o.guestMenu,
        ui: {
            headBar: "._headBar",
            headWrap: "._headWrap",
            bgFilter: "._bgFilter",
            loginTooltip: "._loginTooltip",
            tooltipContent: "._tooltipContent",
            suggestionToggleBtn: "._suggestionToggleBtn"
        },
        styles: {
            alignRight: "w_right",
            suggestionAreaOn: "search_on",
            suggestionBtnOn: "on"
        },
        onRoute: function(t, o, e) {
            var n, s, g = this;
            e.getResolver().hasModule("module/myStory/mainProfile") && ("myStory/settings" === t && (location.href = "/"), n = l.profile.urlKeyToId(o[0]), s = new i({
                id: n
            }), s.fetch().then(function() {
                g.ui.tooltipContent.text(intl.t("gnb.menu.tooltip", {
                    name: s.get("profile").get("display_name")
                })), g._showTooltip()
            }))
        },
        windowEvents: {
            resize: _.throttle(function() {
                this._repositionTooltip()
            }, a),
            scroll: _.once(function() {
                this._hideTooltip()
            })
        },
        events: {
            "click ._loginBtn": function(t) {
                t.preventDefault(), s.show()
            },
            "click ._suggestionToggleBtn": function(t) {
                var i = !this.ui.suggestionToggleBtn.hasClass(this.styles.suggestionBtnOn);
                this._toggleSuggestion(i), t.preventDefault()
            }
        },
        initialize: function() {
            this._timer = null, this._$window = $(window)
        },
        onRender: function() {
            this._addSuggestionArea()
        },
        _addSuggestionArea: function() {
            this.addPart("suggestionArea", "part/gnb/SuggestionAreaPart", {
                listeners: {
                    close: function() {
                        this._toggleSuggestion(!1)
                    }
                }
            })
        },
        onStop: function() {
            this._clearTimer()
        },
        _clearTimer: function() {
            null !== this._timer && (clearTimeout(this._timer), this._timer = null)
        },
        _repositionTooltip: function() {
            var t = this._$window.width();
            u >= t ? this.ui.loginTooltip.addClass(this.styles.alignRight) : this.ui.loginTooltip.removeClass(this.styles.alignRight)
        },
        _showTooltip: function() {
            this._clearTimer(), this.ui.loginTooltip.show(), this._repositionTooltip(), this._timer = setTimeout(_.bind(this._hideTooltip, this), g)
        },
        _hideTooltip: function() {
            this.ui.loginTooltip.is(":visible") && this.ui.loginTooltip.hide()
        },
        extendData: function() {
            return {
                isMobile: agent.type.is.mobile
            }
        },
        _toggleSuggestion: function(t) {
            this.ui.suggestionToggleBtn.toggleClass(this.styles.suggestionBtnOn, t), this.ui.headWrap.toggleClass(this.styles.suggestionAreaOn, t), this.childParts.suggestionArea.toggleSuggestionInput(t)
        }
    })
});
define("module/static/gnb", ["model/me", "template/gnb", "part/gnb/MemberPart", "part/gnb/GuestPart"], function(e, t, i, n) {
    return new(space.StaticModule.extend({
        template: t.layout,
        styles: {
            forward: "forward"
        },
        events: {
            "click ._btnHome": function(e) {
                e.preventDefault(), "" === space.Router.getPath() ? this.trigger("reloadFeed") : space.Router.navigate($(e.currentTarget).attr("href"))
            }
        },
        initialize: function() {
            this._isBlockedUser = !1, this._isBlockedUserMsg = null
        },
        onSetup: function() {
            return this.listenTo(e, "login,logout", function() {
                this._addPart()
            }), this.flow.forkWith(e.fetch()).next(function() {
                this._addPart()
            })
        },
        _addPart: function() {
            this.hasChildPart("gnbMenu") && this.removePart("gnbMenu"), this.addPart("gnbMenu", e.isRegistered() ? i : n, {
                selector: "._headerContainer",
                listeners: {
                    feedWritingChangeMode: function(e) {
                        this.trigger("feedWritingChangeMode", e)
                    },
                    focusFeedWriting: function() {
                        this.trigger("focusFeedWriting")
                    },
                    blockedUser: function(e) {
                        this._isBlockedUser = !0, this._isBlockedUserMsg = e, this.trigger("blockedUser", e)
                    }
                }
            })
        },
        onRender: function() {
            this.$el.insertBefore("#container"), this.domReady(!0)
        },
        setFeedWritingMode: function(e) {
            this.isAvailableChildPart("gnbMenu") && this.childParts.gnbMenu.setFeedWritingMode(e)
        },
        moveForward: function() {
            this.$el.addClass(this.styles.forward)
        },
        moveBackward: function() {
            this.$el.removeClass(this.styles.forward)
        },
        toggleFriendRequestsLayer: function() {
            this.isAvailableChildPart("gnbMenu") && this.childParts.gnbMenu instanceof i && this.childParts.gnbMenu.toggleFriendRequestsLayer()
        },
        getBlockedUserMsg: function() {
            return this.isAvailableChildPart("gnbMenu") && this.childParts.gnbMenu instanceof i ? this.childParts.gnbMenu.getBlockedUserMsg() : null
        },
        isBlockedUser: function() {
            return this.isAvailableChildPart("gnbMenu") && this.childParts.gnbMenu instanceof i ? this.childParts.gnbMenu.isBlockedUser() : !1
        },
        showNewFeed: function(e) {
            this.addPart("newFeed", "part/gnb/NewFeedAlarmPart", {
                listeners: {
                    viewNewFeed: function() {
                        this.trigger("viewNewFeed")
                    },
                    domReady: function() {
                        this.childParts.newFeed.showNewFeed(e)
                    }
                }
            })
        },
        hideNewFeed: function() {
            this.isAvailableChildPart("newFeed") && this.childParts.newFeed.hideNewFeed()
        },
        getHeight: function() {
            return this.$el.height()
        }
    }))
});
define("template/mediaView", ["Handlebars"], function(a) {
    var e = function(e) {
        var t = a.template(e);
        return function(a) {
            return t(a, {
                partials: i
            })
        }
    }, i = {
        media: function() {
            return e(function(a, e, i, t, s) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), s = s || {};
                var n, l, r = "",
                    c = i.helperMissing,
                    d = this.escapeExpression;
                return r += '<div><a href="#" class="img_wrap _media" data-kant-id="209"></a> <span class="gr"></span><div class="_activityInfo"></div><a href="#" class="btn_move _btnMove" data-kant-id="210"><span class="bg"></span> <span class="ic _arrow"></span></a> ' + d((n = i.img || e && e.img, l = {
                    hash: {
                        src: "/img/loding_wave.gif",
                        width: "20",
                        height: "16",
                        "class": "loadingImage _loadingImage"
                    },
                    data: s
                }, n ? n.call(e, l) : c.call(e, "img", l))) + "</div>"
            })
        }(),
        __p__: ""
    };
    return {
        layout: function() {
            var a = e(function(a, e, i, t, s) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), t = this.merge(t, a.partials), s = s || {};
                var n, l, r, c = "",
                    d = this,
                    o = i.helperMissing,
                    m = this.escapeExpression;
                return c += '<div class="gallery_paging _mediaPagination"><span class="_currentMediaIndex">02</span>/<span class="_totalMediaCount"></span></div><div class="gallery_view _mediaContainer" style="display:none">', n = d.invokePartial(t.media, "media", e, i, t, s), (n || 0 === n) && (c += n), c += '</div><div class="gallery_view _mediaContainer" style="display:none">', n = d.invokePartial(t.media, "media", e, i, t, s), (n || 0 === n) && (c += n), c += '</div><div class="gallery_view _mediaContainer" style="display:none">', n = d.invokePartial(t.media, "media", e, i, t, s), (n || 0 === n) && (c += n), c += '</div><a href="#" class="btn_close _mediaViewClose" data-kant-id="208">' + m((l = i.t || e && e.t, r = {
                    hash: {},
                    data: s
                }, l ? l.call(e, "mediaView.alt.close", r) : o.call(e, "t", "mediaView.alt.close", r))) + "</a>"
            });
            return a.wrap = '<div class="gallery_viewer" data-kant-group="mdv">', a
        }(),
        media: function() {
            var a = e(function(a, e, i, t, s) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), s = s || {};
                var n, l, r = "",
                    c = i.helperMissing,
                    d = this.escapeExpression;
                return r += '<a href="#" class="img_wrap _media" data-kant-id="209"></a> <span class="gr"></span><div class="_activityInfo"></div><a href="#" class="btn_move _btnMove" data-kant-id="210"><span class="bg"></span> <span class="ic _arrow"></span></a> ' + d((n = i.img || e && e.img, l = {
                    hash: {
                        src: "/img/loding_wave.gif",
                        width: "20",
                        height: "16",
                        "class": "loadingImage _loadingImage"
                    },
                    data: s
                }, n ? n.call(e, l) : c.call(e, "img", l)))
            });
            return a.wrap = "<div>", a
        }(),
        mediaImage: function() {
            var a = e(function(a, e, i, t, s) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), s = s || {};
                var n, l, r = "",
                    c = "function",
                    d = this.escapeExpression;
                return r += '<img src="', (l = i.url) ? n = l.call(e, {
                    hash: {},
                    data: s
                }) : (l = e && e.url, n = typeof l === c ? l.call(e, {
                    hash: {},
                    data: s
                }) : l), r += d(n) + '" alt="" class="_mediaImage">'
            });
            return a
        }(),
        activityInfo: function() {
            var a = e(function(a, e, i, t, s) {
                this.compilerInfo = [4, ">= 1.0.0"], i = this.merge(i, a.helpers), s = s || {};
                var n, l, r, c = "",
                    d = "function",
                    o = i.helperMissing,
                    m = this.escapeExpression;
                return c += '<div class="in_txt"><p class="pic_info"><a href="#" class="_link _content" data-kant-id="211">', (l = i.escapedTextContent) ? n = l.call(e, {
                    hash: {},
                    data: s
                }) : (l = e && e.escapedTextContent, n = typeof l === d ? l.call(e, {
                    hash: {},
                    data: s
                }) : l), (n || 0 === n) && (c += n), c += '</a></p><p class="date"><a href="#" class="_link" data-kant-id="212">' + m((l = i.dateFormat || e && e.dateFormat, r = {
                    hash: {},
                    data: s
                }, l ? l.call(e, e && e.created_at, r) : o.call(e, "dateFormat", e && e.created_at, r))) + '</a></p><p class="feel"><a href="#" class="_link" data-kant-id="213"><span class="ico_like">' + m((l = i.t || e && e.t, r = {
                    hash: {},
                    data: s
                }, l ? l.call(e, "activity.like.text", r) : o.call(e, "t", "activity.like.text", r))) + "</span>" + m((l = i.numberFormat || e && e.numberFormat, r = {
                    hash: {},
                    data: s
                }, l ? l.call(e, e && e.like_count, r) : o.call(e, "numberFormat", e && e.like_count, r))) + '<span class="ico_comm">' + m((l = i.t || e && e.t, r = {
                    hash: {},
                    data: s
                }, l ? l.call(e, "activity.comment.text", r) : o.call(e, "t", "activity.comment.text", r))) + "</span>" + m((l = i.numberFormat || e && e.numberFormat, r = {
                    hash: {},
                    data: s
                }, l ? l.call(e, e && e.comment_count, r) : o.call(e, "numberFormat", e && e.comment_count, r))) + "</a></p></div>"
            });
            return a
        }()
    }
});
define("common/ellipsis", [], function() {
    var t = 1.5,
        e = 10,
        i = "가a1",
        n = 5,
        h = /(<[^>]*|&[a-z]*|&#[0-9]*)$/gi,
        r = agent.browser.is.chrome && agent.os.is.windows,
        s = agent.browser.is.firefox,
        o = agent.os.is.android,
        c = function(t, e, i) {
            this._$el = t, this._$container = e, this._el = t[0], this._range = null, this._currentHeight = 0, this._currentLineCount = 0, this._lineCount = 0, this._options = i, this._getRange()
        };
    _.extend(c.prototype, {
        _checkLineHeight: function() {
            var e, i = this._getHeight(),
                n = 1,
                h = i - this._currentHeight,
                r = this._currentHeight;
            return this._currentHeight < i && (e = h / (this._currentHeight / this._currentLineCount), e > t && (n = 2), this._currentHeight = i, this._currentLineCount += n, this._lineBreak = !1), this._currentLineCount > this._lineCount ? r : 0
        },
        _reset: function() {
            this._lineCount = 0, this._currentHeight = 0, this._currentLineCount = 0
        },
        _getRange: function() {
            this._range = document.createRange(), this._range.setStart(this._el, 0)
        },
        _getHeight: function() {
            var t = this._range.getBoundingClientRect();
            return t.height || t.bottom - t.top
        },
        _setEnd: function(t, e) {
            this._range.setEnd(t, e)
        },
        getPadding: function() {
            return parseInt(this._$el.css("paddingTop"), 10) + (r ? -2 : -1)
        },
        getLineHeight: function(t) {
            return this._reset(), this._lineCount = t, this._calcLineHeight(this._el)
        },
        _calcLineHeight: function(t) {
            var e;
            if (t.childNodes.length) for (var i = 0, n = t.childNodes.length; n > i; i++) if (e = this._calcLineHeight(t.childNodes[i])) return e;
            if (3 === t.nodeType && t.length) {
                for (var h = 1, r = t.length; r > h; h++) if (this._setEnd(t, h), e = this._checkLineHeight()) return e
            } else if (this._setEnd(t, 0), e = this._checkLineHeight()) return e;
            return 0
        }
    });
    var a = function(t, e, i) {
        this._$el = t, this._$container = e, this._el = t[0], this._currentHeight = 0, this._currentLineCount = 0, this._lineCount = 0, this._characterCountLineBreakExpected = 1, this._options = i || {}
    };
    return _.extend(a.prototype, {
        _reset: function() {
            this._lineCount = 0, this._currentHeight = 0, this._currentLineCount = 0
        },
        setCharacterCountLineBreakExpected: function(t) {
            this._characterCountLineBreakExpected = t
        },
        getPadding: function() {
            return parseInt(this._$container.css("paddingBottom"), 10)
        },
        setOneLineHeight: function(t) {
            this._oneLineHeight = t
        },
        getLineHeight: function(t) {
            var e, i, r, s = this,
                o = this._$el.html(),
                c = 0,
                a = 0,
                u = null,
                l = null,
                g = 0,
                _ = "",
                d = this._options.slice ? 1 : this._characterCountLineBreakExpected,
                f = function(t, e) {
                    return s._$container.css("height", ""), s._$container.html(s._options.slice ? e : o), t
                };
            this._reset(), this._lineCount = t, this._$container.css("height", "auto"), e = this._$container[0].scrollHeight, i = o.split(/<br\s*\/?>/i);
            for (var H = 0, L = i.length; L > H; H++) {
                r = i[H];
                for (var p = 0, C = r.length; C > p; p += d) if (u = _ + (_ ? "<br>" : "") + r.substr(0, p + 1).replace(h, ""), u !== l) {
                    if (this._$el.html(u), c = this._$container[0].scrollHeight, c !== a && Math.abs(c - a) > n && (g += Math.ceil(Math.abs(c - a) / this._oneLineHeight), g > t)) return f(a, l);
                    a = c, l = u
                }
                _ += (_ ? "<br>" : "") + r
            }
            return f(0, o)
        },
        getLineHeightOnHtml: function(t) {
            var e, i, n, h = this,
                r = this._$el.html(),
                s = 0,
                o = 0,
                c = null,
                a = null,
                u = 0,
                l = "",
                g = 1,
                _ = function(t, e) {
                    return h._$container.css("height", ""), h._$container.html(h._options.slice ? e : r), t
                };
            this._reset(), this._lineCount = t, this._$container.css("height", "auto"), e = this._$container[0].scrollHeight, i = r.split(/<br\s*\/?>/i);
            for (var d = 0, f = i.length; f > d; d++) {
                if (n = i[d], c = l + (l ? "<br>" : "") + n, this._$el.html(c), s = this._$container[0].clientHeight, s !== o && (g = Math.round(Math.abs(s - o) / this._oneLineHeight), u += g, u > t)) return _(o, a);
                o = s, a = c, l += (l ? "<br>" : "") + n
            }
            return _(0, r)
        }
    }), {
        byLine: function(t, n, h) {
            h = _.defaults(h || {}, {
                useText: !1,
                onHtml: !1,
                container: null,
                characterCount: e,
                slice: !1
            });
            var r, u, l, g, d = agent.isIe8AndBelow() || s || o || h.useText ? a : c,
                f = h.container || t;
            return t.html() ? (r = new d(t, f, h), r instanceof a ? (r.setCharacterCountLineBreakExpected(h.characterCount), h.oneLineHeight || (g = t.html(), t.html(i), l = t.height(), t.html(g)), r.setOneLineHeight(l), u = h.onHtml ? r.getLineHeightOnHtml(n) : r.getLineHeight(n)) : u = r.getLineHeight(n), u ? (u = Math.max(0, u - r.getPadding()), f.css({
                height: u,
                overflow: "hidden"
            })) : f.css({
                height: "",
                overflow: ""
            }), u) : 0
        },
        byWidth: function(t, e) {
            e = _.defaults(e || {}, {
                width: 0,
                oneLineHeight: 20,
                tail: ".."
            });
            var n = t.width(),
                h = e.oneLineHeight,
                r = t.text(),
                s = r,
                o = !1;
            if (r) {
                if (e.width) {
                    if (n <= e.width) return;
                    t.css({
                        display: "inline-block",
                        width: e.width
                    })
                }
                for (e.oneLineHeight || (t.text(i), h = t.height(), t.text(r)); t.height() > h;) s = s.substring(0, s.length - 1), t.text(s), o = !0;
                e.width && t.css({
                    display: ""
                }), o && (s = s.substring(0, s.length - e.tail.length) + e.tail, t.text(s))
            }
        }
    }
});
define("module/static/mediaView", ["template/mediaView", "common/util", "common/imgUtil", "common/imgPath", "common/animate", "common/ellipsis", "common/kantUtil", "model/Activities", "module/static/cover"], function(t, i, e, n, o, s, h, a, r) {
    var d, l, c, u, g, f, m = 100,
        p = .08,
        v = 54,
        I = .74,
        C = 200,
        w = 200,
        x = .05,
        M = 3,
        E = 100,
        k = 2,
        y = 500,
        T = 200,
        L = 400,
        S = 51,
        H = 45,
        R = {
            LEFT: 0,
            CENTER: 1,
            RIGHT: 2
        }, A = {
            ACTIVITY: "activity",
            COMMENT: "comment",
            PROFILE: "profile",
            ONLY_IMAGE: "image"
        }, N = {
            HOVER: "hover",
            LONG_HEIGHT: "longHeight",
            LEFT: "side_prev",
            RIGHT: "side_next",
            LOADING: "willBeFixedLoading"
        }, P = $(window),
        b = $(document),
        O = agent.type.is.desktop,
        F = agent.support.css3d,
        G = agent.getCssPrefix("transform", !0),
        W = v,
        K = !1,
        D = agent.getScrollBarWidth(),
        Y = function(t, i) {
            switch (i = i || C, t) {
                case R.LEFT:
                    return -i + g;
                case R.CENTER:
                    return d / 2 - i / 2;
                case R.RIGHT:
                    return d - g
            }
        }, z = function(t, i, e) {
            return e = e || {}, t = t || 0, F ? (e[G] = "translate3d(" + t + "px, " + (i || 0) + "px, 0)", e.left = 0, e.top = 0) : (e.left = t + "px", _.isNumber(i) && (e.top = i + "px")), e
        }, V = function(t, i) {
            var e = this;
            this._$el = t, this._$media = this._$el.find("._media"), this._$img = this._$el.find("._mediaImage"), this._$activityInfo = this._$el.find("._activityInfo"), this._$arrow = this._$el.find("._arrow"), this._arrowWidth = this._$arrow.width(), this._$loading = this._$el.find("._loadingImage"), this._isShown = !1, this._mediaInfo = null, this._positionIndex = i || 0, this._isLongHeight = !1, this._didEllipsis = !1, this._containerWidth = null, this._containerHeight = null, this._isLoading = !1, this._position = {
                left: 0,
                top: 0
            }, this._currentPosition = {
                left: 0,
                top: 0
            }, this._$el.on("click", "._link", function(t) {
                t.preventDefault()
            }).on("mouseenter", function() {
                e._positionIndex === R.CENTER && (K || e._isLongHeight && e._$media.scrollTop() < e._$media[0].scrollHeight - e._$el.height() || e.enter())
            }).on("mouseleave", function() {
                K || e._positionIndex === R.CENTER && e.leave()
            })
        };
    _.extend(V.prototype, {
        getElement: function() {
            return this._$el
        },
        getCurrentPosition: function() {
            return this._currentPosition
        },
        getPosition: function() {
            return this._position
        },
        render: function(i) {
            var e = !1;
            return this._adjustMediaStyles(), _.isEmpty(i) ? (this.hide(), void this.reset()) : (i && !this._isEqual(i.media) && (this._mediaInfo = i, e = !0, this._$media.css({
                width: "",
                height: ""
            }), this._showLoading(), this._containerWidth = O ? C : d, this._containerHeight = O ? w : l, this._position.left = Y(this._positionIndex, this._containerWidth), this._position.top = l / 2 - this._containerHeight / 2, this._$el.css({
                width: this._containerWidth,
                height: this._containerHeight,
                display: ""
            }), this.moveTo(this._position.left, this._position.top), K || this._$activityInfo.html($(t.activityInfo(i.model.toData()))), O || this._$arrow.hide(), this.show()), void this.resize(e))
        },
        _adjustMediaStyles: function() {
            switch (this._$el.toggleClass(N.LEFT, this._positionIndex === R.LEFT), this._$el.toggleClass(N.RIGHT, this._positionIndex === R.RIGHT), this._$media.off("scroll"), this._isLongHeight && (this._positionIndex === R.CENTER ? this._activateScroll() : this._deactivateScroll()), this._$el.removeClass(N.HOVER), this._positionIndex) {
                case R.LEFT:
                    this._$arrow.css({
                        left: "",
                        right: g / 2 - this._arrowWidth / 2
                    });
                    break;
                case R.RIGHT:
                    this._$arrow.css({
                        left: g / 2 - this._arrowWidth / 2,
                        right: ""
                    })
            }
        },
        resize: function(i) {
            if (this._mediaInfo) {
                var o, s = this,
                    h = this._mediaInfo.media;
                if (this._didEllipsis = !1, this._isShown && (i || !this._isLoading)) return o = i && h ? h.origin_url : null, o && (this._$img = $(t.mediaImage({
                    url: o
                })).appendTo(this._$media.empty())), e.resize(s._$img, null, {
                    target: !1,
                    containerWidth: c,
                    containerHeight: u,
                    width: h && h.width,
                    height: h && h.height,
                    isCrop: !1,
                    expand: !1,
                    longHeightRatio: M,
                    scrollbarWidth: D
                }).then(_.bind(function(t) {
                    s._isEqual(this) && (s._hideLoading(), s._onResize(t))
                }, h)).fail(_.bind(function() {
                    s._isEqual(this) && (s._hideLoading(), s._$img.attr("src", n.get("/img/img_failed_rtn.png", {
                        retina: !1
                    })).show(), s._onResize({
                        isLongHeight: !1,
                        width: S,
                        height: H
                    }))
                }, h))
            }
        },
        _showLoading: function() {
            this._$el.addClass(N.LOADING), this._$loading.show(), this._isLoading = !0
        },
        _hideLoading: function() {
            this._$el.removeClass(N.LOADING), this._$loading.hide(), this._isLoading = !1
        },
        _onResize: function(t) {
            var i, e = O ? Math.max(C, t.width) : c,
                n = !O || t.isLongHeight ? u : Math.max(w, t.height),
                o = {
                    position: "absolute",
                    width: e,
                    height: n,
                    top: Math.round(l / 2 - n / 2)
                }, s = {
                    width: t.width,
                    height: t.height,
                    left: Math.round(e / 2 - t.width / 2),
                    top: Math.round(n / 2 - t.height / 2)
                };
            switch (this._positionIndex) {
                case R.LEFT:
                    o.left = -e + g;
                    break;
                case R.CENTER:
                    o.left = d / 2 - e / 2;
                    break;
                case R.RIGHT:
                    o.left = d - g
            }
            o.left = Math.round(o.left), t.isLongHeight && (s = {
                width: e,
                height: n,
                left: 0,
                top: 0
            }, this._positionIndex === R.CENTER ? this._activateScroll() : this._deactivateScroll(), i = t.width - (e === t.width ? D : 0), this._$img.css({
                position: "absolute",
                width: i,
                height: Math.round(t.height * i / t.width),
                top: 0,
                left: Math.round(e / 2 - t.width / 2),
                display: ""
            })), this._isLongHeight = t.isLongHeight, this._$el.toggleClass(N.LONG_HEIGHT, !! t.isLongHeight), this._currentPosition.left = this._position.left = o.left, this._currentPosition.top = this._position.top = o.top, this._containerWidth = o.width, this._containerHeight = o.height, F && (z(o.left, o.top, o), z(s.left, s.top, s)), this._$el.css(o), this._$media.css(s), t.isLongHeight || this._$img.css({
                position: "absolute",
                width: "100%",
                height: "100%",
                left: 0,
                top: 0,
                display: ""
            })
        },
        hide: function() {
            this._isShown && (this._$el.hide(), this._isShown = !1)
        },
        show: function() {
            this._isShown || (this._$el.show(), this._isShown = !0)
        },
        isShown: function() {
            return this._isShown
        },
        enter: function() {
            var t = this._$el.find("._content");
            t.length && (this._$el.addClass(N.HOVER), this._didEllipsis || s.byLine(t, k, {
                useText: !0,
                slice: !0
            }))
        },
        leave: function() {
            this._$el.removeClass(N.HOVER)
        },
        reset: function() {
            this._mediaInfo = null, this._isShown = !1, this._position = {
                left: 0,
                top: 0
            }, this._currentPosition = {
                left: 0,
                top: 0
            }, this._isLongHeight = !1, this._didEllipsis = !1, this._containerWidth = null, this._containerHeight = null, this._isLoading = !1
        },
        moveNext: function(t) {
            var i;
            return this._positionIndex--, this._positionIndex < R.LEFT ? (this._positionIndex = R.RIGHT, this.render(t)) : this._adjustMediaStyles(), i = Y(this._positionIndex, this._containerWidth), this._position.left = i, this._move(i)
        },
        movePrev: function(t) {
            var i;
            return this._positionIndex++, this._positionIndex > R.RIGHT ? (this._positionIndex = R.LEFT, this.render(t)) : this._adjustMediaStyles(), i = Y(this._positionIndex, this._containerWidth), this._position.left = i, this._move(i)
        },
        moveBack: function() {
            return this._move(this._position.left, this._position.top)
        },
        moveTo: function(t, i) {
            return this._move(t, i, !0)
        },
        _move: function(t, i, e) {
            var n = this._currentPosition.left,
                s = this._currentPosition.top;
            return i = i || this._position.top, this._currentPosition.left = t, this._currentPosition.top = i, e || O ? (this._$el.css(z(t, i)), Q.resolve()) : o(this._$el, {
                fromX: n,
                x: t,
                fromY: s,
                y: i
            }, E)
        },
        _isEqual: function(t) {
            return _.isEmpty(this._mediaInfo) || _.isEmpty(t) ? !1 : _.isEqual(this._mediaInfo.media, t)
        },
        getPositionIndex: function() {
            return this._positionIndex
        },
        isLongHeight: function() {
            return this._isLongHeight
        },
        _activateScroll: function() {
            var t = this;
            this._$media.css("overflow", "auto").on("scroll", function() {
                t._$media.scrollTop() >= t._$media[0].scrollHeight - t._$media.height() ? t.enter() : t.leave()
            })
        },
        _deactivateScroll: function() {
            this._$media.css("overflow", "hidden").off("scroll")
        }
    });
    var U = space.StaticModule.extend({
        template: t.layout,
        skipGlobalEvents: !0,
        collection: null,
        MODE: A,
        ui: {
            mediaContainer: "._mediaContainer",
            pagination: "._mediaPagination",
            totalCount: "._totalMediaCount",
            currentIndex: "._currentMediaIndex"
        },
        initialize: function() {
            this._mode = null, this._options = {
                profile: null,
                activityIndex: 0,
                mediaIndex: 0
            }, this._mediaCount = 0, this._isShown = !1, this._activities = new a, this._mediaContainers = [], this._flickingInfo = null, this._fOnFlickingMove = _.bind(this._onFlickingMove, this), this._fOnFlickingUp = _.bind(this._onFlickingUp, this), this._isLockedSideArea = !1, K = !1, this._deboucedWheelNavigation = _.debounce(function(t) {
                0 > t ? this.moveNext() : this.movePrev()
            }, T)
        },
        onSetup: function() {
            this.collection = this._activities
        },
        onRoute: function() {
            this.hide()
        },
        onRender: function() {
            this._initMediaContainers(), this._resize(), this._renderMediaAll(), this._updateMediaIndex()
        },
        _initMediaContainers: function() {
            var t = this;
            this._mediaContainers = [], _.each(this.ui.mediaContainer, function(i, e) {
                var n = new V($(i), e);
                t._mediaContainers.push(n)
            })
        },
        _getModel: function(t) {
            return t = "undefined" == typeof t ? this._options.activityIndex : t, this.collection.at(t)
        },
        _getMediaAndModel: function(t, i) {
            var e, n, o = this._getModel(),
                s = this._options.activityIndex;
            if (!o) return null;
            if (e = o.get("media"), !e) return null;
            if (t = "undefined" == typeof t ? this._options.mediaIndex : t, n = e.length, 0 > t && this._getModel(s - 1)) s--, o = this._getModel(s), e = o.get("media"), t = e ? e.length - 1 : 0;
            else if (t >= n && this._getModel(s + 1)) s++, o = this._getModel(s), e = o.get("media"), t = 0;
            else if (0 > t || t >= n) return;
            return i && (this._options.activityIndex = s, this._options.mediaIndex = t), e ? {
                model: o,
                media: e[t],
                mediaIndex: t
            } : s
        },
        _getCurrentIndex: function() {
            for (var t = 0, i = 0, e = this.collection.length; e > i; i++) {
                if (this._options.activityIndex === i) {
                    t += this._options.mediaIndex + 1;
                    break
                }
                t += this.collection.at(i).get("media").length
            }
            return t
        },
        _getProfile: function() {
            var t = this._getModel();
            return t && t.get("actor") && t.get("actor").get("id") ? t.get("actor") : this._options.profile
        },
        _setMediaCount: function(t) {
            this._mediaCount = _.isNumber(t) && t > 0 ? t : this.collection.getMediaCount(), this.ui.totalCount.text(i.numberFormat(this._mediaCount))
        },
        _updateMediaIndex: function() {
            this.ui.currentIndex.text(i.numberFormat(this._getCurrentIndex())), this._getMediaAndModel(this._options.mediaIndex + 1) || this.trigger("end")
        },
        _getMediaContainer: function(t) {
            return _.find(this._mediaContainers, function(i) {
                return i.getPositionIndex() === t
            })
        },
        _getMediaContainerByTargetElement: function(t) {
            var i = $(t).closest("._mediaContainer");
            return i.length ? _.find(this._mediaContainers, function(t) {
                return t.getElement().is(i)
            }) : !1
        },
        movePrev: function() {
            return this._move(-1)
        },
        moveNext: function() {
            return this._move(1)
        },
        _move: function(t) {
            var i = this,
                e = Q.resolve(),
                n = 0 > t ? "movePrev" : "moveNext",
                o = this._getMediaAndModel(this._options.mediaIndex + t, !0),
                s = this._getMediaAndModel(this._options.mediaIndex + t);
            return o ? (e = e.then(function() {
                return Q.all(_.map(i._mediaContainers, function(t) {
                    return t[n](s)
                }))
            }), i._navigate(!0), i._updateMediaIndex(), e) : Q.reject()
        },
        _renderMediaAll: function() {
            var t = this;
            this.collection.length && _.each(this._mediaContainers, function(i, e) {
                var n = t._getMediaAndModel(t._options.mediaIndex + (e - 1));
                i.render(n)
            })
        },
        _resize: function() {
            d = P.width(), l = P.height(), O ? (W = v, l = Math.max(w + 2 * W, l), c = I * d, u = l - 2 * W, g = p * d, f = x * d) : (W = 0, c = d, u = l, g = 0, f = 0), _.invoke(this._mediaContainers, "resize")
        },
        _navigate: function(t) {
            return this._mode === A.ONLY_IMAGE ? Q.resolve() : (h.sendPageView("mdv"), space.Router.navigate(this._getUrl(), {
                trigger: !1,
                replace: t ? !0 : !1
            }))
        },
        _getUrl: function() {
            var t, i = this._getModel(),
                e = this._getProfile();
            switch (this._mode) {
                case A.ACTIVITY:
                    return "/" + e.get("urlKey") + "/" + i.get("urlKey") + "/photos/" + this._options.mediaIndex;
                case A.COMMENT:
                    return t = e.parent, i = t.collection.parent, e = i.get("actor"), "/" + e.get("urlKey") + "/" + i.get("urlKey") + "/" + t.get("id") + "/photo";
                case A.PROFILE:
                    return "/" + e.get("urlKey") + "/profile/photo";
                case A.ONLY_IMAGE:
                    return ""
            }
        },
        _getReturnUrl: function() {
            var t, i = this._getModel(),
                e = this._getProfile();
            switch (this._mode) {
                case A.ACTIVITY:
                    return "/" + e.get("urlKey") + "/" + i.get("urlKey");
                case A.COMMENT:
                    return t = e.parent, i = t.collection.parent, e = i.get("actor"), "/" + e.get("urlKey") + "/" + i.get("urlKey") + "/" + t.get("id");
                case A.PROFILE:
                    return "/" + e.get("urlKey");
                case A.ONLY_IMAGE:
                    return ""
            }
        },
        addActivity: function(t) {
            this.collection.add(t)
        },
        addImages: function(t) {
            var i = [];
            K = !0, _.isString(t) && (t = [t]), _.each(t, function(t) {
                i.push({
                    origin_url: t,
                    url: t,
                    thumbnail_url: t
                })
            }), this.collection = this._activities, this.collection.add({
                id: 0,
                media: i
            }), this._setMediaCount(t.length)
        },
        show: function(t, i) {
            var e = this,
                n = Q.resolve();
            return this._mode = t, this._options = _.defaults(i || {}, {
                totalCount: 0,
                hidePagination: !1,
                skipNavigation: !1,
                profile: null,
                activityIndex: 0,
                mediaIndex: 0
            }), this._isShown || (this._options.skipNavigation || (n = n.then(function() {
                return e._navigate()
            })), n = n.then(function() {
                e._show()
            })), n
        },
        _show: function() {
            this._isShown || (this.render(), this.attachGlobalEvents(), this.attachModelEvents(), r.dimmed("gallery"), r.show(this.$el), this._setMediaCount(this._options.totalCount), this.ui.pagination.toggle(!this._options.hidePagination), this._isShown = !0)
        },
        hide: function() {
            var t = this._options.activityIndex,
                i = this._options.mediaIndex,
                e = K;
            this._isShown && (this.detachGlobalEvents(), r.hide(), this._reset(), this.$el.empty(), this._isShown = !1, this._mode = null, e || this.trigger("hide", t, i))
        },
        _reset: function() {
            this.collection === this._activities && this.collection.reset(), this.collection = this._activities, this._mediaCount = 0, this._options = {
                profile: null,
                mediaIndex: 0,
                activityIndex: 0
            }, K = !1
        },
        _lockSideArea: function() {
            this._isLockedSideArea = !0, this._unlockSideArea()
        },
        _unlockSideArea: _.debounce(function() {
            this._isLockedSideArea = !1
        }, y),
        hideAndClose: function() {
            this._isShown && (this._options.skipNavigation ? space.Router.navigate(this._getReturnUrl()) : this._mode !== A.ONLY_IMAGE ? history.back() : this.hide())
        },
        collectionEvents: {
            add: function() {
                var t = this._getMediaContainer(R.RIGHT);
                this._setMediaCount(), t && (t.isShown() || t.render(this._getMediaAndModel(this._options.mediaIndex + 1)))
            },
            remove: "_setMediaCount"
        },
        documentEvents: {
            selectstart: function(t) {
                t.preventDefault()
            },
            "mousemove,touchmove": function(t) {
                t.preventDefault()
            },
            keydown: function(t) {
                switch (t.keyCode) {
                    case i.KEY.RIGHT:
                        this.moveNext();
                        break;
                    case i.KEY.LEFT:
                        this.movePrev();
                        break;
                    case i.KEY.ESC:
                        this.hideAndClose()
                }
            }
        },
        windowEvents: {
            "resize,orientationchange": _.throttle(function() {
                U.prototype._resize.apply(this, arguments)
            }, m)
        },
        events: {
            "click ._mediaViewClose": function(t) {
                t.preventDefault(), this.hideAndClose()
            },
            touchstart: function(t) {
                var i = agent.getTouchEvent(t);
                return O ? void t.preventDefault() : (this._flickingInfo = {
                    x: i.pageX,
                    y: i.pageY,
                    timeStamp: _.now()
                }, void b.on("mousemove touchmove", this._fOnFlickingMove).on("mouseup contextmenu touchend touchcancel", this._fOnFlickingUp))
            },
            click: function(t) {
                t.preventDefault(), O && ($(t.target).closest("._mediaViewClose").length || this._onClickContainer(t))
            },
            "contextmenu img": function(t) {
                t.preventDefault()
            },
            "wheel,mousewheel,DOMMouseScroll": function(t) {
                var i = this._getMediaContainerByTargetElement($(t.target)),
                    e = agent.getWheelDelta(t);
                i && i.isLongHeight() || this._deboucedWheelNavigation(e)
            }
        },
        _onClickContainer: function(t) {
            var i = $(t.target),
                e = this._getMediaContainerByTargetElement(i),
                n = this._getMediaContainer(R.LEFT),
                o = this._getMediaContainer(R.RIGHT),
                s = this._getModel();
            e && e.getPositionIndex() === R.CENTER ? "contextmenu" !== t.type && (i.closest("._link").length ? space.Router.navigate("/" + (this._options.profile ? this._options.profile.get("urlKey") : s.get("actor").get("urlKey")) + "/" + s.get("urlKey")) : O && !K && (this.moveNext(), e.enter())) : t.pageX <= g ? n && n.isShown() ? (this._lockSideArea(), this.movePrev()) : this._isLockedSideArea || this.hideAndClose() : t.pageX >= d - g ? o && o.isShown() ? (this._lockSideArea(), this.moveNext()) : this._isLockedSideArea || this.hideAndClose() : this.hideAndClose()
        },
        _onFlickingMove: function(t) {
            var i = this,
                e = agent.getTouchEvent(t);
            t.preventDefault(), null !== this._flickingInfo && _.each(this._mediaContainers, function(t) {
                var n = t.getPosition();
                t.moveTo(n.left + (e.pageX - i._flickingInfo.x))
            })
        },
        _onFlickingUp: function(t) {
            var i, e, n, o = this,
                s = this._getMediaContainerByTargetElement($(t.target)),
                h = this._getMediaContainer(R.CENTER),
                a = !1,
                r = 0,
                l = _.now();
            null !== this._flickingInfo && (e = h.getPosition().left, n = h.getCurrentPosition().left, i = Math.abs(n - e), r = i / ((l - this._flickingInfo.timeStamp) / 1e3), a = i >= d / 2 || r > L, a && e > n ? this.moveNext().fail(function() {
                _.invoke(o._mediaContainers, "moveBack")
            }) : a && n > e ? this.movePrev().fail(function() {
                _.invoke(o._mediaContainers, "moveBack")
            }) : 0 === i && s ? this._onClickContainer(t) : _.invoke(o._mediaContainers, "moveBack"), this._flickingInfo = null), b.off("mousemove touchmove", this._fOnFlickingMove).off("mouseup contextmenu touchend touchcancel", this._fOnFlickingUp)
        }
    });
    return new U
});
define("common/mobileAppLink", ["config"], function(e) {
    var o = {
        other: e.serviceUrl.story,
        ios: {
            store: e.appLink.ios.store.app,
            app: e.appLink.ios.scheme
        },
        android: {
            store: e.appLink.android.store.app,
            app: e.appLink.android.scheme
        }
    }, n = {
        ios: function(e, o) {
            var n = 25,
                i = 1e3,
                t = (new Date).getTime();
            setTimeout(function() {
                var e = (new Date).getTime();
                o && i > e - t && (location.href = o)
            }, n), e && (location.href = e)
        },
        android: function(e, o) {
            if (0 === e.indexOf("intent")) return void(location.href = e);
            var n = 1e3,
                i = 2e3,
                t = window.open(e),
                a = (new Date).getTime();
            t.close(), setTimeout(function() {
                var e = (new Date).getTime();
                e - a > i || o && document.webkitHidden === !1 && (location.href = o)
            }, n)
        }
    };
    return {
        openStoryApp: function() {
            this.openApp(o)
        },
        openApp: function(e) {
            var o = agent.os.name,
                i = e[o] && e[o].app,
                t = e[o] && e[o].store;
            (agent.os.is.ios || agent.os.is.android) && i && t ? n[o](i, t) : e.other && (location.href = e.other)
        }
    }
});
define("template/mobileAppLinkBanner", ["Handlebars"], function(n) {
    var a = function(a) {
        var t = n.template(a);
        return function(n) {
            return t(n, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        banner: function() {
            var n = a(function(n, a, e, t, p) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, n.helpers), p = p || {};
                var r, s, i = "",
                    l = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<a href="#" class="link_app _openStoryApp" data-kant-id="214"><span class="ic_story"></span>' + c((r = e.t || a && a.t, s = {
                    hash: {},
                    data: p
                }, r ? r.call(a, "mobileAppLinkBanner.openBtn", s) : l.call(a, "t", "mobileAppLinkBanner.openBtn", s))) + '</a> <a href="#" class="link_close _closeAppLinkBanner" data-kant-id="215"><span class="ic_close">' + c((r = e.t || a && a.t, s = {
                    hash: {},
                    data: p
                }, r ? r.call(a, "mobileAppLinkBanner.closeBtn", s) : l.call(a, "t", "mobileAppLinkBanner.closeBtn", s))) + "</span></a>"
            });
            return n.wrap = '<div class="bnr_app">', n
        }()
    }
});
define("module/static/mobileAppLinkBanner", ["common/mobileAppLink", "common/storage", "template/mobileAppLinkBanner"], function(e, n, t) {
    return new(space.StaticModule.extend({
        BANNER_CONTAINER: "#mobileAppLinkBanner",
        template: t.banner,
        events: {
            "click ._openStoryApp": function(n) {
                n.preventDefault(), e.openStoryApp()
            },
            "click ._closeAppLinkBanner": function(e) {
                e.preventDefault(), this.hide(), n.set(n.KEY.HIDE_MOBILE_APP_LINK_BANNER, !0, n.EXPIRES.HIDE_MOBILE_APP_LINK_BANNER)
            }
        },
        onRender: function() {
            agent.type.is.mobile && !n.get(n.KEY.HIDE_MOBILE_APP_LINK_BANNER) ? this.$el.appendTo(this.BANNER_CONTAINER) : this.remove()
        }
    }))
});
define("template/profilePopup", ["Handlebars"], function(a) {
    var t = function(t) {
        var s = a.template(t);
        return function(a) {
            return s(a, {
                partials: n
            })
        }
    }, n = {
        storyPlusStatus: function() {
            return t(function(a, t, n, s, l) {
                function e(a, t) {
                    var s, l, e = "";
                    return e += "<p>", (l = n.statusMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.statusMessage, s = typeof l === p ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += h(s) + "</p>"
                }
                function i(a, t) {
                    var s, l, e = "";
                    return e += " ", (l = n.followerMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.followerMessage, s = typeof l === p ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += h(s) + " "
                }
                function r(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _follow" data-kant-id="330"><span>' + h((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.follow", l) : u.call(a, "t", "friend.btn.follow", l))) + "</span></button> "
                }
                function o(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _following" data-kant-id="332"><span>' + h((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.following", l) : u.call(a, "t", "friend.btn.following", l))) + '</span></button> <button class="btn_com btn_wh _unfollow" style="display:none" data-kant-id="332"><span>' + h((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.unfollow", l) : u.call(a, "t", "friend.btn.unfollow", l))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), l = l || {};
                var c, d, f = "",
                    p = "function",
                    h = this.escapeExpression,
                    u = n.helperMissing,
                    v = this;
                return f += '<div class="pf_txt"><a href="/', (d = n.urlKey) ? c = d.call(t, {
                    hash: {},
                    data: l
                }) : (d = t && t.urlKey, c = typeof d === p ? d.call(t, {
                    hash: {},
                    data: l
                }) : d), f += h(c) + '" class="tit _profilePopupLink _profileName" data-kant-id="329">', (d = n.display_name) ? c = d.call(t, {
                    hash: {},
                    data: l
                }) : (d = t && t.display_name, c = typeof d === p ? d.call(t, {
                    hash: {},
                    data: l
                }) : d), f += h(c) + "</a>  ", c = n["if"].call(t, t && t.statusMessage, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(1, e, l),
                    data: l
                }), (c || 0 === c) && (f += c), f += '</div><div class="add_txt">', c = n["if"].call(t, t && t.followerMessage, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(3, i, l),
                    data: l
                }), (c || 0 === c) && (f += c), f += " ", c = n["if"].call(t, t && t.canAddFriend, {
                    hash: {},
                    inverse: v.program(7, o, l),
                    fn: v.program(5, r, l),
                    data: l
                }), (c || 0 === c) && (f += c), f += "</div>"
            })
        }(),
        peopleStatus: function() {
            return t(function(a, t, n, s, l) {
                function e() {
                    return '<div class="pf_txt">'
                }
                function i(a, t) {
                    var s, l = "";
                    return l += " ", s = n["if"].call(a, a && a.isMe, {
                        hash: {},
                        inverse: y.program(6, o, t),
                        fn: y.program(4, r, t),
                        data: t
                    }), (s || 0 === s) && (l += s), l += " "
                }
                function r() {
                    return '<div class="pf_txt addbtn v2">'
                }
                function o() {
                    return '<div class="pf_txt addbtn">'
                }
                function c(a, t) {
                    var s, l, e = "";
                    return e += ' <span class="ic_birthday">' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.alt.birthday", l) : k.call(a, "t", "friend.alt.birthday", l))) + "</span> "
                }
                function d(a, t) {
                    var s, l = "";
                    return l += " ", s = n["if"].call(a, a && a.isMusicStatus, {
                        hash: {},
                        inverse: y.program(13, p, t),
                        fn: y.program(11, f, t),
                        data: t
                    }), (s || 0 === s) && (l += s), l += " "
                }
                function f(a, t) {
                    var s, l, e, i = "";
                    return i += '<p class="music"><a href="#" class="_playMusic" data-kant-id="334"><span class="ic_play">' + w((l = n.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.alt.music", e) : k.call(a, "t", "friend.alt.music", e))) + "</span>", (l = n.statusMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.statusMessage, s = typeof l === M ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), i += w(s) + "</a></p>"
                }
                function p(a, t) {
                    var s, l, e = "";
                    return e += "<p>", (l = n.statusMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.statusMessage, s = typeof l === M ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += w(s) + "</p>"
                }
                function h(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _invite" data-kant-id="335"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.invite", l) : k.call(a, "t", "friend.btn.invite", l))) + "</span></button> "
                }
                function u(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com ing _inviting" data-kant-id="336"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.inviting", l) : k.call(a, "t", "friend.btn.inviting", l))) + '</span></button> <button class="btn_com ing _cancel" style="display:none" data-kant-id="336"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.cancel", l) : k.call(a, "t", "friend.btn.cancel", l))) + "</span></button> "
                }
                function v(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _accept" data-kant-id="338"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.accept", l) : k.call(a, "t", "friend.btn.accept", l))) + "</span></button> "
                }
                function b(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _myProfile _profilePopupLink" data-kant-id="339"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.link.editProfile", l) : k.call(a, "t", "friend.link.editProfile", l))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), l = l || {};
                var m, _, g = "",
                    y = this,
                    k = n.helperMissing,
                    w = this.escapeExpression,
                    M = "function";
                return g += " ", m = n["if"].call(t, t && t.isFriend, {
                    hash: {},
                    inverse: y.program(3, i, l),
                    fn: y.program(1, e, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += ' <a href="/', (_ = n.urlKey) ? m = _.call(t, {
                    hash: {},
                    data: l
                }) : (_ = t && t.urlKey, m = typeof _ === M ? _.call(t, {
                    hash: {},
                    data: l
                }) : _), g += w(m) + '" class="tit _profilePopupLink _profileName" data-kant-id="333">', (_ = n.display_name) ? m = _.call(t, {
                    hash: {},
                    data: l
                }) : (_ = t && t.display_name, m = typeof _ === M ? _.call(t, {
                    hash: {},
                    data: l
                }) : _), g += w(m) + "</a> ", m = n["if"].call(t, t && t.is_birthday, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(8, c, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += "  ", m = n["if"].call(t, t && t.statusMessage, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(10, d, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.canAddFriend, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(15, h, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.isRequestSent, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(17, u, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.isRequestReceived, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(19, v, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.isMe, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(21, b, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += "</div></div></div>"
            })
        }(),
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, n, s, l) {
                return this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), l = l || {}, '<div data-part="profile"></div>'
            });
            return a.wrap = '<div class="ly pf_flayer _profilePopup" data-kant-group="mpf">', a
        }(),
        profile: function() {
            var a = t(function(a, t, n, s, l) {
                function e(a, t) {
                    var s, l, e, i = "";
                    return i += ' <img src="' + b((l = n.profileImage || a && a.profileImage, e = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "72"
                        },
                        data: t
                    }, l ? l.call(a, e) : v.call(a, "profileImage", e))) + '" class="_profileImage" alt="', (l = n.display_name) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.display_name, s = typeof l === m ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), i += b(s) + '"><span class="line"></span> '
                }
                function i(a, t) {
                    var s, l, e = "";
                    return e += " ", (l = n.diplay_name) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.diplay_name, s = typeof l === m ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += b(s) + " "
                }
                function r(a, t) {
                    var s, l = "";
                    return l += " ", s = n["if"].call(a, a && a.is_favorite, {
                        hash: {},
                        inverse: _.program(8, c, t),
                        fn: _.program(6, o, t),
                        data: t
                    }), (s || 0 === s) && (l += s), l += " "
                }
                function o(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="bn_inter on _makeUnfav" data-kant-id="327">' + b((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.makeUnfav", l) : v.call(a, "t", "friend.btn.makeUnfav", l))) + "</button> "
                }
                function c(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="bn_inter _makeFav" data-kant-id="328">' + b((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.makeFav", l) : v.call(a, "t", "friend.btn.makeFav", l))) + "</button> "
                }
                function d(a, t) {
                    var l, e = "";
                    return e += " ", l = _.invokePartial(s.storyPlusStatus, "storyPlusStatus", a, n, s, t), (l || 0 === l) && (e += l), e += " "
                }
                function f(a, t) {
                    var l, e = "";
                    return e += " ", l = _.invokePartial(s.peopleStatus, "peopleStatus", a, n, s, t), (l || 0 === l) && (e += l), e += " "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), s = this.merge(s, a.partials), l = l || {};
                var p, h, u = "",
                    v = n.helperMissing,
                    b = this.escapeExpression,
                    m = "function",
                    _ = this;
                return u += ' <a href="/', (h = n.urlKey) ? p = h.call(t, {
                    hash: {},
                    data: l
                }) : (h = t && t.urlKey, p = typeof h === m ? h.call(t, {
                    hash: {},
                    data: l
                }) : h), u += b(p) + '" class="bgimg _profilePopupLink" data-kant-id="325"><img src="', (h = n.bg_image_url) ? p = h.call(t, {
                    hash: {},
                    data: l
                }) : (h = t && t.bg_image_url, p = typeof h === m ? h.call(t, {
                    hash: {},
                    data: l
                }) : h), u += b(p) + '" class="_backgroundImage" alt="', (h = n.display_name) ? p = h.call(t, {
                    hash: {},
                    data: l
                }) : (h = t && t.display_name, p = typeof h === m ? h.call(t, {
                    hash: {},
                    data: l
                }) : h), u += b(p) + '"><span class="cover"></span></a> <div class="pf"><a href="/', (h = n.urlKey) ? p = h.call(t, {
                    hash: {},
                    data: l
                }) : (h = t && t.urlKey, p = typeof h === m ? h.call(t, {
                    hash: {},
                    data: l
                }) : h), u += b(p) + '" class="_profilePopupLink" data-kant-id="326">', p = n["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: _.program(3, i, l),
                    fn: _.program(1, e, l),
                    data: l
                }), (p || 0 === p) && (u += p), u += "</a></div> ", p = n["if"].call(t, t && t.isFriend, {
                    hash: {},
                    inverse: _.noop,
                    fn: _.program(5, r, l),
                    data: l
                }), (p || 0 === p) && (u += p), u += "  ", p = n["if"].call(t, t && t.isStoryPlus, {
                    hash: {},
                    inverse: _.program(12, f, l),
                    fn: _.program(10, d, l),
                    data: l
                }), (p || 0 === p) && (u += p), u += ' <span class="line"></span>'
            });
            return a.wrap = '<div class="pf_layer_in">', a
        }(),
        storyPlusStatus: function() {
            var a = t(function(a, t, n, s, l) {
                function e(a, t) {
                    var s, l, e = "";
                    return e += "<p>", (l = n.statusMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.statusMessage, s = typeof l === p ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += h(s) + "</p>"
                }
                function i(a, t) {
                    var s, l, e = "";
                    return e += " ", (l = n.followerMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.followerMessage, s = typeof l === p ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += h(s) + " "
                }
                function r(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _follow" data-kant-id="330"><span>' + h((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.follow", l) : u.call(a, "t", "friend.btn.follow", l))) + "</span></button> "
                }
                function o(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _following" data-kant-id="332"><span>' + h((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.following", l) : u.call(a, "t", "friend.btn.following", l))) + '</span></button> <button class="btn_com btn_wh _unfollow" style="display:none" data-kant-id="332"><span>' + h((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.unfollow", l) : u.call(a, "t", "friend.btn.unfollow", l))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), l = l || {};
                var c, d, f = "",
                    p = "function",
                    h = this.escapeExpression,
                    u = n.helperMissing,
                    v = this;
                return f += '<div class="pf_txt"><a href="/', (d = n.urlKey) ? c = d.call(t, {
                    hash: {},
                    data: l
                }) : (d = t && t.urlKey, c = typeof d === p ? d.call(t, {
                    hash: {},
                    data: l
                }) : d), f += h(c) + '" class="tit _profilePopupLink _profileName" data-kant-id="329">', (d = n.display_name) ? c = d.call(t, {
                    hash: {},
                    data: l
                }) : (d = t && t.display_name, c = typeof d === p ? d.call(t, {
                    hash: {},
                    data: l
                }) : d), f += h(c) + "</a>  ", c = n["if"].call(t, t && t.statusMessage, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(1, e, l),
                    data: l
                }), (c || 0 === c) && (f += c), f += '</div><div class="add_txt">', c = n["if"].call(t, t && t.followerMessage, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(3, i, l),
                    data: l
                }), (c || 0 === c) && (f += c), f += " ", c = n["if"].call(t, t && t.canAddFriend, {
                    hash: {},
                    inverse: v.program(7, o, l),
                    fn: v.program(5, r, l),
                    data: l
                }), (c || 0 === c) && (f += c), f += "</div>"
            });
            return a
        }(),
        peopleStatus: function() {
            var a = t(function(a, t, n, s, l) {
                function e() {
                    return '<div class="pf_txt">'
                }
                function i(a, t) {
                    var s, l = "";
                    return l += " ", s = n["if"].call(a, a && a.isMe, {
                        hash: {},
                        inverse: y.program(6, o, t),
                        fn: y.program(4, r, t),
                        data: t
                    }), (s || 0 === s) && (l += s), l += " "
                }
                function r() {
                    return '<div class="pf_txt addbtn v2">'
                }
                function o() {
                    return '<div class="pf_txt addbtn">'
                }
                function c(a, t) {
                    var s, l, e = "";
                    return e += ' <span class="ic_birthday">' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.alt.birthday", l) : k.call(a, "t", "friend.alt.birthday", l))) + "</span> "
                }
                function d(a, t) {
                    var s, l = "";
                    return l += " ", s = n["if"].call(a, a && a.isMusicStatus, {
                        hash: {},
                        inverse: y.program(13, p, t),
                        fn: y.program(11, f, t),
                        data: t
                    }), (s || 0 === s) && (l += s), l += " "
                }
                function f(a, t) {
                    var s, l, e, i = "";
                    return i += '<p class="music"><a href="#" class="_playMusic" data-kant-id="334"><span class="ic_play">' + w((l = n.t || a && a.t, e = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.alt.music", e) : k.call(a, "t", "friend.alt.music", e))) + "</span>", (l = n.statusMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.statusMessage, s = typeof l === M ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), i += w(s) + "</a></p>"
                }
                function p(a, t) {
                    var s, l, e = "";
                    return e += "<p>", (l = n.statusMessage) ? s = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.statusMessage, s = typeof l === M ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), e += w(s) + "</p>"
                }
                function h(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _invite" data-kant-id="335"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.invite", l) : k.call(a, "t", "friend.btn.invite", l))) + "</span></button> "
                }
                function u(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com ing _inviting" data-kant-id="336"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.inviting", l) : k.call(a, "t", "friend.btn.inviting", l))) + '</span></button> <button class="btn_com ing _cancel" style="display:none" data-kant-id="336"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.cancel", l) : k.call(a, "t", "friend.btn.cancel", l))) + "</span></button> "
                }
                function v(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _accept" data-kant-id="338"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.accept", l) : k.call(a, "t", "friend.btn.accept", l))) + "</span></button> "
                }
                function b(a, t) {
                    var s, l, e = "";
                    return e += ' <button class="btn_com btn_wh _myProfile _profilePopupLink" data-kant-id="339"><span>' + w((s = n.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.link.editProfile", l) : k.call(a, "t", "friend.link.editProfile", l))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, a.helpers), l = l || {};
                var m, _, g = "",
                    y = this,
                    k = n.helperMissing,
                    w = this.escapeExpression,
                    M = "function";
                return g += " ", m = n["if"].call(t, t && t.isFriend, {
                    hash: {},
                    inverse: y.program(3, i, l),
                    fn: y.program(1, e, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += ' <a href="/', (_ = n.urlKey) ? m = _.call(t, {
                    hash: {},
                    data: l
                }) : (_ = t && t.urlKey, m = typeof _ === M ? _.call(t, {
                    hash: {},
                    data: l
                }) : _), g += w(m) + '" class="tit _profilePopupLink _profileName" data-kant-id="333">', (_ = n.display_name) ? m = _.call(t, {
                    hash: {},
                    data: l
                }) : (_ = t && t.display_name, m = typeof _ === M ? _.call(t, {
                    hash: {},
                    data: l
                }) : _), g += w(m) + "</a> ", m = n["if"].call(t, t && t.is_birthday, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(8, c, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += "  ", m = n["if"].call(t, t && t.statusMessage, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(10, d, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.canAddFriend, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(15, h, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.isRequestSent, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(17, u, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.isRequestReceived, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(19, v, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += " ", m = n["if"].call(t, t && t.isMe, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(21, b, l),
                    data: l
                }), (m || 0 === m) && (g += m), g += "</div></div></div>"
            });
            return a
        }()
    }
});
define("common/musicPlayer", ["common/api"], function(e) {
    var t = "/musics/play_url",
        n = {
            INVALID_DEVICE: {
                message: intl.t("activity.music.notSupport")
            }
        }, r = null,
        i = !agent.type.is.desktop;
    return {
        openByPlayUrl: function(e) {
            return i ? Q.reject(n.INVALID_DEVICE) : (this._openBlankPopupWindow(), this._setPlayerUrl(e), Q.resolve())
        },
        openByProfileId: function(r) {
            var o = this;
            return i ? Q.reject(n.INVALID_DEVICE) : (this._openBlankPopupWindow(), e.request({
                url: t,
                data: {
                    profile_id: r
                }
            }).then(function(e) {
                o._setPlayerUrl(e.play_url)
            }))
        },
        openByActivityId: function(r, o) {
            var l = this;
            return i ? Q.reject(n.INVALID_DEVICE) : (this._openBlankPopupWindow(), e.request({
                url: t,
                data: {
                    activity_id: r
                }
            }).then(function(e) {
                var t = e.play_url;
                o && (t = t.replace(/(?:\&|\?)track=[^\&]*/i, "")), l._setPlayerUrl(t)
            }))
        },
        _openBlankPopupWindow: function() {
            r && r.close(), r = window.open("", "musicPlayer", "width=720,height=575,resizable=1,scrollbars=1")
        },
        _setPlayerUrl: function(e) {
            if (_.isString(e) || (e = e.web), !e) throw new Error("재생할 URL을 찾지 못했습니다.");
            r && (r.location.href = e)
        }
    }
});
define("part/profile/ProfilePart", ["module/static/dialog", "common/musicPlayer", "common/util", "common/imgUtil", "common/ellipsis", "module/static/error"], function(e, i, n, t, l, o) {
    return space.Part.extend({
        PROFILE_NAME_WIDTH: 0,
        model: null,
        modelEvents: {
            "change:relationship": "render",
            "change:is_favorite": "render"
        },
        ui: {
            inviting: "._inviting",
            cancel: "._cancel",
            following: "._following",
            unfollow: "._unfollow",
            profileName: "._profileName",
            profileImage: "._profileImage"
        },
        events: {
            "click ._invite": function(e) {
                e.preventDefault(), this.model.invite().fail(o.getHandler())
            },
            "click ._cancel": function(i) {
                i.preventDefault();
                var n = this,
                    t = intl.t("friend.dialog.cancel");
                e.confirm(t, i.target).then(function() {
                    return n.model.cancel().fail(o.getHandler())
                }).fail(function() {})
            },
            "click ._follow": function(e) {
                e.preventDefault(), this.model.follow().fail(o.getHandler())
            },
            "click ._unfollow": function(i) {
                i.preventDefault();
                var n = this,
                    t = intl.t("friend.dialog.unfollow");
                e.confirm(t, i.target).then(function() {
                    return n.model.unfollow().fail(o.getHandler())
                }).fail(function() {})
            },
            "mouseenter ._inviting,._cancel": function() {
                this.ui.inviting.hide(), this.ui.cancel.show()
            },
            "mouseleave ._inviting,._cancel": function() {
                this.ui.cancel.hide(), this.ui.inviting.show()
            },
            "mouseenter ._following,._unfollow": function() {
                this.ui.following.hide(), this.ui.unfollow.show()
            },
            "mouseleave ._following,._unfollow": function() {
                this.ui.unfollow.hide(), this.ui.following.show()
            },
            "click ._makeFav": function(e) {
                e.preventDefault(), this.model.makeFavorite().fail(o.getHandler())
            },
            "click ._makeUnfav": function(e) {
                e.preventDefault(), this.model.makeUnfavorite().fail(o.getHandler())
            },
            "click ._deleteFriend": function(i) {
                i.preventDefault();
                var n = this,
                    t = intl.t("friend.dialog.delete");
                e.confirm(t, i.target).then(function() {
                    return n.model.deleteFriend().fail(o.getHandler())
                }).fail(function() {})
            },
            "click ._playMusic": function(e) {
                e.preventDefault(), i.openByProfileId(this.model.get("id")).fail(o.getHandler())
            },
            "click ._myProfile": function(e) {
                e.preventDefault(), space.Router.navigate("/s/profile/edit")
            },
            "click ._accept": function(e) {
                e.preventDefault(), this.model.accept().fail(o.getHandler())
            }
        },
        extendData: function() {
            return this.model.get("isStoryPlus") ? {
                followerMessage: intl.t("friend.paragraph.followerMessage", {
                    count: n.numberFormat(this.model.get("follower_count"))
                })
            } : void 0
        },
        onRender: function() {
            this.ui.profileImage && this.ui.profileImage.length && t.resize(this.ui.profileImage, this.ui.profileImage.parent())
        },
        onDomReady: function() {
            this.PROFILE_NAME_WIDTH && this.ui.profileName && this.ui.profileName.length && l.byWidth(this.ui.profileName, {
                width: this.PROFILE_NAME_WIDTH
            })
        }
    })
});
define("module/static/profilePopup", ["template/profilePopup", "model/Profile", "part/profile/ProfilePart", "common/imgUtil", "common/ellipsis", "common/headerArea", "module/static/dialog"], function(t, e, i, o, s, n, r) {
    var u = 340,
        h = 200,
        l = 340,
        p = 154,
        a = 170,
        c = i.extend({
            template: t.profile,
            ui: _.defaults({
                profileName: "._profileName",
                profileImage: "._profileImage",
                backgroundImage: "._backgroundImage"
            }, i.prototype.ui),
            onRender: function() {
                this._resizeProfileImage(), this._resizeBackgroundImage()
            },
            _resizeProfileImage: function() {
                o.resize(this.ui.profileImage, this.ui.profileImage.parent())
            },
            _resizeBackgroundImage: function() {
                var t, e, i = this.model.get("isStoryPlus");
                i ? (t = l, e = p) : (t = u, e = h), o.resize(this.ui.backgroundImage, null, {
                    containerWidth: t,
                    containerHeight: e
                })
            },
            onDomReady: function() {
                this._putEllipsisAtName()
            },
            _putEllipsisAtName: function() {
                s.byWidth(this.ui.profileName, {
                    width: a
                })
            }
        });
    return new(space.StaticModule.extend({
        template: t.layout,
        OPEN_DELAY: 500,
        CLOSE_DELAY: 300,
        TOP_PADDING: 6,
        BOTTOM_PADDING: 24,
        EXCEPTION_CLASS: "#dialog, ._dialogOk, ._dialogCancel",
        styles: {
            storyPlus: "plus"
        },
        documentEvents: {
            "mouseenter [data-profile-popup]": function(t) {
                var e = this,
                    i = $(t.currentTarget);
                this._currentOffset = i.offset(), this._currentHeight = i.height(), this._currentId = i.data("profile-popup"), clearTimeout(this._openTimer), clearTimeout(this._closeTimer), this._openTimer = setTimeout(function() {
                    e._currentId && e._openPopup()
                }, this.OPEN_DELAY)
            },
            "mouseleave [data-profile-popup]": function(t) {
                var e = this;
                this.$el.has(t.relatedTarget).length || (clearTimeout(this._openTimer), this._isTriggeredOpen ? this._closePopup() : this._closeTimer = setTimeout(function() {
                    e._closePopup()
                }, this.CLOSE_DELAY))
            }
        },
        initialize: function() {
            this._$container = $(document.body), this._$window = $(window), this._$document = $(document), this._lastPopupTop = 0, this._currentId = "", this._currentHeight = 0, this._currentOffset = 0, this._isTriggeredOpen = !1, this._openTimer = 0, this._closeTimer = 0
        },
        _openPopup: function() {
            this.childParts.profile && this.removePart("profile"), this.$el.hide(), this._isTriggeredOpen = !0, this.flow.forkWith(this._loadProfile()).next(function(t) {
                return this.addPart("profile", c, {
                    options: {
                        model: t
                    }
                }).next(function() {
                    this._isTriggeredOpen && (this._toggleStoryPlusStyle(t.get("isStoryPlus")), this._show(), this._adjustPosition(), this._attachPopupEvents(), this._attachDialogEvents())
                })
            }).fin(function() {
                this._isTriggeredOpen = !1
            })
        },
        _loadProfile: function() {
            var t = new e({
                id: this._currentId
            });
            return t.fetch().then(function() {
                return t
            })
        },
        _toggleStoryPlusStyle: function(t) {
            this.$el.toggleClass(this.styles.storyPlus, t)
        },
        _show: function() {
            this.$el.css({
                top: Math.round(this._currentOffset.top + this._currentHeight + this.TOP_PADDING),
                left: Math.round(this._currentOffset.left)
            }).appendTo(this._$container), this.show(), this.domReady(!0)
        },
        _adjustPosition: function() {
            var t, e = this._$window,
                i = this.$el,
                o = e.height() + e.scrollTop(),
                s = i.offset().top,
                r = i.height(),
                u = s + r;
            u + this.BOTTOM_PADDING > o && (t = s - r - this._currentHeight - this.BOTTOM_PADDING, t > n.getBottom() && (i.css("top", t), s = t)), this._lastPopupTop = s
        },
        _updateTopPosition: function(t) {
            this.$el.css("top", this._lastPopupTop - t)
        },
        _restoreTopPosition: function() {
            this.$el.css("top", this._lastPopupTop)
        },
        _closePopup: function() {
            this.$el.hide(), this._detachPopupEvents(), this._detachDialogEvents(), this._currentId = "", this._currentHeight = null, this._currentOffset = null, this._isTriggeredOpen = !1
        },
        _attachPopupEvents: function() {
            var t = this;
            this.$el.on("mouseenter", function() {
                clearTimeout(t._closeTimer)
            }).on("mouseleave", function(e) {
                var i = $(e.relatedTarget);
                i.closest(t.EXCEPTION_CLASS).length || (t._closeTimer = setTimeout(function() {
                    t._closePopup()
                }, t.CLOSE_DELAY))
            }).on("click", "._profilePopupLink", function(e) {
                e.preventDefault(), t._closePopup()
            }), this._$document.on("click.profilePopup", function(e) {
                var i = $(e.target);
                t.$el.has(i).length || i.closest(t.EXCEPTION_CLASS).length || t._closePopup()
            })
        },
        _detachPopupEvents: function() {
            this.$el.off(), this._$document.off(".profilePopup")
        },
        _attachDialogEvents: function() {
            this.listenTo(r, {
                show: function(t) {
                    this._updateTopPosition(t)
                },
                hide: function() {
                    this._restoreTopPosition()
                }
            })
        },
        _detachDialogEvents: function() {
            this.stopListening(r)
        },
        onRoute: function() {
            clearTimeout(this._openTimer), this._closePopup()
        }
    }))
});
define("template/report", ["Handlebars"], function(a) {
    var t = function(t) {
        var e = a.template(t);
        return function(a) {
            return e(a, {
                partials: l
            })
        }
    }, l = {
        harmful: function() {
            return t(function(a, t, l, e, r) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), r = r || {};
                var s, o, i = "",
                    c = l.helperMissing,
                    h = this.escapeExpression;
                return i += '<ul class="report_lst report_lst2 _categoryContainer"><li class="loading _selectable">' + h((s = l.img || t && t.img, o = {
                    hash: {
                        src: "/img/loading_circle.gif",
                        width: "24",
                        height: "24",
                        alt: "report.alt.loading"
                    },
                    data: r
                }, s ? s.call(t, o) : c.call(t, "img", o))) + '</li><li><input type="radio" id="report1" name="harm" class="inp_rd _etcReason" value="1"><label for="report1" class="lst_label">' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.harm.etc", o) : c.call(t, "t", "report.harm.etc", o))) + '</label><span class="txt_box"><input type="text" placeholder="' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.harm.etcPlaceholder", o) : c.call(t, "t", "report.harm.etcPlaceholder", o))) + '" title="' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.alt.harmEtcTitle", o) : c.call(t, "t", "report.alt.harmEtcTitle", o))) + '" class="_harmReason"></span></li></ul>'
            })
        }(),
        harmfulProfile: function() {
            return t(function(a, t, l, e, r) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), r = r || {};
                var s, o, i = "",
                    c = l.helperMissing,
                    h = this.escapeExpression;
                return i += '<ul class="report_area"><li><label for="u_text" class="blind">' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.alt.reasonLabel", o) : c.call(t, "t", "report.alt.reasonLabel", o))) + '</label><div class="txt_box txt_box2"><textarea id="u_text" placeholder="' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.harm.reasonPlaceholder", o) : c.call(t, "t", "report.harm.reasonPlaceholder", o))) + '" class="_harmReason"></textarea></div></li></ul>'
            })
        }(),
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, l, e, r) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), r = r || {}, '<div data-part="report"></div>'
            });
            return a.wrap = '<div data-kant-group="rpt">', a
        }(),
        report: function() {
            var a = t(function(a, t, l, e, r) {
                function s(a, t) {
                    var r, s = "";
                    return s += " ", r = p.invokePartial(e.harmfulProfile, "harmfulProfile", a, l, e, t), (r || 0 === r) && (s += r), s += " "
                }
                function o(a, t) {
                    var r, s = "";
                    return s += " ", r = p.invokePartial(e.harmful, "harmful", a, l, e, t), (r || 0 === r) && (s += r), s += " "
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), e = this.merge(e, a.partials), r = r || {};
                var i, c, h, n = "",
                    p = this,
                    d = l.helperMissing,
                    u = this.escapeExpression;
                return n += '<div class="ly_report _reportMenu _reportLayer"><h1>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.title", h) : d.call(t, "t", "report.title", h))) + '</h1><ul class="report_lst"><li><a href="#" class="_harmful" data-kant-id="340"><h2>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.harm.title", h) : d.call(t, "t", "report.harm.title", h))) + "</h2><p>" + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.harm.desc", h) : d.call(t, "t", "report.harm.desc", h))) + '</p><span class="arr"></span></a></li><li><a href="#" class="_libelous" data-kant-id="341"><h2>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.title", h) : d.call(t, "t", "report.libel.title", h))) + "</h2><p>" + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.desc", h) : d.call(t, "t", "report.libel.desc", h))) + '</p><span class="arr"></span></a></li></ul><p class="txt_war"><span class="ico_war"></span>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.warn", h) : d.call(t, "t", "report.warn", h))) + '</p><a href="#" class="btn_close _btnClose" data-kant-id="false">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.alt.close", h) : d.call(t, "t", "report.alt.close", h))) + '</a></div><div class="ly_report _harmfulPane _reportLayer" style="display:none"><h1>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.title", h) : d.call(t, "t", "report.title", h))) + '</h1><div class="tab_lst"> <a href="#" class="selected _harmful" data-kant-id="343">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.harm.title", h) : d.call(t, "t", "report.harm.title", h))) + '</a><a href="#" class="_libelous" data-kant-id="344">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.title", h) : d.call(t, "t", "report.libel.title", h))) + '</a></div><h2 class="blind">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.harm.title", h) : d.call(t, "t", "report.harm.title", h))) + '</h2><h3 class="_typeTitle"></h3><p class="txt">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.harm.guide", h) : d.call(t, "t", "report.harm.guide", h))) + '</p><form class="_harmForm">', i = l["if"].call(t, t && t.isProfile, {
                    hash: {},
                    inverse: p.program(3, o, r),
                    fn: p.program(1, s, r),
                    data: r
                }), (i || 0 === i) && (n += i), n += '<div class="btn_group"><button type="button" class="btn_com btn_wh _btnClose" data-kant-id="false"><span>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.cancel", h) : d.call(t, "t", "report.cancel", h))) + '</span></button> <button type="button" class="btn_com btn_or _harmfulSubmit" data-kant-id="false">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.submit", h) : d.call(t, "t", "report.submit", h))) + '</button></div></form><a href="#" class="btn_close _btnClose" data-kant-id="false">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.alt.close", h) : d.call(t, "t", "report.alt.close", h))) + '</a></div><div class="ly_report _LibelousPane _reportLayer" style="display:none"><h1>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.title", h) : d.call(t, "t", "report.title", h))) + '</h1><div class="tab_lst"> <a href="#" class="_harmful" data-kant-id="348">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.harm.title", h) : d.call(t, "t", "report.harm.title", h))) + '</a><a href="#" class="selected _libelous" data-kant-id="349">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.title", h) : d.call(t, "t", "report.libel.title", h))) + '</a></div><h2 class="blind">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.title", h) : d.call(t, "t", "report.libel.title", h))) + '</h2><p class="txt">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.guide", h) : d.call(t, "t", "report.libel.guide", h))) + '</p><form class="_libelousForm"><ul class="report_area"><li><label for="u_text" class="blind">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.alt.reasonLabel", h) : d.call(t, "t", "report.alt.reasonLabel", h))) + '</label><div class="txt_box txt_box2"><textarea id="u_text" placeholder="' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.libel.reasonPlaceholder", h) : d.call(t, "t", "report.libel.reasonPlaceholder", h))) + '" class="_libReason"></textarea></div></li></ul><div class="btn_group"><button type="button" class="btn_com btn_wh _btnClose" data-kant-id="false"><span>' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.cancel", h) : d.call(t, "t", "report.cancel", h))) + '</span></button> <button type="button" class="btn_com btn_or _libelousSubmit" data-kant-id="false">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.submit", h) : d.call(t, "t", "report.submit", h))) + '</button></div></form><a href="#" class="btn_close _btnClose" data-kant-id="false">' + u((c = l.t || t && t.t, h = {
                    hash: {},
                    data: r
                }, c ? c.call(t, "report.alt.close", h) : d.call(t, "t", "report.alt.close", h))) + "</a></div>"
            });
            return a
        }(),
        categories: function() {
            var a = t(function(a, t, l, e, r) {
                function s(a, t) {
                    var e, r, s = "";
                    return s += '<li class="_selectable"><input type="radio" id="report', (r = l.id) ? e = r.call(a, {
                        hash: {},
                        data: t
                    }) : (r = a && a.id, e = typeof r === i ? r.call(a, {
                        hash: {},
                        data: t
                    }) : r), s += c(e) + '" class="inp_rd" name="harm" value="', (r = l.id) ? e = r.call(a, {
                        hash: {},
                        data: t
                    }) : (r = a && a.id, e = typeof r === i ? r.call(a, {
                        hash: {},
                        data: t
                    }) : r), s += c(e) + '"><label for="report', (r = l.id) ? e = r.call(a, {
                        hash: {},
                        data: t
                    }) : (r = a && a.id, e = typeof r === i ? r.call(a, {
                        hash: {},
                        data: t
                    }) : r), s += c(e) + '" class="lst_label">', (r = l.text) ? e = r.call(a, {
                        hash: {},
                        data: t
                    }) : (r = a && a.text, e = typeof r === i ? r.call(a, {
                        hash: {},
                        data: t
                    }) : r), s += c(e) + "</label></li>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), r = r || {};
                var o, i = "function",
                    c = this.escapeExpression,
                    h = this;
                return o = l.each.call(t, t && t.items, {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(1, s, r),
                    data: r
                }), o || 0 === o ? o : ""
            });
            return a.wrap = "<ul>", a
        }(),
        harmful: function() {
            var a = t(function(a, t, l, e, r) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), r = r || {};
                var s, o, i = "",
                    c = l.helperMissing,
                    h = this.escapeExpression;
                return i += '<li class="loading _selectable">' + h((s = l.img || t && t.img, o = {
                    hash: {
                        src: "/img/loading_circle.gif",
                        width: "24",
                        height: "24",
                        alt: "report.alt.loading"
                    },
                    data: r
                }, s ? s.call(t, o) : c.call(t, "img", o))) + '</li><li><input type="radio" id="report1" name="harm" class="inp_rd _etcReason" value="1"><label for="report1" class="lst_label">' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.harm.etc", o) : c.call(t, "t", "report.harm.etc", o))) + '</label><span class="txt_box"><input type="text" placeholder="' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.harm.etcPlaceholder", o) : c.call(t, "t", "report.harm.etcPlaceholder", o))) + '" title="' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.alt.harmEtcTitle", o) : c.call(t, "t", "report.alt.harmEtcTitle", o))) + '" class="_harmReason"></span></li>'
            });
            return a.wrap = '<ul class="report_lst report_lst2 _categoryContainer">', a
        }(),
        harmfulProfile: function() {
            var a = t(function(a, t, l, e, r) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), r = r || {};
                var s, o, i = "",
                    c = l.helperMissing,
                    h = this.escapeExpression;
                return i += '<li><label for="u_text" class="blind">' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.alt.reasonLabel", o) : c.call(t, "t", "report.alt.reasonLabel", o))) + '</label><div class="txt_box txt_box2"><textarea id="u_text" placeholder="' + h((s = l.t || t && t.t, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, "report.harm.reasonPlaceholder", o) : c.call(t, "t", "report.harm.reasonPlaceholder", o))) + '" class="_harmReason"></textarea></div></li>'
            });
            return a.wrap = '<ul class="report_area">', a
        }()
    }
});
define("module/static/report", ["module/static/cover", "template/report", "common/util", "common/kantUtil"], function(t, e, r, i) {
    var o = 500,
        n = space.StaticModule.extend({
            template: e.layout,
            skipGlobalEvents: !0,
            ui: {
                reportLayer: "._reportLayer"
            },
            events: {
                "click ._btnClose": function(t) {
                    t.preventDefault(), this.hide()
                }
            },
            windowEvents: {
                keydown: function(t) {
                    this._isShown && t.keyCode === r.KEY.ESC && (this.hide(), this.childParts.report.resetPane())
                }
            },
            initialize: function() {
                this._isShown = !1
            },
            show: function() {
                var e = $(window).height(),
                    r = (e - o) / 2;
                agent.type.is.mobile || this.$el.find(this.ui.reportLayer.selector).css({
                    top: r + "px"
                }), this.attachGlobalEvents(), t.show(this.$el, !0), this._isShown = !0, i.sendPageView("rpt")
            },
            hide: function() {
                t.hide(), this.detachGlobalEvents(), this._isShown = !1
            },
            reportActivity: function(t, e) {
                this.addPart("report", "part/report/ReportPart").next(function() {
                    return this.childParts.report.reportActivity(t, e)
                }).next(function() {
                    this.show()
                })
            },
            reportVideo: function(t, e) {
                this.addPart("report", "part/report/ReportPart").next(function() {
                    return this.childParts.report.reportVideo(t, e)
                }).next(function() {
                    this.show()
                })
            },
            reportComment: function(t, e, r, i) {
                this.addPart("report", "part/report/ReportPart").next(function() {
                    return this.childParts.report.reportComment(t, e, r, i)
                }).next(function() {
                    this.show()
                })
            },
            reportProfile: function(t) {
                this.addPart("report", "part/report/ReportPart").next(function() {
                    return this.childParts.report.reportProfile(t)
                }).next(function() {
                    this.show()
                })
            }
        });
    return new n
});
define("module/static/sessionCookie", ["common/util", "common/api", "model/me"], function(e, t, s) {
    var i = 108e5,
        o = 108e5,
        n = 36e5,
        c = "_kslat",
        r = "_karmtea",
        a = 6e4;
    return new(space.StaticModule.extend({
        initialize: function() {
            this._expiresAt = this.getExpiresAt(), this._setLastAccessTime()
        },
        getExpiresAt: function() {
            var t = 1e3 * parseInt(e.getCookie(r), 10);
            return t && !isNaN(t) ? t - i : null
        },
        documentEvents: {
            click: _.throttle(function() {
                var i = this;
                if (this._expiresAt && s.isRegistered()) {
                    var n = o > this._expiresAt - _.now(),
                        c = !this._getLastAccessCookie();
                    n && c && t.request({
                        url: "/web/new_token"
                    }).then(function(t) {
                        t && t.status ? i._expiresAt = i.getExpiresAt() : (e.clearSessionCookie(), s.setLoggedIn(!1))
                    }), this._setLastAccessTime()
                }
            }, a)
        },
        _setLastAccessTime: function() {
            var t = _.now();
            e.setCookie(c, t, t + n, location.hostname)
        },
        _getLastAccessCookie: function() {
            return e.getCookie(c)
        }
    }))
});
define("template/tooltip", ["Handlebars"], function(t) {
    var n = function(n) {
        var o = t.template(n);
        return function(t) {
            return o(t, {
                partials: a
            })
        }
    }, a = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = n(function(t, n, a, o, e) {
                this.compilerInfo = [4, ">= 1.0.0"], a = this.merge(a, t.helpers), e = e || {};
                var r, l, s = "",
                    i = "function",
                    p = this.escapeExpression;
                return s += '<p class="_tooltipContent">', (l = a.content) ? r = l.call(n, {
                    hash: {},
                    data: e
                }) : (l = n && n.content, r = typeof l === i ? l.call(n, {
                    hash: {},
                    data: e
                }) : l), s += p(r) + '</p><span class="arr _tooltipArrow"></span>'
            });
            return t.wrap = '<div class="ly_tooltip customTooltip" style="display:block">', t
        }()
    }
});
define("module/static/tooltip", ["template/tooltip", "common/headerArea"], function(t, e) {
    var o = 43,
        i = 5,
        n = 12,
        s = 7,
        a = "data-tooltip",
        l = space.StaticModule.extend({
            template: t.layout,
            ui: {
                content: "._tooltipContent",
                arrow: "._tooltipArrow"
            },
            styles: {
                down: "down"
            },
            initialize: function() {
                this._$window = $(window)
            },
            onRoute: function() {
                this.$el.detach()
            },
            documentEvents: {
                "mouseover [data-tooltip]": function(t) {
                    var l, r, d, p, u = $(t.currentTarget),
                        c = u.attr(a),
                        h = !1,
                        w = u.width() / 2;
                    agent.type.is.desktop && ("true" === c ? (c = u.attr("title") || u.attr("alt") || "", u.attr(a, c).removeAttr("title")) : "false" === c && (c = ""), c && (this.ui.content.text(c), this.$el.appendTo(document.body), p = this.$el.outerWidth(), l = u.offset(), d = l.left + (u.outerWidth() - p) / 2, r = l.top, w = (p - n) / 2, h = l.top - e.getBottom() - this._$window.scrollTop() < o, this.$el.toggleClass(this.styles.down, h), h ? r += u.height() + s : r -= o - i, this.ui.arrow.css("left", w), this.$el.css({
                        left: parseInt(d, 10),
                        top: parseInt(r, 10)
                    })))
                },
                "mouseout [data-tooltip]": function() {
                    agent.type.is.desktop && this.$el.detach()
                }
            }
        });
    return new l
});
define("template/feed", ["Handlebars"], function(a) {
    var t = function(t) {
        var l = a.template(t);
        return function(a) {
            return l(a, {
                partials: e
            })
        }
    }, e = {
        music: function() {
            return t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = e.helperMissing;
                return c += '<div class="music_wrap"><a href="#" class="img_album _btnOpenMusicPlayer" data-kant-id="122"><img src="' + d((s = t && t.object, s = null == s || s === !1 ? s : s.album_image, typeof s === o ? s.apply(t) : s)) + '" alt=""> <span class="cover"></span></a><div class="txt"><p class="tit"><a href="#" class="_btnOpenMusicPlayer" data-kant-id="123">' + d((s = t && t.object, s = null == s || s === !1 ? s : s.title, typeof s === o ? s.apply(t) : s)) + "</a></p><p>" + d((s = t && t.object, s = null == s || s === !1 ? s : s.artist, typeof s === o ? s.apply(t) : s)) + " - " + d((s = t && t.object, s = null == s || s === !1 ? s : s.album_title, typeof s === o ? s.apply(t) : s)) + '</p><a href="#" class="bn_play _btnOpenMusicPlayer" data-kant-id="124">' + d((n = e.t || t && t.t, r = {
                    hash: {},
                    data: i
                }, n ? n.call(t, "activity.music.play", r) : p.call(t, "t", "activity.music.play", r))) + '</a><p class="agency"><a href="', (n = e.serviceUrl) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.serviceUrl, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + '" target="_blank" class="_btnOpenKakaoMusic" data-kant-id="125">' + d((n = e.img || t && t.img, r = {
                    hash: {
                        src: "/img/logo_kakaomusic.png",
                        width: "56",
                        height: "8",
                        alt: "activity.music.kakaoMusic"
                    },
                    data: i
                }, n ? n.call(t, r) : p.call(t, "img", r))) + "</a></p></div></div>"
            })
        }(),
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, e, l, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {}, '<div data-part="blockedUser"></div><div data-part="campaign"></div><div data-part="writingButton"></div><div data-part="writing"></div><div data-part="feed"></div>'
            });
            return a.wrap = '<div class="wrap">', a
        }(),
        campaignList: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s = "";
                return s
            });
            return a.wrap = '<div data-kant-group="feed.n" style="display:none">', a
        }(),
        campaignItem: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s, r = "";
                    return r += ' <strong class="banner_tit">', (i = e.title) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.title, l = typeof i === h ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), r += u(l) + "</strong> ", l = e["if"].call(a, a && a.hasContent, {
                        hash: {},
                        inverse: f.noop,
                        fn: f.program(2, n, t),
                        data: t
                    }), (l || 0 === l) && (r += l), r += ' <em class="banner_dt">' + u((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.campaign.more", s) : m.call(a, "t", "activity.campaign.more", s))) + '<span class="ic_arrow"></span></em> '
                }
                function n(a, t) {
                    var l, i, s = "";
                    return s += '<p class="banner_dsc">', (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === h ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (s += l), s += "</p>"
                }
                function r(a, t) {
                    var l, i, s = "";
                    return s += ' <img src="', (i = e.imagePath) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.imagePath, l = typeof i === h ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += u(l) + '" alt="', (i = e.title) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.title, l = typeof i === h ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += u(l) + '"> '
                }
                function c(a, t) {
                    var l, i, s = "";
                    return s += '<button class="_closeButton bn_close" data-kant-id="500">' + u((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "activity.campaign.alt.close", i) : m.call(a, "t", "activity.campaign.alt.close", i))) + "</button>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var o, d, p = "",
                    h = "function",
                    u = this.escapeExpression,
                    f = this,
                    m = e.helperMissing;
                return p += '<div class="admin_banner ', (d = e.itemClass) ? o = d.call(t, {
                    hash: {},
                    data: i
                }) : (d = t && t.itemClass, o = typeof d === h ? d.call(t, {
                    hash: {},
                    data: i
                }) : d), p += u(o) + '" style="', (d = e.itemStyle) ? o = d.call(t, {
                    hash: {},
                    data: i
                }) : (d = t && t.itemStyle, o = typeof d === h ? d.call(t, {
                    hash: {},
                    data: i
                }) : d), p += u(o) + '"><a href="', (d = e.action_url) ? o = d.call(t, {
                    hash: {},
                    data: i
                }) : (d = t && t.action_url, o = typeof d === h ? d.call(t, {
                    hash: {},
                    data: i
                }) : d), p += u(o) + '" target="_blank" data-kant-id="499">', o = e["if"].call(t, t && t.isTextCampaign, {
                    hash: {},
                    inverse: f.program(4, r, i),
                    fn: f.program(1, s, i),
                    data: i
                }), (o || 0 === o) && (p += o), p += "</a> ", o = e.unless.call(t, t && t.sticky, {
                    hash: {},
                    inverse: f.noop,
                    fn: f.program(6, c, i),
                    data: i
                }), (o || 0 === o) && (p += o), p += "</div>"
            });
            return a.wrap = "<div>", a
        }(),
        listContainer: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s = "";
                return s
            });
            return a.wrap = '<div class="feed">', a
        }(),
        writingButton: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<ul><li><a href="#" class="_changeMode" data-mode="text" data-kant-id="77"><span class="ic_pen"></span><em>' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "writing.mode.text", n) : c.call(t, "t", "writing.mode.text", n))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="photo" data-kant-id="78"><span class="ic_camera"></span><em>' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "writing.mode.photo", n) : c.call(t, "t", "writing.mode.photo", n))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="video" data-kant-id="79"><span class="ic_video"></span><em>' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "writing.mode.video", n) : c.call(t, "t", "writing.mode.video", n))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="music" data-kant-id="80"><span class="ic_music"></span><em>' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "writing.mode.music", n) : c.call(t, "t", "writing.mode.music", n))) + '</em></a></li><li><a href="#" class="_changeMode" data-mode="link" data-kant-id="81"><span class="ic_link"></span><em>' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "writing.mode.link", n) : c.call(t, "t", "writing.mode.link", n))) + "</em></a></li></ul>"
            });
            return a.wrap = '<div class="type" data-kant-group="wrt.s">', a
        }(),
        item: function() {
            var a = t(function(a, t, e, l, i) {
                function s() {
                    return "hash.u"
                }
                function n() {
                    return "feed.u"
                }
                function r(a, t) {
                    var l, i, s = "";
                    return s += '<div class="pf_date">' + k((l = e.dateFormat || a && a.dateFormat, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, a && a.created_at, "MM.DD", i) : b.call(a, "dateFormat", a && a.created_at, "MM.DD", i))) + "</div>"
                }
                function c(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="pf"><a href="/' + k((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === w ? l.apply(a) : l)) + '" data-profile-popup="' + k((l = a && a.actor, l = null == l || l === !1 ? l : l.id, typeof l === w ? l.apply(a) : l)) + '" data-kant-id="82"><img src="' + k((i = e.profileImage || a && a.profileImage, s = {
                        hash: {
                            url: (l = a && a.actor, null == l || l === !1 ? l : l.profile_thumbnail_url),
                            size: "56"
                        },
                        data: t
                    }, i ? i.call(a, s) : b.call(a, "profileImage", s))) + '" alt="" class="_profileImage"><span class="line"></span></a></div>'
                }
                function o(a, t) {
                    var l, i = "";
                    return i += '<div class="myid"><a href="/' + k((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === w ? l.apply(a) : l)) + '" class="pf_name" data-profile-popup="' + k((l = a && a.actor, l = null == l || l === !1 ? l : l.id, typeof l === w ? l.apply(a) : l)) + '" data-kant-id="83">' + k((l = a && a.actor, l = null == l || l === !1 ? l : l.display_name, typeof l === w ? l.apply(a) : l)) + "</a> ", l = e["if"].call(a, (l = a && a.actor, null == l || l === !1 ? l : l.is_birthday), {
                        hash: {},
                        inverse: I.noop,
                        fn: I.program(10, d, t),
                        data: t
                    }), (l || 0 === l) && (i += l), i += "</div>"
                }
                function d(a, t) {
                    var l, i, s = "";
                    return s += ' <span class="ic_birthday">' + k((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "profile.alt.birthdayTitle", i) : b.call(a, "t", "profile.alt.birthdayTitle", i))) + "</span> "
                }
                function p(a, t) {
                    var l, i, s = "";
                    return s += '<span class="time" title="' + k((l = e.dateFormat || a && a.dateFormat, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, a && a.created_at, "all", i) : b.call(a, "dateFormat", a && a.created_at, "all", i))) + '" data-tooltip="true">' + k((l = e.dateFormat || a && a.dateFormat, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, a && a.created_at, i) : b.call(a, "dateFormat", a && a.created_at, i))) + "</span>"
                }
                function h(a, t) {
                    var l, i, s, n = "";
                    return n += '<a href="/' + k((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === w ? l.apply(a) : l)) + "/", (i = e.urlKey) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.urlKey, l = typeof i === w ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += k(l) + '" class="time _linkPost" title="' + k((i = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, a && a.created_at, "all", s) : b.call(a, "dateFormat", a && a.created_at, "all", s))) + '" data-tooltip="true" data-skip-navigate="true" data-kant-id="84">' + k((i = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, a && a.created_at, s) : b.call(a, "dateFormat", a && a.created_at, s))) + "</a>"
                }
                function u(a, t) {
                    var l, i, s = "";
                    return s += '<span class="time" title="' + k((l = e.dateFormat || a && a.dateFormat, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, a && a.content_updated_at, "all", i) : b.call(a, "dateFormat", a && a.content_updated_at, "all", i))) + '" data-tooltip="true">- ' + k((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "activity.modified", i) : b.call(a, "t", "activity.modified", i))) + "</span>"
                }
                function f(a, t) {
                    var l, i, s = "";
                    return s += '<div class="txt_wrap overflowedContent _content">', (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === w ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (s += l), s += "</div>"
                }
                function m(a, t) {
                    var l, i, s = "";
                    return s += '<p class="with"> <a href="#" class="_btnWithTags" data-kant-id="87"><span class="ic_people"></span>', (i = e.withTag) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.withTag, l = typeof i === w ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (s += l), s += "</a></p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var v, y, g, _ = "",
                    b = e.helperMissing,
                    k = this.escapeExpression,
                    w = "function",
                    I = this;
                return _ += '<div data-kant-group="', v = e["if"].call(t, t && t.isHashtagActivities, {
                    hash: {},
                    inverse: I.program(3, n, i),
                    fn: I.program(1, s, i),
                    data: i
                }), (v || 0 === v) && (_ += v), _ += '">', v = e["if"].call(t, t && t.isMyStoryActivities, {
                    hash: {},
                    inverse: I.program(7, c, i),
                    fn: I.program(5, r, i),
                    data: i
                }), (v || 0 === v) && (_ += v), _ += '<div class="add_top">', v = e.unless.call(t, t && t.isMyStoryActivities, {
                    hash: {},
                    inverse: I.noop,
                    fn: I.program(9, o, i),
                    data: i
                }), (v || 0 === v) && (_ += v), _ += " ", v = e["if"].call(t, t && t.isPost, {
                    hash: {},
                    inverse: I.program(14, h, i),
                    fn: I.program(12, p, i),
                    data: i
                }), (v || 0 === v) && (_ += v), v = e["if"].call(t, t && t.content_updated_at, {
                    hash: {},
                    inverse: I.noop,
                    fn: I.program(16, u, i),
                    data: i
                }), (v || 0 === v) && (_ += v), _ += ' <span class="ic_friend _permissionFriends" style="display:none" title="' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.permission.friends", g) : b.call(t, "t", "activity.permission.friends", g))) + '" data-tooltip="true">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.permission.friends", g) : b.call(t, "t", "activity.permission.friends", g))) + '</span> <span class="ic_lock _permissionMeOnly" style="display:none" title="' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.permission.meOnly", g) : b.call(t, "t", "activity.permission.meOnly", g))) + '" data-tooltip="true">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.permission.meOnly", g) : b.call(t, "t", "activity.permission.meOnly", g))) + '</span>  <button class="bn_modify _btnSetting" data-kant-id="85">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.alt.setting", g) : b.call(t, "t", "activity.alt.setting", g))) + '</button><div data-part="setting"></div></div><div class="fd_cont _contentWrapper">', v = e["if"].call(t, t && t.escapedContent, {
                    hash: {},
                    inverse: I.noop,
                    fn: I.program(18, f, i),
                    data: i
                }), (v || 0 === v) && (_ += v), _ += '<p class="more _moreBtnContainer" style="display:none"><a href="#" class="_btnFeedMore" data-kant-id="86">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.more", g) : b.call(t, "t", "activity.more", g))) + "</a></p>", v = e["if"].call(t, t && t.withTag, {
                    hash: {},
                    inverse: I.noop,
                    fn: I.program(20, m, i),
                    data: i
                }), (v || 0 === v) && (_ += v), _ += '<div data-part="media"></div><div data-part="thirdPartyLink"></div></div><div class="add_bot"><div class="btn_group _btnGroup"><button class="bn_feel _btnLike" style="display:none" data-kant-id="91">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.like.action", g) : b.call(t, "t", "activity.like.action", g))) + '</button> <button class="bn_like _btnLike" style="display:none" data-kant-id="92">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.emotion.like", g) : b.call(t, "t", "activity.emotion.like", g))) + '</button> <button class="bn_pleasure _btnLike" style="display:none" data-kant-id="92"><span>' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.emotion.pleasure", g) : b.call(t, "t", "activity.emotion.pleasure", g))) + '</span></button> <button class="bn_sad _btnLike" style="display:none" data-kant-id="92"><span>' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.emotion.sad", g) : b.call(t, "t", "activity.emotion.sad", g))) + '</span></button> <button class="bn_cheerup _btnLike" style="display:none" data-kant-id="92"><span>' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.emotion.cheerup", g) : b.call(t, "t", "activity.emotion.cheerup", g))) + '</span></button> <button class="bn_good _btnLike" style="display:none" data-kant-id="92"><span>' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.emotion.good", g) : b.call(t, "t", "activity.emotion.good", g))) + '</span></button><div class="btn_group_in"><button class="bn_share _btnShare" style="display:none" data-kant-id="97" data-kant-option="t:', (y = e.contentType) ? v = y.call(t, {
                    hash: {},
                    data: i
                }) : (y = t && t.contentType, v = typeof y === w ? y.call(t, {
                    hash: {},
                    data: i
                }) : y), _ += k(v) + '">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.share.action", g) : b.call(t, "t", "activity.share.action", g))) + '</button><div class="ly other_layer _shareButtonLayer" style="display:none"><ul><li class="_btnShareStory"><a href="#" data-kant-id="98">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.share.toStory", g) : b.call(t, "t", "activity.share.toStory", g))) + '</a></li><li class="_btnPermalink"><a href="#" data-kant-id="99">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.share.toUrl", g) : b.call(t, "t", "activity.share.toUrl", g))) + '</a></li></ul><span class="arr"></span></div></div><div data-part="likeButtonLayer"></div></div><div data-part="likeThumbnail"></div></div><div class="comment"><div class="count_group _countContainer"><a href="#" class="_btnViewLikes" data-kant-id="88">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.like.text", g) : b.call(t, "t", "activity.like.text", g))) + ' <strong class="_likeCount">' + k((y = e.numberFormat || t && t.numberFormat, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, t && t.like_count, 9999, g) : b.call(t, "numberFormat", t && t.like_count, 9999, g))) + '</strong></a> <a href="#" class="_btnViewComments" data-kant-id="89">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.comment.text", g) : b.call(t, "t", "activity.comment.text", g))) + ' <strong class="_commentCount">' + k((y = e.numberFormat || t && t.numberFormat, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, t && t.comment_count, 9999, g) : b.call(t, "numberFormat", t && t.comment_count, 9999, g))) + '</strong></a> <a href="#" class="_btnViewShareList" data-kant-id="90">' + k((y = e.t || t && t.t, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, "activity.share.text", g) : b.call(t, "t", "activity.share.text", g))) + ' <strong class="_shareCount">' + k((y = e.numberFormat || t && t.numberFormat, g = {
                    hash: {},
                    data: i
                }, y ? y.call(t, t && t.share_count, 9999, g) : b.call(t, "numberFormat", t && t.share_count, 9999, g))) + '</strong></a></div><div data-part="comment"></div></div></div>'
            });
            return a.wrap = '<div class="section" style="display:none;">', a
        }(),
        itemUpdate: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = e.helperMissing;
                return c += '<a href="/' + d((s = t && t.actor, s = null == s || s === !1 ? s : s.urlKey, typeof s === o ? s.apply(t) : s)) + "/", (n = e.urlKey) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.urlKey, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + '" class="notify_link" data-kant-id="100"><div class="pf_tit"><div class="pf"><span data-profile-popup="' + d((s = t && t.actor, s = null == s || s === !1 ? s : s.id, typeof s === o ? s.apply(t) : s)) + '"><img src="' + d((n = e.profileImage || t && t.profileImage, r = {
                    hash: {
                        url: (s = t && t.actor, null == s || s === !1 ? s : s.profile_thumbnail_url),
                        size: "36"
                    },
                    data: i
                }, n ? n.call(t, r) : p.call(t, "profileImage", r))) + '" alt="" class="_profileImage"><span class="line"></span></span></div><p class="txt"><span class="in">', (n = e.escapedContent) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.escapedContent, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), (s || 0 === s) && (c += s), c += '</span></p></div><span class="bl_arrow_right"></span></a>'
            });
            return a.wrap = '<div class="notify" data-kant-group="feed.p">', a
        }(),
        itemJoin: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="notify" data-kant-group="feed.s"><a href="/' + b((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === _ ? l.apply(a) : l)) + '" class="notify_link" data-kant-id="101" data-profile-popup="' + b((l = a && a.actor, l = null == l || l === !1 ? l : l.id, typeof l === _ ? l.apply(a) : l)) + '"><div class="pf_tit"><div class="pf"><span><img src="' + b((i = e.profileImage || a && a.profileImage, s = {
                        hash: {
                            url: (l = a && a.actor, null == l || l === !1 ? l : l.profile_thumbnail_url),
                            size: "86"
                        },
                        data: t
                    }, i ? i.call(a, s) : k.call(a, "profileImage", s))) + '" class="_profileImage" alt="' + b((l = a && a.actor, l = null == l || l === !1 ? l : l.display_name, typeof l === _ ? l.apply(a) : l)) + '"><span class="line"></span></span></div><p class="txt"><span class="in"><strong>' + b((l = a && a.actor, l = null == l || l === !1 ? l : l.display_name, typeof l === _ ? l.apply(a) : l)) + "</strong><br>", (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === _ ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (n += l), n += '</span></p></div><span class="bl_arrow_right"></span></a></div>'
                }
                function n(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="notify', l = e["if"].call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.noop,
                        fn: w.program(4, r, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += '" data-kant-group="', l = e["if"].call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.program(8, o, t),
                        fn: w.program(6, c, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += '">', l = e.unless.call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.noop,
                        fn: w.program(10, d, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += '<div class="pf_tit"><div class="pf">', l = e["if"].call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.program(14, h, t),
                        fn: w.program(12, p, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += ' <img src="' + b((i = e.profileImage || a && a.profileImage, s = {
                        hash: {
                            url: (l = a && a.actor, null == l || l === !1 ? l : l.profile_thumbnail_url),
                            size: "36"
                        },
                        data: t
                    }, i ? i.call(a, s) : k.call(a, "profileImage", s))) + '" class="_profileImage" alt=""><span class="line"></span> ', l = e["if"].call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.program(18, f, t),
                        fn: w.program(16, u, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += '</div><p class="txt"><span class="in">', (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === _ ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (n += l), n += "</span></p></div>", l = e["if"].call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.program(22, v, t),
                        fn: w.program(20, m, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += " ", l = e.unless.call(a, a && a.displayRelationship, {
                        hash: {},
                        inverse: w.noop,
                        fn: w.program(24, y, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += "</div>"
                }
                function r() {
                    return " addbtn"
                }
                function c() {
                    return "feed.k"
                }
                function o() {
                    return "false"
                }
                function d(a) {
                    var t, e = "";
                    return e += ' <a href="/' + b((t = a && a.actor, t = null == t || t === !1 ? t : t.urlKey, typeof t === _ ? t.apply(a) : t)) + '" class="notify_link" data-kant-id="104" data-kant-group="feed.m">'
                }
                function p(a) {
                    var t, e = "";
                    return e += ' <a href="/' + b((t = a && a.actor, t = null == t || t === !1 ? t : t.urlKey, typeof t === _ ? t.apply(a) : t)) + '" data-kant-id="105" data-profile-popup="' + b((t = a && a.actor, t = null == t || t === !1 ? t : t.id, typeof t === _ ? t.apply(a) : t)) + '">'
                }
                function h(a) {
                    var t, e = "";
                    return e += ' <span data-profile-popup="' + b((t = a && a.actor, t = null == t || t === !1 ? t : t.id, typeof t === _ ? t.apply(a) : t)) + '">'
                }
                function u() {
                    return "</span></a> "
                }
                function f() {
                    return " "
                }
                function m(a, t) {
                    var l, i, s = "";
                    return s += ' <span data-part="friendButton"><button class="btn_com btn_wh _btnRequestFriend _friendButtons" style="display:none" data-kant-id="106"><span>' + b((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.invite", i) : k.call(a, "t", "friend.btn.invite", i))) + '</span></button> <button class="btn_com ing _btnRequestingFriend _friendButtons" style="display:none" data-kant-id="false"><span>' + b((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.inviting", i) : k.call(a, "t", "friend.btn.inviting", i))) + '</span></button> <button class="btn_com ing _btnCancelRequestingFriend _friendButtons" style="display:none" data-kant-id="108"><span>' + b((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.cancel", i) : k.call(a, "t", "friend.btn.cancel", i))) + '</span></button> <button class="btn_com btn_wh accept _btnAcceptFriend _friendButtons" style="display:none" data-kant-id="109"><span>' + b((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "friend.btn.accept", i) : k.call(a, "t", "friend.btn.accept", i))) + "</span></button></span> "
                }
                function v() {
                    return ' <span class="bl_arrow_right"></span> '
                }
                function y() {
                    return "</a> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var g, _ = "function",
                    b = this.escapeExpression,
                    k = e.helperMissing,
                    w = this;
                return g = e["if"].call(t, (g = t && t.actor, null == g || g === !1 ? g : g.isStoryPlus), {
                    hash: {},
                    inverse: w.program(3, n, i),
                    fn: w.program(1, s, i),
                    data: i
                }), g || 0 === g ? g : ""
            });
            return a.wrap = "<div>", a
        }(),
        itemNotice: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {}
            });
            return a.wrap = '<div class="notify notice_short">', a
        }(),
        withTag: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = "function",
                    o = this.escapeExpression;
                return r += "<strong>", (n = e.display_name) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.display_name, s = typeof n === c ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), r += o(s) + "</strong>"
            });
            return a
        }(),
        setting: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="ly open_layer" style="display:block"><ul><li><label for="rdo_all', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '"><span class="ic_global"></span>' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.permission.all", s) : d.call(a, "t", "activity.permission.all", s))) + '</label> <span class="bg_rdo _permissionSpan" data-permission="A"><input type="radio" id="rdo_all', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '" name="permission" class="_btnChangePermission" value="A" data-kant-id="pall" data-kant-ignore="true"></span></li><li><label for="rdo_friend', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '"><span class="ic_friend"></span>' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.permission.friends", s) : d.call(a, "t", "activity.permission.friends", s))) + '</label><span class="bg_rdo _permissionSpan" data-permission="F"><input type="radio" id="rdo_friend', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '" name="permission" class="_btnChangePermission" value="F" data-kant-id="pfri" data-kant-ignore="true"></span></li><li><label for="rdo_me_only', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '"><span class="ic_lock"></span>' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.permission.meOnly", s) : d.call(a, "t", "activity.permission.meOnly", s))) + '</label><span class="bg_rdo _permissionSpan" data-permission="M"><input type="radio" id="rdo_me_only', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '" name="permission" class="_btnChangePermission" value="M" data-kant-id="pme" data-kant-ignore="true"></span></li><li class="v2 _allowShareLayer"> <span class="bg_chk _enableShareSpan"><input type="checkbox" id="chk_share', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '" name="open" value="true" class="_enableShare" data-kant-id="penb" data-kant-ignore="true"></span><label for="chk_share', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '">' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.setting.allowShare", s) : d.call(a, "t", "activity.setting.allowShare", s))) + '</label></li><li class="v2 _allowCommentLayer"> <span class="bg_chk _enableAllCommentSpan"><input type="checkbox" id="chk_comment', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '" name="comment" value="true" class="_enableAllComment" data-kant-id="pcmt" data-kant-ignore="true"></span><label for="chk_comment', (i = e.id) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.id, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += o(l) + '">' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.setting.allowComment", s) : d.call(a, "t", "activity.setting.allowComment", s))) + '</label></li><li class="v2 _modifyBtnContainer"><a href="#" class="_btnActivityModify" data-kant-id="530">' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.setting.modify", s) : d.call(a, "t", "activity.setting.modify", s))) + '</a></li><li class="v2"><a href="#" class="_btnActivityDelete" data-kant-id="112">' + o((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.setting.delete", s) : d.call(a, "t", "activity.setting.delete", s))) + "</a></li></ul></div>"
                }
                function n(a, t) {
                    var l, i, s = "";
                    return s += '<div class="ly other_layer" style="display:block"><ul><li class="_btnActivityHide"><a href="#" data-kant-id="113">' + o((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "activity.setting.hide", i) : d.call(a, "t", "activity.setting.hide", i))) + '</a></li><li class="_btnActivityReport"><a href="#" data-kant-id="114">' + o((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "activity.setting.report", i) : d.call(a, "t", "activity.setting.report", i))) + "</a></li></ul></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var r, c = "function",
                    o = this.escapeExpression,
                    d = e.helperMissing,
                    p = this;
                return r = e["if"].call(t, (r = t && t.actor, null == r || r === !1 ? r : r.isMe), {
                    hash: {},
                    inverse: p.program(3, n, i),
                    fn: p.program(1, s, i),
                    data: i
                }), r || 0 === r ? r : ""
            });
            return a.wrap = '<div data-kant-group="feed.u">', a
        }(),
        share: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i = "";
                    return i += " ", l = e.unless.call(a, a && a.blinded, {
                        hash: {},
                        inverse: v.noop,
                        fn: v.program(2, n, t),
                        data: t
                    }), (l || 0 === l) && (i += l), i += " "
                }
                function n(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="pf"><a href="/' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === m ? l.apply(a) : l)) + '" data-profile-popup="' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.id, typeof l === m ? l.apply(a) : l)) + '" data-kant-id="115"><img src="' + f((i = e.profileImage || a && a.profileImage, s = {
                        hash: {
                            url: (l = a && a.actor, null == l || l === !1 ? l : l.profile_thumbnail_url),
                            size: "36"
                        },
                        data: t
                    }, i ? i.call(a, s) : u.call(a, "profileImage", s))) + '" alt="" class="_profileImage"><span class="line"></span></a></div><div class="add_top"><div class="myid"><a href="/' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === m ? l.apply(a) : l)) + '" class="pf_name" data-profile-popup="' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.id, typeof l === m ? l.apply(a) : l)) + '" data-kant-id="116">' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.display_name, typeof l === m ? l.apply(a) : l)) + "</a>", l = e["if"].call(a, (l = a && a.actor, null == l || l === !1 ? l : l.is_birthday), {
                        hash: {},
                        inverse: v.noop,
                        fn: v.program(3, r, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += '</div><p><a href="/' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === m ? l.apply(a) : l)) + "/", (i = e.urlKey) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.urlKey, l = typeof i === m ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += f(l) + '" class="time _btnViewDetailInShare" title="' + f((i = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, a && a.created_at, "all", s) : u.call(a, "dateFormat", a && a.created_at, "all", s))) + '" data-skip-navigate="true" data-tooltip="true" data-kant-id="117">' + f((i = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, a && a.created_at, s) : u.call(a, "dateFormat", a && a.created_at, s))) + "</a>", l = e["if"].call(a, a && a.content_updated_at, {
                        hash: {},
                        inverse: v.noop,
                        fn: v.program(5, c, t),
                        data: t
                    }), (l || 0 === l) && (n += l), n += ' <a href="#" class="_btnViewShareList" data-kant-id="118">' + f((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.share.text", s) : u.call(a, "t", "activity.share.text", s))) + " <strong>" + f((i = e.numberFormat || a && a.numberFormat, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, a && a.share_count, s) : u.call(a, "numberFormat", a && a.share_count, s))) + '</strong></a></p></div><div class="txt_wrap overflowedContent _content">', (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === m ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (n += l), n += '</div><p class="more _moreBtnContainer" style="display:none"><a href="/' + f((l = a && a.actor, l = null == l || l === !1 ? l : l.urlKey, typeof l === m ? l.apply(a) : l)) + "/", (i = e.urlKey) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.urlKey, l = typeof i === m ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += f(l) + '" class="_btnViewDetailInShare" data-skip-navigate="true" data-kant-id="119">' + f((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.more", s) : u.call(a, "t", "activity.more", s))) + '</a></p><div data-part="media"></div>'
                }
                function r(a, t) {
                    var l, i, s = "";
                    return s += '<span class="ic_birthday">' + f((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "profile.alt.birthdayTitle", i) : u.call(a, "t", "profile.alt.birthdayTitle", i))) + "</span>"
                }
                function c(a, t) {
                    var l, i, s = "";
                    return s += '<span class="time" title="' + f((l = e.dateFormat || a && a.dateFormat, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, a && a.content_updated_at, "all", i) : u.call(a, "dateFormat", a && a.content_updated_at, "all", i))) + '" data-tooltip="true">- ' + f((l = e.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, l ? l.call(a, "activity.modified", i) : u.call(a, "t", "activity.modified", i))) + "</span>"
                }
                function o(a, t) {
                    var l, i, s = "";
                    return s += '<p class="case_del"><span class="ic"></span>', (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === m ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (s += l), s += "</p>"
                }
                function d(a, t) {
                    var l, i, s = "";
                    return s += '<p class="case_report"><span class="ic"></span>', (i = e.escapedContent) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.escapedContent, l = typeof i === m ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), (l || 0 === l) && (s += l), s += "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var p, h = "",
                    u = e.helperMissing,
                    f = this.escapeExpression,
                    m = "function",
                    v = this;
                return p = e.unless.call(t, t && t.deleted, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(1, s, i),
                    data: i
                }), (p || 0 === p) && (h += p), h += " ", p = e["if"].call(t, t && t.deleted, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(7, o, i),
                    data: i
                }), (p || 0 === p) && (h += p), h += " ", p = e["if"].call(t, t && t.blinded, {
                    hash: {},
                    inverse: v.noop,
                    fn: v.program(9, d, i),
                    data: i
                }), (p || 0 === p) && (h += p), h
            });
            return a.wrap = '<div class="share_wrap">', a
        }(),
        image: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t, l) {
                    var i, s, c = "";
                    return c += '<div class="img" style="', (s = e.style) ? i = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.style, i = typeof s === u ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), c += f(i) + '">', i = e["if"].call(a, l && l.isPreview, {
                        hash: {},
                        inverse: m.program(4, r, t),
                        fn: m.program(2, n, t),
                        data: t
                    }), (i || 0 === i) && (c += i), c += "</div>"
                }
                function n(a, t) {
                    var l, i, s = "";
                    return s += '<div data-index="' + f((l = null == t || t === !1 ? t : t.index, typeof l === u ? l.apply(a) : l)) + '" data-url="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === u ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += f(l) + '" class="imageContainer _mediaImageContainer"><img src="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === u ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += f(l) + '" class="_mediaImage" alt=""> <span class="bg_gr _gradation" style="display:none"></span> <span class="line"></span></div>'
                }
                function r(a, t) {
                    var l, i, s = "";
                    return s += ' <a href="#" data-index="' + f((l = null == t || t === !1 ? t : t.index, typeof l === u ? l.apply(a) : l)) + '" data-url="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === u ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += f(l) + '" class="imageContainer _btnMediaView _mediaImageContainer" data-skip-navigate="true" data-kant-id="120"><img src="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === u ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += f(l) + '" class="_mediaImage" alt=""> <span class="bg_gr _gradation" style="display:none"></span> <span class="line"></span></a> '
                }
                function c(a, t) {
                    var l, i = "";
                    return i += " ", l = e["if"].call(a, a && a.isPreview, {
                        hash: {},
                        inverse: m.program(9, d, t),
                        fn: m.program(7, o, t),
                        data: t
                    }), (l || 0 === l) && (i += l), i += " "
                }
                function o(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="more"><span class="ic">' + f((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.image.moreText", s) : v.call(a, "t", "activity.image.moreText", s))) + "</span>+", (i = e.moreImageCount) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.moreImageCount, l = typeof i === u ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += f(l) + "</div>"
                }
                function d(a, t) {
                    var l, i, s, n = "";
                    return n += ' <a href="#" class="more _btnViewImageMore" data-kant-id="120"><span class="ic">' + f((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.image.moreText", s) : v.call(a, "t", "activity.image.moreText", s))) + "</span>+", (i = e.moreImageCount) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.moreImageCount, l = typeof i === u ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += f(l) + "</a> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var p, h = "",
                    u = "function",
                    f = this.escapeExpression,
                    m = this,
                    v = e.helperMissing;
                return p = e.each.call(t, t && t.media, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.programWithDepth(1, s, i, t),
                    data: i
                }), (p || 0 === p) && (h += p), h += " ", p = e["if"].call(t, t && t.moreImageCount, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(6, c, i),
                    data: i
                }), (p || 0 === p) && (h += p), h
            });
            return a.wrap = '<div class="img_wrap">', a
        }(),
        video: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s, n = "";
                    return n += '<div class="_videoContainer"><div class="willbefixed-video-media-container _videoThumbnail"><img class="_videoThumbnailImg" src="', (i = e.preview_url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.preview_url, l = typeof i === r ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += c(l) + '"> <span class="line"></span></div><span class="mask"></span> <a href="#" data-url="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === r ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), n += c(l) + '" class="bn_play _btnViewVideo" data-kant-id="121">' + c((i = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "activity.alt.videoPlay", s) : o.call(a, "t", "activity.alt.videoPlay", s))) + "</a></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var n, r = "function",
                    c = this.escapeExpression,
                    o = e.helperMissing,
                    d = this;
                return n = e.each.call(t, t && t.media, {
                    hash: {},
                    inverse: d.noop,
                    fn: d.program(1, s, i),
                    data: i
                }), n || 0 === n ? n : ""
            });
            return a.wrap = '<div class="movie_wrap v2">', a
        }(),
        videoPlayer: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s = "";
                    return s += '<video class="mejs-kakao" controls src="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '" width="', (i = e.width) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.width, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '" height="', (i = e.height) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.height, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '" data-preview-path="', (i = e.previewPath) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.previewPath, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '"></video>'
                }
                function n(a, t) {
                    var l, i, s = "";
                    return s += '<video class="mejs-kakao" src="', (i = e.url) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.url, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '" width="', (i = e.width) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.width, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '" height="', (i = e.height) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.height, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '" data-preview-path="', (i = e.previewPath) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.previewPath, l = typeof i === o ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += d(l) + '"></video>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = this;
                return c += '<div data-kant-group="vdp">', r = e["if"].call(t, t && t.defaultControls, {
                    hash: {},
                    inverse: p.program(3, n, i),
                    fn: p.program(1, s, i),
                    data: i
                }), (r || 0 === r) && (c += r), c += "</div>"
            });
            return a
        }(),
        noFlashPlayer: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="no_flash_player_message">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.video.noFlashPlayer", n) : c.call(t, "t", "activity.video.noFlashPlayer", n))) + '<br><a href="http://get.adobe.com/kr/flashplayer" target="_blank" data-kant-id="472">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.video.installLink", n) : c.call(t, "t", "activity.video.installLink", n))) + "</a></div>"
            });
            return a
        }(),
        music: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = e.helperMissing;
                return c += '<a href="#" class="img_album _btnOpenMusicPlayer" data-kant-id="122"><img src="' + d((s = t && t.object, s = null == s || s === !1 ? s : s.album_image, typeof s === o ? s.apply(t) : s)) + '" alt=""> <span class="cover"></span></a><div class="txt"><p class="tit"><a href="#" class="_btnOpenMusicPlayer" data-kant-id="123">' + d((s = t && t.object, s = null == s || s === !1 ? s : s.title, typeof s === o ? s.apply(t) : s)) + "</a></p><p>" + d((s = t && t.object, s = null == s || s === !1 ? s : s.artist, typeof s === o ? s.apply(t) : s)) + " - " + d((s = t && t.object, s = null == s || s === !1 ? s : s.album_title, typeof s === o ? s.apply(t) : s)) + '</p><a href="#" class="bn_play _btnOpenMusicPlayer" data-kant-id="124">' + d((n = e.t || t && t.t, r = {
                    hash: {},
                    data: i
                }, n ? n.call(t, "activity.music.play", r) : p.call(t, "t", "activity.music.play", r))) + '</a><p class="agency"><a href="', (n = e.serviceUrl) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.serviceUrl, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + '" target="_blank" class="_btnOpenKakaoMusic" data-kant-id="125">' + d((n = e.img || t && t.img, r = {
                    hash: {
                        src: "/img/logo_kakaomusic.png",
                        width: "56",
                        height: "8",
                        alt: "activity.music.kakaoMusic"
                    },
                    data: i
                }, n ? n.call(t, r) : p.call(t, "img", r))) + "</a></p></div>"
            });
            return a.wrap = '<div class="music_wrap">', a
        }(),
        scrap: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s = "";
                    return s += '<div class="movie_wrap"><div class="movie"><div class="_scrapMediaContainer"></div></div><div class="txt"><a href="', (i = e.scrapUrl) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapUrl, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" target="_blank" data-kant-id="126"><strong class="tit">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.title, typeof l === p ? l.apply(a) : l)) + '</strong><p class="overflowedContent _scrapContent">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.description, typeof l === p ? l.apply(a) : l)) + '</p></a><p class="link"><a href="', (i = e.scrapHostRedirect) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapHostRedirect, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" target="_blank" data-kant-id="128">', (i = e.scrapHost) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapHost, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + "</a></p></div></div>"
                }
                function n(a, t) {
                    var l, i = "";
                    return i += " ", l = e["if"].call(a, a && a.isMagazine, {
                        hash: {},
                        inverse: u.program(6, c, t),
                        fn: u.program(4, r, t),
                        data: t
                    }), (l || 0 === l) && (i += l), i += " "
                }
                function r(a, t) {
                    var l, i, s = "";
                    return s += '<div class="_scrapWrapper scrap_wrap scrap_tistory"><div class="_scrapMediaContainer"></div><div class="txt"><div class="info"><a href="' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.hostWithProtocolRedirect, typeof l === p ? l.apply(a) : l)) + '" class="site" target="_blank" data-kant-id="531">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.siteName, typeof l === p ? l.apply(a) : l)) + '</a> <span class="cate">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.section, typeof l === p ? l.apply(a) : l)) + '</span></div><a href="', (i = e.scrapUrl) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapUrl, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" target="_blank" class="cont" data-kant-id="532"><strong class="_scrapTitle">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.title, typeof l === p ? l.apply(a) : l)) + '</strong><p class="_scrapContent">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.description, typeof l === p ? l.apply(a) : l)) + "</p></a></div></div>"
                }
                function c(a, t) {
                    var l, i, s = "";
                    return s += '<div class="_scrapWrapper scrap_wrap"><div class="_scrapMediaContainer"></div><div class="txt"><a href="', (i = e.scrapUrl) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapUrl, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" target="_blank" class="cont" data-kant-id="129"><strong>' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.title, typeof l === p ? l.apply(a) : l)) + '</strong><p class="_scrapContent">' + h((l = a && a.scrap, l = null == l || l === !1 ? l : l.description, typeof l === p ? l.apply(a) : l)) + '</p></a><p class="link"><a href="', (i = e.scrapHostRedirect) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapHostRedirect, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" target="_blank" data-kant-id="130">', (i = e.scrapHost) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.scrapHost, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + "</a></p></div></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var o, d = "",
                    p = "function",
                    h = this.escapeExpression,
                    u = this;
                return o = e["if"].call(t, t && t.isVideo, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(1, s, i),
                    data: i
                }), (o || 0 === o) && (d += o), d += " ", o = e["if"].call(t, t && t.isUrl, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(3, n, i),
                    data: i
                }), (o || 0 === o) && (d += o), d
            });
            return a.wrap = "<div>", a
        }(),
        likeButtonLayer: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<li class="btn_like _btnLikeEmotion" data-emotion="like"><button data-kant-id="131">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.emotion.like", n) : c.call(t, "t", "activity.emotion.like", n))) + '</button></li><li class="btn_good _btnLikeEmotion" data-emotion="good"><button data-kant-id="132">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.emotion.good", n) : c.call(t, "t", "activity.emotion.good", n))) + '</button></li><li class="btn_pleasure _btnLikeEmotion" data-emotion="pleasure"><button data-kant-id="133">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.emotion.pleasure", n) : c.call(t, "t", "activity.emotion.pleasure", n))) + '</button></li><li class="btn_sad _btnLikeEmotion" data-emotion="sad"><button data-kant-id="134">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.emotion.sad", n) : c.call(t, "t", "activity.emotion.sad", n))) + '</button></li><li class="btn_cheerup _btnLikeEmotion" data-emotion="cheerup"><button data-kant-id="135">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.emotion.cheerup", n) : c.call(t, "t", "activity.emotion.cheerup", n))) + "</button></li>"
            });
            return a.wrap = '<ul class="ly feel_layer _layerLike" data-kant-group="feed.u">', a
        }(),
        permalink: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s = "";
                    return s += ' <input type="text" value="', (i = e.shareUrl) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.shareUrl, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" readonly="readonly" class="address _shareUrlInput"> '
                }
                function n(a, t) {
                    var l, i, s = "";
                    return s += ' <input type="text" value="', (i = e.shareUrl) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.shareUrl, l = typeof i === p ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += h(l) + '" class="address _shareUrlInput"> '
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var r, c, o, d = "",
                    p = "function",
                    h = this.escapeExpression,
                    u = e.helperMissing,
                    f = this;
                return d += '<div class="ly_con link_copy _layerContainer"><div class="inner"><h1>' + h((c = e.t || t && t.t, o = {
                    hash: {},
                    data: i
                }, c ? c.call(t, "activity.url.title", o) : u.call(t, "t", "activity.url.title", o))) + '</h1><div class="copy"><div class="inp_txt">', r = e["if"].call(t, t && t.isDesktop, {
                    hash: {},
                    inverse: f.program(3, n, i),
                    fn: f.program(1, s, i),
                    data: i
                }), (r || 0 === r) && (d += r), d += "</div><p>", (c = e.copyUrlDescription) ? r = c.call(t, {
                    hash: {},
                    data: i
                }) : (c = t && t.copyUrlDescription, r = typeof c === p ? c.call(t, {
                    hash: {},
                    data: i
                }) : c), (r || 0 === r) && (d += r), d += '</p></div><button class="bn_x _btnCloseLayer" data-kant-id="136">' + h((c = e.t || t && t.t, o = {
                    hash: {},
                    data: i
                }, c ? c.call(t, "activity.alt.close", o) : u.call(t, "t", "activity.alt.close", o))) + "</button></div></div>"
            });
            return a.wrap = '<div class="dim_ly" data-kant-group="feed.u">', a
        }(),
        loading: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="loading_wrap">' + o((s = e.img || t && t.img, n = {
                    hash: {
                        src: "/img/loading_circle_g.gif",
                        width: "24",
                        height: "24",
                        alt: ""
                    },
                    data: i
                }, s ? s.call(t, n) : c.call(t, "img", n))) + "</div>"
            });
            return a
        }(),
        empty: function() {
            var a = t(function(a, t, e, l, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {}, '<div class="nodata _emptyFeedItem"><p class="friend"><span class="ic_txt"></span></p></div>'
            });
            return a
        }(),
        noRelationship: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="section_card" data-kant-group="feed.d" style="display:none">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.noRelationship.content", n) : c.call(t, "t", "activity.noRelationship.content", n))) + ' <button class="btn_com btn_or _btnFindFriend" data-kant-id="137"><span>' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.noRelationship.findFriend", n) : c.call(t, "t", "activity.noRelationship.findFriend", n))) + "</span></button></div>"
            });
            return a
        }(),
        year: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = e.helperMissing;
                return c += '<p class="txt_year">', (n = e.year) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.year, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + d((n = e.t || t && t.t, r = {
                    hash: {},
                    data: i
                }, n ? n.call(t, "myStory.year", r) : p.call(t, "t", "myStory.year", r))) + "</p>"
            });
            return a
        }(),
        newFeedCard: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="section_card new"><a href="#" class="_viewNewFeed" data-kant-id="138">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.newFeed", n) : c.call(t, "t", "activity.newFeed", n))) + ' <em class="_newFeedCount">' + o((s = e.numberFormat || t && t.numberFormat, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, t && t.count, n) : c.call(t, "numberFormat", t && t.count, n))) + "</em></a></div>"
            });
            return a
        }(),
        blockedUser: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = e.helperMissing;
                return c += '<p class="tip"><span class="ico"></span>', (n = e.message) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.message, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + '</p><button class="btn_com btn_wh _inquiry" data-kant-id="139"><span>' + d((n = e.t || t && t.t, r = {
                    hash: {},
                    data: i
                }, n ? n.call(t, "activity.blockedUserInquiry", r) : p.call(t, "t", "activity.blockedUserInquiry", r))) + "</span></button>"
            });
            return a.wrap = '<div class="service_info">', a
        }(),
        moreCard: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="section_card new"><a href="#" class="_viewMoreFeed" data-kant-id="473">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.moreFeed", n) : c.call(t, "t", "activity.moreFeed", n))) + "</a></div>"
            });
            return a
        }(),
        aboutCard: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r = "",
                    c = e.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="notify about _aboutCard"><a href="/s/about" target="_blank" class="_btnViewAbout" data-kant-id="474">' + o((s = e.img || t && t.img, n = {
                    hash: {
                        src: "/img/card_about.jpg",
                        width: "512",
                        height: "261"
                    },
                    data: i
                }, s ? s.call(t, n) : c.call(t, "img", n))) + '</a> <button class="bn_close _btnHideAbout" data-kant-id="475">' + o((s = e.t || t && t.t, n = {
                    hash: {},
                    data: i
                }, s ? s.call(t, "activity.alt.hideAbout", n) : c.call(t, "t", "activity.alt.hideAbout", n))) + "</button></div>"
            });
            return a
        }(),
        likeThumbnailContainer: function() {
            var a = t(function(a, t, e, l, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {}, '<ul class="_likeThumbnailContainer"></ul>'
            });
            return a.wrap = '<div class="feel_group">', a
        }(),
        likeThumbnailItem: function() {
            var a = t(function(a, t, e, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var s, n, r, c = "",
                    o = "function",
                    d = this.escapeExpression,
                    p = e.helperMissing;
                return c += '<div class="pf"><a href="/' + d((s = t && t.actor, s = null == s || s === !1 ? s : s.urlKey, typeof s === o ? s.apply(t) : s)) + '" data-profile-popup="' + d((s = t && t.actor, s = null == s || s === !1 ? s : s.id, typeof s === o ? s.apply(t) : s)) + '" data-kant-id="518"><span class="pf_thmb"><img src="' + d((n = e.profileImage || t && t.profileImage, r = {
                    hash: {
                        url: (s = t && t.actor, null == s || s === !1 ? s : s.profile_thumbnail_url),
                        size: "28"
                    },
                    data: i
                }, n ? n.call(t, r) : p.call(t, "profileImage", r))) + '" alt="" class="_profileImage"></span> <span class="ico_feel ico_', (n = e.emotion) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.emotion, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + '">', (n = e.text) ? s = n.call(t, {
                    hash: {},
                    data: i
                }) : (n = t && t.text, s = typeof n === o ? n.call(t, {
                    hash: {},
                    data: i
                }) : n), c += d(s) + "</span></a></div>"
            });
            return a.wrap = "<li>", a
        }(),
        thirdPartyLink: function() {
            var a = t(function(a, t, e, l, i) {
                function s(a, t) {
                    var l, i, s = "";
                    return s += ' <a href="#" class="_thirdPartyLink" data-kant-id="533"><span class="ico"><img src="', (i = e.icon) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.icon, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += o(l) + '" width="24" height="24"><span class="line"></span></span> <strong>', (i = e.name) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.name, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += o(l) + "</strong></a> "
                }
                function n(a, t) {
                    var l, i, s = "";
                    return s += ' <span><span class="ico"><img src="', (i = e.icon) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.icon, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += o(l) + '" width="24" height="24"><span class="line"></span></span> <strong>', (i = e.name) ? l = i.call(a, {
                        hash: {},
                        data: t
                    }) : (i = a && a.name, l = typeof i === c ? i.call(a, {
                        hash: {},
                        data: t
                    }) : i), s += o(l) + "</strong></span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), i = i || {};
                var r, c = "function",
                    o = this.escapeExpression,
                    d = this;
                return r = e["if"].call(t, t && t.hasLink, {
                    hash: {},
                    inverse: d.program(3, n, i),
                    fn: d.program(1, s, i),
                    data: i
                }), r || 0 === r ? r : ""
            });
            return a.wrap = '<div class="third_txt">', a
        }()
    }
});
define("model/Campaign", ["common/util"], function(t) {
    var e = {
        IMAGE: "template01",
        TEXT: "template02"
    };
    return space.Model.extend({
        TYPE: e,
        defaults: {
            id: null,
            action_url: "",
            template_type: e.IMAGE,
            title: "",
            content: "",
            sticky: !1
        },
        virtuals: {
            escapedContent: function() {
                return t.escapeHtmlString(this.get("content"))
            },
            hasContent: function() {
                return !!this.get("content")
            },
            isTextCampaign: function() {
                return this.get("template_type") === this.TYPE.TEXT
            }
        }
    })
});
define("model/Campaigns", ["model/me", "model/Campaign"], function(e, t) {
    var n = e.get("property");
    return space.Collection.extend({
        model: t,
        initialize: function() {
            this._fetchedCount = 0
        },
        setCampaigns: function(e) {
            this._fetchedCount = e.length, this.reset(e, {
                parse: !0
            })
        },
        parse: function(e) {
            var t = n.get(n.TYPE.LAST_CAMPAIGN_ID_LIST),
                i = _.filter(e, function(e) {
                    return -1 === _.indexOf(t, e.id)
                });
            return i = i.length > 1 ? _.initial(i, i.length - 1) : i
        },
        getFetchedCount: function() {
            return this._fetchedCount
        }
    })
});
define("model/Feeds", ["common/api", "model/Activities", "model/Campaigns"], function(e, t, i) {
    var a = space.Model.extend({
        url: "/feeds",
        defaults: {
            activities: t,
            campaigns: i
        },
        fetch: function() {
            var i = this;
            return e.request({
                url: _.result(this, "url"),
                type: "GET",
                data: {
                    comment_count: t.PAYLOAD_COMMENT_COUNT,
                    like_count: t.PAYLOAD_LIKE_COUNT,
                    since: null
                },
                extraData: !0
            }).then(function(e) {
                i.get("activities").addActivities(e), i.get("campaigns").setCampaigns(e.campaigns)
            })
        }
    });
    return a
});
define("module/feed", ["template/feed", "module/static/gnb", "module/static/cover", "module/static/error", "module/static/loginView", "part/writing/WritingPart", "model/Feeds", "model/Activities", "model/me", "common/animate", "common/kantUtil"], function(e, t, i, s, o, n, d, r, h, a, l) {
    var c = 300,
        u = 6e4,
        w = 10,
        f = "feed";
    return new(space.Module.extend({
        name: "feed",
        template: e.layout,
        childParts: {
            writingButton: "part/feed/WritingButtonPart",
            writing: n,
            feed: "part/feed/FeedListPart"
        },
        styles: {
            over: "over"
        },
        initialize: function() {
            this._$window = $(window), this._$htmlAndBody = $("html,body"), this._timerCheckNewFeed = null, this._blockedMsg = null, this._isBlockedUser = !1, this._checkedBlockedUser = !1, this._isShownNewFeedCard = !1, this._$newFeedCard = null, this._$aboutCard = null, this._$empty = null
        },
        onSetup: function() {
            var o = new d;
            this.childParts.feed.collection = o.get("activities"), agent.type.is.mobile || this.addPart("campaign", "part/feed/CampaignListPart", {
                options: {
                    collection: o.get("campaigns")
                }
            }), this._stopCheckNewFeed(), this._startCheckNewFeed(), this.listenTo(this.childParts.writingButton, "changeMode", function(e) {
                this.childParts.writing.changeMode(e)
            }), this.listenTo(this.childParts.feed, {
                fetchData: function() {
                    l.sendPageView(f)
                },
                changeListStatus: function(t) {
                    t ? this._$empty && (this._$empty.remove(), this._$empty = null) : this._$empty = $(e.empty()).appendTo(this.childParts.feed.itemPartContainer)
                }
            }), this.listenTo(this.childParts.writing, {
                changeMode: function(e) {
                    t.setFeedWritingMode(e), this.childParts.writingButton.changeMode(e)
                },
                post: function(e) {
                    this._viewNewFeed() === !0 || e.isMeOnlyPermission() || this.childParts.feed.addActivity(e)
                }
            }), this.listenTo(t, {
                feedWritingChangeMode: function(e) {
                    this.flow.forkWith(this._scrollToTop()).next(function() {
                        this.childParts.writing.changeMode(e)
                    })
                },
                focusFeedWriting: function() {
                    this.flow.forkWith(this._scrollToTop()).next(function() {
                        this.childParts.writing.focus()
                    })
                },
                reloadFeed: function() {
                    var e = this.flow.fork();
                    agent.type.is.mobile || e.next(function() {
                        return this.childParts.writing.cancel({
                            focus: !1,
                            beforeUnload: !0
                        })
                    }), e.next(function() {
                        this._reloadFeed()
                    })
                },
                blockedUser: function(e) {
                    this._checkedBlockedUser = !0, this._isBlockedUser = !0, this._blockedMsg = e, this._showBlockedUserBanner(e)
                }
            }), this.listenTo(t, "viewNewFeed", this._viewNewFeed), this.listenTo(i, {
                show: function() {
                    this._stopCheckNewFeed()
                },
                hide: function() {
                    this._startCheckNewFeed()
                }
            }), o.fetch().fail(s.getHandler())
        },
        onRoute: function() {
            var e = this;
            this.hasChildPart("writing") && (space.Router.onBeforeUnload = function() {
                return e.isAvailableChildPart("writing") ? e.childParts.writing.cancel({
                    beforeUnload: !0
                }) : Q.resolve()
            })
        },
        _showBlockedUserBanner: function(e) {
            null !== e && this.isRendered() && this.addPart("blockedUser", "part/feed/BlockedUserPart", {
                options: {
                    message: e
                }
            })
        },
        onRender: function() {
            var e = h.get("property");
            this._checkedBlockedUser || (t.isBlockedUser() && (this._isBlockedUser = !0, this._blockedMsg = t.getBlockedUserMsg()), this._checkedBlockedUser = !0), this._isBlockedUser && this._showBlockedUserBanner(this._blockedMsg), e.isFetched() ? this._showAboutCard() : this.listenTo(e, "fetched", this._showAboutCard), agent.type.is.desktop || this.$("._aboutCard").addClass(this.styles.over)
        },
        onStop: function() {
            this._stopCheckNewFeed()
        },
        _scrollToTop: function() {
            return this._$window.scrollTop() > 0 ? a(this._$htmlAndBody, {
                scrollTop: 0
            }, c) : Q.resolve()
        },
        _stopCheckNewFeed: function() {
            null !== this._timerCheckNewFeed && (clearTimeout(this._timerCheckNewFeed), this._timerCheckNewFeed = null)
        },
        _startCheckNewFeed: function() {
            var e = this;
            this._timerCheckNewFeed = setTimeout(function() {
                var i;
                e.isAvailableChildPart("feed") && (i = e.childParts.feed.collection.originalCollection, e.flow.forkWith(i.checkNewFeed()).next(function(e) {
                    var i = e && e.length;
                    i && (this._$window.scrollTop() && t.showNewFeed(i), this._showNewFeedCard(i)), this._startCheckNewFeed()
                }).stopped(function(e) {
                    e && 401 === e.status && (h.setLoggedIn(!1), this._stopCheckNewFeed())
                }))
            }, u)
        },
        _reloadFeed: function() {
            var e;
            this.flow.isChildFlowPending("fetch") || (e = new d, this._hideAboutCard(), this._hideNewFeedCard(), this.childParts.feed.stop(), this.childParts.feed.collection = e.get("activities"), this.childParts.feed.start(), this.isAvailableChildPart("campaign") && (this.childParts.campaign.stop(), this.childParts.campaign.collection = e.get("campaigns"), this.childParts.campaign.start()), this._showAboutCard())
        },
        _viewNewFeed: function() {
            var e = this.childParts.feed.collection.originalCollection,
                i = e.getNewFeed();
            if (!h.isRegistered()) return void(o.isShown() || o.show());
            if (t.hideNewFeed(), this._hideNewFeedCard(), i && i.length) {
                if (i.length > w) return this._reloadFeed(), !0;
                for (var s = i.length - 1; s >= 0; s--) e.add(i[s], {
                    at: 0
                });
                l.sendPageView(f)
            }
            this._scrollToTop()
        },
        _showNewFeedCard: function(t) {
            this._$newFeedCard ? t && this._$newFeedCard.find("._newFeedCount").text(t) : this._$newFeedCard = $(e.newFeedCard({
                count: t
            })), !this._isShownNewFeedCard && this.isAvailableChildPart("feed") && (this._$newFeedCard.prependTo(this.childParts.feed.itemPartContainer), this._isShownNewFeedCard = !0, agent.isIe10AndBelow() && this._$newFeedCard.css("visibility", "hidden").css("visibility", "visible"))
        },
        _hideNewFeedCard: function() {
            this._$newFeedCard && this._isShownNewFeedCard && (this._$newFeedCard.detach(), this._isShownNewFeedCard = !1)
        },
        _showAboutCard: function() {
            this._$aboutCard || h.get("property").isOn("about") || this.isAvailableChildPart("feed") && (this._$aboutCard = $(e.aboutCard()).prependTo(this.childParts.feed.itemPartContainer))
        },
        _hideAboutCard: function() {
            this._$aboutCard && (this._$aboutCard.remove(), this._$aboutCard = null)
        },
        events: {
            "click ._viewNewFeed": function(e) {
                e.preventDefault(), this._viewNewFeed()
            },
            "click ._btnHideAbout": function(e) {
                e.preventDefault(), this._hideAboutCard(), h.get("property").updateOnOff("about", !0)
            },
            "click ._btnViewAbout": function(e) {
                e.preventDefault(), h.get("property").updateOnOff("about", !0), window.open("/s/about")
            },
            "mouseenter ._aboutCard": function(e) {
                $(e.currentTarget).addClass(this.styles.over)
            },
            "mouseleave ._aboutCard": function(e) {
                $(e.currentTarget).removeClass(this.styles.over)
            }
        }
    }))
});
define("template/myStory", ["Handlebars"], function(a) {
    var t = function(t) {
        var e = a.template(t);
        return function(a) {
            return e(a, {
                partials: l
            })
        }
    }, l = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, l, e, n) {
                function r() {
                    return " my"
                }
                function i() {
                    return " plus"
                }
                function s(a, t) {
                    var e, n, r = "";
                    return r += ' <button class="bn_pedit _btnEditProfileImage" data-kant-id="217">' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.alt.editProfileImage", n) : F.call(a, "t", "profile.alt.editProfileImage", n))) + '</button><div data-part="profileImageLayer"></div>'
                }
                function o(a, t) {
                    var e, n, r = "";
                    return r += '  <button class="bn bn_pf _btnEditProfile" data-kant-id="218"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.editButton", n) : F.call(a, "t", "profile.editButton", n))) + '</span></button> <button class="bn _btnEditBgImage" data-kant-id="219"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.image.editBackground", n) : F.call(a, "t", "profile.image.editBackground", n))) + '</span></button><div data-part="bgImageLayer"></div>'
                }
                function p(a, t) {
                    var e, n, r, i = "";
                    return i += " ", e = l.unless.call(a, (e = a && a.profile, null == e || e === !1 ? e : e.isStoryPlus), {
                        hash: {},
                        inverse: k.noop,
                        fn: k.program(10, d, t),
                        data: t
                    }), (e || 0 === e) && (i += e), i += " ", e = l["if"].call(a, (e = a && a.profile, null == e || e === !1 ? e : e.isStoryPlus), {
                        hash: {},
                        inverse: k.noop,
                        fn: k.program(12, c, t),
                        data: t
                    }), (e || 0 === e) && (i += e), i += '<div data-part="friendSetting" class="ly_story_layer ly_friend" style="display:none"><ul><li><label for="chk_interest"><span class="ic_star"></span>' + S((n = l.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "profile.favoriteFriend", r) : F.call(a, "t", "profile.favoriteFriend", r))) + '</label> <span class="bg_chk _favoriteSpan"><input type="checkbox" id="chk_interest" name="favorite" class="_btnFavorite" data-kant-id="mpfw"></span></li>', e = l["if"].call(a, (e = a && a.profile, null == e || e === !1 ? e : e.isStoryPlus), {
                        hash: {},
                        inverse: k.program(16, f, t),
                        fn: k.program(14, u, t),
                        data: t
                    }), (e || 0 === e) && (i += e), i += '</ul></div><div class="edit_box"><a href="#" class="btn_edit _btnActionLayer" data-kant-id="231">' + S((n = l.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "profile.alt.toggleLayer", r) : F.call(a, "t", "profile.alt.toggleLayer", r))) + '</a><ul class="ly_story_layer" data-part="actionLayer" style="display:none"><li><a href="#" class="_btnReportFriend" data-kant-id="232">' + S((n = l.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "profile.report", r) : F.call(a, "t", "profile.report", r))) + "</a></li></ul></div>"
                }
                function d(a, t) {
                    var e, n, r = "";
                    return r += '  <button class="bn_down _friendButtons _btnFavoriteFriend _btnFriendSetting" style="display:none" data-kant-id="220"><em><span class="ic_star">' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.favoriteFriend", n) : F.call(a, "t", "profile.favoriteFriend", n))) + "</span>" + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.friend", n) : F.call(a, "t", "profile.friend", n))) + '</em> <span class="arrow_down"></span></button> <button class="bn_down _friendButtons _btnFriend _btnFriendSetting" style="display:none" data-kant-id="220"><em>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.friend", n) : F.call(a, "t", "profile.friend", n))) + '</em> <span class="arrow_down"></span></button> <button class="bn _friendButtons _btnRequestFriend" style="display:none" data-kant-id="222"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.requestFriend", n) : F.call(a, "t", "profile.requestFriend", n))) + '</span></button><div class="_requestingArea"><button class="bn _friendButtons _btnRequestingFriend" style="display:none" data-kant-id="false"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.requestingFriend", n) : F.call(a, "t", "profile.requestingFriend", n))) + '</span></button> <button class="bn _friendButtons _btnCancelRequestingFriend" style="display:none" data-kant-id="224"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.cancelRequestingFriend", n) : F.call(a, "t", "profile.cancelRequestingFriend", n))) + '</span></button></div><button class="bn _friendButtons _btnAcceptFriend" style="display:none" data-kant-id="225"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.acceptFriend", n) : F.call(a, "t", "profile.acceptFriend", n))) + "</span></button> "
                }
                function c(a, t) {
                    var e, n, r = "";
                    return r += ' <button class="bn _friendButtons _btnFollowStoryPlus" style="display:none" data-kant-id="226"><span>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.storyPlus.follow", n) : F.call(a, "t", "profile.storyPlus.follow", n))) + '</span></button> <button class="bn_down _friendButtons _btnFollowingStoryPlus _btnFriendSetting" style="display:none" data-kant-id="226"><em>' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.storyPlus.following", n) : F.call(a, "t", "profile.storyPlus.following", n))) + '</em> <span class="arrow_down"></span></button> <button class="bn_down _friendButtons _btnFavoriteFriend _btnFriendSetting" style="display:none" data-kant-id="226"><em><span class="ic_star">' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.favoriteFriend", n) : F.call(a, "t", "profile.favoriteFriend", n))) + "</span>" + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.storyPlus.following", n) : F.call(a, "t", "profile.storyPlus.following", n))) + '</em> <span class="arrow_down"></span></button> '
                }
                function u(a, t) {
                    var e, n, r = "";
                    return r += '<li><a href="#" class="_btnUnfollowStoryPlus" data-kant-id="229">' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.storyPlus.unfollow", n) : F.call(a, "t", "profile.storyPlus.unfollow", n))) + "</a></li>"
                }
                function f(a, t) {
                    var e, n, r = "";
                    return r += '<li><a href="#" class="_btnDeleteFriend" data-kant-id="230">' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.removeFriend", n) : F.call(a, "t", "profile.removeFriend", n))) + "</a></li>"
                }
                function h() {
                    return '<ul class="five">'
                }
                function m() {
                    return "<ul>"
                }
                function y(a, t) {
                    var e, n, r = "";
                    return r += '<li class="_myStoryTabItem" data-resolver="myStory/friends"><a href="/s/friends" data-kant-id="237">' + S((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "myStory.menu.friends", n) : F.call(a, "t", "myStory.menu.friends", n))) + ' <span class="_friendsCount">' + S((e = l.numberFormat || a && a.numberFormat, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, a && a.friendCount, 9999, n) : F.call(a, "numberFormat", a && a.friendCount, 9999, n))) + "</span></a></li>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var v, g, _, b = "",
                    F = l.helperMissing,
                    S = this.escapeExpression,
                    k = this,
                    I = "function";
                return b += '<div class="storycover"><div class="bg_story"><div class="blur"><img src="' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.bg_image_url, typeof v === I ? v.apply(t) : v)) + '" alt="" class="_bgImageBlurred"><div class="bg_cover"></div></div><div class="story"><img src="' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.bg_image_url, typeof v === I ? v.apply(t) : v)) + '" alt="" class="_bgImage"></div><span class="gr"></span></div><div class="storycontent" data-kant-group="', (g = l.groupId) ? v = g.call(t, {
                    hash: {},
                    data: n
                }) : (g = t && t.groupId, v = typeof g === I ? g.call(t, {
                    hash: {},
                    data: n
                }) : g), b += S(v) + '"><div class="profile_area"><div class="profile_box', v = l["if"].call(t, (v = t && t.profile, null == v || v === !1 ? v : v.isMe), {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(1, r, n),
                    data: n
                }), (v || 0 === v) && (b += v), v = l["if"].call(t, (v = t && t.profile, null == v || v === !1 ? v : v.isStoryPlus), {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(3, i, n),
                    data: n
                }), (v || 0 === v) && (b += v), b += '"><div class="pf_img"><div class="pf"><a href="#" class="_btnViewProfileImage" data-kant-id="216"><img src="' + S((g = l.profileImage || t && t.profileImage, _ = {
                    hash: {
                        url: (v = t && t.profile, null == v || v === !1 ? v : v.profile_thumbnail_url),
                        size: "124"
                    },
                    data: n
                }, g ? g.call(t, _) : F.call(t, "profileImage", _))) + '" alt="" class="_profileImage"><span class="line"></span></a></div> ', v = l["if"].call(t, (v = t && t.profile, null == v || v === !1 ? v : v.isMe), {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(5, s, n),
                    data: n
                }), (v || 0 === v) && (b += v), b += '</div><div class="pf_info"><div class="profile"><div data-part="status"></div></div><div class="btn_area">', v = l["if"].call(t, (v = t && t.profile, null == v || v === !1 ? v : v.isMe), {
                    hash: {},
                    inverse: k.program(9, p, n),
                    fn: k.program(7, o, n),
                    data: n
                }), (v || 0 === v) && (b += v), b += '</div></div></div></div></div><div class="story_tab _myStoryTabMenu" data-kant-group="my.menu">', v = l["if"].call(t, (v = t && t.profile, null == v || v === !1 ? v : v.isMe), {
                    hash: {},
                    inverse: k.program(20, m, n),
                    fn: k.program(18, h, n),
                    data: n
                }), (v || 0 === v) && (b += v), b += '<li class="_myStoryTabItem" data-resolver="myStory/feed"><a href="/' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.urlKey, typeof v === I ? v.apply(t) : v)) + '" data-kant-id="233" data-kant-option="t:', (g = l.storyType) ? v = g.call(t, {
                    hash: {},
                    data: n
                }) : (g = t && t.storyType, v = typeof g === I ? g.call(t, {
                    hash: {},
                    data: n
                }) : g), b += S(v) + '">' + S((g = l.t || t && t.t, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, "myStory.menu.all", _) : F.call(t, "t", "myStory.menu.all", _))) + ' <span class="_activityCount">' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.activity_count, typeof v === I ? v.apply(t) : v)) + '</span></a></li><li class="_myStoryTabItem" data-resolver="myStory/photos"><a href="/' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.urlKey, typeof v === I ? v.apply(t) : v)) + '/photos" data-kant-id="234" data-kant-option="t:', (g = l.storyType) ? v = g.call(t, {
                    hash: {},
                    data: n
                }) : (g = t && t.storyType, v = typeof g === I ? g.call(t, {
                    hash: {},
                    data: n
                }) : g), b += S(v) + '">' + S((g = l.t || t && t.t, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, "myStory.menu.photos", _) : F.call(t, "t", "myStory.menu.photos", _))) + ' <span class="_photoCount">' + S((g = l.numberFormat || t && t.numberFormat, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, (v = t && t.photoSection, null == v || v === !1 ? v : v.count), 9999, _) : F.call(t, "numberFormat", (v = t && t.photoSection, null == v || v === !1 ? v : v.count), 9999, _))) + '</span></a></li><li class="_myStoryTabItem" data-resolver="myStory/videos"><a href="/' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.urlKey, typeof v === I ? v.apply(t) : v)) + '/videos" data-kant-id="235" data-kant-option="t:', (g = l.storyType) ? v = g.call(t, {
                    hash: {},
                    data: n
                }) : (g = t && t.storyType, v = typeof g === I ? g.call(t, {
                    hash: {},
                    data: n
                }) : g), b += S(v) + '">' + S((g = l.t || t && t.t, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, "myStory.menu.videos", _) : F.call(t, "t", "myStory.menu.videos", _))) + ' <span class="_videoCount">' + S((g = l.numberFormat || t && t.numberFormat, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, (v = t && t.videoSection, null == v || v === !1 ? v : v.count), 9999, _) : F.call(t, "numberFormat", (v = t && t.videoSection, null == v || v === !1 ? v : v.count), 9999, _))) + '</span></a></li><li class="_myStoryTabItem" data-resolver="myStory/music"><a href="/' + S((v = t && t.profile, v = null == v || v === !1 ? v : v.urlKey, typeof v === I ? v.apply(t) : v)) + '/music" data-kant-id="236" data-kant-option="t:', (g = l.storyType) ? v = g.call(t, {
                    hash: {},
                    data: n
                }) : (g = t && t.storyType, v = typeof g === I ? g.call(t, {
                    hash: {},
                    data: n
                }) : g), b += S(v) + '">' + S((g = l.t || t && t.t, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, "myStory.menu.music", _) : F.call(t, "t", "myStory.menu.music", _))) + ' <span class="_musicCount">' + S((g = l.numberFormat || t && t.numberFormat, _ = {
                    hash: {},
                    data: n
                }, g ? g.call(t, (v = t && t.musicSection, null == v || v === !1 ? v : v.count), 9999, _) : F.call(t, "numberFormat", (v = t && t.musicSection, null == v || v === !1 ? v : v.count), 9999, _))) + "</span></a></li>", v = l["if"].call(t, (v = t && t.profile, null == v || v === !1 ? v : v.isMe), {
                    hash: {},
                    inverse: k.noop,
                    fn: k.program(22, y, n),
                    data: n
                }), (v || 0 === v) && (b += v), b += '</ul></ul></div></div><div class="scrollDummy"></div>'
            });
            return a.wrap = '<div class="storyProfileContainer">', a
        }(),
        contentLayout: function() {
            var a = t(function(a, t, l, e, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {}, '<div data-part="content"></div>'
            });
            return a.wrap = '<div class="story_area">', a
        }(),
        postLayout: function() {
            var a = t(function(a, t, l, e, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {}, '<div class="feed _feedContainer"><div data-part="content"></div></div>'
            });
            return a.wrap = '<div class="story_area">', a
        }(),
        editImage: function() {
            var a = t(function(a, t, l, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var r, i, s = "",
                    o = l.helperMissing,
                    p = this.escapeExpression;
                return s += '<ul><li><div class="add"><a href="#" data-kant-id="239">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.upload", i) : o.call(t, "t", "profile.image.upload", i))) + '</a><form action="#" method="post" enctype="multipart/form-data"><input name="file_1" class="bg_file_upload _uploadInput" type="file" title="' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.upload", i) : o.call(t, "t", "profile.image.upload", i))) + '" accept="image/png,image/bmp,image/jpeg"></form></div></li><li><a href="#" class="_btnSelect" data-kant-id="240">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.selectFromPhotos", i) : o.call(t, "t", "profile.image.selectFromPhotos", i))) + '</a></li><li><a href="#" class="_btnDelete" data-kant-id="241">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.delete", i) : o.call(t, "t", "profile.image.delete", i))) + "</a></li></ul>"
            });
            return a.wrap = '<div class="ly_story_layer" style="display:none;">', a
        }(),
        editBgImage: function() {
            var a = t(function(a, t, l, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var r, i, s = "",
                    o = l.helperMissing,
                    p = this.escapeExpression;
                return s += '<ul><li><div class="add"><a href="#" data-kant-id="242">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.upload", i) : o.call(t, "t", "profile.image.upload", i))) + '</a><form action="#" method="post" enctype="multipart/form-data"><input name="file_1" class="bg_file_upload _uploadInput" type="file" title="' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.upload", i) : o.call(t, "t", "profile.image.upload", i))) + '" accept="image/png,image/bmp,image/jpeg"></form></div></li><li><a href="#" class="_btnSelect" data-kant-id="243">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.selectFromPhotos", i) : o.call(t, "t", "profile.image.selectFromPhotos", i))) + '</a></li><li><a href="#" class="_btnDelete" data-kant-id="244">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.changeDefault", i) : o.call(t, "t", "profile.image.changeDefault", i))) + "</a></li></ul>"
            });
            return a.wrap = '<div class="ly_story_layer" style="display:none;">', a
        }(),
        albumLayer: function() {
            var a = t(function(a, t, l, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var r, i, s = "",
                    o = l.helperMissing,
                    p = this.escapeExpression;
                return s += '<div class="ly_con album_choice _layerContainer"><div class="inner"><h1>' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.selectImage", i) : o.call(t, "t", "profile.image.selectImage", i))) + '</h1><div class="album_list"><p>' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.countFirst", i) : o.call(t, "t", "profile.image.countFirst", i))) + '<em class="_imageCount">' + p((r = l.numberFormat || t && t.numberFormat, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, t && t.count, i) : o.call(t, "numberFormat", t && t.count, i))) + "</em>" + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "profile.image.countLast", i) : o.call(t, "t", "profile.image.countLast", i))) + '</p><div><ul class="_listContainer" style="height:475px"></ul></div></div><button class="bn_x _btnCloseLayer" data-kant-id="245">' + p((r = l.t || t && t.t, i = {
                    hash: {},
                    data: n
                }, r ? r.call(t, "common.layer.close", i) : o.call(t, "t", "common.layer.close", i))) + "</button></div></div>"
            });
            return a.wrap = '<div class="dim_ly" style="display:block">', a
        }(),
        albumItem: function() {
            var a = t(function(a, t, l, e, n) {
                function r(a, t, e) {
                    var n, r, i = "";
                    return i += '<li data-id="' + o((n = e && e.id, typeof n === s ? n.apply(a) : n)) + '" data-idx="' + o((n = null == t || t === !1 ? t : t.index, typeof n === s ? n.apply(a) : n)) + '" class="_selectImage"><a href="#" class="_mediaContainer" data-kant-id="246"><img src="', (r = l.url) ? n = r.call(a, {
                        hash: {},
                        data: t
                    }) : (r = a && a.url, n = typeof r === s ? r.call(a, {
                        hash: {},
                        data: t
                    }) : r), i += o(n) + '" alt="" class="_media"></a> <span class="line"></span></li>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var i, s = "function",
                    o = this.escapeExpression,
                    p = this;
                return i = l.each.call(t, t && t.media, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.programWithDepth(1, r, n, t),
                    data: n
                }), i || 0 === i ? i : ""
            });
            return a
        }(),
        emptyFeed: function() {
            var a = t(function(a, t, l, e, n) {
                function r(a, t) {
                    var e, n, r = "";
                    return r += "<p>" + h((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "myStory.empty.feed", n) : f.call(a, "t", "myStory.empty.feed", n))) + '</p><div class="bx_nodata"><a href="#" class="_btnWriteNewFeed" data-kant-id="247"><span class="ic_pen"></span>' + h((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "myStory.empty.writeButton", n) : f.call(a, "t", "myStory.empty.writeButton", n))) + "</a></div>"
                }
                function i() {
                    return '<p class="friend"><span class="ic_txt"></span></p>'
                }
                function s(a, t) {
                    var e, n, r = "";
                    return r += "<p>" + h((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "myStory.empty.feed", n) : f.call(a, "t", "myStory.empty.feed", n))) + "</p>"
                }
                function o(a, t) {
                    var e, n = "";
                    return n += " ", e = l.unless.call(a, (e = a && a.profile, null == e || e === !1 ? e : e.isMe), {
                        hash: {},
                        inverse: m.noop,
                        fn: m.program(8, p, t),
                        data: t
                    }), (e || 0 === e) && (n += e), n += " "
                }
                function p(a, t) {
                    var e, n = "";
                    return n += " ", e = l.unless.call(a, (e = a && a.profile, null == e || e === !1 ? e : e.isStoryPlus), {
                        hash: {},
                        inverse: m.noop,
                        fn: m.program(9, d, t),
                        data: t
                    }), (e || 0 === e) && (n += e), n += " "
                }
                function d(a, t) {
                    var e, n, r = "";
                    return r += "<p>" + h((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "myStory.emptyOther.feed", n) : f.call(a, "t", "myStory.emptyOther.feed", n))) + "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var c, u = "",
                    f = l.helperMissing,
                    h = this.escapeExpression,
                    m = this;
                return u += '<div class="nodata">', c = l["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isMe), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(1, r, n),
                    data: n
                }), (c || 0 === c) && (u += c), u += " ", c = l["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isFriend), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(3, i, n),
                    data: n
                }), (c || 0 === c) && (u += c), u += " ", c = l["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isStoryPlus), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(5, s, n),
                    data: n
                }), (c || 0 === c) && (u += c), u += " ", c = l.unless.call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isFriend), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(7, o, n),
                    data: n
                }), (c || 0 === c) && (u += c), u += "</div>"
            });
            return a
        }(),
        emptyFeedMobile: function() {
            var a = t(function(a, t, l, e, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {}, '<div class="nodata"><p class="friend"><span class="ic_txt"></span></p></div>'
            });
            return a
        }(),
        statusArea: function() {
            var a = t(function(a, t, l, e, n) {
                function r(a, t) {
                    var e, n, r = "";
                    return r += ' <span class="ic_birthday">' + u((e = l.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "profile.alt.birthdayTitle", n) : c.call(a, "t", "profile.alt.birthdayTitle", n))) + "</span> "
                }
                function i(a, t) {
                    var e, n, r, i = "";
                    return i += '<div class="user_music"><a href="#" class="ic_play _btnOpenMusicPlayer" data-kant-id="249">' + u((n = l.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "profile.alt.playMusic", r) : c.call(a, "t", "profile.alt.playMusic", r))) + '</a><p class="tit"><a href="#" class="_btnOpenMusicPlayer" data-kant-id="250">' + u((e = a && a.profile, e = null == e || e === !1 ? e : e.status_objects, e = null == e || e === !1 ? e : e[0], e = null == e || e === !1 ? e : e.title, typeof e === f ? e.apply(a) : e)) + '</a></p><p class="player">' + u((e = a && a.profile, e = null == e || e === !1 ? e : e.status_objects, e = null == e || e === !1 ? e : e[0], e = null == e || e === !1 ? e : e.artist, typeof e === f ? e.apply(a) : e)) + " / " + u((e = a && a.profile, e = null == e || e === !1 ? e : e.status_objects, e = null == e || e === !1 ? e : e[0], e = null == e || e === !1 ? e : e.album_title, typeof e === f ? e.apply(a) : e)) + "</p></div>"
                }
                function s(a) {
                    var t, l = "";
                    return l += '<div class="user_info">' + u((t = a && a.profile, t = null == t || t === !1 ? t : t.statusMessage, typeof t === f ? t.apply(a) : t)) + "</div>"
                }
                function o(a) {
                    var t, l = "";
                    return l += '<p class="tx_news">' + u((t = a && a.profile, t = null == t || t === !1 ? t : t.storyPlusDescription, typeof t === f ? t.apply(a) : t)) + "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var p, d = "",
                    c = l.helperMissing,
                    u = this.escapeExpression,
                    f = "function",
                    h = this;
                return d += '<a href="/' + u((p = t && t.profile, p = null == p || p === !1 ? p : p.urlKey, typeof p === f ? p.apply(t) : p)) + '" class="tit _btnMainProfile _nameHolder" data-kant-id="248">' + u((p = t && t.profile, p = null == p || p === !1 ? p : p.display_name, typeof p === f ? p.apply(t) : p)) + '</a> <span class="date _birthdayHolder">' + u((p = t && t.profile, p = null == p || p === !1 ? p : p.birthdayText, typeof p === f ? p.apply(t) : p)) + "</span> ", p = l["if"].call(t, (p = t && t.profile, null == p || p === !1 ? p : p.is_birthday), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(1, r, n),
                    data: n
                }), (p || 0 === p) && (d += p), d += " ", p = l["if"].call(t, (p = t && t.profile, null == p || p === !1 ? p : p.isMusicStatus), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(3, i, n),
                    data: n
                }), (p || 0 === p) && (d += p), d += " ", p = l["if"].call(t, t && t.hasTextMessage, {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(5, s, n),
                    data: n
                }), (p || 0 === p) && (d += p), d += " ", p = l["if"].call(t, (p = t && t.profile, null == p || p === !1 ? p : p.isStoryPlus), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(7, o, n),
                    data: n
                }), (p || 0 === p) && (d += p), d
            });
            return a.wrap = "<div>", a
        }(),
        notFoundFeed: function() {
            var a = t(function(a, t, l, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var r, i, s, o = "",
                    p = l.helperMissing;
                return o += '<div class="nodata"><p>', i = l.t || t && t.t, s = {
                    hash: {},
                    data: n
                }, r = i ? i.call(t, "myStory.empty.notFound", s) : p.call(t, "t", "myStory.empty.notFound", s), (r || 0 === r) && (o += r), o += "</p></div>"
            });
            return a
        }(),
        error: function() {
            var a = t(function(a, t, l, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var r, i, s = "",
                    o = "function",
                    p = this.escapeExpression;
                return s += '<div class="nodata"><p>', (i = l.error_message) ? r = i.call(t, {
                    hash: {},
                    data: n
                }) : (i = t && t.error_message, r = typeof i === o ? i.call(t, {
                    hash: {},
                    data: n
                }) : i), s += p(r) + "</p></div>"
            });
            return a
        }()
    }
});
define("module/myStory/feed", ["template/myStory", "model/me", "model/Profiles", "model/Profile", "module/static/error", "module/static/writingView", "part/writing/WritingPart", "common/kantUtil", "common/urlKey"], function(t, e, i, n, o, l, s, a, r) {
    return new(space.Module.extend({
        name: "myStoryFeed",
        template: t.contentLayout,
        model: null,
        childParts: {
            content: "part/feed/FeedListPart"
        },
        initialize: function() {
            this._$empty = null
        },
        onSetup: function(l) {
            var s, m = this,
                c = r.profile.urlKeyToId(l),
                d = e.get("notifications");
            return this.model = new i({
                id: c
            }), this.childParts.content.collection = this.model.get("activities"), this.listenTo(this.childParts.content, {
                fetchData: function() {
                    a.sendPageView(this._getPageViewId())
                },
                changeListStatus: function(e) {
                    var i;
                    this.isAvailableChildPart("content") && this.childParts.content.toggle(e), e ? this._$empty && (this._$empty.remove(), this._$empty = null) : this._$empty || (i = agent.type.is.mobile && this.model.get("profile").get("isMe") ? t.emptyFeedMobile() : t.emptyFeed(this.model.toData()), this._$empty = $(i).appendTo(this.$el))
                }
            }), this.listenTo(this.childParts.content.collection, "remove", function(t) {
                this.model.get("profile").get("isMe") && require(["module/myStory/mainProfile"], function(e) {
                    e && e.isStarted() && e.changeActivityCount(-1, t)
                })
            }), d.getReadingMark() === c ? (s = new n({
                id: c
            }), s.fetch(!0).then(function() {
                d.clearReadingMark(c)
            })) : d.clearReadingMark(), this.model.fetch().then(function() {
                var t = m.model.get("profile");
                document.title = intl.t("title.myStory", {
                    name: t.get("display_name")
                })
            }).fail(o.getHandler({
                page: {
                    404: o.PAGE.ERROR_40X,
                    400: o.PAGE.ERROR_40X
                }
            }))
        },
        onStop: function() {
            this._$empty && (this._$empty.remove(), this._$empty = null)
        },
        _getPageViewId: function() {
            var t = this.model.get("profile");
            return t.get("isMe") ? "my.01" : t.get("isStoryPlus") ? "ss" : "fs.01"
        },
        events: {
            "click ._btnWriteNewFeed": function(t) {
                t.preventDefault(), l.show(s.MODE.TEXT)
            }
        }
    }))
});
define("template/myStoryFriend", ["Handlebars"], function(a) {
    var t = function(t) {
        var s = a.template(t);
        return function(a) {
            return s(a, {
                partials: e
            })
        }
    }, e = {
        searchResultItem: function() {
            return t(function(a, t, e, s, n) {
                function l() {
                    return "t:unfollowing"
                }
                function r(a, t) {
                    var s;
                    return s = e["if"].call(a, a && a.isStoryPlus, {
                        hash: {},
                        inverse: u.program(6, d, t),
                        fn: u.program(4, i, t),
                        data: t
                    }), s || 0 === s ? s : ""
                }
                function i() {
                    return "t:following"
                }
                function d() {
                    return "t:friend"
                }
                function c(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + v((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "56"
                        },
                        data: t
                    }, n ? n.call(a, l) : m.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === _ ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += v(s) + '"> '
                }
                function h(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === _ ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += v(s) + " "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var o, p, f = "",
                    u = this,
                    m = e.helperMissing,
                    v = this.escapeExpression,
                    _ = "function";
                return f += '<li><div class="pf"><a href="/', (p = e.urlKey) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.urlKey, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" data-profile-popup="', (p = e.id) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.id, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" data-kant-id="279" data-kant-option="', o = e["if"].call(t, t && t.isSearchItem, {
                    hash: {},
                    inverse: u.program(3, r, n),
                    fn: u.program(1, l, n),
                    data: n
                }), (o || 0 === o) && (f += o), f += '">', o = e["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: u.program(10, h, n),
                    fn: u.program(8, c, n),
                    data: n
                }), (o || 0 === o) && (f += o), f += '</a></div><div class="txt"><span class="in"><a href="/', (p = e.urlKey) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.urlKey, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" class="_profileName" data-profile-popup="', (p = e.id) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.id, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" data-kant-id="280" data-kant-option="', o = e["if"].call(t, t && t.isSearchItem, {
                    hash: {},
                    inverse: u.program(3, r, n),
                    fn: u.program(1, l, n),
                    data: n
                }), (o || 0 === o) && (f += o), f += '">', (p = e.display_name) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.display_name, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '</a></span><span class="txt_v"></span></div></li>'
            })
        }(),
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, e, s, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {}, '<div class="friend_top"><div data-part="menu"></div><div data-part="suggestionInput"></div></div><div data-part="list"></div><div data-part="suggestionList"></div>'
            });
            return a.wrap = '<div class="story_area" data-kant-group="my.friend">', a
        }(),
        friendMenuLayout: function() {
            var a = t(function(a, t, e, s, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {}, '<div data-part="friendWrap"></div>'
            });
            return a.wrap = "<div>", a
        }(),
        friendMenu: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<a href="/s/friends" data-menu="friends" class="_myStoryFriendMenu" data-kant-id="252">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.title.friendTab", r) : d.call(t, "t", "friend.title.friendTab", r))) + '</a> <a href="/s/friends/recommend" data-menu="recommend" class="_myStoryFriendMenu" data-kant-id="253">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.title.recommendTab", r) : d.call(t, "t", "friend.title.recommendTab", r))) + '</a> <a href="/s/friends/requests" data-menu="requests" class="_myStoryFriendMenu" data-kant-id="254">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.title.requestsTab", r) : d.call(t, "t", "friend.title.requestsTab", r))) + ' <span class="ic _newInvitationBadge" style="display:none"></span></a><div class="_suggestionArea"></div>'
            });
            return a.wrap = "<div>", a
        }(),
        suggestionInput: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<label for="myStorySearchQuery" class="_queryPlaceholder">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.placeholder.search", r) : d.call(t, "t", "friend.placeholder.search", r))) + '</label><input type="text" id="myStorySearchQuery" class="_query" data-kant-id="search" data-kant-ignore="true"> <button data-kant-id="255">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.btn.search", r) : d.call(t, "t", "friend.btn.search", r))) + "</button>"
            });
            return a.wrap = '<div class="srch_area">', a
        }(),
        friendListLayout: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<div data-part="newList"></div><div data-part="favoriteList"></div><div data-part="wholeList"></div><div class="_noFriend nodata" style="display:none"><p>' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.paragraph.noFriend", r) : d.call(t, "t", "friend.paragraph.noFriend", r))) + "</p></div>"
            });
            return a.wrap = '<div class="friend_wrap">', a
        }(),
        newList: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<p class="tit_fr">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.title.newList", r) : d.call(t, "t", "friend.title.newList", r))) + '</p><ul class="lst_friend _list"></ul>'
            });
            return a.wrap = "<div>", a
        }(),
        favoriteList: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<p class="tit_fr">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.title.favoriteList", r) : d.call(t, "t", "friend.title.favoriteList", r))) + '</p><ul class="lst_friend _list"></ul>'
            });
            return a.wrap = "<div>", a
        }(),
        wholeList: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<p class="tit_fr">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.title.wholeList", r) : d.call(t, "t", "friend.title.wholeList", r))) + '</p><ul class="lst_friend _list"></ul><div class="loading _loading" style="display:none">' + c((l = e.img || t && t.img, r = {
                    hash: {
                        src: "/img/loading_circle_g.gif",
                        width: "24",
                        height: "24",
                        alt: "friend.alt.loading"
                    },
                    data: n
                }, l ? l.call(t, r) : d.call(t, "img", r))) + "</div>"
            });
            return a.wrap = "<div>", a
        }(),
        friendItem: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="bn_fr _makeUnfav on" data-kant-id="256">' + g((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.makeUnfav", n) : _.call(a, "t", "friend.btn.makeUnfav", n))) + "</button> "
                }
                function r(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="bn_fr _makeFav" data-kant-id="257">' + g((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.makeFav", n) : _.call(a, "t", "friend.btn.makeFav", n))) + "</button> "
                }
                function i(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + g((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "100"
                        },
                        data: t
                    }, n ? n.call(a, l) : _.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === y ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += g(s) + '"> '
                }
                function d(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.diplay_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.diplay_name, s = typeof n === y ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += g(s) + " "
                }
                function c(a, t) {
                    var s, n, l = "";
                    return l += ' <span class="ic_birthday">' + g((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.alt.birthday", n) : _.call(a, "t", "friend.alt.birthday", n))) + "</span> "
                }
                function h(a, t) {
                    var s, n, l, r = "";
                    return r += ' <span class="music"><a href="#" class="_playMusic" data-kant-id="260"><span class="bn_music">' + g((n = e.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "friend.alt.music", l) : _.call(a, "t", "friend.alt.music", l))) + "</span>", (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === y ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += g(s) + "</a></span> "
                }
                function o(a, t) {
                    var s, n, l = "";
                    return l += ' <span class="txt_desc">', (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === y ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += g(s) + "</span> "
                }
                function p(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_wh fr _unfollow" data-kant-id="261"><span>' + g((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.unfollow", n) : _.call(a, "t", "friend.btn.unfollow", n))) + "</span></button> "
                }
                function f(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_wh fr _deleteFriend" data-kant-id="262"><span>' + g((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.delete", n) : _.call(a, "t", "friend.btn.delete", n))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var u, m, v = "",
                    _ = e.helperMissing,
                    g = this.escapeExpression,
                    y = "function",
                    b = this;
                return u = e["if"].call(t, t && t.is_favorite, {
                    hash: {},
                    inverse: b.program(3, r, n),
                    fn: b.program(1, l, n),
                    data: n
                }), (u || 0 === u) && (v += u), v += '<div class="pf"><a href="/', (m = e.urlKey) ? u = m.call(t, {
                    hash: {},
                    data: n
                }) : (m = t && t.urlKey, u = typeof m === y ? m.call(t, {
                    hash: {},
                    data: n
                }) : m), v += g(u) + '" data-profile-popup="', (m = e.id) ? u = m.call(t, {
                    hash: {},
                    data: n
                }) : (m = t && t.id, u = typeof m === y ? m.call(t, {
                    hash: {},
                    data: n
                }) : m), v += g(u) + '" data-kant-id="258">', u = e["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: b.program(7, d, n),
                    fn: b.program(5, i, n),
                    data: n
                }), (u || 0 === u) && (v += u), v += '</a></div><div class="txt"><span class="in"><a href="/', (m = e.urlKey) ? u = m.call(t, {
                    hash: {},
                    data: n
                }) : (m = t && t.urlKey, u = typeof m === y ? m.call(t, {
                    hash: {},
                    data: n
                }) : m), v += g(u) + '" class="_profileName" data-profile-popup="', (m = e.id) ? u = m.call(t, {
                    hash: {},
                    data: n
                }) : (m = t && t.id, u = typeof m === y ? m.call(t, {
                    hash: {},
                    data: n
                }) : m), v += g(u) + '" data-kant-id="259">', (m = e.display_name) ? u = m.call(t, {
                    hash: {},
                    data: n
                }) : (m = t && t.display_name, u = typeof m === y ? m.call(t, {
                    hash: {},
                    data: n
                }) : m), v += g(u) + "</a> ", u = e["if"].call(t, t && t.is_birthday, {
                    hash: {},
                    inverse: b.noop,
                    fn: b.program(9, c, n),
                    data: n
                }), (u || 0 === u) && (v += u), v += " ", u = e["if"].call(t, t && t.isMusicStatus, {
                    hash: {},
                    inverse: b.program(13, o, n),
                    fn: b.program(11, h, n),
                    data: n
                }), (u || 0 === u) && (v += u), v += '</span><span class="txt_v"></span></div><div class="btn_area">', u = e["if"].call(t, t && t.isStoryPlus, {
                    hash: {},
                    inverse: b.program(17, f, n),
                    fn: b.program(15, p, n),
                    data: n
                }), (u || 0 === u) && (v += u), v += "</div>"
            });
            return a.wrap = "<li>", a
        }(),
        friendRecommendLayout: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<div class="_listWrap"><div data-part="storyPlusRecommendList"></div><div data-part="storyRecommendList"></div></div><div class="nodata _noData" style="display:none"><p>' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.paragraph.noRecommend", r) : d.call(t, "t", "friend.paragraph.noRecommend", r))) + "</p></div>"
            });
            return a.wrap = '<div class="friend_wrap">', a
        }(),
        storyRecommendList: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l = "";
                    return l += '<p class="tit_fr">' + d((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.title.storyRecommendList", n) : i.call(a, "t", "friend.title.storyRecommendList", n))) + '</p><ul class="lst_friend lst_friend_v4 _list"></ul><div class="loading _loading" style="display:none">' + d((s = e.img || a && a.img, n = {
                        hash: {
                            src: "/img/loading_circle_g.gif",
                            width: "24",
                            height: "24",
                            alt: "friend.alt.loading"
                        },
                        data: t
                    }, s ? s.call(a, n) : i.call(a, "img", n))) + "</div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var r, i = e.helperMissing,
                    d = this.escapeExpression,
                    c = this;
                return r = e["if"].call(t, (r = t && t.items, null == r || r === !1 ? r : r.length), {
                    hash: {},
                    inverse: c.noop,
                    fn: c.program(1, l, n),
                    data: n
                }), r || 0 === r ? r : ""
            });
            return a.wrap = "<div>", a
        }(),
        storyPlusRecommendList: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l = "";
                    return l += '<p class="tit_fr">' + d((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.title.storyPlusRecommendList", n) : i.call(a, "t", "friend.title.storyPlusRecommendList", n))) + '</p><ul class="lst_friend lst_friend_v4 _list"></ul>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var r, i = e.helperMissing,
                    d = this.escapeExpression,
                    c = this;
                return r = e["if"].call(t, (r = t && t.items, null == r || r === !1 ? r : r.length), {
                    hash: {},
                    inverse: c.noop,
                    fn: c.program(1, l, n),
                    data: n
                }), r || 0 === r ? r : ""
            });
            return a.wrap = "<div>", a
        }(),
        storyPlusRecommendItem: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + u((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_image_url,
                            size: "100"
                        },
                        data: t
                    }, n ? n.call(a, l) : f.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === m ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += u(s) + '"> '
                }
                function r(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === m ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += u(s) + " "
                }
                function i(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.recommend_type_msg) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.recommend_type_msg, s = typeof n === m ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += u(s) + " "
                }
                function d(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === m ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += u(s) + " "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var c, h, o, p = "",
                    f = e.helperMissing,
                    u = this.escapeExpression,
                    m = "function",
                    v = this;
                return p += '<div class="pf"><a href="/', (h = e.urlKey) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.urlKey, c = typeof h === m ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), p += u(c) + '" data-kant-id="263">', c = e["if"].call(t, t && t.profile_image_url, {
                    hash: {},
                    inverse: v.program(3, r, n),
                    fn: v.program(1, l, n),
                    data: n
                }), (c || 0 === c) && (p += c), p += '</a></div><div class="txt"><span class="in"><a href="/', (h = e.urlKey) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.urlKey, c = typeof h === m ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), p += u(c) + '" class="_profileName" data-kant-id="264">', (h = e.display_name) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.display_name, c = typeof h === m ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), p += u(c) + "</a> <span>", c = e["if"].call(t, t && t.recommend_type_msg, {
                    hash: {},
                    inverse: v.program(7, d, n),
                    fn: v.program(5, i, n),
                    data: n
                }), (c || 0 === c) && (p += c), p += '</span></span><span class="txt_v"></span></div><div class="btn_area"><button class="btn_com btn_or w68 _follow" data-kant-id="265"><span>' + u((h = e.t || t && t.t, o = {
                    hash: {},
                    data: n
                }, h ? h.call(t, "friend.btn.follow", o) : f.call(t, "t", "friend.btn.follow", o))) + "</span></button></div>"
            });
            return a.wrap = "<li>", a
        }(),
        storyRecommendItem: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + _((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_image_url,
                            size: "100"
                        },
                        data: t
                    }, n ? n.call(a, l) : v.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += _(s) + '"> '
                }
                function r(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += _(s) + " "
                }
                function i(a, t) {
                    var s, n, l = "";
                    return l += " <span>", (n = e.recommend_type_msg) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.recommend_type_msg, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += _(s) + "</span> "
                }
                function d(a, t) {
                    var s, n = "";
                    return n += " ", s = e["if"].call(a, a && a.isMusicStatus, {
                        hash: {},
                        inverse: y.program(10, h, t),
                        fn: y.program(8, c, t),
                        data: t
                    }), (s || 0 === s) && (n += s), n += " "
                }
                function c(a, t) {
                    var s, n, l, r = "";
                    return r += ' <span class="music"><a href="#" class="_playMusic" data-kant-id="268"><span class="bn_music">' + _((n = e.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "friend.alt.music", l) : v.call(a, "t", "friend.alt.music", l))) + "</span>", (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += _(s) + "</a></span> "
                }
                function h(a, t) {
                    var s, n, l = "";
                    return l += " <span>", (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += _(s) + "</span> "
                }
                function o(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com ing w68 _inviting" data-kant-id="270">' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.inviting", n) : v.call(a, "t", "friend.btn.inviting", n))) + '</button> <button class="btn_com ing w68 _cancel" style="display:none" data-kant-id="270">' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.cancel", n) : v.call(a, "t", "friend.btn.cancel", n))) + "</button> "
                }
                function p(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_wh _ignore" data-kant-id="271"><span>' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.ignore", n) : v.call(a, "t", "friend.btn.ignore", n))) + '</span></button> <button class="btn_com btn_or w68 _invite" data-kant-id="272"><span>' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.invite", n) : v.call(a, "t", "friend.btn.invite", n))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var f, u, m = "",
                    v = e.helperMissing,
                    _ = this.escapeExpression,
                    g = "function",
                    y = this;
                return m += '<div class="pf"><a href="/', (u = e.urlKey) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.urlKey, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" data-profile-popup="', (u = e.user_id) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.user_id, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" data-kant-id="266">', f = e["if"].call(t, t && t.profile_image_url, {
                    hash: {},
                    inverse: y.program(3, r, n),
                    fn: y.program(1, l, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += '</a></div><div class="txt"><span class="in"><a href="/', (u = e.urlKey) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.urlKey, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" class="_profileName" data-profile-popup="', (u = e.user_id) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.user_id, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" data-kant-id="267">', (u = e.display_name) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.display_name, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + "</a> ", f = e["if"].call(t, t && t.recommend_type_msg, {
                    hash: {},
                    inverse: y.program(7, d, n),
                    fn: y.program(5, i, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += '</span><span class="txt_v"></span></div><div class="btn_area">', f = e["if"].call(t, t && t.sent, {
                    hash: {},
                    inverse: y.program(14, p, n),
                    fn: y.program(12, o, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += "</div>"
            });
            return a.wrap = "<li>", a
        }(),
        friendRequestsLayout: function() {
            var a = t(function(a, t, e, s, n) {
                function l() {
                    return '<div data-part="receivedList"></div><div data-part="sentList"></div>'
                }
                function r(a, t) {
                    var s, n, l = "";
                    return l += '<div class="nodata"><p>' + c((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.paragraph.noRequests", n) : d.call(a, "t", "friend.paragraph.noRequests", n))) + "</p></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var i, d = e.helperMissing,
                    c = this.escapeExpression,
                    h = this;
                return i = e["if"].call(t, t && t.total, {
                    hash: {},
                    inverse: h.program(3, r, n),
                    fn: h.program(1, l, n),
                    data: n
                }), i || 0 === i ? i : ""
            });
            return a.wrap = '<div class="friend_wrap">', a
        }(),
        invitationList: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l, r = "";
                    return r += '<p class="tit_fr">', (n = e.title) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.title, s = typeof n === i ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += d(s) + ' <em class="_count">' + d((n = e.numberFormat || a && a.numberFormat, l = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, (s = a && a.items, null == s || s === !1 ? s : s.length), l) : c.call(a, "numberFormat", (s = a && a.items, null == s || s === !1 ? s : s.length), l))) + '</em></p><ul class="lst_friend lst_friend_v4 _list"></ul>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var r, i = "function",
                    d = this.escapeExpression,
                    c = e.helperMissing,
                    h = this;
                return r = e["if"].call(t, (r = t && t.items, null == r || r === !1 ? r : r.length), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(1, l, n),
                    data: n
                }), r || 0 === r ? r : ""
            });
            return a.wrap = "<div>", a
        }(),
        invitationItem: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + f((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "100"
                        },
                        data: t
                    }, n ? n.call(a, l) : p.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === u ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += f(s) + '"> '
                }
                function r(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === u ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += f(s) + " "
                }
                function i(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_wh w68 _cancel" data-kant-id="275"><span>' + f((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.cancel", n) : p.call(a, "t", "friend.btn.cancel", n))) + "</span></button> "
                }
                function d(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_wh _ignore" data-kant-id="276"><span>' + f((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.ignore", n) : p.call(a, "t", "friend.btn.ignore", n))) + '</span></button> <button class="btn_com btn_or _accept" data-kant-id="277"><span>' + f((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.accept", n) : p.call(a, "t", "friend.btn.accept", n))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var c, h, o = "",
                    p = e.helperMissing,
                    f = this.escapeExpression,
                    u = "function",
                    m = this;
                return o += '<div class="pf"><a href="/', (h = e.urlKey) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.urlKey, c = typeof h === u ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), o += f(c) + '" data-profile-popup="', (h = e.user_id) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.user_id, c = typeof h === u ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), o += f(c) + '" data-kant-id="273">', c = e["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: m.program(3, r, n),
                    fn: m.program(1, l, n),
                    data: n
                }), (c || 0 === c) && (o += c), o += '</a></div><div class="txt"><span class="in"><a href="/', (h = e.urlKey) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.urlKey, c = typeof h === u ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), o += f(c) + '" class="_profileName" data-profile-popup="', (h = e.user_id) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.user_id, c = typeof h === u ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), o += f(c) + '" data-kant-id="274">', (h = e.display_name) ? c = h.call(t, {
                    hash: {},
                    data: n
                }) : (h = t && t.display_name, c = typeof h === u ? h.call(t, {
                    hash: {},
                    data: n
                }) : h), o += f(c) + '</a></span><span class="txt_v"></span></div><div class="btn_area">', c = e["if"].call(t, t && t.isSent, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(5, i, n),
                    data: n
                }), (c || 0 === c) && (o += c), o += " ", c = e["if"].call(t, t && t.isReceived, {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(7, d, n),
                    data: n
                }), (c || 0 === c) && (o += c), o += "</div>"
            });
            return a.wrap = "<li>", a
        }(),
        suggestionList: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n = "";
                    return n += " ", s = e["if"].call(a, a && a.total, {
                        hash: {},
                        inverse: o.noop,
                        fn: o.program(2, r, t),
                        data: t
                    }), (s || 0 === s) && (n += s), n += " ", s = e["if"].call(a, a && a.isIdPattern, {
                        hash: {},
                        inverse: o.noop,
                        fn: o.program(5, d, t),
                        data: t
                    }), (s || 0 === s) && (n += s), n += " "
                }
                function r(a, t) {
                    var s, n, l, r = "";
                    return r += '<h1 class="tit_fr">' + f((n = e.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "friend.title.suggestionList", l) : p.call(a, "t", "friend.title.suggestionList", l))) + '</h1><ul class="lst_friend lst_friend_v3">', s = e.each.call(a, a && a.people, {
                        hash: {},
                        inverse: o.noop,
                        fn: o.program(3, i, t),
                        data: t
                    }), (s || 0 === s) && (r += s), r += " ", s = e.each.call(a, a && a.storyPlus, {
                        hash: {},
                        inverse: o.noop,
                        fn: o.program(3, i, t),
                        data: t
                    }), (s || 0 === s) && (r += s), r += "</ul>"
                }
                function i(a, t) {
                    var n, l = "";
                    return l += " ", n = o.invokePartial(s.searchResultItem, "searchResultItem", a, e, s, t), (n || 0 === n) && (l += n), l += " "
                }
                function d(a, t) {
                    var s, n, l = "";
                    return l += '<div><h1 class="tit_fr">' + f((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.title.idSearch", n) : p.call(a, "t", "friend.title.idSearch", n))) + '</h1><div class="_idSearchResult"><ul class="lst_friend lst_friend_v3"><li class="nodata"><a href="#" class="_searchId" data-kant-id="278"><span class="ico_search"></span>' + f((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.searchId", n) : p.call(a, "t", "friend.btn.searchId", n))) + "</a></li></ul></div></div>"
                }
                function c(a, t) {
                    var s, n, l = "";
                    return l += '<div class="nodata"><p>' + f((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.paragraph.noSearchResult", n) : p.call(a, "t", "friend.paragraph.noSearchResult", n))) + "</p></div>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = this.merge(s, a.partials), n = n || {};
                var h, o = this,
                    p = e.helperMissing,
                    f = this.escapeExpression;
                return h = e["if"].call(t, t && t.hasResult, {
                    hash: {},
                    inverse: o.program(7, c, n),
                    fn: o.program(1, l, n),
                    data: n
                }), h || 0 === h ? h : ""
            });
            return a.wrap = '<div class="friend_wrap" style="display:none;">', a
        }(),
        searchResultItem: function() {
            var a = t(function(a, t, e, s, n) {
                function l() {
                    return "t:unfollowing"
                }
                function r(a, t) {
                    var s;
                    return s = e["if"].call(a, a && a.isStoryPlus, {
                        hash: {},
                        inverse: u.program(6, d, t),
                        fn: u.program(4, i, t),
                        data: t
                    }), s || 0 === s ? s : ""
                }
                function i() {
                    return "t:following"
                }
                function d() {
                    return "t:friend"
                }
                function c(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + v((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "56"
                        },
                        data: t
                    }, n ? n.call(a, l) : m.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === _ ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += v(s) + '"> '
                }
                function h(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === _ ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += v(s) + " "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var o, p, f = "",
                    u = this,
                    m = e.helperMissing,
                    v = this.escapeExpression,
                    _ = "function";
                return f += '<div class="pf"><a href="/', (p = e.urlKey) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.urlKey, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" data-profile-popup="', (p = e.id) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.id, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" data-kant-id="279" data-kant-option="', o = e["if"].call(t, t && t.isSearchItem, {
                    hash: {},
                    inverse: u.program(3, r, n),
                    fn: u.program(1, l, n),
                    data: n
                }), (o || 0 === o) && (f += o), f += '">', o = e["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: u.program(10, h, n),
                    fn: u.program(8, c, n),
                    data: n
                }), (o || 0 === o) && (f += o), f += '</a></div><div class="txt"><span class="in"><a href="/', (p = e.urlKey) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.urlKey, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" class="_profileName" data-profile-popup="', (p = e.id) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.id, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '" data-kant-id="280" data-kant-option="', o = e["if"].call(t, t && t.isSearchItem, {
                    hash: {},
                    inverse: u.program(3, r, n),
                    fn: u.program(1, l, n),
                    data: n
                }), (o || 0 === o) && (f += o), f += '">', (p = e.display_name) ? o = p.call(t, {
                    hash: {},
                    data: n
                }) : (p = t && t.display_name, o = typeof p === _ ? p.call(t, {
                    hash: {},
                    data: n
                }) : p), f += v(o) + '</a></span><span class="txt_v"></span></div>'
            });
            return a.wrap = "<li>", a
        }(),
        idFound: function() {
            var a = t(function(a, t, e, s, n) {
                function l(a, t) {
                    var s, n, l, r = "";
                    return r += ' <img src="' + _((n = e.profileImage || a && a.profileImage, l = {
                        hash: {
                            url: a && a.profile_thumbnail_url,
                            size: "100"
                        },
                        data: t
                    }, n ? n.call(a, l) : v.call(a, "profileImage", l))) + '" class="_profileImage" alt="', (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += _(s) + '"> '
                }
                function r(a, t) {
                    var s, n, l = "";
                    return l += " ", (n = e.display_name) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.display_name, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += _(s) + " "
                }
                function i(a, t) {
                    var s, n, l = "";
                    return l += ' <span class="ic_birthday">' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.alt.birthday", n) : v.call(a, "t", "friend.alt.birthday", n))) + "</span> "
                }
                function d(a, t) {
                    var s, n, l, r = "";
                    return r += ' <span class="music"><a href="#" class="_playMusic" data-kant-id="283"><span class="bn_music">' + _((n = e.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "friend.alt.music", l) : v.call(a, "t", "friend.alt.music", l))) + "</span>", (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), r += _(s) + "</a></span> "
                }
                function c(a, t) {
                    var s, n, l = "";
                    return l += ' <span class="txt_desc">', (n = e.statusMessage) ? s = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.statusMessage, s = typeof n === g ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), l += _(s) + "</span> "
                }
                function h(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_or fr _invite" data-kant-id="284"><span>' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.invite", n) : v.call(a, "t", "friend.btn.invite", n))) + "</span></button> "
                }
                function o(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com ing w68 _inviting" data-kant-id="285">' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.inviting", n) : v.call(a, "t", "friend.btn.inviting", n))) + '</button> <button class="btn_com ing w68 _cancel" style="display:none" data-kant-id="285">' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.cancel", n) : v.call(a, "t", "friend.btn.cancel", n))) + "</button> "
                }
                function p(a, t) {
                    var s, n, l = "";
                    return l += ' <button class="btn_com btn_wh _ignore" data-kant-id="287"><span>' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.ignore", n) : v.call(a, "t", "friend.btn.ignore", n))) + '</span></button> <button class="btn_com btn_or _accept" data-kant-id="288"><span>' + _((s = e.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "friend.btn.accept", n) : v.call(a, "t", "friend.btn.accept", n))) + "</span></button> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var f, u, m = "",
                    v = e.helperMissing,
                    _ = this.escapeExpression,
                    g = "function",
                    y = this;
                return m += '<li><div class="pf"><a href="/', (u = e.urlKey) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.urlKey, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" data-profile-popup="', (u = e.id) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.id, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" data-kant-id="281">', f = e["if"].call(t, t && t.profile_thumbnail_url, {
                    hash: {},
                    inverse: y.program(3, r, n),
                    fn: y.program(1, l, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += '</a></div><div class="txt"><span class="in"><a href="/', (u = e.urlKey) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.urlKey, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" class="_profileName" data-profile-popup="', (u = e.id) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.id, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + '" data-kant-id="282">', (u = e.display_name) ? f = u.call(t, {
                    hash: {},
                    data: n
                }) : (u = t && t.display_name, f = typeof u === g ? u.call(t, {
                    hash: {},
                    data: n
                }) : u), m += _(f) + "</a> ", f = e["if"].call(t, t && t.is_birthday, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(5, i, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += " ", f = e["if"].call(t, t && t.isMusicStatus, {
                    hash: {},
                    inverse: y.program(9, c, n),
                    fn: y.program(7, d, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += '</span><span class="txt_v"></span></div><div class="btn_area">', f = e["if"].call(t, t && t.canAddFriend, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(11, h, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += " ", f = e["if"].call(t, t && t.isRequestSent, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(13, o, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += " ", f = e["if"].call(t, t && t.isRequestReceived, {
                    hash: {},
                    inverse: y.noop,
                    fn: y.program(15, p, n),
                    data: n
                }), (f || 0 === f) && (m += f), m += "</div></li>"
            });
            return a.wrap = '<ul class="lst_friend lst_friend_v4">', a
        }(),
        idNotFound: function() {
            var a = t(function(a, t, e, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), n = n || {};
                var l, r, i = "",
                    d = e.helperMissing,
                    c = this.escapeExpression;
                return i += '<ul class="lst_friend lst_friend_v3"><li class="nodata">' + c((l = e.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, l ? l.call(t, "friend.paragraph.noIdSearchResult", r) : d.call(t, "t", "friend.paragraph.noIdSearchResult", r))) + "</li></ul>"
            });
            return a
        }()
    }
});
define("model/HashtagActivities", ["model/Activities"], function(t) {
    var e = t.extend({
        type: t.TYPE.HASHTAG,
        parent: null,
        fetch: function() {
            return this.parent.fetch.apply(this.parent, arguments)
        }
    });
    return e
});
define("model/Hashtags", ["common/api", "model/HashtagActivities"], function(t, e) {
    var i = {
        TEXT: "",
        IMAGE: "image"
    }, s = space.Model.extend({
        url: "/hashtags",
        defaults: {
            feeds: e,
            tag: "",
            activityId: "",
            type: ""
        },
        fetch: function() {
            var e = null,
                i = this,
                s = this.get("feeds");
            return s ? (s.length && (e = _.last(s.models).get("id")), s.isEnd() ? Q.resolve() : t.request({
                url: _.result(this, "url"),
                type: "GET",
                data: {
                    tag: this.get("tag"),
                    id: this.get("activityId"),
                    type: this.get("type"),
                    since: e
                },
                extraData: !0
            }).then(function(t) {
                return i.get("feeds").addActivities(t), t
            })) : Q.resolve()
        }
    });
    return s.TYPE = i, s
});
define("model/Suggestion", ["common/api", "common/util", "model/me", "model/Profile", "model/Hashtags"], function(t, e, s, n, r) {
    var i = "#",
        o = {
            PUBLIC: 0,
            ALL: 1
        }, a = n.extend({
            virtuals: _.defaults({
                isSearchItem: function() {
                    return !0
                }
            }, n.prototype.virtuals)
        }),
        u = space.Model.extend({
            url: {
                suggestion: "/search/suggestions",
                idSearch: "/profiles/search"
            },
            PERMISSION: o,
            DEFAULT_TOTAL_COUNT: 20,
            RATIO_PEOPLE: .5,
            RATIO_STORY_PLUS: .3,
            SEARCH_RESPONSE_CACHE_TIMEOUT: 6e5,
            isIdSearchCountable: !0,
            includeHashtag: !1,
            defaults: {
                query: "",
                total: 0,
                storyPlus: null,
                people: null,
                hashtags: null
            },
            virtuals: {
                isIdPattern: function() {
                    return this.isAllPermission() && e.isValidStoryId(this.get("query"))
                },
                hasResult: function() {
                    return this.get("isIdPattern") || this.get("total") > 0
                },
                isHashtagSearch: function() {
                    return this.get("query").charAt(0) === i
                }
            },
            initialize: function() {
                this._maxTotalCount = 0, this._permission = o.PUBLIC, this.setMaxTotalCount(this.DEFAULT_TOTAL_COUNT)
            },
            search: function(t) {
                var s = this;
                return Q.all([this._searchPeople(t), this._searchStoryPlusAndHashtags(t)]).spread(function(n, r) {
                    var i = r.storyPlus,
                        o = r.hashtags,
                        a = s._calculateProperCount(n.length, i.length, o.length, Number(e.isValidStoryId(t)));
                    n = _.first(n, a.people), i = _.first(i, a.storyPlus), o = _.first(o, a.hashtags), s.clear({
                        silent: !0
                    }), s.set({
                        query: t,
                        total: i.length + n.length + o.length,
                        storyPlus: s._arrayToCollection(i),
                        people: s._arrayToCollection(n),
                        hashtags: s._arrayToCollection(o)
                    })
                })
            },
            _searchPeople: function(t) {
                return this.isAllPermission() ? s.get("friends").getPeopleInFriends(t) : []
            },
            _searchStoryPlusAndHashtags: function(t) {
                return Q.all([this._searchStoryPlusInFriends(t), this._requestStoryPlusAndHashtags(t)]).spread(function(t, e) {
                    var s = e.storyPlus,
                        n = _.flatten([t, s], !0);
                    return e.storyPlus = _.uniq(n, function(t) {
                        return t.get("id")
                    }), e
                })
            },
            _searchStoryPlusInFriends: function(t) {
                return this.isAllPermission() ? s.get("friends").getStoryPlusInFriends(t) : []
            },
            _requestStoryPlusAndHashtags: function(e) {
                return t.request({
                    url: this.url.suggestion,
                    type: "GET",
                    data: {
                        q: e,
                        profile: !0,
                        hashtag: this.includeHashtag
                    },
                    responseCacheTimeout: this.SEARCH_RESPONSE_CACHE_TIMEOUT
                }).then(function(t) {
                    return {
                        storyPlus: _.map(t.profiles, function(t) {
                            return new a(t)
                        }),
                        hashtags: _.map(t.hashtags, function(t) {
                            return new r({
                                tag: t
                            })
                        })
                    }
                })
            },
            _arrayToCollection: function(t) {
                return new(space.Collection.extend({
                    model: n
                }))(t)
            },
            searchId: function() {
                return t.request({
                    url: this.url.idSearch,
                    type: "GET",
                    data: {
                        profile_uri: this.get("query")
                    }
                }).then(function(t) {
                    return new n(t.profile)
                })
            },
            _calculateProperCount: function(t, e, s, n) {
                var r, i, o, a, u, l, h, c, _, P = this._maxTotalCount;
                return this.isIdSearchCountable && (P -= n), r = Math.round(P * this.RATIO_PEOPLE), i = Math.round(P * this.RATIO_STORY_PLUS), o = P - r - i, a = Math.min(r, t), u = Math.min(i, e), l = Math.min(o, s), h = P - (a + u + l), h > 0 && (c = Math.min(h, t - a), a += c, h -= c), h > 0 && (_ = Math.min(h, e - u), u += _, h -= _), h > 0 && (l += Math.min(h, s - l)), {
                    people: a,
                    storyPlus: u,
                    hashtags: l
                }
            },
            setMaxTotalCount: function(t) {
                this._maxTotalCount = t
            },
            setPermission: function(t) {
                this._permission = t
            },
            isAllPermission: function() {
                return this._permission === o.ALL
            },
            isPublicPermission: function() {
                return this._permission === o.PUBLIC
            }
        });
    return u.PERMISSION = o, u
});
define("part/suggestion/SuggestionInputPart", ["common/util", "kant", "module/static/error"], function(e, t, r) {
    var i = 100;
    return space.Part.extend({
        model: null,
        ui: {
            query: "._query",
            queryPlaceholder: "._queryPlaceholder"
        },
        events: {
            "click ._searchBtn": function(t) {
                var r = e.trim(this.ui.query.val());
                this.search(r), t.preventDefault()
            },
            "click ._clearBtn": function(e) {
                var t = "" === this.ui.query.val();
                this.clear(), this.trigger("clear"), t && this.trigger("close"), e.preventDefault()
            },
            "focusout ._query": function() {
                var e, r = ".search";
                this._searchTry && (this._searchTry = !1, e = this.$el.closest("[data-kant-group]").attr("data-kant-group"), t.send(e + r))
            }
        },
        initialize: function() {
            this._prevQuery = "", this._searchTry = !1, this._onInputQuery = _.throttle(function() {
                var t = e.trim(this.ui.query.val());
                this._searchTry = !0, this.search(t)
            }, i)
        },
        clear: function() {
            this._prevQuery = "", this.ui.query.val("").blur(), this.isAvailableChildPart("placeholder") && this.childParts.placeholder.update()
        },
        search: function(e) {
            e !== this._prevQuery && this._search(e)
        },
        selectQuery: function() {
            var e = this;
            _.defer(function() {
                e.ui.query.select()
            })
        },
        _search: function(e) {
            var t = this;
            return this._prevQuery = e, _.isEmpty(e) ? void this.trigger("clear") : (this.trigger("searchStart", e), void this.model.search(e).then(function() {
                t.trigger("searchEnd", e)
            }).fail(function(e) {
                return 401 === e.status ? r.getHandler()(e) : void t.trigger("searchError")
            }))
        },
        searchWithPrevQuery: function() {
            this._prevQuery && this._search(this._prevQuery)
        },
        focus: function() {
            this.ui.query.focus()
        },
        onRender: function() {
            var e = this;
            agent.isIe8AndBelow() ? this.ui.query.on("propertychange", function(t) {
                "value" === t.originalEvent.propertyName && e._onInputQuery()
            }) : this.ui.query.on("input", function() {
                e._onInputQuery()
            }), this.addPart("placeholder", "part/plugin/PlaceholderPart", {
                selector: this.ui.query,
                options: {
                    placeholder: this.ui.queryPlaceholder,
                    forceActivate: !0
                }
            })
        },
        extendData: function() {
            return {
                isAllPermission: this.model.isAllPermission(),
                isMobile: agent.type.is.mobile
            }
        },
        onStop: function() {
            this.ui.query.off(agent.isIe8AndBelow() ? "propertychange" : "input")
        }
    })
});
define("part/suggestion/SuggestionListPart", ["common/imgUtil", "common/ellipsis"], function(e, t) {
    return space.Part.extend({
        PROFILE_NAME_WIDTH: 0,
        model: null,
        ui: {
            idSearchResult: "._idSearchResult"
        },
        modelEvents: {
            change: "render"
        },
        events: {
            "click ._searchId": function(e) {
                e.preventDefault(), this.searchId()
            }
        },
        onRender: function() {
            this.childParts.searchedProfile && this.removePart("searchedProfile"), this._resizeProfileImages()
        },
        onDomReady: function() {
            this._putEllipsisToProfileName()
        },
        searchId: function() {
            var e = this;
            this.model.searchId().then(function(t) {
                e._updateIdSearchResult(t)
            }).fail(function() {
                e._updateIdSearchResult()
            })
        },
        _updateIdSearchResult: function(e) {
            var t = this.getIdSearchResultTemplate();
            e ? this.addPart("searchedProfile", "part/profile/ProfilePart", {
                selector: this.ui.idSearchResult,
                options: {
                    model: e,
                    template: t.idFound,
                    PROFILE_NAME_WIDTH: this.ID_SEARCH_PROFILE_NAME_WIDTH
                }
            }).next(function() {
                this.onIdFound()
            }) : this.ui.idSearchResult.replaceWith(t.idNotFound())
        },
        _resizeProfileImages: function() {
            var t, i = this.$el.find("._profileImage");
            _.each(i, function(i) {
                t = $(i), e.resize(t, t.parent())
            })
        },
        _putEllipsisToProfileName: function() {
            var e, i = this;
            this.PROFILE_NAME_WIDTH && (e = this.$el.find("._profileName"), _.each(e, function(e) {
                t.byWidth($(e), {
                    width: i.PROFILE_NAME_WIDTH
                })
            }))
        },
        getIdSearchResultTemplate: function() {
            throw new Error("아이디 검색 결과의 템플릿이 필요합니다.")
        },
        hide: function() {
            this.$el.hide().empty()
        },
        extendData: function() {
            var e = this.model.get("people"),
                t = this.model.get("storyPlus"),
                i = this.model.get("hashtags"),
                o = {};
            return e && (o.people = e.toData()), t && (o.storyPlus = t.toData()), i && (o.hashtags = i.toData()), o
        },
        onIdFound: function() {}
    })
});
define("module/myStory/friends", ["template/myStoryFriend", "model/Suggestion", "model/me", "part/suggestion/SuggestionInputPart", "part/suggestion/SuggestionListPart", "common/kantUtil", "module/static/toastPopup"], function(t, e, s, i, n, r, o) {
    return new(space.Module.extend({
        name: "myStoryFriends",
        keepAlive: !0,
        template: t.layout,
        childParts: {
            menu: "part/myStory/friend/FriendMenuPart",
            suggestionInput: i.extend({
                template: t.suggestionInput
            }),
            suggestionList: n.extend({
                PROFILE_NAME_WIDTH: 160,
                ID_SEARCH_PROFILE_NAME_WIDTH: 220,
                template: t.suggestionList,
                getIdSearchResultTemplate: function() {
                    return {
                        idFound: t.idFound,
                        idNotFound: t.idNotFound
                    }
                }
            })
        },
        onSetup: function() {
            var t = new(e.extend({
                isIdSearchCountable: !1
            }));
            s.isRegistered() && t.setPermission(e.PERMISSION.ALL), this.listenTo(this.childParts.suggestionInput, {
                searchEnd: function() {
                    this.childParts.list.hide(), this.childParts.suggestionList.show()
                },
                searchError: function() {
                    o.isShown() || o.show(o.TYPE.SEARCH_FAIL)
                },
                clear: function() {
                    this.childParts.list.show(), this.childParts.suggestionList.hide()
                }
            }), this.childParts.suggestionInput.model = t, this.childParts.suggestionList.model = t
        },
        onRoute: function() {
            var t = _.last(space.Router.getPath().split("/"));
            switch (this.removePart("list"), t) {
                case "friends":
                    this.addPart("list", "part/myStory/friend/FriendListPart"), r.sendPageView("my.05.01");
                    break;
                case "recommend":
                    this.addPart("list", "part/myStory/friend/FriendRecommendPart"), r.sendPageView("my.05.02");
                    break;
                case "requests":
                    this.addPart("list", "part/myStory/friend/FriendRequestsPart"), r.sendPageView("my.05.03")
            }
            this.childParts.suggestionInput.clear(), this.childParts.suggestionList.hide(), document.title = intl.t("title.myStory", {
                name: s.get("display_name")
            })
        }
    }))
});
define("model/SectionActivities", ["model/Activities", "model/Profile", "model/me", "model/Activity", "common/api"], function(t, e, i, o, n) {
    var s = space.Model.extend({
        TYPE: {
            VIDEOS: "videos",
            PHOTOS: "photos",
            MUSIC: "music"
        },
        url: function() {
            return "/profiles/" + this.get("id") + "/sections/" + this.get("type")
        },
        defaults: {
            count: 0,
            profile: e,
            relationship: null,
            type: null,
            activities: t,
            loadedMediaCount: 0
        },
        isMine: function() {
            return this.get("id") === i.get("id")
        },
        parse: function(t) {
            var e = this.get("loadedMediaCount");
            return t.activities = this.get("activities").filterSupportedFeedType(t.activities, !0), _.each(t.activities, function(t) {
                e += t.media ? t.media.length : 0
            }), {
                count: t.section_info.count,
                relationship: t.section_info.relationship,
                type: t.section_info.type,
                activities: t.activities,
                loadedMediaCount: e
            }
        },
        fetch: function() {
            var t = null,
                e = this,
                i = this.get("activities");
            return i && i.length && (t = _.last(i.models).get("id"), this.get("count") === this.get("loadedMediaCount")) ? Q.resolve() : n.request({
                url: _.result(this, "url"),
                type: "GET",
                data: {
                    since: t
                }
            }).then(function(t) {
                return e.set(e.parse(t)), t
            })
        }
    });
    return s.TYPE = s.prototype.TYPE, s.getTypeByActivity = function(t) {
        return t.get("verb") !== t.VERB.POST ? "" : t.get("media_type") === t.MEDIA_TYPE.IMAGE ? s.TYPE.PHOTOS : t.get("media_type") === t.MEDIA_TYPE.VIDEO ? s.TYPE.VIDEOS : t.get("object") && t.get("object").object_type === t.OBJECT_TYPE.MUSIC ? s.TYPE.MUSIC : void 0
    }, s
});
define("module/myStory/mainProfile", ["template/myStory", "model/Profiles", "model/SectionActivities", "model/me", "module/static/mediaView", "module/static/writingView", "module/static/report", "module/static/dialog", "module/static/error", "module/static/cover", "part/writing/WritingPart", "common/musicPlayer", "common/util", "common/imgUtil", "common/domUtil", "common/urlKey", "common/profileImage"], function(t, e, i, n, s, o, r, l, a, u, h, d, c, g, f, m, b) {
    var p = /[\+\,]+/g,
        y = 110,
        v = 350,
        F = 124,
        P = 10,
        w = space.Part.extend({
            template: t.statusArea,
            model: null,
            onSetup: function() {
                var t = this.model.get("profile");
                this.listenTo(t, {
                    "change:birthday": this.render,
                    "change:birth_type": this.render,
                    "change:display_name": this.render,
                    "change:status_objects": this.render
                })
            },
            extendData: function() {
                var t = this.model.get("profile");
                return {
                    hasTextMessage: !t.get("isMusicStatus") && t.get("statusMessage")
                }
            }
        });
    return new(space.Module.extend({
        name: "myStoryMainProfile",
        template: t.layout,
        keepAlive: !0,
        childParts: {
            status: w
        },
        model: null,
        ui: {
            btnEditProfile: "._btnEditProfile",
            btnEditProfileImage: "._btnEditProfileImage",
            btnEditBgImage: "._btnEditBgImage",
            btnFriend: "._btnFriend",
            btnActionLayer: "._btnActionLayer",
            btnRequestFriend: "._btnRequestFriend",
            btnRequestingFriend: "._btnRequestingFriend",
            btnFollowStoryPlus: "._btnFollowStoryPlus",
            btnFollowingStoryPlus: "._btnFollowingStoryPlus",
            btnUnfollowStoryPlus: "._btnUnfollowStoryPlus",
            btnCancelRequestingFriend: "._btnCancelRequestingFriend",
            btnFavoriteFriend: "._btnFavoriteFriend",
            btnAcceptFriend: "._btnAcceptFriend",
            friendButtons: "._friendButtons",
            profileImage: "._profileImage",
            bgImage: "._bgImage",
            nameHolder: "._nameHolder",
            birthdayHolder: "._birthdayHolder",
            bgImageBlurred: "._bgImageBlurred",
            tabMenu: "._myStoryTabMenu",
            tabMenuItems: "._myStoryTabItem",
            scrollDummy: "._scrollDummy",
            favoriteSpan: "._favoriteSpan",
            btnFavorite: "._btnFavorite",
            requestingArea: "._requestingArea",
            activityCount: "._activityCount",
            photoCount: "._photoCount",
            videoCount: "._videoCount",
            musicCount: "._musicCount",
            friendsCount: "._friendsCount"
        },
        styles: {
            scrollDown: "scroll_down",
            showLayer: "on",
            activateBtn: "on",
            checked: "checked",
            disabledCursor: "dis_cursor"
        },
        initialize: function() {
            this._$window = $(window), this._currentProfileId = null, this._isTabMenuVisibility = !0, this._isProfileEdit = !1, this._isScrollFrozen = !1
        },
        onSetup: function(t) {
            var e = m.profile.urlKeyToId(t);
            return e = e || n.get("id"), this.listenTo(u, {
                scrollFrozen: this._scrollFrozen,
                scrollReleased: this._scrollReleased
            }), this.listenTo(l, {
                scrollFrozen: this._scrollFrozen,
                scrollReleased: this._scrollReleased
            }), this.listenTo(o, "post", function(t) {
                this.changeActivityCount(1, t)
            }), this._fetchData(e)
        },
        onStop: function() {
            this._currentProfileId = null
        },
        onRoute: function(t, e) {
            var i = e[0],
                s = m.profile.urlKeyToId(i);
            return s = s || n.get("id"), this.ui.tabMenuItems && (this.ui.tabMenuItems.removeClass(this.styles.activateBtn), this.ui.tabMenuItems.filter('[data-resolver="' + t + '"]').addClass(this.styles.activateBtn)), this.flow.forkWith(this._fetchData(s)).next(function() {
                this._isTabMenuVisibility = this._getTabMenuVisibility(t), this._isProfileEdit = this._isProfileEditMenu(t), this._setVisibilityTabMenu(), this._setScrollStyle(), this._setVisibilityProfileEditButtons(), self._isProfileEdit && !agent.type.is.mobile && f.scrollTo(y), "myStory/profilePhoto" === t && this._showProfilePhoto(!0)
            })
        },
        _fetchData: function(t) {
            var i = this._currentProfileId,
                n = this;
            return this._currentProfileId !== t ? (this._currentProfileId = t, this.model = new e({
                id: t
            }), this.hasChildPart("status") && (this.childParts.status.model = this.model), this._fetchProfileData(t).then(function() {
                null !== i && n.render(), o.setIsMyStoryOfMe(n.model.get("profile").get("isMe"))
            }).fail(a.getHandler({
                page: {
                    404: a.PAGE.NOT_FOUND_MEMBER,
                    "*": a.PAGE.NOT_FOUND
                }
            }))) : Q.resolve()
        },
        extendData: function() {
            var t, e = this.model.get("profile"),
                i = "";
            return e.get("isStoryPlus") ? t = "prf.s" : e.get("isMe") ? (t = "prf.m", i = "my") : (i = e.get("isFriend") ? "friend" : "other", t = "prf.o"), {
                groupId: t,
                storyType: i,
                friendCount: n.get("friends").length
            }
        },
        onRender: function() {
            this._setVisibilityActionLayer(), this._setVisibilityFriendButtons(), this._setProfileImage(), this._setBgImage(), this._setScrollStyle(), this._setVisibilityTabMenu()
        },
        onDomReady: function() {
            this._setScrollStyle(), this._setVisibilityTabMenu()
        },
        changeActivityCount: function(t, e) {
            var n, s = i.getTypeByActivity(e),
                o = t;
            switch (s) {
                case i.TYPE.PHOTOS:
                    n = this.ui.photoCount, e && e.get("media") && (o *= e.get("media").length);
                    break;
                case i.TYPE.VIDEOS:
                    n = this.ui.videoCount;
                    break;
                case i.TYPE.MUSIC:
                    n = this.ui.musicCount
            }
            this.ui.activityCount.text(c.numberFormat(parseInt(this.ui.activityCount.text().replace(p, ""), 10) + t)), n && n.text(c.numberFormat(parseInt(n.text().replace(p, ""), 10) + (s === i.TYPE.PHOTOS ? o : t)))
        },
        changeFavoriteFriendStatus: function(t) {
            var e;
            this._currentProfileId === t.get("id") && (e = t.get("is_favorite"), this.model.get("profile").set("is_favorite", e), this._changeFavoriteFriendBtnStatus(e))
        },
        _setProfileEditStyle: function() {
            this._setVisibilityProfileEditButtons()
        },
        _isProfileEditMenu: function(t) {
            return "myStory/settings" === t
        },
        _getTabMenuVisibility: function(t) {
            return "post" === t || this._isProfileEditMenu(t) || this.model.get("profile").get("isStoryPlus") ? !1 : !0
        },
        _fetchProfileData: function(t) {
            var e = this;
            return this.model.fetch().then(function() {
                var i = e.model.get("profile");
                t && i.get("isMe") && e.listenTo(n, {
                    "change:profile_thumbnail_url": function() {
                        var t = this.model.get("profile"),
                            e = n.get("profile_thumbnail_url"),
                            i = n.get("profile_image_url");
                        t.set("profile_thumbnail_url", e), t.set("profile_image_url", i), this._setProfileImage(e)
                    },
                    "change:bg_image_url": function() {
                        var t = this.model.get("profile"),
                            e = n.get("bg_image_url");
                        t.set("bg_image_url", e), this._setBgImage(e)
                    },
                    "change:birthday": function() {
                        var t = this.model.get("profile"),
                            e = n.get("birthday");
                        t.set("birthday", e)
                    },
                    "change:birth_type": function() {
                        var t = this.model.get("profile"),
                            e = n.get("birth_type");
                        t.set("birth_type", e)
                    },
                    "change:display_name": function() {
                        var t = this.model.get("profile"),
                            e = n.get("display_name");
                        t.set("display_name", e)
                    },
                    "change:status_objects": function() {
                        var t = this.model.get("profile"),
                            e = n.get("status_objects");
                        t.set("status_objects", _.clone(e)), t.trigger("change:status_objects", t)
                    }
                })
            })
        },
        _setProfileImage: function(t) {
            g.resize(this.ui.profileImage, this.ui.profileImage.parent(), {
                url: b.getUrl(t, F)
            })
        },
        _setBgImage: function(t) {
            var e = this.ui.bgImageBlurred.parent();
            g.resize(this.ui.bgImage, this.ui.bgImage.parent(), {
                url: t
            }), this.flow.forkWith(g.resize(this.ui.bgImageBlurred, e, {
                url: t
            })).next(function() {
                this.ui.bgImageBlurred.width(e.width() + P)
            })
        },
        _setScrollStyle: function() {
            var t;
            agent.type.is.mobile || (t = this._$window.scrollTop() > v, this.$el.toggleClass(this.styles.scrollDown, this._isTabMenuVisibility && t))
        },
        _scrollFrozen: function() {
            this._isScrollFrozen = !0
        },
        _scrollReleased: function() {
            this._isScrollFrozen = !1
        },
        _setVisibilityTabMenu: function() {
            this.ui.tabMenu.toggle(this._isTabMenuVisibility), this._isTabMenuVisibility ? this.ui.scrollDummy.css("display", "") : this.ui.scrollDummy.hide()
        },
        _setVisibilityProfileEditButtons: function() {
            var t = this.ui.btnEditProfile;
            t && (this._isProfileEdit ? t.addClass(this.styles.disabledCursor).addClass(this.styles.activateBtn) : t.removeClass(this.styles.disabledCursor).removeClass(this.styles.activateBtn))
        },
        _setVisibilityActionLayer: function() {
            n.isRegistered() || this.ui.btnActionLayer.hide()
        },
        _setVisibilityFriendButtons: function() {
            var t = this.model.get("profile");
            this.ui.friendButtons.hide(), agent.type.is.mobile || (t.get("isStoryPlus") ? t.get("is_favorite") ? this.ui.btnFavoriteFriend.show() : t.get("isFriend") ? this.ui.btnFollowingStoryPlus.show() : this.ui.btnFollowStoryPlus.show() : t.get("isRequestReceived") ? this.ui.btnAcceptFriend.show() : t.get("isRequestSent") ? this.ui.btnRequestingFriend.show() : t.get("canAddFriend") ? this.ui.btnRequestFriend.show() : t.get("is_favorite") ? this.ui.btnFavoriteFriend.show() : this.ui.btnFriend.show())
        },
        _changeFavoriteFriend: function() {
            var t = this.model.get("profile");
            t.get("is_favorite") ? this.flow.forkWith(t.makeUnfavorite().fail(a.getHandler())).next(function() {
                this._changeFavoriteFriendBtnStatus(!1)
            }) : this.flow.forkWith(t.makeFavorite().fail(a.getHandler())).next(function() {
                this._changeFavoriteFriendBtnStatus(!0)
            })
        },
        _changeFavoriteFriendBtnStatus: function(t) {
            var e = this.styles.activateBtn;
            this.ui.favoriteSpan.toggleClass(this.styles.checked, t), this.ui.btnFavoriteFriend.toggleClass(e, t).toggle(t), this.ui.btnFriend.toggleClass(e, !t).toggle(!t), this.ui.btnFollowingStoryPlus.toggleClass(e, !t).toggle(!t)
        },
        _showProfilePhoto: function(t) {
            var e = this.model.get("profile"),
                i = e.get("profile_image_url");
            i && (s.addImages(i), s.show(s.MODE.PROFILE, {
                profile: e,
                totalCount: 1,
                hidePagination: !0,
                skipNavigation: !! t
            }))
        },
        events: {
            "click ._btnViewProfileImage": function(t) {
                t.preventDefault(), this._showProfilePhoto()
            },
            "click ._btnEditProfileImage": function(t) {
                t.preventDefault(), this.addPart("profileImageLayer", "part/myStory/EditingImagePart", {
                    options: {
                        model: this.model,
                        exceptionClass: "_btnEditProfileImage"
                    },
                    listeners: {
                        show: function() {
                            var t = this.model.get("profile").get("profile_image_url");
                            this.ui.btnEditProfileImage.addClass(this.styles.showLayer), this.childParts.profileImageLayer.toggleDelete( !! t)
                        },
                        hide: function() {
                            this.ui.btnEditProfileImage.removeClass(this.styles.showLayer)
                        },
                        upload: function(t) {
                            n.updateProfileImage(t)
                        },
                        select: function(t, e) {
                            n.updateProfileImageFromAlbum(t, e)
                        },
                        "delete": function() {
                            n.deleteProfileImage()
                        }
                    }
                }).next(function() {
                    this.childParts.profileImageLayer.toggle()
                })
            },
            "click ._btnEditBgImage": function(e) {
                e.preventDefault(), this.addPart("bgImageLayer", "part/myStory/EditingImagePart", {
                    options: {
                        template: t.editBgImage,
                        model: this.model,
                        exceptionClass: "_btnEditBgImage"
                    },
                    listeners: {
                        show: function() {
                            var t = this.model.get("profile").isDefaultBgImage();
                            this.ui.btnEditBgImage.addClass(this.styles.showLayer), this.childParts.bgImageLayer.toggleDelete(!t)
                        },
                        hide: function() {
                            this.ui.btnEditBgImage.removeClass(this.styles.showLayer)
                        },
                        upload: function(t) {
                            n.updateBackgroundImage(t)
                        },
                        select: function(t, e) {
                            n.updateBackgroundImageFromAlbum(t, e)
                        },
                        "delete": function() {
                            n.deleteBackgroundImage()
                        }
                    }
                }).next(function() {
                    this.childParts.bgImageLayer.toggle()
                })
            },
            "click ._btnEditProfile": function(t) {
                t.preventDefault(), this._isProfileEdit || space.Router.navigate("/s/profile/edit")
            },
            "click ._btnActionLayer": function(t) {
                t.preventDefault(), this.addPart("actionLayer", "part/plugin/LayerPart", {
                    options: {
                        exceptionClass: "_btnActionLayer"
                    }
                }).next(function() {
                    this.childParts.actionLayer.toggle()
                })
            },
            "click ._btnFriendSetting": function(t) {
                t.preventDefault(), this.addPart("friendSetting", "part/plugin/LayerPart", {
                    options: {
                        exceptionClass: "_btnFriendSetting"
                    },
                    listeners: {
                        show: function() {
                            this.ui.btnFavoriteFriend.addClass(this.styles.activateBtn), this.ui.btnFriend.addClass(this.styles.activateBtn), this.ui.btnFollowingStoryPlus.addClass(this.styles.activateBtn)
                        },
                        hide: function() {
                            this.ui.btnFavoriteFriend.removeClass(this.styles.activateBtn), this.ui.btnFriend.removeClass(this.styles.activateBtn), this.ui.btnFollowingStoryPlus.removeClass(this.styles.activateBtn)
                        }
                    }
                }).next(function() {
                    this.childParts.friendSetting.toggle(), this.model.get("profile").get("is_favorite") && (this.ui.btnFavorite.prop("checked", !0), this.ui.favoriteSpan.addClass(this.styles.checked))
                })
            },
            "click ._btnDeleteFriend": function(t) {
                var e = this,
                    i = this.model.get("profile");
                t.preventDefault(), this.childParts.friendSetting.hide(), l.confirm(intl.t("friend.dialog.delete"), t.target).then(function() {
                    return i.deleteFriend().fail(a.getHandler())
                }).then(function() {
                    e.render()
                })
            },
            "click ._btnReportFriend": function(t) {
                t.preventDefault(), this.childParts.actionLayer.hide(), r.reportProfile(this.model.get("profile").get("id"))
            },
            "click ._btnRequestFriend": function(t) {
                var e = this.model.get("profile");
                t.preventDefault(), this.flow.forkWith(e.invite().fail(a.getHandler())).next(function() {
                    this.ui.friendButtons.hide(), this.ui.btnRequestingFriend.show().focus()
                })
            },
            "click ._btnCancelRequestingFriend": function(t) {
                var e = this,
                    i = this.model.get("profile"),
                    n = intl.t("friend.dialog.cancel");
                t.preventDefault(), l.confirm(n, t.target).then(function() {
                    return i.cancel().fail(a.getHandler())
                }).then(function() {
                    e.ui.btnCancelRequestingFriend.hide(), e.ui.btnRequestingFriend.hide(), e.ui.btnRequestFriend.show().focus()
                })
            },
            "click ._btnAcceptFriend": function(t) {
                var e = this.model.get("profile");
                t.preventDefault(), this.flow.forkWith(e.accept().fail(a.getHandler())).next(function() {
                    this.ui.btnAcceptFriend.hide(), this.ui.btnFriend.show().focus()
                })
            },
            "click ._btnFollowStoryPlus": function(t) {
                var e = this.model.get("profile");
                t.preventDefault(), this.flow.forkWith(e.follow().fail(a.getHandler())).next(function() {
                    this.ui.btnFollowStoryPlus.hide(), this.ui.btnFollowingStoryPlus.show().focus()
                })
            },
            "click ._btnUnfollowStoryPlus": function(t) {
                var e = this,
                    i = this.model.get("profile");
                t.preventDefault(), this.childParts.friendSetting.hide(), l.confirm(intl.t("friend.dialog.unfollow"), t.target).then(function() {
                    return i.unfollow().fail(a.getHandler())
                }).then(function() {
                    e.ui.btnFollowingStoryPlus.hide(), e.ui.btnFavoriteFriend.hide(), e.ui.btnFollowStoryPlus.show().focus()
                })
            },
            "click ._favoriteSpan": function(t) {
                var e = $(t.target).find("input");
                e.length && e.prop("checked", e.is(":checked") ? !1 : !0), this._changeFavoriteFriend()
            },
            "click ._btnFavorite": function() {
                this._changeFavoriteFriend()
            },
            "mouseenter ._requestingArea": function(t) {
                t.preventDefault(), this.model.get("profile").get("isRequestSent") && (this.ui.btnRequestingFriend.hide(), this.ui.btnCancelRequestingFriend.show())
            },
            "mouseleave ._requestingArea": function(t) {
                t.preventDefault(), this.model.get("profile").get("isRequestSent") && (this.ui.btnRequestingFriend.show(), this.ui.btnCancelRequestingFriend.hide())
            },
            "click ._btnRequestingFriend": function(t) {
                t.preventDefault(), this.ui.btnRequestingFriend.hide(), this.ui.btnCancelRequestingFriend.show()
            },
            "click ._btnOpenMusicPlayer": function(t) {
                t.preventDefault(), d.openByProfileId(this.model.get("profile").get("id")).fail(a.getHandler())
            },
            "click ._btnMainProfile": function(t) {
                space.Router.getPath() === this.model.get("id") && (t.preventDefault(), location.reload())
            }
        },
        windowEvents: {
            scroll: function() {
                this._isTabMenuVisibility && (this._isScrollFrozen || this._setScrollStyle())
            },
            resize: function() {
                this._setBgImage()
            }
        }
    }))
});
define("module/myStory/music", ["template/myStory", "model/Profiles", "model/SectionActivities", "module/static/error", "common/urlKey"], function(e, t, o, n, i) {
    return new(space.Module.extend({
        name: "myStoryVideos",
        template: e.contentLayout,
        childParts: {
            content: "part/myStory/MusicListPart"
        },
        onSetup: function(e) {
            var r = i.profile.urlKeyToId(e),
                l = new t({
                    id: r
                }),
                m = new o({
                    id: r,
                    profile: l.get("profile"),
                    type: o.TYPE.MUSIC
                });
            return this.childParts.content.model = m, l.fetch().then(function() {
                document.title = intl.t("title.myStory", {
                    name: l.get("profile").get("display_name")
                })
            }).fail(n.getHandler())
        }
    }))
});
define("module/myStory/photos", ["template/myStory", "model/Profiles", "model/SectionActivities", "module/static/error", "common/urlKey"], function(t, e, o, n, i) {
    return new(space.Module.extend({
        name: "myStoryPhotos",
        template: t.contentLayout,
        childParts: {
            content: "part/myStory/PhotoListPart"
        },
        onSetup: function(t) {
            var r = i.profile.urlKeyToId(t),
                l = new e({
                    id: r
                }),
                m = new o({
                    id: r,
                    profile: l.get("profile"),
                    type: o.TYPE.PHOTOS
                });
            return this.childParts.content.model = m, l.fetch().then(function() {
                document.title = intl.t("title.myStory", {
                    name: l.get("profile").get("display_name")
                })
            }).fail(n.getHandler())
        }
    }))
});
define("template/myStorySettings", ["Handlebars"], function(t) {
    var a = function(a) {
        var e = t.template(a);
        return function(t) {
            return e(t, {
                partials: l
            })
        }
    }, l = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = a(function(t, a, l, e, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {}, '<div data-part="profile"></div>'
            });
            return t.wrap = '<div data-kant-group="epf">', t
        }(),
        profile: function() {
            var t = a(function(t, a, l, e, i) {
                function s() {
                    return ' <input type="radio" id="letter" name="statusMsgType" value="text" checked="checked" class="_radioBtn"> '
                }
                function d() {
                    return ' <input type="radio" id="letter" name="statusMsgType" value="text" class="_radioBtn"> '
                }
                function r() {
                    return ' <input type="radio" id="music" name="statusMsgType" value="music" class="_musicRadioBtn _radioBtn" checked="checked"> '
                }
                function c() {
                    return ' <input type="radio" id="music" name="statusMsgType" value="music" class="_musicRadioBtn _radioBtn"> '
                }
                function n() {
                    return ' <input type="radio" id="nosetting" name="statusMsgType" value="nosetting" checked="checked" class="_radioBtn"> '
                }
                function o() {
                    return ' <input type="radio" id="nosetting" name="statusMsgType" value="nosetting" class="_radioBtn"> '
                }
                function p() {
                    return ' <input type="checkbox" class="type_chk _birthType" name="birthType" id="chk" checked="checked"> '
                }
                function u() {
                    return ' <input type="checkbox" class="type_chk _birthType" name="birthType" id="chk"> '
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {};
                var h, f, _, m = "",
                    v = l.helperMissing,
                    y = this.escapeExpression,
                    b = "function",
                    g = this;
                return m += '<div class="feed"><div class="profile_modify"><strong class="tit_page">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.title", _) : v.call(a, "t", "profile.edit.title", _))) + '</strong><ul class="my_profile"><li><div class="ui_left"><strong class="tit">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.name", _) : v.call(a, "t", "profile.edit.name", _))) + '</strong></div><div class="ui_right"><div class="user_name"><div class="fl _firstNameMarker" data-id="_firstNameMarker"><label class="first_nm" for="mainname">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.firstName", _) : v.call(a, "t", "profile.edit.firstName", _))) + '</label><input type="text" class="type_txt _text _firstName _checkModified" name="firstName" id="mainname" value="', (f = l.first_name) ? h = f.call(a, {
                    hash: {},
                    data: i
                }) : (f = a && a.first_name, h = typeof f === b ? f.call(a, {
                    hash: {},
                    data: i
                }) : f), m += y(h) + '"> <button class="ico_mark _errorIcon dis_cursor" data-kant-id="false" disabled="disabled">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.warning", _) : v.call(a, "t", "profile.alt.warning", _))) + '</button> <div class="ly_tooltip _tooltip"></div></div><div class="fr _lastNameMarker" data-id="_lastNameMarker"><label class="last_nm" for="subname">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.lastName", _) : v.call(a, "t", "profile.edit.lastName", _))) + '</label><input type="text" class="type_txt _text _lastName _checkModified" name="lastName" id="subname" value="', (f = l.last_name) ? h = f.call(a, {
                    hash: {},
                    data: i
                }) : (f = a && a.last_name, h = typeof f === b ? f.call(a, {
                    hash: {},
                    data: i
                }) : f), m += y(h) + '"> <button class="ico_mark _errorIcon dis_cursor" data-kant-id="false" disabled="disabled">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.warning", _) : v.call(a, "t", "profile.alt.warning", _))) + '</button> <div class="ly_tooltip _tooltip"></div></div></div><ul class="name_notify">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.nameGuide", _) : v.call(a, "t", "profile.edit.nameGuide", _))) + '</ul><a href="#" class="guide_detail _nameGuideBtn" data-kant-id="302"><span class="blind">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.howTo", _) : v.call(a, "t", "profile.alt.howTo", _))) + "</span>" + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.viewDetail", _) : v.call(a, "t", "profile.edit.viewDetail", _))) + '</a></div></li><li><div class="ui_left v2"><strong class="tit">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.statusText", _) : v.call(a, "t", "profile.edit.statusText", _))) + '</strong></div><div class="ui_right"><div class="set_type set_letter"><div class="radio">', h = l["if"].call(a, a && a.isTextStatus, {
                    hash: {},
                    inverse: g.program(3, d, i),
                    fn: g.program(1, s, i),
                    data: i
                }), (h || 0 === h) && (m += h), m += '<label for="letter">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.textStatus", _) : v.call(a, "t", "profile.edit.textStatus", _))) + '</label></div><div class="pr_label _dis"><label for="mytxt" class="_StatusMsgPlaceholder">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.textStatusDesc", _) : v.call(a, "t", "profile.edit.textStatusDesc", _))) + '</label><input type="text" class="type_txt _statusMsg _checkModified" id="mytxt" value="', (f = l.statusTextMsg) ? h = f.call(a, {
                    hash: {},
                    data: i
                }) : (f = a && a.statusTextMsg, h = typeof f === b ? f.call(a, {
                    hash: {},
                    data: i
                }) : f), m += y(h) + '" title="' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.inputTextStatus", _) : v.call(a, "t", "profile.alt.inputTextStatus", _))) + '" maxlength="', (f = l.statusTextMsgMaxLength) ? h = f.call(a, {
                    hash: {},
                    data: i
                }) : (f = a && a.statusTextMsgMaxLength, h = typeof f === b ? f.call(a, {
                    hash: {},
                    data: i
                }) : f), m += y(h) + '"></div><span class="num_letter"><em class="_counter">' + y((h = a && a.statusTextMsg, h = null == h || h === !1 ? h : h.length, typeof h === b ? h.apply(a) : h)) + "</em>/", (f = l.statusTextMsgMaxLength) ? h = f.call(a, {
                    hash: {},
                    data: i
                }) : (f = a && a.statusTextMsgMaxLength, h = typeof f === b ? f.call(a, {
                    hash: {},
                    data: i
                }) : f), m += y(h) + '</span></div><div class="set_type set_music"><div class="radio">', h = l["if"].call(a, a && a.isMusicStatus, {
                    hash: {},
                    inverse: g.program(7, c, i),
                    fn: g.program(5, r, i),
                    data: i
                }), (h || 0 === h) && (m += h), m += '<label for="music">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.musicStatus", _) : v.call(a, "t", "profile.edit.musicStatus", _))) + '</label></div><p class="bx_txt_music _guideMusic _musicIntro" style="display: none">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.musicStatusDesc", _) : v.call(a, "t", "profile.edit.musicStatusDesc", _))) + '</p><p class="bx_txt_music v2 _guideNoMusic _musicIntro" style="display: none">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.buyMusic", _) : v.call(a, "t", "profile.edit.buyMusic", _))) + '</p><div class="bx_music _musicIntro _selectedMusic" style="display: none"></div><div class="bx_list_music _musicSelector" style="display: none"><div data-part="musicSelector"></div></div></div><div class="set_type"><div class="radio">', h = l["if"].call(a, a && a.isNoStatus, {
                    hash: {},
                    inverse: g.program(11, o, i),
                    fn: g.program(9, n, i),
                    data: i
                }), (h || 0 === h) && (m += h), m += '<label for="nosetting">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.noStatus", _) : v.call(a, "t", "profile.edit.noStatus", _))) + '</label></div></div></div></li><li class="user_birth"><div class="ui_left"><strong class="tit">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.birthday", _) : v.call(a, "t", "profile.edit.birthday", _))) + '</strong></div><div class="ui_right"><div class="inp_box _yearMarker"><input type="text" class="type_txt _birthYear _checkModified _birth" id="y" value="' + y((h = a && a.birthday, h = null == h || h === !1 ? h : h.year, typeof h === b ? h.apply(a) : h)) + '" maxlength="4"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.warning", _) : v.call(a, "t", "profile.alt.warning", _))) + '</button> <div class="ly_tooltip _tooltip"></div></div><label for="y">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.year", _) : v.call(a, "t", "profile.edit.year", _))) + '</label><div class="inp_box _monthMarker"><input type="text" class="type_txt _birthMonth _checkModified _birth" id="m" value="' + y((h = a && a.birthday, h = null == h || h === !1 ? h : h.month, typeof h === b ? h.apply(a) : h)) + '" maxlength="2"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.warning", _) : v.call(a, "t", "profile.alt.warning", _))) + '</button> <div class="ly_tooltip _tooltip"></div></div><label for="m">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.month", _) : v.call(a, "t", "profile.edit.month", _))) + '</label><div class="inp_box _dateMarker"><input type="text" class="type_txt _birthDate _checkModified _birth" id="d" value="' + y((h = a && a.birthday, h = null == h || h === !1 ? h : h.date, typeof h === b ? h.apply(a) : h)) + '" maxlength="2"> <button class="ico_mark dis_cursor" data-kant-id="false" disabled="disabled">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.alt.warning", _) : v.call(a, "t", "profile.alt.warning", _))) + '</button> <div class="ly_tooltip _tooltip"></div></div><label for="d">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.date", _) : v.call(a, "t", "profile.edit.date", _))) + '</label><span class="chk_bx">', h = l["if"].call(a, a && a.isLunar, {
                    hash: {},
                    inverse: g.program(15, u, i),
                    fn: g.program(13, p, i),
                    data: i
                }), (h || 0 === h) && (m += h), m += '</span>  <label for="chk">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.lunarCal", _) : v.call(a, "t", "profile.edit.lunarCal", _))) + '</label></div></li></ul><div class="btn_group"><p class="set_account"><a href="/s/settings" data-kant-id="306">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.profileEdit", _) : v.call(a, "t", "profile.edit.profileEdit", _))) + '<span class="ic_arrow"></span></a></p><div class="btn"><button class="btn_com btn_wh _cancel" data-kant-id="false">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.cancel", _) : v.call(a, "t", "profile.edit.cancel", _))) + '</button> <button class="btn_com btn_or _submit" data-kant-id="false">' + y((f = l.t || a && a.t, _ = {
                    hash: {},
                    data: i
                }, f ? f.call(a, "profile.edit.submit", _) : v.call(a, "t", "profile.edit.submit", _))) + '</button></div></div><div data-part="nameGuide"></div></div></div>'
            });
            return t.wrap = '<div class="story_area">', t
        }(),
        nameGuide: function() {
            var t = a(function(t, a, l, e, i) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {};
                var s, d, r = "",
                    c = l.helperMissing,
                    n = this.escapeExpression;
                return r += '<div class="ly_con guide _layerContainer"><div class="inner">' + n((s = l.t || a && a.t, d = {
                    hash: {},
                    data: i
                }, s ? s.call(a, "profile.edit.nameFullGuide", d) : c.call(a, "t", "profile.edit.nameFullGuide", d))) + ' <button class="bn_x _nameGuideCloseBtn" data-kant-id="false">' + n((s = l.t || a && a.t, d = {
                    hash: {},
                    data: i
                }, s ? s.call(a, "profile.edit.close", d) : c.call(a, "t", "profile.edit.close", d))) + "</button></div></div>"
            });
            return t.wrap = '<div class="dim_ly _nameGuideLayer">', t
        }(),
        selectedMusic: function() {
            var t = a(function(t, a, l, e, i) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {};
                var s, d, r, c = "",
                    n = "function",
                    o = this.escapeExpression,
                    p = l.helperMissing;
                return c += '<div class="_musicItem" data-id="', (d = l.track_id) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.track_id, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + '"><button class="ic_play _selectedMusicItemPlayBtn" data-kant-id="310">' + o((d = l.t || a && a.t, r = {
                    hash: {},
                    data: i
                }, d ? d.call(a, "profile.edit.play", r) : p.call(a, "t", "profile.edit.play", r))) + '</button><div class="txt"><p class="tit"><a href="#" class="_selectedMusicItemPlayBtn" data-kant-id="476">', (d = l.title) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.title, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + "</a></p><p>", (d = l.artist) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.artist, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + " - ", (d = l.album_title) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.album_title, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + "</p></div></div>"
            });
            return t.wrap = "<div>", t
        }(),
        musicContainer: function() {
            var t = a(function(t, a, l, e, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {}, '<div data-part="musicList"></div>'
            });
            return t.wrap = "<div>", t
        }(),
        musicList: function() {
            var t = a(function(t, a, l, e, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {}, '<ul class="_musicContainer"></ul>'
            });
            return t.wrap = "<div>", t
        }(),
        musicItem: function() {
            var t = a(function(t, a, l, e, i) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {};
                var s, d, r, c = "",
                    n = "function",
                    o = this.escapeExpression,
                    p = l.helperMissing;
                return c += '<div class="_musicItem" data-id="', (d = l.track_id) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.track_id, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + '"><div class="info"><p class="tit"><a href="#" class="_musicItemPlayBtn" data-kant-id="311"><span class="ic">' + o((d = l.t || a && a.t, r = {
                    hash: {},
                    data: i
                }, d ? d.call(a, "profile.edit.play", r) : p.call(a, "t", "profile.edit.play", r))) + "</span>", (d = l.title) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.title, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + "</a></p><p>", (d = l.artist) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.artist, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + " - ", (d = l.album_title) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.album_title, s = typeof d === n ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), c += o(s) + '</p></div> <button class="btn_com btn_wh _musicItemSelectBtn" data-kant-id="312"><span class="_selectBtnLabel">' + o((d = l.t || a && a.t, r = {
                    hash: {},
                    data: i
                }, d ? d.call(a, "profile.edit.select", r) : p.call(a, "t", "profile.edit.select", r))) + "</span></button></div>"
            });
            return t.wrap = "<li>", t
        }(),
        tooltip: function() {
            var t = a(function(t, a, l, e, i) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, t.helpers), i = i || {};
                var s, d, r = "",
                    c = "function",
                    n = this.escapeExpression;
                return r += "<p>", (d = l.message) ? s = d.call(a, {
                    hash: {},
                    data: i
                }) : (d = a && a.message, s = typeof d === c ? d.call(a, {
                    hash: {},
                    data: i
                }) : d), r += n(s) + '</p><span class="arr"></span>'
            });
            return t
        }()
    }
});
define("module/myStory/settings", ["template/myStorySettings"], function(t) {
    return new(space.Module.extend({
        name: "myStorySettings",
        template: t.layout,
        childParts: {
            profile: "part/myStory/ProfileSettingsPart"
        }
    }))
});
define("module/myStory/videos", ["template/myStory", "model/Profiles", "model/SectionActivities", "module/static/error", "common/urlKey"], function(e, t, o, n, i) {
    return new(space.Module.extend({
        name: "myStoryVideos",
        template: e.contentLayout,
        childParts: {
            content: "part/myStory/VideoListPart"
        },
        onSetup: function(e) {
            var r = i.profile.urlKeyToId(e),
                l = new t({
                    id: r
                }),
                d = new o({
                    id: r,
                    profile: l.get("profile"),
                    type: o.TYPE.VIDEOS
                });
            return this.childParts.content.model = d, l.fetch().then(function() {
                document.title = intl.t("title.myStory", {
                    name: l.get("profile").get("display_name")
                })
            }).fail(n.getHandler())
        }
    }))
});
define("module/post", ["template/myStory", "model/Activity", "model/Profiles", "model/me", "common/domUtil", "common/urlKey"], function(t, e, i, o, n, r) {
    var d = 110,
        s = 10;
    return new(space.Module.extend({
        name: "post",
        template: t.postLayout,
        model: null,
        childParts: {
            content: "part/feed/FeedItemPart"
        },
        ui: {
            feed: "._feedContainer"
        },
        initialize: function() {
            this._$window = $(window), this._errorActivity = null, this._isForbidden = !1
        },
        onSetup: function(t, l, a) {
            var c = this,
                u = r.profile.urlKeyToId(t),
                m = r.activity.urlKeyToId(u, l),
                h = new e({
                    id: m
                }),
                g = o.get("notifications");
            return this._errorActivity = null, this._isForbidden = !1, this.model = new i({
                id: u
            }), this.childParts.content.model = h, agent.type.is.mobile || a || this.listenTo(this.childParts.content, "mediaReady", function() {
                n.scrollTo(d)
            }), this.listenTo(h, "destroy", function(t) {
                this.model.get("profile").get("isMe") && (require(["module/myStory/mainProfile"], function(e) {
                    e && e.isStarted() && e.changeActivityCount(-1, t)
                }), space.Router.navigate("/" + h.get("actor").get("urlKey")))
            }), Q.all([this.model.fetch(), h.fetch().then(function() {
                var t = h.get("id");
                g.getReadingMark() === t ? g.clearReadingMark(t) : g.clearReadingMark()
            }).fail(function(t) {
                c._isForbidden = t && 403 === t.status, c._errorActivity = t.responseJSON
            })]).then(function() {
                var t = h.get("content");
                c._isForbidden && o.isLoggedIn() && o.is(c.model.get("id")) && o.setLoggedIn(!1), document.title = intl.t("title.activity", {
                    name: c.model.get("profile").get("display_name"),
                    content: t.substr(0, s) + (t.length > s ? "..." : "")
                })
            })
        },
        onRender: function() {
            this.ui.feed.toggle(!this._errorActivity), this._errorActivity && (this._errorActivity && this._errorActivity.error_message ? $(t.error(this._errorActivity)).appendTo(this.$el) : $(t.notFoundFeed()).appendTo(this.$el))
        }
    }))
});
define("template/settings", ["Handlebars"], function(a) {
    var t = function(t) {
        var s = a.template(t);
        return function(a) {
            return s(a, {
                partials: l
            })
        }
    }, l = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, l, s, c) {
                return this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), c = c || {}, '<div data-part="account"></div>'
            });
            return a.wrap = '<div data-kant-group="acct">', a
        }(),
        account: function() {
            var a = t(function(a, t, l, s, c) {
                function i(a, t) {
                    var s, c, i, e = "";
                    return e += ' <a href="#" class="user_info _btnOpenMusicPlayer" data-kant-id="358"><span class="ico_music">' + v((c = l.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, c ? c.call(a, "account.profile.music", i) : _.call(a, "t", "account.profile.music", i))) + "</span>", (c = l.statusMessage) ? s = c.call(a, {
                        hash: {},
                        data: t
                    }) : (c = a && a.statusMessage, s = typeof c === g ? c.call(a, {
                        hash: {},
                        data: t
                    }) : c), e += v(s) + "</a> "
                }
                function e(a, t) {
                    var s, c, i = "";
                    return i += '<p class="user_info">', (c = l.statusMessage) ? s = c.call(a, {
                        hash: {},
                        data: t
                    }) : (c = a && a.statusMessage, s = typeof c === g ? c.call(a, {
                        hash: {},
                        data: t
                    }) : c), i += v(s) + "</p>"
                }
                function n(a, t) {
                    var s, c, i, e = "";
                    return e += ' <li><div class="ui_left v2"><strong class="tit">' + v((c = l.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, c ? c.call(a, "account.storyId.title", i) : _.call(a, "t", "account.storyId.title", i))) + '</strong></div><div class="ui_right"><div class="id_area"><strong class="user_id">', (c = l.id) ? s = c.call(a, {
                        hash: {},
                        data: t
                    }) : (c = a && a.id, s = typeof c === g ? c.call(a, {
                        hash: {},
                        data: t
                    }) : c), e += v(s) + "</strong> ", s = l["if"].call(a, a && a.isSearchable, {
                        hash: {},
                        inverse: m.program(8, d, t),
                        fn: m.program(6, o, t),
                        data: t
                    }), (s || 0 === s) && (e += s), e += '  <label for="find" class="tit_find">' + v((c = l.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, c ? c.call(a, "account.storyId.searchable", i) : _.call(a, "t", "account.storyId.searchable", i))) + "</label></div></div></li> "
                }
                function o() {
                    return ' <input type="checkbox" id="find" value="" class="chk_box _searchable" name="searchable" checked="checked"> '
                }
                function d() {
                    return ' <input type="checkbox" id="find" value="" class="chk_box _searchable" name="searchable"> '
                }
                function r(a, t) {
                    var s, c, i = "";
                    return i += ' <li class="_makeId"><div class="ui_left v2"><strong class="tit">' + v((s = l.t || a && a.t, c = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "account.storyId.title", c) : _.call(a, "t", "account.storyId.title", c))) + '</strong></div><div class="ui_right"><div class="id_area"><a href="#" class="btn_com btn_or make _makeIdBtn" data-kant-id="360">' + v((s = l.t || a && a.t, c = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "account.storyId.makeId", c) : _.call(a, "t", "account.storyId.makeId", c))) + '</a></div></div></li> <li class="_makeIdForm" style="display: none"><div class="ui_left v2"><strong class="tit"><label for="add_id">' + v((s = l.t || a && a.t, c = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "account.storyId.title", c) : _.call(a, "t", "account.storyId.title", c))) + '</label></strong></div><div class="ui_right"><div class="id_area"><div class="srch_area"><input type="text" id="add_id" class="_idForm" name="idForm" maxlength="30" autocapitalize="off"> <span class="txt_label _idPlaceholder">' + v((s = l.t || a && a.t, c = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "account.storyId.rule", c) : _.call(a, "t", "account.storyId.rule", c))) + '</span></div><button class="btn_com btn_or _updateStoryId" data-kant-id="361"><span>' + v((s = l.t || a && a.t, c = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "account.storyId.confirm", c) : _.call(a, "t", "account.storyId.confirm", c))) + '</span></button><p class="add_info">' + v((s = l.t || a && a.t, c = {
                        hash: {},
                        data: t
                    }, s ? s.call(a, "account.storyId.info", c) : _.call(a, "t", "account.storyId.info", c))) + "</p></div></div></li> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), c = c || {};
                var u, h, p, f = "",
                    _ = l.helperMissing,
                    v = this.escapeExpression,
                    g = "function",
                    m = this;
                return f += '<div class="profile_modify"><strong class="tit_page">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.settings", p) : _.call(t, "t", "account.settings", p))) + '</strong><ul class="my_profile"><li><div class="ui_left"><strong class="tit">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.profile.myProfile", p) : _.call(t, "t", "account.profile.myProfile", p))) + '</strong></div><div class="ui_right"><div class="ui_profile"><a href="/', (h = l.urlKey) ? u = h.call(t, {
                    hash: {},
                    data: c
                }) : (h = t && t.urlKey, u = typeof h === g ? h.call(t, {
                    hash: {},
                    data: c
                }) : h), f += v(u) + '" data-kant-id="356"><span class="pf _profileImageContainer"><img src="' + v((h = l.profileImage || t && t.profileImage, p = {
                    hash: {
                        url: t && t.profile_thumbnail_url,
                        size: "86"
                    },
                    data: c
                }, h ? h.call(t, p) : _.call(t, "profileImage", p))) + '" alt="" class="_profileImage"></span></a><div class="profile_tit"><span class="profile"><a href="/', (h = l.urlKey) ? u = h.call(t, {
                    hash: {},
                    data: c
                }) : (h = t && t.urlKey, u = typeof h === g ? h.call(t, {
                    hash: {},
                    data: c
                }) : h), f += v(u) + '" class="name" data-kant-id="357">', (h = l.display_name) ? u = h.call(t, {
                    hash: {},
                    data: c
                }) : (h = t && t.display_name, u = typeof h === g ? h.call(t, {
                    hash: {},
                    data: c
                }) : h), f += v(u) + "</a> ", u = l["if"].call(t, t && t.isMusicStatus, {
                    hash: {},
                    inverse: m.program(3, e, c),
                    fn: m.program(1, i, c),
                    data: c
                }), (u || 0 === u) && (f += u), f += '</span><div class="btn_area"><a href="/s/profile/edit" class="btn_com btn_wh _editProfile" data-kant-id="359">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.profile.editProfile", p) : _.call(t, "t", "account.profile.editProfile", p))) + "</a></div></div></div></div></li>", u = l["if"].call(t, t && t.isStoryId, {
                    hash: {},
                    inverse: m.program(10, r, c),
                    fn: m.program(5, n, c),
                    data: c
                }), (u || 0 === u) && (f += u), f += '<li class="row"><div class="ui_left v2"><strong class="tit">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.kakaoAccount.title", p) : _.call(t, "t", "account.kakaoAccount.title", p))) + '</strong></div><div class="ui_right"><strong class="user_id">', (h = l.email) ? u = h.call(t, {
                    hash: {},
                    data: c
                }) : (h = t && t.email, u = typeof h === g ? h.call(t, {
                    hash: {},
                    data: c
                }) : h), f += v(u) + '</strong><p class="btn_group"><a href="#" class="btn_com btn_wh _changePasswd" data-kant-id="524">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.kakaoAccount.changePasswd", p) : _.call(t, "t", "account.kakaoAccount.changePasswd", p))) + '</a><a href="#" class="btn_com btn_wh out _logout" data-kant-id="362" data-kant-ignore="true">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.kakaoAccount.logout", p) : _.call(t, "t", "account.kakaoAccount.logout", p))) + '</a></p></div></li></ul><p class="set_account"><a href="#" class="_withdrawBtn" data-kant-id="363">' + v((h = l.t || t && t.t, p = {
                    hash: {},
                    data: c
                }, h ? h.call(t, "account.quit.title", p) : _.call(t, "t", "account.quit.title", p))) + '</a></p><div data-part="withdraw"></div></div>'
            });
            return a.wrap = '<div class="story_area modify">', a
        }(),
        withdraw: function() {
            var a = t(function(a, t, l, s, c) {
                function i(a) {
                    var t, l = "";
                    return l += "<li>- ", t = typeof a === r ? a.apply(a) : a, (t || 0 === t) && (l += t), l += "</li>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), c = c || {};
                var e, n, o, d = "",
                    r = "function",
                    u = l.helperMissing,
                    h = this.escapeExpression,
                    p = this;
                return d += '<div class="ly_con guide _layerContainer" style="z-index:250"><div class="inner"><h1>' + h((n = l.t || t && t.t, o = {
                    hash: {},
                    data: c
                }, n ? n.call(t, "account.quitGuide.title", o) : u.call(t, "t", "account.quitGuide.title", o))) + '</h1><div class="guide_info"><p class="txt">', (n = l.guide) ? e = n.call(t, {
                    hash: {},
                    data: c
                }) : (n = t && t.guide, e = typeof n === r ? n.call(t, {
                    hash: {},
                    data: c
                }) : n), (e || 0 === e) && (d += e), d += '</p><strong class="tit">', (n = l.toBeDeleted) ? e = n.call(t, {
                    hash: {},
                    data: c
                }) : (n = t && t.toBeDeleted, e = typeof n === r ? n.call(t, {
                    hash: {},
                    data: c
                }) : n), (e || 0 === e) && (d += e), d += '</strong><ul class="txt">', e = l.each.call(t, t && t.items, {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, i, c),
                    data: c
                }), (e || 0 === e) && (d += e), d += '</ul><div class="btn_group"><button class="btn_com btn_or _withdraw" data-kant-id="365"><span>' + h((n = l.t || t && t.t, o = {
                    hash: {},
                    data: c
                }, n ? n.call(t, "account.quitGuide.quit", o) : u.call(t, "t", "account.quitGuide.quit", o))) + '</span></button> <button class="btn_com btn_wh _withdrawCloseBtn" data-kant-id="364"><span>' + h((n = l.t || t && t.t, o = {
                    hash: {},
                    data: c
                }, n ? n.call(t, "account.quitGuide.cancel", o) : u.call(t, "t", "account.quitGuide.cancel", o))) + '</span></button></div></div><button class="bn_x _withdrawCloseBtn" data-kant-id="366">' + h((n = l.t || t && t.t, o = {
                    hash: {},
                    data: c
                }, n ? n.call(t, "account.quitGuide.close", o) : u.call(t, "t", "account.quitGuide.close", o))) + "</button></div></div>"
            });
            return a.wrap = '<div class="dim_ly">', a
        }()
    }
});
define("module/settings", ["template/settings"], function(t) {
    var e = space.Module.extend({
        name: "settings",
        template: t.layout,
        childParts: {
            account: "part/settings/AccountSettingsPart"
        }
    });
    return new e
});
define("template/footer", ["Handlebars"], function(a) {
    var t = function(t) {
        var l = a.template(t);
        return function(a) {
            return l(a, {
                partials: o
            })
        }
    }, o = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, o, l, r) {
                this.compilerInfo = [4, ">= 1.0.0"], o = this.merge(o, a.helpers), r = r || {};
                var n, e, c = "",
                    p = o.helperMissing,
                    i = this.escapeExpression;
                return c += '<ul><li><a href="http://www.kakao.com/company" target="_blank" data-kant-id="71">' + i((n = o.t || t && t.t, e = {
                    hash: {},
                    data: r
                }, n ? n.call(t, "gnb.footer.companyInfo", e) : p.call(t, "t", "gnb.footer.companyInfo", e))) + '</a><span class="bar"></span></li><li><a href="http://www.kakao.com/policy/terms" target="_blank" data-kant-id="72">' + i((n = o.t || t && t.t, e = {
                    hash: {},
                    data: r
                }, n ? n.call(t, "gnb.footer.terms", e) : p.call(t, "t", "gnb.footer.terms", e))) + '</a><span class="bar"></span></li><li><a href="http://www.kakao.com/policy/privacy" target="_blank" data-kant-id="73">' + i((n = o.t || t && t.t, e = {
                    hash: {},
                    data: r
                }, n ? n.call(t, "gnb.footer.privacy", e) : p.call(t, "t", "gnb.footer.privacy", e))) + '</a><span class="bar"></span></li><li><a href="http://www.kakao.com/policy/oppolicy" target="_blank" data-kant-id="74">' + i((n = o.t || t && t.t, e = {
                    hash: {},
                    data: r
                }, n ? n.call(t, "gnb.footer.policy", e) : p.call(t, "t", "gnb.footer.policy", e))) + "</a></li></ul><p>" + i((n = o.t || t && t.t, e = {
                    hash: {},
                    data: r
                }, n ? n.call(t, "gnb.footer.copyright", e) : p.call(t, "t", "gnb.footer.copyright", e))) + ' <a href="http://www.kakao.com" target="_blank" data-kant-id="75">' + i((n = o.t || t && t.t, e = {
                    hash: {},
                    data: r
                }, n ? n.call(t, "gnb.footer.kakaoCorp", e) : p.call(t, "t", "gnb.footer.kakaoCorp", e))) + "</a></p>"
            });
            return a.wrap = '<div class="footer_m" style="display:none;">', a
        }()
    }
});
define("module/footer", ["template/footer"], function(e) {
    return new(space.Module.extend({
        name: "footer",
        template: e.layout,
        onRender: function() {
            agent.type.is.mobile && this.show()
        }
    }))
});
define("template/hashtag", ["Handlebars"], function(a) {
    var t = function(t) {
        var h = a.template(t);
        return function(a) {
            return h(a, {
                partials: s
            })
        }
    }, s = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, s, h, e) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var n, l, r, i = "",
                    p = "function",
                    c = this.escapeExpression,
                    g = s.helperMissing;
                return i += '<p class="hash"><a href="/hashtag/', (l = s.tag) ? n = l.call(t, {
                    hash: {},
                    data: e
                }) : (l = t && t.tag, n = typeof l === p ? l.call(t, {
                    hash: {},
                    data: e
                }) : l), i += c(n) + '" class="_mainTag" data-kant-id="520" title="#', (l = s.tag) ? n = l.call(t, {
                    hash: {},
                    data: e
                }) : (l = t && t.tag, n = typeof l === p ? l.call(t, {
                    hash: {},
                    data: e
                }) : l), i += c(n) + '"><strong>#', (l = s.tag) ? n = l.call(t, {
                    hash: {},
                    data: e
                }) : (l = t && t.tag, n = typeof l === p ? l.call(t, {
                    hash: {},
                    data: e
                }) : l), i += c(n) + '</strong></a> <button class="btn_com btn_wh _hashtagWriting" data-hashtag="#', (l = s.tag) ? n = l.call(t, {
                    hash: {},
                    data: e
                }) : (l = t && t.tag, n = typeof l === p ? l.call(t, {
                    hash: {},
                    data: e
                }) : l), i += c(n) + '" data-kant-id="543"><span>' + c((l = s.t || t && t.t, r = {
                    hash: {},
                    data: e
                }, l ? l.call(t, "hashtag.writing", r) : g.call(t, "t", "hashtag.writing", r))) + '</span></button></p><div data-part="list"></div>'
            });
            return a.wrap = '<div class="wrap" data-kant-group="hash">', a
        }(),
        empty: function() {
            var a = t(function(a, t, s, h, e) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), e = e || {};
                var n, l, r = "",
                    i = s.helperMissing,
                    p = this.escapeExpression;
                return r += '<div class="nohashbx" data-kant-group="hash"><span class="im_hash"></span><p class="tx">' + p((n = s.t || t && t.t, l = {
                    hash: {},
                    data: e
                }, n ? n.call(t, "hashtag.empty.message", l) : i.call(t, "t", "hashtag.empty.message", l))) + '</p><span class="tx2"><a href="#" onclick="history.back();return false" data-kant-id="521">' + p((n = s.t || t && t.t, l = {
                    hash: {},
                    data: e
                }, n ? n.call(t, "hashtag.empty.prevPage", l) : i.call(t, "t", "hashtag.empty.prevPage", l))) + '</a><a href="/" data-kant-id="522">' + p((n = s.t || t && t.t, l = {
                    hash: {},
                    data: e
                }, n ? n.call(t, "hashtag.empty.home", l) : i.call(t, "t", "hashtag.empty.home", l))) + "</a></span></div>"
            });
            return a
        }()
    }
});
define("module/hashtag", ["template/hashtag", "module/static/error", "model/Hashtags", "module/static/writingView", "part/writing/WritingPart", "common/urlKey"], function(t, e, i, a, r, n) {
    return new(space.Module.extend({
        name: "hashtag",
        template: t.layout,
        model: null,
        childParts: {
            list: "part/feed/FeedListPart"
        },
        initialize: function() {
            this._isEmpty = !1, this._$empty = null
        },
        events: {
            "click ._hashtagWriting": function(t) {
                var e = $(t.currentTarget).data("hashtag");
                t.preventDefault(), a.setIsMyStoryOfMe(!1), a.show(r.MODE.TEXT, {
                    hashtag: e
                })
            }
        },
        onSetup: function(t, e, a) {
            var r, s = n.profile.urlKeyToId(e),
                o = n.activity.urlKeyToId(s, a);
            return t ? e && !a ? (location.href = "/hashtag/" + t, Q.reject()) : (r = new i({
                tag: t,
                activityId: o
            }), this.model = r, this.childParts.list.collection = r.get("feeds"), void this.listenTo(this.childParts.list, {
                changeListStatus: function(t) {
                    t ? this._removeEmptyCard() : this._renderEmptyCard(), this.childParts.list.toggle(t)
                }
            })) : (location.href = "/", Q.reject())
        },
        onStop: function() {
            this._removeEmptyCard()
        },
        _renderEmptyCard: function() {
            this._$empty = $(t.empty()).appendTo(this.$el)
        },
        _removeEmptyCard: function() {
            this._$empty && (this._$empty.detach(), this._$empty = null)
        }
    }))
});
define("template/more", ["Handlebars"], function(a) {
    var t = function(t) {
        var s = a.template(t);
        return function(a) {
            return s(a, {
                partials: l
            })
        }
    }, l = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, l, s, n) {
                this.compilerInfo = [4, ">= 1.0.0"], l = this.merge(l, a.helpers), n = n || {};
                var o, r, e = "",
                    i = l.helperMissing,
                    u = this.escapeExpression;
                return e += '<div class="f_cont"><ul class="my_setlst"><li><a href="/s/logout" class="_logout" data-kant-id="544"><span class="ic_logout"></span><strong>' + u((o = l.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, o ? o.call(t, "gnb.profile.logout", r) : i.call(t, "t", "gnb.profile.logout", r))) + '</strong></a></li><li class="border"><a href="/s/about" target="_blank" data-kant-id="545"><span class="ic_about"></span><strong>' + u((o = l.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, o ? o.call(t, "gnb.profile.aboutKakaoStory", r) : i.call(t, "t", "gnb.profile.aboutKakaoStory", r))) + '</strong></a></li></ul><span class="line"></span></div>'
            });
            return a.wrap = '<div class="f_ly set_ly" data-kant-group="gnb" style="display:none;">', a
        }()
    }
});
define("module/more", ["template/more", "common/kantUtil", "model/me"], function(e, t, n) {
    return new(space.Module.extend({
        name: "more",
        template: e.layout,
        events: {
            "click ._logout": function(e) {
                var o = this;
                t.send("gnb.544").then(function() {
                    n.logout(!1, o._fromPath)
                }), e.preventDefault()
            }
        },
        initialize: function() {
            this._fromPath = null
        },
        onRender: function() {
            agent.type.is.mobile && this.show()
        },
        onRoute: function() {
            var e = space.Router.getParams();
            this._fromPath = e && e.from ? e.from : null
        }
    }))
});
define("resolver/main", ["module"], function(e) {
    return {
        id: e.id,
        title: intl.t("title.common"),
        modules: ["module/feed", "module/footer"]
    }
});
define("resolver/error", ["module"], function(e) {
    return {
        id: e.id,
        title: intl.t("title.common")
    }
});
define("resolver/s/settings", ["module"], function(t) {
    return {
        id: t.id,
        title: intl.t("title.setting"),
        modules: ["module/settings"],
        onRoute: function() {
            require(["common/kantUtil"], function(t) {
                t.sendPageView("st")
            })
        }
    }
});
define("resolver/s/more", ["module"], function(e) {
    return {
        id: e.id,
        title: intl.t("title.more"),
        modules: ["module/more"]
    }
});
define("resolver/report", ["module"], function(e) {
    return {
        id: e.id,
        title: intl.t("title.common"),
        modules: ["module/report"]
    }
});
define("resolver/post", ["module"], function(o) {
    return {
        id: o.id,
        modules: ["module/myStory/mainProfile", "module/post", "module/footer"],
        onRoute: function() {
            require(["common/kantUtil"], function(o) {
                o.sendPageView("dt")
            })
        }
    }
});
define("resolver/myStory/feed", ["module"], function(e) {
    return {
        id: e.id,
        modules: ["module/myStory/mainProfile", "module/myStory/feed", "module/footer"]
    }
});
define("resolver/myStory/photos", ["module"], function(o) {
    return {
        id: o.id,
        modules: ["module/myStory/mainProfile", "module/myStory/photos", "module/footer"]
    }
});
define("resolver/myStory/videos", ["module"], function(o) {
    return {
        id: o.id,
        modules: ["module/myStory/mainProfile", "module/myStory/videos", "module/footer"]
    }
});
define("resolver/myStory/music", ["module"], function(o) {
    return {
        id: o.id,
        modules: ["module/myStory/mainProfile", "module/myStory/music", "module/footer"]
    }
});
define("resolver/myStory/friends", ["module"], function(e) {
    var o = ["module/myStory/friends", "module/footer"];
    return agent.type.is.mobile || o.unshift("module/myStory/mainProfile"), {
        id: e.id,
        modules: o
    }
});
define("resolver/myStory/settings", ["module"], function(e) {
    return {
        id: e.id,
        modules: ["module/myStory/mainProfile", "module/myStory/settings"],
        onRoute: function() {
            require(["common/kantUtil"], function(e) {
                e.sendPageView("ef")
            })
        }
    }
});
define("resolver/myStory/profilePhoto", ["module"], function(o) {
    return {
        id: o.id,
        modules: ["module/myStory/mainProfile", "module/myStory/feed", "module/footer"]
    }
});
define("model/Scheme", ["config", "common/api"], function(e, t) {
    var n = {
        PROFILE: "p",
        ACTIVITY: "a"
    }, r = space.Model.extend({
        url: "/webtoapp",
        defaults: {
            scheme: "",
            intent: ""
        },
        virtuals: {
            storyAppOptions: function() {
                return {
                    other: e.serviceUrl.story,
                    ios: {
                        store: e.appLink.ios.store.app,
                        app: this.get("scheme")
                    },
                    android: {
                        store: e.appLink.android.store.app,
                        app: this.get("intent")
                    }
                }
            }
        },
        fetch: function(e, n) {
            var r = this;
            return t.request({
                url: this.url,
                type: "GET",
                data: {
                    t: e,
                    v: n
                }
            }).then(function(e) {
                return r.set(e.response), e
            })
        }
    });
    return r.TYPE = n, r
});
define("resolver/scheme/feed", ["module", "model/Scheme", "common/urlKey", "common/mobileAppLink"], function(e, o, n, t) {
    var i = 2e3,
        a = function() {
            var e = space.Router.getPath().replace(/\/app$/, "");
            space.Router.navigate("/" + e, {
                replace: !0
            })
        };
    return {
        id: e.id,
        onRoute: function(e) {
            var p, r = n.profile.urlKeyToId(e);
            agent.type.is.mobile && (agent.os.is.ios || agent.os.is.android) ? (p = new o, p.fetch(o.TYPE.PROFILE, r).then(function() {
                setTimeout(a, i), t.openApp(p.get("storyAppOptions"))
            }).fail(a)) : a()
        }
    }
});
define("resolver/scheme/post", ["module", "model/Scheme", "common/urlKey", "common/mobileAppLink"], function(e, o, t, n) {
    var i = 2e3,
        a = function() {
            var e = space.Router.getPath().replace(/\/app$/, "");
            space.Router.navigate("/" + e, {
                replace: !0
            })
        };
    return {
        id: e.id,
        onRoute: function(e, p) {
            var r, c = t.profile.urlKeyToId(e),
                s = t.activity.urlKeyToId(c, p);
            agent.type.is.mobile && (agent.os.is.ios || agent.os.is.android) ? (r = new o, r.fetch(o.TYPE.ACTIVITY, s).then(function() {
                setTimeout(a, i), n.openApp(r.get("storyAppOptions"))
            }).fail(a)) : a()
        }
    }
});
define("resolver/mediaView", ["module"], function(e) {
    return {
        id: e.id,
        onRoute: function(e, t, i) {
            var o = Q.defer();
            return require(["model/Activity", "module/static/mediaView", "module/static/error", "common/kantUtil", "common/urlKey"], function(n, r, d, a, l) {
                var m = l.profile.urlKeyToId(e),
                    u = l.activity.urlKeyToId(m, t),
                    c = new n({
                        id: u
                    });
                a.sendPageView("mdv"), r.addActivity(c), c.fetch().then(function() {
                    document.title = intl.t("title.photo", {
                        name: c.get("actor").get("display_name")
                    }), r.show(r.MODE.ACTIVITY, {
                        mediaIndex: parseInt(i, 10) || 0,
                        skipNavigation: !0
                    }), o.resolve()
                }).fail(d.getHandler({
                    page: d.PAGE.NOT_FOUND
                }))
            }), o.promise
        }
    }
});
define("resolver/hashtag", ["module", "common/kantUtil"], function(t, e) {
    var o = 10,
        n = "...";
    return {
        id: t.id,
        modules: ["module/hashtag", "module/footer"],
        onRoute: function(t) {
            return t ? (t.length > o && (t = t.substr(0, o) + n), e.sendPageView("tag"), void(document.title = intl.t("title.hashtag", {
                tag: t
            }))) : void space.Router.navigate("/")
        }
    }
});
define("mainRouter", ["resolver/main", "resolver/error", "resolver/s/settings", "resolver/s/more", "resolver/report", "resolver/post", "resolver/myStory/feed", "resolver/myStory/photos", "resolver/myStory/videos", "resolver/myStory/music", "resolver/myStory/friends", "resolver/myStory/settings", "resolver/myStory/profilePhoto", "resolver/scheme/feed", "resolver/scheme/post", "resolver/mediaView", "resolver/hashtag"], function() {
    var e = {
        NAMED_PARAM: "[^/?]+",
        OPTIONAL_PARAM: "(?:$1)?",
        START_OF_URL: "^",
        END_OF_URL: "/?(?:\\?([\\s\\S]*))?$",
        replacements: {
            profileUrlKey: "(?:ch/[^/?]{2,}|[^/?]{4,}|_[^_]{1,})"
        },
        convert: function(e) {
            var r = e,
                o = this;
            return _.isString(e) ? (r = r.replace(/\((.*?)\)/g, this.OPTIONAL_PARAM), r = r.replace(/(\(\?)?:(\w+)/g, function(e, r, t) {
                var s;
                return r ? e : (s = o.replacements[t] || o.NAMED_PARAM, "(" + s + ")")
            }), r = this.START_OF_URL + r + this.END_OF_URL, new RegExp(r)) : e
        }
    }, r = _.map([{
        route: "",
        resolverName: "main"
    }, {
        route: "s/settings",
        resolverName: "s/settings"
    }, {
        route: "s/more",
        resolverName: "s/more"
    }, {
        route: "hashtag(/:tag)(/:profileUrlKey)(/:activityUrlKey)",
        resolverName: "hashtag"
    }, {
        route: "s/friends",
        resolverName: "myStory/friends"
    }, {
        route: "s/friends/recommend",
        resolverName: "myStory/friends"
    }, {
        route: "s/friends/requests",
        resolverName: "myStory/friends"
    }, {
        route: "s/profile/edit",
        resolverName: "myStory/settings"
    }, {
        route: ":profileUrlKey/photos",
        resolverName: "myStory/photos"
    }, {
        route: ":profileUrlKey/videos",
        resolverName: "myStory/videos"
    }, {
        route: ":profileUrlKey/music",
        resolverName: "myStory/music"
    }, {
        route: ":profileUrlKey/profile/photo",
        resolverName: "myStory/profilePhoto"
    }, {
        route: ":profileUrlKey/app",
        resolverName: "scheme/feed"
    }, {
        route: ":profileUrlKey/:activityUrlKey/photos/:mediaIndex",
        resolverName: "mediaView"
    }, {
        route: ":profileUrlKey/:activityUrlKey/app",
        resolverName: "scheme/post"
    }, {
        route: ":profileUrlKey/:activityUrlKey(/:commentId)(/:photo)",
        resolverName: "post"
    }, {
        route: ":profileUrlKey",
        resolverName: "myStory/feed"
    }, {
        route: /.+/,
        resolverName: "error"
    }], function(r) {
        return r.route = e.convert(r.route), r
    }),
        o = ["main", "s/settings", "myStory/friends", "myStory/settings"],
        t = ["s/notice", "s/login", "s/logout", "s/about", "s/privacy", "s/share"],
        s = {}, i = ["module/static/gnb", "module/static/cover", "module/static/report", "module/static/dialog", "module/static/error", "module/static/mediaView", "module/static/familySite", "module/static/writingView", "module/static/toastPopup", "module/static/profilePopup", "module/static/loginView", "module/static/registerView", "module/static/confirmPasswordView", "module/static/mobileAppLinkBanner", "module/static/sessionCookie", "module/static/tooltip"],
        l = _.union(_.pluck(r, "resolverName"));
    return _.each(l, function(e) {
        s[e] = require("resolver/" + e)
    }), new(space.Router.extend({
        routes: r,
        resolvers: s,
        staticPath: t,
        staticModules: i,
        initialize: function() {
            this._isFirstRoute = !0
        },
        onRoute: function() {
            var e = this,
                r = Q.defer();
            return require(["model/me"], function(o) {
                var t = Q.resolve();
                e._isFirstRoute && (e._isFirstRoute = !1, t = o.fetch()), t = t.then(e.isLoginRequired() ? function() {
                    return o.isRegistered() ? Q.resolve() : void(location.href = o.isLoggedIn() ? "/s/login" : "/s/logout")
                } : function() {
                    o.isStoryPlus() && (location.href = "/s/login")
                }), t.then(function() {
                    r.resolve()
                })
            }), r.promise
        },
        isLoginRequired: function() {
            return _.contains(o, this.getResolver().getName())
        }
    }))
});
define("part/plugin/PlaceholderPart", ["common/domUtil"], function(e) {
    return space.Part.extend({
        initialize: function() {
            this._$placeholder = null, this._forceActivate = !1, this._isPlaceholderSupport = !1, this._isContenteditable = !1
        },
        onRender: function() {
            this._isPlaceholderSupport = e.isTextareaNode(this.$el[0]) || e.isInputNode(this.$el[0]), this._isContenteditable = !! this.$el.attr("contenteditable")
        },
        onDomReady: function() {
            var e = this;
            agent.type.is.desktop || this._forceActivate || !this._isPlaceholderSupport ? this._isContenteditable && agent.browser.is.ie ? this.$el.on("keyup", function() {
                e.update()
            }) : agent.isIe8AndBelow() ? this.$el.on("propertychange", function(t) {
                "value" === t.originalEvent.propertyName && e.update()
            }) : agent.isIe9AndBelow() ? this.$el.on("input change keyup", function() {
                e.update()
            }) : this.$el.on("input change", function() {
                e.update()
            }) : (this.$el.attr("placeholder", this._$placeholder.text()), this._$placeholder.hide())
        },
        onStop: function() {
            this.$el.off("input change keyup propertychange")
        },
        options: {
            placeholder: "setPlaceholder",
            forceActivate: "setForceActivate"
        },
        setPlaceholder: function(e) {
            this._$placeholder = e
        },
        setForceActivate: function(e) {
            this._forceActivate = e
        },
        update: function() {
            var e = !! (this._isPlaceholderSupport ? this.$el.val() : this.$el.html());
            this._isContenteditable && (e = !(!this.$el.text().length && !this.$el.find("img:first").length && this.$el.find("br").length <= 1)), (agent.type.is.desktop || this._forceActivate || !this._isPlaceholderSupport) && (this._$placeholder.toggle(!e), this.trigger("change"))
        }
    })
});
define("part/auth/RegisterBoxPart", ["model/me", "template/auth", "part/auth/LoginBoxPart", "module/static/registerView", "module/static/error", "model/Account"], function(t, i, e, o, n, l) {
    return space.Part.extend({
        template: i.registerBox,
        ui: {
            form: "._loginBoxForm",
            loginBtn: "._loginBoxLoginBtn",
            loginViewTitleWrapper: "._loginViewTitleWrapper",
            loginPageTitleWrapper: "._loginPageTitleWrapper",
            closeBtn: "._loginBoxCloseBtn"
        },
        options: {
            display: "setDisplay"
        },
        initialize: function() {
            this._email = null, this._display = !1
        },
        onSetup: function() {
            var t = this;
            return l.requestEmail().then(function(i) {
                t._email = i
            }).fail(n.getHandler())
        },
        onRender: function() {
            this.show()
        },
        events: {
            "click ._loginBoxLoginBtn": function(t) {
                t.preventDefault(), this.trigger("close"), o.show()
            },
            "click ._otherAccountLoginBtn": function(t) {
                t.preventDefault(), location.href = "/s/logout"
            },
            "click ._loginBoxCloseBtn": function(t) {
                t.preventDefault(), this.trigger("close")
            }
        },
        show: function() {
            this._display === e.LOGIN_DISPLAY_TYPE.LAYER ? this.ui.loginViewTitleWrapper.show() : this.ui.loginPageTitleWrapper.show(), this.ui.closeBtn.toggle(this._isLoginView), this.$el.show(), this.ui.loginBtn.focus(), this.trigger("show")
        },
        setDisplay: function(t) {
            this._display = t
        },
        getOffsetTop: function() {
            return this.$el.offset().top
        },
        extendData: function() {
            return {
                email: this._email
            }
        }
    })
});
define("part/auth/RegisterPart", ["template/auth", "model/Account", "model/me", "common/util", "common/imgUtil", "common/urlUtil", "common/profileImage", "module/static/dialog"], function(e, t, i, r, a, l, s, o) {
    var h = 2e3,
        n = {
            WIDTH: 124,
            HEIGHT: 124
        };
    return space.Part.extend({
        model: null,
        template: e.profileForm,
        ui: {
            profileForm: "._profileForm",
            profileImage: "._profileImage",
            profileImageEditBtn: "._profileImageEditBtn",
            nameText: "._text",
            lastName: "._lastName",
            firstName: "._firstName",
            firstNamePlaceholder: "._firstNamePlaceHolder",
            lastNamePlaceholder: "._lastNamePlaceholder",
            lastNameMarker: "._lastNameMarker",
            firstNameMarker: "._firstNameMarker",
            yearPlaceholder: "._yearPlaceholder",
            monthPlaceholder: "._monthPlaceholder",
            datePlaceholder: "._datePlaceholder",
            storyIdPlaceholder: "._storyIdPlaceholder",
            birthYear: "._birthYear",
            birthMonth: "._birthMonth",
            birthDate: "._birthDate",
            birthType: "._birthType",
            storyIdMarker: "._storyIdMarker",
            storyId: "._storyId",
            privacyCheckBox: "._privacyCheck",
            submitBtn: "._submit",
            inProgress: "._inProgress"
        },
        styles: {
            on: "on",
            error: "error",
            disabledCursor: "dis_cursor",
            inactive: "inactive",
            active: "btn_or"
        },
        events: {
            "click ._profileImageEditBtn": function(e) {
                e.preventDefault(), this.addPart("profileImageEdit", "part/auth/ProfileImageEditPart", {
                    selector: "._profileImageEditLayer",
                    options: {
                        exceptionClass: "._profileImageEditBtn"
                    },
                    listeners: {
                        show: function() {
                            this.ui.profileImageEditBtn.addClass(this.styles.on)
                        },
                        hide: function() {
                            this.ui.profileImageEditBtn.removeClass(this.styles.on)
                        },
                        upload: function(e) {
                            this.model.set("profile_image_url", e.get("previewPath")), this._profileImageMediaPath = e.get("mediaPath"), this.childParts.profileImageEdit.hide(), this.childParts.profileImageEdit.enableDelBtn()
                        },
                        "delete": function() {
                            this.model.set("profile_image_url", ""), this._profileImageMediaPath = null, this.childParts.profileImageEdit.disableDelBtn()
                        }
                    }
                }).next(function() {
                    this.childParts.profileImageEdit.toggle()
                })
            },
            "click ._privacyLink": function(e) {
                var t = $(e.currentTarget).attr("href");
                e.preventDefault(), window.open(t, null, "width=510,height=510,resizable=no,scrollbars=no,status=no,toolbar=no")
            },
            "input ._checkModified": "_updateSubmitBtn",
            "change ._privacyCheck": "_updateSubmitBtn",
            "click ._submit": function(e) {
                var t = r.trim(this.ui.firstName.val()),
                    a = r.trim(this.ui.lastName.val()),
                    s = this.ui.birthYear.val() || "",
                    o = this.ui.birthMonth.val() || "",
                    h = this.ui.birthDate.val() || "",
                    n = r.makeValidDate(s, o, h),
                    d = this.ui.birthType.prop("checked"),
                    c = d ? "-" : "+",
                    m = r.trim(this.ui.storyId.val()),
                    u = this.ui.privacyCheckBox.prop("checked"),
                    _ = {}, p = Q.resolve(),
                    f = this;
                return e.preventDefault(), this._submitBtnEnabled ? this._checkName(t, a) && u ? (_.first_name = t, _.last_name = a, _.privacy_agreement = u, this._checkBirthday(s, o, h) ? ((s + o + h).length > 0 && (_.birth = n, _.birth_type = c), 0 === m.length && (m = null), p.then(function() {
                    return m ? f._checkStoryId(m) : void 0
                }).then(function() {
                    return f._showInProgressLayer(), f.model.signIn(_)
                }).then(function() {
                    return m ? f.model.updateStoryId(m, !0) : void 0
                }).then(function() {
                    return f._profileImageMediaPath && f._profileImageMediaPath.length > 0 ? i.updateProfileImage(f._profileImageMediaPath) : void 0
                }).then(function() {
                    location.href = decodeURIComponent(l.getQueryValueFromUrl(location.href, "continue")) || "/"
                }).fail(function(e) {
                    f._hideInProgressLayer(), f._handleFail(e)
                })) : !1) : !1 : void 0
            }
        },
        _checkStoryId: function(e) {
            return this.model.checkStoryId(e).then(function(e) {
                return o.confirm(r.nl2br(e.message))
            })
        },
        _handleFail: function(e) {
            var i = null,
                a = null;
            if (e) switch (i = e.responseJSON.message || e.responseJSON.error_message || e.responseJSON.error, i = r.nl2br(i), a = e.responseJSON.status || e.responseJSON.error_code) {
                case t.STORYID.FORBIDDEN_URI:
                case t.STORYID.NOT_FOUND_URI:
                case t.STORYID.URI_ALREADY_EXISTS:
                case t.STORYID.DUPLICATED_URI:
                case t.STORYID.INVALID_URI:
                    this._showErrorTooltip(this.ui.storyIdMarker, i);
                    break;
                case t.BIRTH.INVALID_FORMAT:
                    this._showErrorTooltip(this._getInvalidBirthField(), i);
                    break;
                case t.NAME.PROFILE_FORBIDDEN_NAME_DETAIL:
                case t.NAME.PROFILE_NAME_REQUIRED:
                    this._showErrorTooltip(this._getInvalidNameField(), i);
                    break;
                case t.NAME.PROFILE_FORBIDDEN_NAME:
                    o.alert(i);
                    break;
                case t.STORYID.NOT_TO_CHANGE:
                    break;
                case t.ETC.INTERNAL_ERROR:
                    o.alert(intl.t("error.general"));
                    break;
                default:
                    o.alert(i)
            }
        },
        _getReasonJSON: function(e, t) {
            return {
                responseJSON: {
                    message: e,
                    status: t
                }
            }
        },
        _checkBirthday: function(e, t, i) {
            return 0 === (e + t + i).length ? !0 : r.isValidBirthday(e, t, i) ? !0 : (this._showErrorTooltip(this._getInvalidBirthField(), intl.t("register.birth.invalidBirth")), !1)
        },
        _showErrorTooltip: function(t, i) {
            var r = t.data("id");
            t.addClass(this.styles.error), t.find("._tooltip").html(e.tooltip({
                message: i
            })).show(), this._tooltipTimer[r] && (clearTimeout(this._tooltipTimer[r]), this._tooltipTimer[r] = null), this._tooltipTimer[r] = setTimeout(_.bind(this._hideErrorTooltip, this, t), h)
        },
        _hideErrorTooltip: function(e) {
            e.removeClass(this.styles.error), e.find("._tooltip").hide().html("")
        },
        _checkName: function(e, t) {
            return 0 === e.length ? (this._showErrorTooltip(this.ui.firstNameMarker, intl.t("register.name.firstNameRequired")), !1) : 0 === t.length ? (this._showErrorTooltip(this.ui.lastNameMarker, intl.t("register.name.lastNameRequired")), !1) : !0
        },
        _getInvalidBirthField: function() {
            var e = this.ui.birthYear.val(),
                t = this.ui.birthMonth.val();
            return 0 === e.length ? this.ui.birthYear.closest("._yearMarker") : r.isValidDate(e, "YYYY") && r.isValidBirthYear(e) ? 0 === t.length ? this.ui.birthMonth.closest("._monthMarker") : r.isValidDate((e + t).substring(0, 6), "YYYYMM") ? this.ui.birthDate.closest("._dateMarker") : this.ui.birthMonth.closest("._monthMarker") : this.ui.birthYear.closest("._yearMarker")
        },
        _getInvalidNameField: function() {
            var e = r.trim(this.ui.firstName.val()),
                t = r.trim(this.ui.lastName.val()),
                i = this.ui.firstName,
                a = this.ui.lastName,
                l = "._firstNameMarker",
                s = "._lastNameMarker";
            return r.isValidStoryNameChar(e) ? r.isValidStoryNameChar(t) && e.length > t.length ? i.closest(l) : a.closest(s) : i.closest(l)
        },
        _updateProfileImage: function() {
            this.ui.profileImage.prop("src", s.getUrl(this.model.get("profile_image_url"), n.WIDTH)), a.resize(this.ui.profileImage, null, {
                containerWidth: n.WIDTH,
                containerHeight: n.HEIGHT
            })
        },
        _updateSubmitBtn: function() {
            var e = r.trim(this.ui.firstName.val()),
                t = r.trim(this.ui.lastName.val()),
                i = this.ui.privacyCheckBox.prop("checked");
            return 0 === e.length || 0 === t.length ? void this._disableSubmitBtn() : i ? void this._enableSubmitBtn() : void this._disableSubmitBtn()
        },
        _disableSubmitBtn: function() {
            var e = this.ui.submitBtn;
            e.addClass(this.styles.disabledCursor).addClass(this.styles.inactive).removeClass(this.styles.active), this._submitBtnEnabled = !1
        },
        _enableSubmitBtn: function() {
            var e = this.ui.submitBtn;
            e.addClass(this.styles.active).removeClass(this.styles.disabledCursor).removeClass(this.styles.inactive), this._submitBtnEnabled = !0
        },
        onSetup: function() {
            this.model = new t, this.listenTo(this.model, "change:profile_image_url", this._updateProfileImage)
        },
        initialize: function() {
            this._profileImageMediaPath = null, this._tooltipTimer = {}, this._placeholders = null, this._submitBtnEnabled = !1
        },
        onRender: function() {
            this._placeholders = [{
                name: "firstNamePlaceholder",
                fieldSelector: "._firstName",
                placeholder: this.ui.firstNamePlaceholder
            }, {
                name: "lastNamePlaceholder",
                fieldSelector: "._lastName",
                placeholder: this.ui.lastNamePlaceholder
            }, {
                name: "yearPlaceholder",
                fieldSelector: "._birthYear",
                placeholder: this.ui.yearPlaceholder
            }, {
                name: "monthPlaceholder",
                fieldSelector: "._birthMonth",
                placeholder: this.ui.monthPlaceholder
            }, {
                name: "datePlaceholder",
                fieldSelector: "._birthDate",
                placeholder: this.ui.datePlaceholder
            }, {
                name: "storyIdPlaceholder",
                fieldSelector: "._storyId",
                placeholder: this.ui.storyIdPlaceholder
            }], this._addPlaceholder(), this._updateProfileImage()
        },
        onDomReady: function() {
            this._updateSubmitBtn()
        },
        _addPlaceholder: function() {
            _.each(this._placeholders, function(e) {
                this.addPart(e.name, "part/plugin/PlaceholderPart", {
                    selector: e.fieldSelector,
                    options: {
                        placeholder: e.placeholder
                    }
                })
            }, this)
        },
        _updatePlaceholder: function() {
            _.each(this._placeholders, function(e) {
                this.isAvailableChildPart(e.name) && this.childParts[e.name].update()
            }, this)
        },
        hide: function() {
            this._resetForm()
        },
        reposition: function() {
            var e = this.$el.outerHeight();
            this.$el.css("margin-top", e / -2 + "px")
        },
        _resetForm: function() {
            this.isRendered() && (this.ui.profileForm[0].reset(), this._updatePlaceholder()), this.model && this.model.set("profile_image_url", ""), this.isAvailableChildPart("profileImageEdit") && this.childParts.profileImageEdit.disableDelBtn()
        },
        _showInProgressLayer: function() {
            this.ui.inProgress.show()
        },
        _hideInProgressLayer: function() {
            this.ui.inProgress.hide()
        }
    })
});
define("model/MediaPreview", [], function() {
    var e = {
        READY: "ready",
        WAIT: "wait",
        PROGRESS: "progress",
        SUCCESS: "success",
        FAIL: "fail"
    };
    return space.Model.extend({
        UPLOAD_STATE: e,
        defaults: {
            id: null,
            state: e.READY,
            mediaPath: "",
            kageAccessKey: "",
            previewPath: "",
            contentType: "",
            fileSize: "",
            visible: !0
        },
        isSuccess: function() {
            return this.get("state") === this.UPLOAD_STATE.SUCCESS
        },
        isReady: function() {
            return this.get("state") === this.UPLOAD_STATE.READY
        },
        _readFileAsDataUrl: function(e) {
            var t = Q.defer();
            return _.extend(new FileReader, {
                onload: function(e) {
                    var r = e.target.result;
                    t.resolve(r)
                },
                onerror: function() {
                    t.reject(this)
                }
            }).readAsDataURL(e), t.promise
        },
        destroy: function() {
            this.trigger("destroy", this)
        },
        requestFileUpload: null
    })
});
define("model/PhotoPreview", ["model/MediaPreview", "common/kage"], function(e, t) {
    var i = {
        GIF: "image/gif"
    }, s = {
        GIF: "gif",
        OTHERS: "others"
    }, n = e.extend({
        initialize: function() {
            this._fileUploadPromise = Q.resolve()
        },
        requestFileUpload: function(e) {
            var i;
            return i = $.isPlainObject(e) ? _.extend({}, e) : {
                method: t.UPLOAD_METHOD.IFRAME,
                input: e[0]
            }, this._requestFileUpload(i)
        },
        _requestFileUpload: function(e) {
            var i = this;
            return this.set("uploadOptions", e), this.set("state", this.UPLOAD_STATE.PROGRESS), this._fileUploadPromise = t.requestPictureFileUpload(e).then(function(e) {
                return i.set({
                    state: i.UPLOAD_STATE.SUCCESS,
                    mediaPath: e.mediaPath,
                    downloadPath: e.downloadPath,
                    kageAccessKey: e.kageAccessKey,
                    previewPath: e.previewPath,
                    contentType: e.contentType,
                    fileSize: e.fileSize
                }), Q.resolve(e)
            }).fail(function(e) {
                return i.set("state", i.UPLOAD_STATE.FAIL), Q.reject(e)
            }).progress(function() {
                i.set("state", i.UPLOAD_STATE.PROGRESS)
            }), this._fileUploadPromise
        },
        isProgress: function() {
            return this.get("state") === this.UPLOAD_STATE.PROGRESS
        },
        isDone: function() {
            return this.get("state") === this.UPLOAD_STATE.SUCCESS || this.get("state") === this.UPLOAD_STATE.FAIL
        },
        isGif: function() {
            return this.isDone() ? this.get("contentType") === i.GIF : this.get("uploadOptions") && this.get("uploadOptions").isGif
        },
        getFileUploadPromise: function() {
            return this._fileUploadPromise
        }
    });
    return n.CONTENT_TYPE = i, n.EXTENSION = s, n
});
define("part/auth/ProfileImageEditPart", ["template/auth", "part/plugin/LayerPart", "model/PhotoPreview", "module/static/dialog", "module/static/error"], function(e, t, i, n, l) {
    return t.extend({
        model: null,
        ui: _.defaults({
            delBtn: "._btnDelete"
        }, t.prototype.ui),
        events: {
            "click ._btnDelete": function(e) {
                e.preventDefault(), this.trigger("delete"), this.hide()
            },
            "change ._uploadInputForm": function(e) {
                var t, a = $(e.currentTarget),
                    r = this;
                a.val() && (t = new i, t.requestFileUpload(a).then(function(e) {
                    return e.contentType === i.CONTENT_TYPE.GIF ? n.alert(intl.t("profile.image.invalidFileByGif")) : void r.trigger("upload", t)
                }).fail(l.getHandler()).fin(function() {
                    a.closest("form")[0].reset(), r.hide()
                }))
            }
        },
        initialize: function() {
            t.prototype.initialize.apply(this, arguments), this._delBtnEnabled = !1
        },
        enableDelBtn: function() {
            this._delBtnEnabled = !0, this.ui.delBtn.show()
        },
        disableDelBtn: function() {
            this._delBtnEnabled = !1, this.ui.delBtn.hide()
        }
    })
});
define("part/gnb/NewFeedAlarmPart", ["template/gnb", "module/static/cover", "common/util", "common/animate", "common/headerArea"], function(e, t, i, n, o) {
    var s = 100,
        h = 100,
        l = 2500;
    return space.Part.extend({
        template: e.newFeed,
        skipGlobalEvents: !0,
        ui: {
            count: "._newFeedCount"
        },
        initialize: function() {
            this._timerNewFeed = null
        },
        onSetup: function() {
            this.listenTo(t, "show", function() {
                this.hideNewFeed()
            })
        },
        onRoute: function() {
            this.hideNewFeed()
        },
        showNewFeed: function(e) {
            var t = agent.type.is.mobile ? 0 : o.getBottom();
            this.attachGlobalEvents(), this._timerNewFeed && (clearTimeout(this._timerNewFeed), this._timerNewFeed = null), this.$el.is(":visible") || n(this.$el.css("top", 0).show(), {
                top: t
            }, s), e && this.ui.count.text(i.numberFormat(e))
        },
        hideNewFeed: function(e) {
            var t = this,
                i = function() {
                    n(t.$el, {
                        top: 0
                    }, s).then(function() {
                        t.$el.hide(), t._timerNewFeed = null
                    })
                };
            this._timerNewFeed || (e ? this._timerNewFeed = setTimeout(i, l) : i()), this.detachGlobalEvents()
        },
        windowEvents: {
            scroll: _.throttle(function() {
                this.hideNewFeed(!0)
            }, h)
        },
        events: {
            "click ._viewNewFeed": function(e) {
                e.preventDefault(), this.hideNewFeed(), this.trigger("viewNewFeed")
            }
        }
    })
});
define("model/fragment", [], function() {
    return {
        clone: function(t, i) {
            var n = t.constructor,
                e = space.Collection.extend({
                    model: n.model,
                    originalCollection: t,
                    comparator: t.comparator || null,
                    initialize: function() {
                        var n = t.first(i.limit);
                        this.set(n), this._nextIdx = n.length, this.listenTo(this.originalCollection, {
                            add: function(t, n, e) {
                                (0 === e.at || i.intoTheMiddle && n.indexOf(t) < this._nextIdx) && (this.add(t, e), this._nextIdx++)
                            },
                            remove: function(t) {
                                this.remove(t)
                            }
                        })
                    },
                    addNextFragment: function() {
                        if (this.hasNextFragment()) {
                            var t = this.originalCollection.length,
                                n = this._nextIdx,
                                e = Math.min(this._nextIdx + i.limit, t);
                            this.add(this.originalCollection.slice(n, e)), this._nextIdx = e
                        }
                    },
                    hasNextFragment: function() {
                        return this._nextIdx < this.originalCollection.length
                    },
                    isRequireFetch: function() {
                        return this._nextIdx + i.limit > this.originalCollection.length
                    }
                });
            return new e
        }
    }
});
define("template/notification", ["Handlebars"], function(a) {
    var t = function(t) {
        var r = a.template(t);
        return function(a) {
            return r(a, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        noItem: function() {
            var a = t(function(a, t, e, r, s) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var l, i, n = "",
                    o = e.helperMissing,
                    c = this.escapeExpression;
                return n += "<li>" + c((l = e.t || t && t.t, i = {
                    hash: {},
                    data: s
                }, l ? l.call(t, "gnb.noti.noRecent", i) : o.call(t, "t", "gnb.noti.noRecent", i))) + "</li>"
            });
            return a
        }(),
        activities: function() {
            var a = t(function(a, t, e, r, s) {
                function l(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="ico_feel ico_', (s = e.emotion) ? r = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.emotion, r = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), l += v(r) + '"></span> '
                }
                function i(a, t) {
                    var r, s, l = "";
                    return l += '<p class="add _mobileMaxWidth">"', (s = e.content) ? r = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.content, r = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), (r || 0 === r) && (l += r), l += '<span>"</span></p> '
                }
                function n(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="img_thmb _activityImageContainer"><img src="', (s = e.thumbnail_url) ? r = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.thumbnail_url, r = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), l += v(r) + '" class="_activityImage"></span> '
                }
                function o(a, t) {
                    var r, s = "";
                    return s += " ", r = e["if"].call(a, a && a.thumbnail_text, {
                        hash: {},
                        inverse: _.noop,
                        fn: _.program(8, c, t),
                        data: t
                    }), (r || 0 === r) && (s += r), s += " "
                }
                function c(a, t) {
                    var r, s, l = "";
                    return l += ' <em class="tx_thmb">', (s = e.thumbnailText) ? r = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.thumbnailText, r = typeof s === g ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), (r || 0 === r) && (l += r), l += "</em> "
                }
                function h(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + v((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "a h:mm", s) : I.call(a, "dateFormat", a && a.created_at, "a h:mm", s))) + "</span> "
                }
                function d(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + v((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "MMM Do", s) : I.call(a, "dateFormat", a && a.created_at, "MMM Do", s))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var p, m, f, u = "",
                    g = "function",
                    v = this.escapeExpression,
                    _ = this,
                    I = e.helperMissing;
                return u += '<a href="/', (m = e.targetProfileId) ? p = m.call(t, {
                    hash: {},
                    data: s
                }) : (m = t && t.targetProfileId, p = typeof m === g ? m.call(t, {
                    hash: {},
                    data: s
                }) : m), u += v(p) + "/", (m = e.activityUrlKey) ? p = m.call(t, {
                    hash: {},
                    data: s
                }) : (m = t && t.activityUrlKey, p = typeof m === g ? m.call(t, {
                    hash: {},
                    data: s
                }) : m), u += v(p) + '" data-kant-id="320" data-target-id="', (m = e.activityId) ? p = m.call(t, {
                    hash: {},
                    data: s
                }) : (m = t && t.activityId, p = typeof m === g ? m.call(t, {
                    hash: {},
                    data: s
                }) : m), u += v(p) + '" class="_notification"><div class="img_cover"><span class="img_user _profileImageContainer"><img src="' + v((m = e.profileImage || t && t.profileImage, f = {
                    hash: {
                        url: (p = t && t.actor, null == p || p === !1 ? p : p.profile_thumbnail_url),
                        size: "36"
                    },
                    data: s
                }, m ? m.call(t, f) : I.call(t, "profileImage", f))) + '" class="_profileImage"><span class="line"></span></span> ', p = e["if"].call(t, t && t.hasEmoticon, {
                    hash: {},
                    inverse: _.noop,
                    fn: _.program(1, l, s),
                    data: s
                }), (p || 0 === p) && (u += p), u += '</div><div class="intx"><p>', (m = e.messageText) ? p = m.call(t, {
                    hash: {},
                    data: s
                }) : (m = t && t.messageText, p = typeof m === g ? m.call(t, {
                    hash: {},
                    data: s
                }) : m), (p || 0 === p) && (u += p), u += "</p>", p = e["if"].call(t, t && t.hasContent, {
                    hash: {},
                    inverse: _.noop,
                    fn: _.program(3, i, s),
                    data: s
                }), (p || 0 === p) && (u += p), u += "</div>", p = e["if"].call(t, t && t.hasThumbnail, {
                    hash: {},
                    inverse: _.program(7, o, s),
                    fn: _.program(5, n, s),
                    data: s
                }), (p || 0 === p) && (u += p), u += " ", p = e["if"].call(t, t && t.isToday, {
                    hash: {},
                    inverse: _.program(12, d, s),
                    fn: _.program(10, h, s),
                    data: s
                }), (p || 0 === p) && (u += p), u += "</a>"
            });
            return a.wrap = "<li>", a
        }(),
        profiles: function() {
            var a = t(function(a, t, e, r, s) {
                function l(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "a h:mm", s) : d.call(a, "dateFormat", a && a.created_at, "a h:mm", s))) + "</span> "
                }
                function i(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "MMM Do", s) : d.call(a, "dateFormat", a && a.created_at, "MMM Do", s))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var n, o, c, h = "",
                    d = e.helperMissing,
                    p = this.escapeExpression,
                    m = "function",
                    f = this;
                return h += '<a href="/', (o = e.profileId) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.profileId, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), h += p(n) + '" data-kant-id="321" data-target-id="', (o = e.profileId) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.profileId, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), h += p(n) + '" class="_notification"><div class="img_cover"><span class="img_user _profileImageContainer"><img src="' + p((o = e.profileImage || t && t.profileImage, c = {
                    hash: {
                        url: (n = t && t.actor, null == n || n === !1 ? n : n.profile_thumbnail_url),
                        size: "36"
                    },
                    data: s
                }, o ? o.call(t, c) : d.call(t, "profileImage", c))) + '" class="_profileImage"><span class="line"></span></span></div><div class="intx"><p>', (o = e.messageText) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.messageText, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), (n || 0 === n) && (h += n), h += "</p></div>", n = e["if"].call(t, t && t.isToday, {
                    hash: {},
                    inverse: f.program(3, i, s),
                    fn: f.program(1, l, s),
                    data: s
                }), (n || 0 === n) && (h += n), h += "</a>"
            });
            return a.wrap = "<li>", a
        }(),
        storyplus: function() {
            var a = t(function(a, t, e, r, s) {
                function l(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "a h:mm", s) : d.call(a, "dateFormat", a && a.created_at, "a h:mm", s))) + "</span> "
                }
                function i(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "MMM Do", s) : d.call(a, "dateFormat", a && a.created_at, "MMM Do", s))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var n, o, c, h = "",
                    d = e.helperMissing,
                    p = this.escapeExpression,
                    m = "function",
                    f = this;
                return h += '<a href="', (o = e.storyPlusUrl) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.storyPlusUrl, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), h += p(n) + '" class="_notification" target="_blank" data-kant-id="528"><div class="img_cover"><span class="img_user _profileImageContainer"><img src="' + p((o = e.profileImage || t && t.profileImage, c = {
                    hash: {
                        url: (n = t && t.actor, null == n || n === !1 ? n : n.profile_thumbnail_url),
                        size: "36"
                    },
                    data: s
                }, o ? o.call(t, c) : d.call(t, "profileImage", c))) + '" class="_profileImage"><span class="line"></span></span></div><div class="intx"><p>', (o = e.messageText) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.messageText, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), (n || 0 === n) && (h += n), h += "</p></div>", n = e["if"].call(t, t && t.isToday, {
                    hash: {},
                    inverse: f.program(3, i, s),
                    fn: f.program(1, l, s),
                    data: s
                }), (n || 0 === n) && (h += n), h += "</a>"
            });
            return a.wrap = "<li>", a
        }(),
        friendship: function() {
            var a = t(function(a, t, e, r, s) {
                function l(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "a h:mm", s) : d.call(a, "dateFormat", a && a.created_at, "a h:mm", s))) + "</span> "
                }
                function i(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "MMM Do", s) : d.call(a, "dateFormat", a && a.created_at, "MMM Do", s))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var n, o, c, h = "",
                    d = e.helperMissing,
                    p = this.escapeExpression,
                    m = "function",
                    f = this;
                return h += '<a href="/', (o = e.meProfileId) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.meProfileId, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), h += p(n) + '/friends/requests" data-kant-id="322"><div class="img_cover"><span class="img_user _profileImageContainer"><img src="' + p((o = e.profileImage || t && t.profileImage, c = {
                    hash: {
                        url: (n = t && t.actor, null == n || n === !1 ? n : n.profile_thumbnail_url),
                        size: "36"
                    },
                    data: s
                }, o ? o.call(t, c) : d.call(t, "profileImage", c))) + '" class="_profileImage"><span class="line"></span></span></div><div class="intx"><p>', (o = e.messageText) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.messageText, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), (n || 0 === n) && (h += n), h += "</p></div>", n = e["if"].call(t, t && t.isToday, {
                    hash: {},
                    inverse: f.program(3, i, s),
                    fn: f.program(1, l, s),
                    data: s
                }), (n || 0 === n) && (h += n), h += "</a>"
            });
            return a.wrap = "<li>", a
        }(),
        "default": function() {
            var a = t(function(a, t, e, r, s) {
                function l(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "a h:mm", s) : d.call(a, "dateFormat", a && a.created_at, "a h:mm", s))) + "</span> "
                }
                function i(a, t) {
                    var r, s, l = "";
                    return l += ' <span class="date">' + p((r = e.dateFormat || a && a.dateFormat, s = {
                        hash: {},
                        data: t
                    }, r ? r.call(a, a && a.created_at, "MMM Do", s) : d.call(a, "dateFormat", a && a.created_at, "MMM Do", s))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var n, o, c, h = "",
                    d = e.helperMissing,
                    p = this.escapeExpression,
                    m = "function",
                    f = this;
                return h += '<a href="/', (o = e.meProfileId) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.meProfileId, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), h += p(n) + '" data-kant-id="323"><div class="img_cover"><span class="img_user _profileImageContainer"><img src="' + p((o = e.profileImage || t && t.profileImage, c = {
                    hash: {
                        url: (n = t && t.actor, null == n || n === !1 ? n : n.profile_thumbnail_url),
                        size: "36"
                    },
                    data: s
                }, o ? o.call(t, c) : d.call(t, "profileImage", c))) + '" class="_profileImage"><span class="line"></span></span></div><div class="intx"><p>', (o = e.messageText) ? n = o.call(t, {
                    hash: {},
                    data: s
                }) : (o = t && t.messageText, n = typeof o === m ? o.call(t, {
                    hash: {},
                    data: s
                }) : o), (n || 0 === n) && (h += n), h += "</p></div>", n = e["if"].call(t, t && t.isToday, {
                    hash: {},
                    inverse: f.program(3, i, s),
                    fn: f.program(1, l, s),
                    data: s
                }), (n || 0 === n) && (h += n), h += "</a>"
            });
            return a.wrap = "<li>", a
        }(),
        decoratorProfile: function() {
            var a = t(function(a, t, e, r, s) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var l, i, n = "",
                    o = "function",
                    c = this.escapeExpression;
                return n += "<strong>", (i = e.text) ? l = i.call(t, {
                    hash: {},
                    data: s
                }) : (i = t && t.text, l = typeof i === o ? i.call(t, {
                    hash: {},
                    data: s
                }) : i), n += c(l) + "</strong>"
            });
            return a
        }(),
        loading: function() {
            var a = t(function(a, t, e, r, s) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var l, i, n = "",
                    o = e.helperMissing,
                    c = this.escapeExpression;
                return n += "<li>" + c((l = e.img || t && t.img, i = {
                    hash: {
                        src: "/img/loading_circle.gif",
                        width: "24",
                        height: "24",
                        alt: "gnb.noti.loading"
                    },
                    data: s
                }, l ? l.call(t, i) : o.call(t, "img", i))) + "</li>"
            });
            return a
        }()
    }
});
define("part/notification/NotificationListPart", ["model/me", "model/Notification", "model/fragment", "part/plugin/LayerPart", "template/notification", "common/animate", "common/decoratorUtil", "common/imgUtil", "common/headerArea", "module/static/error", "moment"], function(t, i, e, a, n, o, s, r, l, h, c) {
    var d = 84,
        m = 100,
        g = .8,
        u = 37,
        f = {
            TRANSPARENT: 0,
            OPAQUE: 1
        }, p = 6,
        P = 3,
        y = "<br>",
        T = "...",
        N = "170",
        v = 10,
        I = space.Part.extend({
            model: null,
            tagName: "li",
            ui: {
                profileImage: "._profileImage",
                profileImageContainer: "._profileImageContainer",
                activityImage: "._activityImage",
                activityImageContainer: "._activityImageContainer",
                mobileMaxWidth: "._mobileMaxWidth"
            },
            styles: {
                read: "read"
            },
            onSetup: function() {
                var t = this.model.get("notificationType"),
                    e = n.noItem;
                if (t) switch (t) {
                    case i.TYPE.ACTIVITIES:
                        e = n.activities;
                        break;
                    case i.TYPE.PROFILES:
                        e = n.profiles;
                        break;
                    case i.TYPE.FRIENDSHIP:
                        e = n.friendship;
                        break;
                    case i.TYPE.STORYPLUS:
                        e = n.storyplus;
                        break;
                    case i.TYPE.NOTIFICATIONS:
                    case i.TYPE.UPGRADE:
                    case i.TYPE.UNKNOWN:
                        e = n["default"]
                }
                this.template = e, this.listenTo(this.model, "change:is_new", function() {
                    this.model.get("is_new") || this.$el.addClass(this.styles.read)
                })
            },
            extendData: function() {
                var i, e = this.model.get("decorators"),
                    a = c(this.model.get("created_at")).isSame(new Date, "day"),
                    o = this.model.get("thumbnail_text");
                return o = !this.model.get("hasThumbnail") && o ? this._ellipsisThumbnailText(o) : "", i = e ? s.toMarkup(e, {
                    profile: n.decoratorProfile
                }) : this.model.get("message"), {
                    messageText: i,
                    meProfileId: t.get("id"),
                    isToday: a,
                    thumbnailText: o
                }
            },
            _ellipsisThumbnailText: function(t) {
                var i = 0;
                return t = t.replace(/ +/g, "").replace(/\n/g, ""), i = t.length, i > p && (t = t.substring(0, p - 1), t += T), i > P && (t = t.substring(0, P) + y + t.substring(P)), t
            },
            onRender: function() {
                this.$el.css("opacity", f.TRANSPARENT), this.model.get("is_new") || this.$el.addClass(this.styles.read), r.resize(this.ui.profileImage, this.ui.profileImageContainer), this.model.get("hasThumbnail") && r.resize(this.ui.activityImage, this.ui.activityImageContainer), this.$el.css("opacity", f.OPAQUE), agent.type.is.mobile && this.ui.mobileMaxWidth && this.ui.mobileMaxWidth.css("max-width", N + "px")
            }
        });
    return a.extend({
        itemPart: I,
        itemPartContainer: "._notiList",
        ui: _.defaults({
            notiList: "._notiList"
        }, a.prototype.ui),
        styles: _.defaults({
            noData: "no_data"
        }, a.prototype.styles),
        collectionEvents: {
            add: function(t, i, e) {
                this._isLoading && this._removeLoading(), this._isNoData && this._removeNoData(), this.addItemPart(t, i, e)
            },
            remove: "removeItemPart"
        },
        events: {
            "click ._notiList": function() {
                this.hide()
            },
            "click ._notification": function(t) {
                var i = $(t.currentTarget).attr("data-target-id");
                this.collection.originalCollection.setReadingMark(i)
            }
        },
        initialize: function() {
            this._isLoading = !1, this._$loading = null, this._isNoData = !1, this._$noData = null, this._height = 0, this._newAddedModels = [], this._isFirstFetch = !0, a.prototype.initialize.apply(this, arguments)
        },
        onSetup: function() {
            this.collection = e.clone(this.collection, {
                limit: v
            })
        },
        onRender: function() {
            this.childParts.scroll || this.addPart("scroll", "part/plugin/ScrollPart", {
                selector: "._notiList"
            }), this.childParts.infinityScroll || this.addPart("infinityScroll", "part/plugin/InfinityScrollPart", {
                selector: "._notiList",
                listeners: {
                    end: function() {
                        this.collection.addNextFragment()
                    }
                }
            }).next(function() {
                this.childParts.infinityScroll.activate()
            }), 0 === this.collection.length && this._addLoading()
        },
        show: function() {
            a.prototype.show.apply(this, arguments), this.itemPartContainer.scrollTop(0), this._resizeHeight()
        },
        itemFilter: function(t) {
            var e = !0;
            switch (t.get("notificationType")) {
                case i.TYPE.NOTIFICATIONS:
                case i.TYPE.UPGRADE:
                case i.TYPE.UNKNOWN:
                    e = !1
            }
            return e
        },
        _addLoading: function() {
            this._isLoading || (this._isLoading = !0, this.itemPartContainer.addClass(this.styles.noData), this._$loading = $(n.loading()).appendTo(this.itemPartContainer))
        },
        _removeLoading: function() {
            this._$loading.remove(), this.itemPartContainer.removeClass(this.styles.noData), this._$loading = null, this._isLoading = !1
        },
        _resizeHeight: function() {
            var t = agent.type.is.mobile ? this._getMobileLayerHeight() : this._getLayerHeight();
            this._height !== t && (this._height = t, this.itemPartContainer.height(t))
        },
        _getMobileLayerHeight: function() {
            return $(window).height() - l.getBottom()
        },
        _getLayerHeight: function() {
            var t = this.getItemParts(),
                i = Math.round($(window).height() * g) - m,
                e = 0;
            if (0 === t.length) return d;
            for (var a = 0, n = t.length; n > a; a++) if (e += t[a].$el.outerHeight(), e >= i) return i;
            return t.length % v === 0 && (e -= u), e
        },
        fetchNewNotification: function() {
            var t = this,
                i = this.collection.originalCollection;
            return i.fetch().then(function() {
                0 === i.length ? t._setNoNotifications() : t._isFirstFetch && (t.collection.addNextFragment(), t._isFirstFetch = !1), t._resizeHeight()
            }).fail(h.getHandler()).fail(function() {
                t.hide()
            })
        },
        _setNoNotifications: function() {
            this._isLoading && this._removeLoading(), this._addNoData()
        },
        _addNoData: function() {
            this._isNoData || (this._isNoData = !0, this.itemPartContainer.addClass(this.styles.noData), this._$noData = $(n.noItem()).appendTo(this.itemPartContainer))
        },
        _removeNoData: function() {
            this._$noData.remove(), this.itemPartContainer.removeClass(this.styles.noData), this._$noData = null, this._isNoData = !1
        }
    })
});
define("part/gnb/SuggestionAreaPart", ["model/Suggestion", "model/me", "template/gnb"], function(t, e, i) {
    var n = 200;
    return space.Part.extend({
        template: i.suggestionArea,
        childParts: {
            suggestionInput: "part/gnb/GnbSuggestionInputPart",
            suggestionLayer: "part/gnb/SuggestionLayerPart"
        },
        onSetup: function() {
            var i = new(t.extend({
                includeHashtag: !0
            })),
                n = this.childParts.suggestionInput,
                s = this.childParts.suggestionLayer;
            e.isRegistered() && i.setPermission(t.PERMISSION.ALL), n.model = i, s.model = i, this._listenSuggestionInput(), this._listenSuggestionLayer()
        },
        _listenSuggestionInput: function() {
            var t, e = this.childParts.suggestionInput,
                i = this.childParts.suggestionLayer;
            this.listenTo(e, {
                searchStart: function() {
                    i.show(), clearTimeout(t), t = setTimeout(function() {
                        i.showLoading()
                    }, n)
                },
                searchEnd: function() {
                    i.hideLoading(), clearTimeout(t)
                },
                searchError: function() {
                    i.showErrorMessage()
                },
                clear: function() {
                    i.hide()
                },
                close: function() {
                    this.trigger("close"), agent.type.is.mobile && $(window).scrollTop(0)
                },
                up: function() {
                    i.isShown() && i.activatePrevItem()
                },
                down: function() {
                    i.isShown() && i.activateNextItem()
                },
                enter: function() {
                    i.isShown() && i.selectCurrentItem()
                },
                focusOnExistingQuery: function() {
                    i.isShown() || (e.searchWithPrevQuery(), e.selectQuery())
                }
            })
        },
        _listenSuggestionLayer: function() {
            var t = this.childParts.suggestionInput,
                e = this.childParts.suggestionLayer;
            this.listenTo(e, {
                selectLink: function() {
                    t.clear(), this.trigger("close")
                },
                show: function() {
                    agent.type.is.mobile && (t.scrollToInput(), t.disableTouchScroll())
                },
                hide: function() {
                    agent.type.is.mobile && t.enableTouchScroll()
                }
            })
        },
        toggleSuggestionInput: function(t) {
            this.isAvailableChildPart("suggestionInput") && (this.childParts.suggestionInput.toggle(t), t && this.childParts.suggestionInput.focus())
        },
        onRoute: function() {
            this.trigger("close")
        }
    })
});
define("part/gnb/SnbPart", ["template/gnb", "model/me"], function(e, t) {
    return space.Part.extend({
        template: e.snb,
        model: null,
        ui: {
            snbMenus: "._snbMenus",
            feed: "._snbFeed",
            myStory: "._snbMyStory",
            friends: "._snbFriends",
            more: "._snbMore",
            newInvitationBadge: "._newInvitationBadge"
        },
        styles: {
            selected: "selected"
        },
        events: {
            "click ._snbMore": function(e) {
                var t = space.Router.getPath();
                space.Router.navigate("/s/more", {
                    params: {
                        from: "/" + t
                    }
                }), e.preventDefault()
            }
        },
        onSetup: function() {
            this.model = t, this.listenTo(t.get("newCount"), {
                "change:received_count": function() {
                    this._updateNewInvitationBadge()
                }
            })
        },
        _updateNewInvitationBadge: function() {
            var e = !1;
            this.ui.newInvitationBadge && (e = !! t.get("newCount").get("received_count"), this.ui.newInvitationBadge.toggle(e))
        },
        onRender: function() {
            this._highlightMenu()
        },
        onRoute: function() {
            this._highlightMenu()
        },
        _highlightMenu: function() {
            var e, n = space.Router.getPath(),
                i = this.styles.selected;
            switch (n) {
                case t.get("urlKey"):
                    e = this.ui.myStory;
                    break;
                case "s/friends":
                    e = this.ui.friends;
                    break;
                case "s/more":
                    e = this.ui.more;
                    break;
                default:
                    ("" === n || 0 === n.indexOf("hashtag/")) && (e = this.ui.feed)
            }
            this.ui.snbMenus.removeClass(i), e && e.addClass(i)
        }
    })
});
define("part/gnb/FriendLayerPart", ["template/gnbFriend", "model/me", "common/util", "common/urlUtil", "common/kantUtil", "part/gnb/FriendMenuPart", "part/plugin/LayerPart"], function(t, i, e, s, n, a, r) {
    return r.extend({
        template: t.layout,
        childParts: {
            menu: "part/gnb/FriendMenuPart"
        },
        ui: _.defaults({
            firstShadow: "._friendLayerFirstShadow",
            lastShadow: "._friendLayerLastShadow",
            loading: "._gnbFriendLoading"
        }, r.prototype.ui),
        events: _.defaults({
            "click ._gnbFriendLink": function() {
                this.hide()
            },
            "focusin ._friendLayerFirstShadow": function() {
                this.layerOpenerButton.focus()
            },
            "focusin ._friendLayerLastShadow": function() {
                this.layerOpenerButton.focus()
            }
        }, r.prototype.events),
        layerOpenerButton: null,
        options: _.defaults({
            openType: function(t) {
                this._openType = t || a.TYPE.FRIENDS
            }
        }, r.prototype.options),
        initialize: function() {
            r.prototype.initialize.call(this), this._openType = null
        },
        onSetup: function() {
            this.listenTo(this.childParts.menu, {
                change: function(t) {
                    this.isAvailableChildPart("list") && this.removePart("list"), "friends" === t ? (this._addFriendListPart(), n.sendPageView("frd.01")) : "requests" === t && (this._addFriendRequestsPart(), n.sendPageView("frd.02"))
                },
                restore: function() {
                    this.isAvailableChildPart("list") && this.childParts.list.show()
                }
            })
        },
        onRender: function() {
            switch (this._openType) {
                case a.TYPE.REQUESTS:
                    this.childParts.menu.selectRequestsMenu();
                    break;
                default:
                    this.childParts.menu.selectFriendsMenu()
            }
        },
        _addFriendListPart: function() {
            return this.ui.loading.show(), this.addPart("list", "part/gnb/FriendListPart", {
                listeners: {
                    domReady: function() {
                        this.ui.loading.hide()
                    }
                }
            }).next(function() {
                this.childParts.list.show()
            })
        },
        _addFriendRequestsPart: function() {
            return this.ui.loading.show(), this.addPart("list", "part/gnb/FriendRequestsPart", {
                listeners: {
                    domReady: function() {
                        this.ui.loading.hide()
                    }
                }
            }).next(function() {
                this.childParts.list.show()
            })
        },
        refreshList: function() {
            this.isAvailableChildPart("list") && this.childParts.list.render()
        },
        focus: function() {
            this.isAvailableChildPart("menu") && this.childParts.menu.focusFirstTab()
        },
        selectRequestsMenu: function() {
            this.isAvailableChildPart("menu") && this.childParts.menu.selectRequestsMenu()
        },
        show: function() {
            r.prototype.show.call(this), this.isAvailableChildPart("list") && this.childParts.list.show()
        },
        hide: function() {
            r.prototype.hide.call(this), this.childParts.menu.restoreSelection(), this.isAvailableChildPart("list") && this.childParts.list.hide()
        }
    })
});
define("part/plugin/TitleRecoveryPart", [], function() {
    var t = agent.isIe8AndBelow(),
        e = agent.browser.is.ie && 9 === agent.browser.version,
        i = 1e3,
        s = 1e3,
        o = "title",
        c = t && "object" == typeof document.attachEvent;
    return space.Part.extend({
        initialize: function() {
            this._documentTitle = null, this._checkTimer = null, this._stopTimer = null, this._isCheckStarted = !1
        },
        startCheck: function() {
            var i = this;
            this._stopTimer && (clearTimeout(this._stopTimer), this._stopTimer = null), this._isCheckStarted || (this._isCheckStarted = !0, this._documentTitle = document.title, c ? $(document).on("propertychange", function(t) {
                t.originalEvent.propertyName === o && i._recoverTitle()
            }) : (t || e) && this._titleCheck())
        },
        _titleCheck: function() {
            this._recoverTitle(), this._checkTimer = setTimeout(_.bind(this._titleCheck, this), i)
        },
        _stopCheck: function() {
            c ? $(document).off("propertychange") : e && this._checkTimer && (clearTimeout(this._checkTimer), this._checkTimer = null), this._isCheckStarted = !1
        },
        stopCheck: function() {
            this._stopTimer && (clearTimeout(this._stopTimer), this._stopTimer = null), this._stopTimer = setTimeout(_.bind(this._stopCheck, this), s)
        },
        onStop: this.stopCheck,
        _recoverTitle: function() {
            document.title !== this._documentTitle && (document.title = this._documentTitle)
        }
    })
});
define("part/writing/FriendInputPart", ["kant", "template/writing", "common/util", "model/me"], function(t, e, i, n) {
    var r = 50,
        a = 100,
        s = 485,
        d = "wrt",
        u = 200;
    return space.Part.extend({
        template: e.friendInput,
        ui: {
            inputWrapper: "._friendInputWrapper",
            input: "._friendInput",
            placeholder: "._friendInputPlaceholder"
        },
        initialize: function() {
            this._tags = [], this._previousQuery = ""
        },
        onRender: function() {
            var e = this;
            this.addPart("friendMentionLayer", "part/writing/FriendMentionLayerPart", {
                options: {
                    collection: n.get("friends")
                },
                selector: "._friendInputDropdownWrapper",
                listeners: {
                    selectItem: function(e) {
                        t.send(d + ".149"), this._addSelectedFriend(e), this._updatePlaceholder(), this._updateFriendInputVisibility(), this.focus()
                    }
                }
            }), this.addPart("autoResize", "part/plugin/AutoResizeWidthPart", {
                selector: "._friendInput",
                options: {
                    range: {
                        min: a,
                        max: s
                    }
                }
            }).next(function() {
                this.childParts.autoResize.activate(), this._updatePlaceholder()
            }), agent.isIe8AndBelow() && this.ui.input.on("propertychange", function(t) {
                "value" === t.originalEvent.propertyName && (e._updatePlaceholder(), e._showFriendMentionLayer())
            })
        },
        onStop: function() {
            agent.isIe8AndBelow() && this.ui.input.off("propertychange")
        },
        focus: function() {
            this.ui.input.focus()
        },
        _updatePlaceholder: function() {
            var t = !this.ui.input.val() && !this.hasWithTags();
            this.ui.placeholder.toggle(t)
        },
        events: {
            click: function(t) {
                t.preventDefault(), this.ui.input[0] !== document.activeElement && this.focus()
            },
            "focus ._friendInput": function() {
                t.send(d + ".396"), this._showFriendMentionLayer()
            },
            "keydown ._friendInput": function(t) {
                var e, n = agent.os.is.mac ? t.metaKey : t.ctrlKey;
                if (this.childParts.friendMentionLayer.isVisible() && this.childParts.friendMentionLayer.handleKeydown(t.keyCode)) return void t.preventDefault();
                if (!this.ui.input.val() && this._tags.length > 0) switch (t.keyCode) {
                    case i.KEY.BACKSPACE:
                        this._removeTags(_.last(this._tags).id), this._updatePlaceholder(), this.focus();
                        break;
                    case i.KEY.LEFT:
                        e = this.$el.find("._removeFriendTagBtn:last"), e.length && e.focus();
                        break;
                    case i.KEY.RIGHT:
                        e = this.$el.find("._removeFriendTagBtn:first"), e.length && e.focus();
                        break;
                    case i.KEY.ENTER:
                        t.preventDefault(), n && this.trigger("complete")
                }
            },
            "input ._friendInput": function() {
                this._updatePlaceholder(), this._showFriendMentionLayer()
            },
            "click ._removeFriendTagBtn": function(t) {
                t.preventDefault();
                var e = $(t.currentTarget).closest("._friendTag").attr("data-id");
                this._removeTags(e), this._updatePlaceholder(), this._updateFriendInputVisibility(), this.focus()
            },
            "keydown ._removeFriendTagBtn": function(t) {
                var e, n, r = $(t.currentTarget);
                switch (t.keyCode) {
                    case i.KEY.LEFT:
                        e = r.parent("._friendTag").prev("._friendTag").children("._removeFriendTagBtn");
                        break;
                    case i.KEY.RIGHT:
                        e = r.parent("._friendTag").next("._friendTag").children("._removeFriendTagBtn");
                        break;
                    case i.KEY.BACKSPACE:
                        n = $(t.currentTarget).closest("._friendTag").attr("data-id"), this._removeTags(n), this._updatePlaceholder(), this._updateFriendInputVisibility(), t.preventDefault();
                        break;
                    default:
                        return
                }
                e && e.length ? e.focus() : this.focus()
            }
        },
        hasWithTags: function() {
            return this._tags.length > 0
        },
        hasContent: function() {
            return !1
        },
        setWithTags: function(t) {
            t.each(function(t) {
                this._addSelectedFriend(t)
            }, this), this._updatePlaceholder(), this._updateFriendInputVisibility()
        },
        getWithTags: function() {
            return JSON.stringify(_.pluck(this._tags, "id"))
        },
        clearContent: function() {
            this.ui.input.val(""), this._previousQuery = "", this._tags = [], this._paintTags(), this._updatePlaceholder(), this.hide()
        },
        _addSelectedFriend: function(t) {
            this._addTags({
                id: t.get("id"),
                display_name: t.get("display_name"),
                profile_thumbnail_url: t.get("profile_thumbnail_url")
            }), this.ui.input.val("")
        },
        _showFriendMentionLayer: function() {
            var t = this.ui.input.val();
            t ? this.childParts.friendMentionLayer.show(t, {
                rejectList: _.pluck(this._tags, "id")
            }, {
                width: u
            }) : this._hideFriendMentionLayer()
        },
        _hideFriendMentionLayer: function() {
            this.childParts.friendMentionLayer.hide()
        },
        _updateFriendInputVisibility: function() {
            var t = this._tags.length >= r;
            this.ui.inputWrapper.toggle(!t)
        },
        _paintTags: function() {
            this.$el.find("._friendTag").remove(), _.each(this._tags, function(t) {
                var i = $(e.friendTag(t));
                i.insertBefore(this.ui.inputWrapper)
            }, this)
        },
        _addTags: function(t) {
            this._tags.push(t), this._paintTags(), this.trigger("change")
        },
        _removeTags: function(t) {
            this._tags = _.reject(this._tags, function(e) {
                return e.id === t
            }), this._paintTags(), this.trigger("change")
        }
    })
});
define("part/writing/PhotoModePart", ["template/writing", "model/PhotoPreview", "module/static/dialog", "module/static/loginView", "common/kage", "common/api", "common/util", "common/urlUtil"], function(e, t, i, n, o, s, r, l) {
    var a = 2e3,
        u = agent.support.cors && agent.support.xhrUpload,
        h = !! agent.getFlashVersion(),
        c = !u && h;
    return space.Part.extend({
        template: e.photoMode,
        ui: {
            fileInputWrapper: "._photofileInputWrapper",
            fileInput: "._photoFileInput",
            fileButton: "._photofileBtn",
            swfupload: "._swfUpload",
            preview: "._photoPreview",
            gifPreview: "._gifPreview",
            maxCountWarning: "._maxCountWarning"
        },
        styles: {
            fileInputOutline: "outline",
            goaway: "goaway"
        },
        collection: null,
        childParts: {
            previewList: "part/writing/PhotoPreviewListPart"
        },
        onSetup: function() {
            this._isUploading = !1, this._isSetSwfUpload = !1, this._isSetSwfUploadInside = !1, this.collection = new space.Collection, this.childParts.previewList.collection = this.collection, this.collection.add(new t), this.listenTo(this.childParts.previewList, {
                domReady: function() {
                    this.trigger("domready")
                },
                change: function() {
                    var t, i = this._isUploading || this.collection.length >= 1 && this.collection.some(function(e) {
                        return !e.isReady()
                    });
                    i ? (t = this.collection.first(), 1 === this.getPreviewCount() && t.isDone() && t.isGif() ? (this.ui.preview.hide(), this.ui.gifPreview.html(e.gifPreview({
                        src: t.get("downloadPath")
                    })).show()) : (this.ui.fileInputWrapper.addClass(this.styles.goaway), this.ui.preview.show(), this.ui.gifPreview.hide(), c && !this._isSetSwfUploadInside && (this._isSetSwfUploadInside = !0, this._initiateSwfUpload(this.ui.preview.find("._swfUpload").last())))) : (this.ui.fileInputWrapper.removeClass(this.styles.goaway), this.ui.preview.hide(), this._isSetSwfUploadInside = !1, this.trigger("cancel")), this.trigger("change")
                },
                cancel: function() {
                    this.trigger("cancel")
                },
                changeFileInput: function(e) {
                    this.changeFileInput(e)
                },
                request: function(e) {
                    this._request(e)
                },
                activateFriendInput: function() {
                    this.trigger("activateFriendInput")
                }
            })
        },
        _initiateSwfUpload: function(e) {
            var t = this;
            this.trigger("initiateSwfUpload", e, {
                file_dialog_complete_handler: function(e) {
                    var i = {
                        method: o.UPLOAD_METHOD.SWF,
                        swfupload: this,
                        files: this.customSettings.files,
                        removeGif: !1,
                        onlyOne: !1
                    };
                    e > 0 && i.files.length > 0 && t.postPhoto(i)
                }
            })
        },
        onDomReady: function() {
            c && !this._isSetSwfUpload && (this.ui.fileInput.hide(), this._initiateSwfUpload(this.ui.swfupload), this._isSetSwfUpload = !0)
        },
        onStop: function() {
            this._isSetSwfUpload = !1
        },
        events: {
            "focus ._photoFileInput": function() {
                this.ui.fileInputWrapper.addClass(this.styles.fileInputOutline)
            },
            "blur ._photoFileInput": function() {
                this.ui.fileInputWrapper.removeClass(this.styles.fileInputOutline)
            },
            "change ._photoFileInput": function(e) {
                var t = $(e.currentTarget);
                t.val() && this.changeFileInput(t)
            },
            "keydown ._photoFileInput": function(e) {
                agent.browser.is.ie && e.keyCode === r.KEY.ENTER && e.preventDefault()
            },
            "click ._removeMediaBtn": function(e) {
                e.preventDefault(), this.trigger("cancel")
            }
        },
        focus: function() {
            this.ui.fileInput.focus()
        },
        isPreviewMode: function() {
            return this.collection.length > 1
        },
        hasContent: function() {
            return this.collection && this.collection.some(function(e) {
                return e.isSuccess()
            })
        },
        isProgress: function() {
            return this.collection && this.collection.some(function(e) {
                return e.isProgress()
            })
        },
        getPreviewCount: function() {
            return this.isAvailableChildPart("previewList") && this.childParts.previewList.getPreviewCount()
        },
        getAvailableCount: function() {
            return this.isAvailableChildPart("previewList") && this.childParts.previewList.getAvailableCount()
        },
        clearContent: function() {
            this.collection.reset()
        },
        getMediaPath: function() {
            return _.compact(this.collection.pluck("mediaPath"))
        },
        _getSelectedFilesByFileInput: function(e) {
            var i, n = {};
            return n[t.EXTENSION.GIF] = 0, n[t.EXTENSION.OTHERS] = 0, u && e.files && e.files.length > 0 ? _.each(e.files, function(e) {
                n[e.type === t.CONTENT_TYPE.GIF ? t.EXTENSION.GIF : t.EXTENSION.OTHERS] += 1
            }) : (i = l.getExtension(e.value), i === t.EXTENSION.GIF && (n[t.EXTENSION.GIF] = 1)), n
        },
        _getSelectedFilesByFileList: function(e) {
            var i, n = {};
            return n[t.EXTENSION.GIF] = 0, n[t.EXTENSION.OTHERS] = 0, _.each(e, function(e) {
                i = e.type === t.CONTENT_TYPE.GIF ? t.EXTENSION.GIF : t.EXTENSION.OTHERS, n[i] += 1
            }), n
        },
        _getSelectedFilesBySwf: function(e) {
            return _.countBy(e, function(e) {
                return e.type.substr(1).toLowerCase() === t.EXTENSION.GIF ? t.EXTENSION.GIF : t.EXTENSION.OTHERS
            })
        },
        postPhoto: function(e) {
            var n = this,
                s = this.childParts.previewList,
                r = this.flow.fork(),
                l = e.method === o.UPLOAD_METHOD.SWF && e.files ? this._getSelectedFilesBySwf(e.files) : e.selected;
            s.isEmpty() && l[t.EXTENSION.GIF] > 1 && 0 === l[t.EXTENSION.OTHERS] ? (r.next(function() {
                i.alert(intl.t("writing.photoMode.maxGifCountWarning"))
            }), e.onlyOne = !0) : this.isAppendable(l) || (r.next(function() {
                i.alert(intl.t("writing.photoMode.maxGifMixedWarning"))
            }), e.removeGif = !0), r.next(function() {
                n._uploadPhoto(e)
            })
        },
        changeFileInput: function(e) {
            var t = e[0],
                i = {
                    method: o.UPLOAD_METHOD.IFRAME,
                    selected: this._getSelectedFilesByFileInput(t),
                    input: t,
                    removeGif: !1,
                    onlyOne: !1
                };
            u && t.files && t.files.length > 0 && (i.method = o.UPLOAD_METHOD.XHR, i.files = t.files), this.postPhoto(i)
        },
        dropFiles: function(e) {
            var t = {
                method: o.UPLOAD_METHOD.XHR,
                selected: this._getSelectedFilesByFileList(e),
                files: e,
                removeGif: !1,
                onlyOne: !1
            };
            this.postPhoto(t)
        },
        isAppendable: function() {
            return this.isAvailableChildPart("previewList") && this.childParts.previewList.isAppendable.apply(this.childParts.previewList, arguments)
        },
        _showMaxImageWarning: function() {
            this.ui.maxCountWarning.stop(!0, !0).fadeIn().delay(a).fadeOut()
        },
        _addPreview: function() {
            var e = new t;
            return e.set("state", e.UPLOAD_STATE.WAIT), this.collection.add(e, {
                at: this.collection.length - 1
            }), e
        },
        _request: function(e) {
            var t = this;
            return e.photoPreview.requestFileUpload(e).fail(function(s) {
                var r;
                if (!(t.collection.indexOf(e.photoPreview) < 0)) {
                    switch (s) {
                        case o.UPLOAD_STATUS_CODE.ENTITY_TOO_LARGE:
                            r = intl.t("writing.photoMode.error.entityTooLarge");
                            break;
                        case o.UPLOAD_STATUS_CODE.UNSUPPORTED_MEDIA_TYPE:
                            r = intl.t("writing.photoMode.error.invalidFile");
                            break;
                        case o.UPLOAD_STATUS_CODE.INTERNAL_SERVER_ERROR:
                        case o.UPLOAD_STATUS_CODE.FATAL_ERROR:
                            r = intl.t("writing.photoMode.error.networkError");
                            break;
                        case o.UPLOAD_STATUS_CODE.BAD_REQUEST:
                            r = intl.t("writing.photoMode.error.badRequest");
                            break;
                        case o.UPLOAD_STATUS_CODE.UNAUTHORIZED:
                            n.show()
                    }(s === o.UPLOAD_STATUS_CODE.ENTITY_TOO_LARGE || s === o.UPLOAD_STATUS_CODE.UNSUPPORTED_MEDIA_TYPE || s === o.UPLOAD_STATUS_CODE.BAD_REQUEST) && e.photoPreview.trigger("destroy", e.photoPreview), r && i.alert(r)
                }
            })
        },
        _uploadPhoto: function(e) {
            var i, n, s, r = this,
                a = Q.resolve(),
                u = this.getAvailableCount();
            switch (e.method) {
                case o.UPLOAD_METHOD.XHR:
                    i = e.removeGif ? _.filter(e.files, function(e) {
                        return e.type !== t.CONTENT_TYPE.GIF
                    }) : _.toArray(e.files), i.length > u && (i.length = u, this._showMaxImageWarning()), i.length && (e.onlyOne && (i.length = 1), agent.type.is.desktop ? (s = _.map(i, function(i) {
                        return this._request(_.defaults({
                            photoPreview: this._addPreview(),
                            file: i,
                            isGif: i.type === t.CONTENT_TYPE.GIF
                        }, e))
                    }, this), a = Q.all(s)) : (s = _.map(i, function(i) {
                        var n = this._addPreview();
                        return function() {
                            return r._request(_.defaults({
                                photoPreview: n,
                                file: i,
                                isGif: i.type === t.CONTENT_TYPE.GIF
                            }, e))
                        }
                    }, this), a = _.reduce(s, Q.when, null)));
                    break;
                case o.UPLOAD_METHOD.SWF:
                    i = e.removeGif ? _.filter(e.swfupload.customSettings.files, function(e) {
                        return e.type.substr(1).toLowerCase() !== t.EXTENSION.GIF
                    }) : e.swfupload.customSettings.files, i.length > u && (i.length = u, this._showMaxImageWarning()), i.length && (e.onlyOne && (i.length = 1), s = _.map(i, function(i) {
                        var n = this._addPreview(),
                            o = l.getExtension(i.name);
                        return function() {
                            return r._request(_.defaults({
                                photoPreview: n,
                                fileId: i.id,
                                isGif: o === t.EXTENSION.GIF
                            }, e))
                        }
                    }, this), a = _.reduce(s, Q.when, null));
                    break;
                case o.UPLOAD_METHOD.IFRAME:
                    n = l.getExtension(e.input.value), a = this._request(_.defaults({
                        photoPreview: this._addPreview(),
                        isGif: n === t.EXTENSION.GIF
                    }, e))
            }
            a.then(function() {
                "undefined" != typeof e.input && e.input.form.reset()
            })
        }
    })
});
define("model/VideoPreview", ["model/MediaPreview", "common/kage"], function(e, t) {
    return e.extend({
        TRANSCODING_STATE: {
            READY: "transcoding_ready",
            PROGRESS: "transcoding_progress",
            SUCCESS: "transcoding_success",
            FAIL: "transcoding_fail"
        },
        defaults: _.defaults({
            downloadPath: "",
            percent: 0,
            fileSize: 0
        }, e.prototype.defaults),
        initialize: function() {
            this._fileUploadPromise = Q.resolve(), this._checkTranscodingPromise = Q.resolve(), this._kageAccessKey = null
        },
        isSuccess: function() {
            return this.get("state") === this.TRANSCODING_STATE.SUCCESS
        },
        isUploadSuccess: function() {
            return this.get("state") === this.UPLOAD_STATE.SUCCESS
        },
        isProgress: function() {
            return _.contains([this.UPLOAD_STATE.PROGRESS, this.UPLOAD_STATE.SUCCESS, this.TRANSCODING_STATE.READY, this.TRANSCODING_STATE.PROGRESS], this.get("state"))
        },
        isTranscodingProgress: function() {
            return this.get("state") === this.TRANSCODING_STATE.PROGRESS
        },
        isFail: function() {
            return this.get("state") === this.UPLOAD_STATE.FAIL || this.get("state") === this.TRANSCODING_STATE.FAIL
        },
        checkVideoTranscodingStatus: function(e) {
            var i = this;
            return this._kageAccessKey = e, this._checkTranscodingPromise = t.requestCheckVideoTranscoding(e).then(function(t) {
                i.set({
                    state: i.TRANSCODING_STATE.SUCCESS,
                    mediaPath: t.mediaPath,
                    kageAccessKey: e,
                    previewPath: t.previewPath,
                    downloadPath: t.downloadPath,
                    percent: 100
                })
            }).fail(function(e) {
                return i.set("state", i.TRANSCODING_STATE.FAIL), Q.reject(e)
            }).progress(function(e) {
                i.set({
                    state: i.TRANSCODING_STATE.PROGRESS,
                    percent: e / 2 + 50
                })
            }), this._checkTranscodingPromise
        },
        clear: function() {
            return this._fileInputId && (t.clearFileUploadTimer(this._fileInputId), this._fileInputId = null), this._kageAccessKey && (t.clearTranscodingTimer(this._kageAccessKey), this._kageAccessKey = null), this._fileUploadPromise = Q.resolve(), this._checkTranscodingPromise = Q.resolve(), e.prototype.clear.apply(this, arguments)
        },
        requestFileUpload: function(e) {
            var i;
            return i = $.isPlainObject(e) ? e : {
                method: t.UPLOAD_METHOD.IFRAME,
                input: e[0]
            }, this._requestFileUpload(i)
        },
        _requestFileUpload: function(e) {
            var i, s = this,
                n = _.uniqueId("videoUpload"),
                r = 0;
            switch (e.method) {
                case t.UPLOAD_METHOD.IFRAME:
                    i = e.input.value, e.input.files && (i = e.input.files[0].name, r = e.input.files[0].size);
                    break;
                case t.UPLOAD_METHOD.XHR:
                    i = e.file.name, r = e.file.size
            }
            return $(e.input).attr("data-id", n), this._fileInputId = n, this._fileUploadPromise = Q.resolve().then(function() {
                return s.set({
                    filename: i,
                    state: s.UPLOAD_STATE.PROGRESS,
                    fileSize: r
                }), t.requestVideoFileUpload(e)
            }).then(function(e) {
                return s.set("state", s.UPLOAD_STATE.SUCCESS), e
            }).fail(function(e) {
                return s.set("state", s.UPLOAD_STATE.FAIL), Q.reject(e)
            }).progress(function(e) {
                s.set({
                    state: s.UPLOAD_STATE.PROGRESS,
                    percent: e / 2
                })
            }).fin(function() {
                s._fileInputId = null
            }), this._fileUploadPromise
        }
    })
});
define("part/writing/VideoModePart", ["template/writing", "model/VideoPreview", "module/static/loginView", "module/static/dialog", "common/util", "common/kage"], function(e, i, t, o, n, r) {
    var s = 60,
        l = "exceedPlayTime",
        u = agent.support.cors && agent.support.xhrUpload;
    return space.Part.extend({
        template: e.videoMode,
        ui: {
            fileInputWrapper: "._videoFileInputWrapper",
            fileInputForm: "._videoFileInputForm",
            fileInput: "._videoFileInput",
            preview: "._videoPreview"
        },
        styles: {
            fileInputOutline: "outline"
        },
        model: null,
        modelEvents: {
            "change:state": function() {
                if (!this.model.isFail() && !this.model.isUploadSuccess()) {
                    var e = this.isPreviewMode();
                    this.childParts.preview.toggle(e), this.ui.fileInputWrapper.toggle(!e)
                }
                this.model.isSuccess() && this.trigger("activateFriendInput"), this.trigger("change")
            }
        },
        childParts: {
            preview: "part/writing/VideoPreviewPart"
        },
        onSetup: function() {
            this.model = new i, this.childParts.preview.model = this.model, this.listenTo(this.childParts.preview, {
                retryFileupload: function() {
                    this._retryFileupload()
                },
                removeVideo: function() {
                    this._removeVideo()
                }
            }), this.listenTo(this, {
                domReady: function() {
                    this.trigger("domready")
                }
            })
        },
        events: {
            "focus ._videoFileInput": function() {
                this.ui.fileInputWrapper.addClass(this.styles.fileInputOutline)
            },
            "blur ._videoFileInput": function() {
                this.ui.fileInputWrapper.removeClass(this.styles.fileInputOutline)
            },
            "change ._videoFileInput": function(e) {
                var i = $(e.currentTarget);
                i.val() && this.postVideoByFileInput(i)
            },
            "keydown ._videoFileInput": function(e) {
                agent.browser.is.ie && e.keyCode === n.KEY.ENTER && e.preventDefault()
            },
            "click ._removeVideoBtn": function(e) {
                e.preventDefault(), this._removeVideo()
            }
        },
        focus: function() {
            this.ui.fileInput.focus()
        },
        isPreviewMode: function() {
            return this.model.isSuccess() || this.model.isProgress()
        },
        isProgress: function() {
            return this.model.isProgress()
        },
        hasContent: function() {
            return this.model && this.model.isSuccess()
        },
        clearContent: function() {
            this.ui.fileInputForm[0].reset(), this.model.clear(), this.model.set("state", this.model.UPLOAD_STATE.READY), this.childParts.preview.render(), this.render()
        },
        getMediaPath: function() {
            return [this.model.get("mediaPath")]
        },
        dropFiles: function(e) {
            this._postVideo({
                method: r.UPLOAD_METHOD.XHR,
                file: e[0]
            })
        },
        postVideoByFileInput: function(e) {
            var i = e[0],
                t = {
                    method: r.UPLOAD_METHOD.IFRAME,
                    input: i
                };
            u && i.files && i.files.length > 0 && (t.method = r.UPLOAD_METHOD.XHR, t.file = i.files[0]), this._postVideo(t)
        },
        _retryFileupload: function() {
            this.uploadOptions && this._postVideo(this.uploadOptions)
        },
        _postVideo: function(e) {
            this.uploadOptions = e, this.flow.forkWith(this.model.requestFileUpload(e)).next(function(e) {
                return e.info.duration <= s ? e.access_key : o.confirm(intl.t("writing.videoMode.error.exceedPlayTime")).then(function() {
                    return e.access_key
                }).fail(function() {
                    return Q.reject(l)
                })
            }).next(function(e) {
                return this.model.checkVideoTranscodingStatus(e)
            }).next(function() {
                this.ui.fileInputForm[0].reset()
            }).stopped(function(e) {
                var i, n = this.flow.fork();
                switch (e) {
                    case r.UPLOAD_STATUS_CODE.ENTITY_TOO_LARGE:
                        i = intl.t("writing.videoMode.error.entityTooLarge");
                        break;
                    case r.UPLOAD_STATUS_CODE.UNSUPPORTED_MEDIA_TYPE:
                        i = intl.t("writing.videoMode.error.invalidFile");
                        break;
                    case r.UPLOAD_STATUS_CODE.INTERNAL_SERVER_ERROR:
                    case r.UPLOAD_STATUS_CODE.FATAL_ERROR:
                        i = intl.t("writing.videoMode.error.networkError");
                        break;
                    case r.UPLOAD_STATUS_CODE.BAD_REQUEST:
                        i = intl.t("writing.videoMode.error.badRequest");
                        break;
                    case r.UPLOAD_STATUS_CODE.UNAUTHORIZED:
                        t.show()
                }
                i && n.next(function() {
                    return o.alert(i)
                }), (e === r.UPLOAD_STATUS_CODE.ENTITY_TOO_LARGE || e === r.UPLOAD_STATUS_CODE.UNSUPPORTED_MEDIA_TYPE || e === r.UPLOAD_STATUS_CODE.BAD_REQUEST || e === l) && n.next(function() {
                    this.clearContent()
                })
            })
        },
        _removeVideo: function() {
            this.clearContent(), this.trigger("cancel")
        }
    })
});
define("model/MyMusic", ["common/api"], function(e) {
    var t = 3e4,
        l = space.Model.extend({
            idAttribute: "track_id",
            defaults: {
                object_type: "",
                track_id: 0,
                title: "",
                artist: "",
                playtime: 0,
                album_image: "",
                album_title: "",
                play_url: null,
                selected: !1
            },
            getWebPlayUrl: function() {
                return this.get("play_url").web
            }
        }),
        u = space.Collection.extend({
            model: l
        }),
        i = space.Model.extend({
            url: "/musics/me",
            defaults: {
                musics: u,
                player: null
            },
            fetch: function() {
                var l = this;
                return e.request({
                    url: this.url,
                    type: "GET",
                    responseCacheTimeout: t
                }).then(function(e) {
                    return l.set(e), e
                })
            }
        });
    return i
});
define("part/writing/MusicModePart", ["template/writing", "model/MyMusic", "module/static/error", "common/musicPlayer", "config"], function(i, t, e, s, c) {
    var r = space.Part.extend({
        template: i.musicList,
        collection: null,
        ui: {
            musicListWrapper: "._musicListWrapper",
            musicList: "._musicList",
            musicListLoading: "._musicListLoading",
            musicListEmpty: "._musicListEmpty"
        },
        events: {
            "click ._musicItemSelectBtn": function(i) {
                var t;
                i.preventDefault(), t = $(i.currentTarget).closest("._musicItem").data("id"), this.trigger("select", this.collection.get(t))
            },
            "click ._musicItemPlayBtn": function(i) {
                var t = $(i.currentTarget).closest("._musicItem").data("id");
                i.preventDefault(), s.openByPlayUrl(this.collection.get(t).get("play_url")).fail(e.getHandler())
            }
        },
        renderProgress: function() {
            this.ui.musicListWrapper.show(), this.ui.musicListLoading.show(), this.ui.musicListEmpty.hide()
        },
        renderAfterLoading: function() {
            this.collection.isEmpty() ? (this.ui.musicListWrapper.hide(), this.ui.musicListEmpty.show()) : this.addPart("scroll", "part/plugin/ScrollPart", {
                selector: this.ui.musicList
            }).next(function() {
                this.ui.musicListWrapper.show(), this.ui.musicListLoading.hide(), this.ui.musicListEmpty.hide()
            })
        },
        extendData: function() {
            return {
                serviceUrl: c.serviceUrl.music
            }
        }
    }),
        n = space.Part.extend({
            template: i.musicPreview,
            model: null,
            events: {
                "click ._musicPreviewPlayBtn": function(i) {
                    i.preventDefault(), s.openByPlayUrl(this.model.get("play_url")).fail(e.getHandler())
                },
                "click ._musicPreviewCancelBtn": function(i) {
                    i.preventDefault(), this.trigger("cancel")
                }
            },
            extendData: function() {
                return {
                    serviceUrl: c.serviceUrl.music
                }
            }
        });
    return space.Part.extend({
        template: i.musicMode,
        ui: {
            musicListTitle: "._musicListTitle"
        },
        model: null,
        childParts: {
            musicList: r,
            musicPreview: n
        },
        initialize: function() {
            this._trackId = null
        },
        onSetup: function() {
            this.model = new t, this.childParts.musicList.collection = this.model.get("musics"), this.listenTo(this.childParts.musicList, "select", function(i) {
                this._trackId = i.get("track_id"), this.childParts.musicPreview.model = i, this.childParts.musicPreview.render(), this.ui.musicListTitle.hide(), this.childParts.musicList.hide(), this.childParts.musicPreview.show(), this.trigger("change")
            }), this.listenTo(this.childParts.musicPreview, "cancel", function() {
                this.clearContent(), this.trigger("cancel")
            })
        },
        events: {
            "click ._musicListCancelBtn": function(i) {
                i.preventDefault(), this.clearContent(), this.trigger("cancel")
            }
        },
        show: function() {
            this.childParts.musicList.renderProgress(), this.flow.forkWith(this.model.fetch().fail(e.getHandler())).next(function() {
                this.childParts.musicList.render(), this.childParts.musicList.renderAfterLoading()
            }), this.$el.show()
        },
        hasContent: function() {
            return !!this._trackId
        },
        clearContent: function() {
            this._trackId = null, this.ui.musicListTitle.show(), this.childParts.musicList.show(), this.childParts.musicPreview.hide(), this.trigger("change")
        },
        getTrackId: function() {
            return this._trackId
        }
    })
});
define("part/writing/LinkModePart", ["kant", "template/writing", "model/Scrap", "common/util", "common/urlUtil"], function(i, e, t, s, r) {
    var a = 3e3,
        n = {
            READY: "ready",
            PROGRESS: "progress",
            SUCCESS: "success",
            FAIL: "fail"
        }, l = "wrt";
    return space.Part.extend({
        template: e.linkMode,
        ui: {
            inputWrapper: "._linkInputWrapper",
            placeholder: "._linkInputPlaceholder",
            input: "._linkInput",
            preview: "._linkPreview",
            previewReady: "._linkPreviewReady",
            previewLoading: "._linkPreviewLoading",
            previewRetry: "._linkPreviewRetry"
        },
        styles: {
            magazinePreview: "scrap_tistory",
            moviePreview: "scrap_movie",
            textOnlyPreview: "v2"
        },
        model: null,
        childParts: {
            defaultScrapPreview: "part/writing/DefaultScrapPreviewPart",
            magazineScrapPreview: "part/writing/MagazineScrapPreviewPart",
            videoScrapPreview: "part/writing/VideoScrapPreviewPart"
        },
        initialize: function() {
            this._status = n.READY, this._cancelled = !1, this._isHideLinkInput = !1, this._previousUrl = ""
        },
        onSetup: function() {
            this.model = new t, this.childParts.defaultScrapPreview.model = this.model, this.childParts.magazineScrapPreview.model = this.model, this.childParts.videoScrapPreview.model = this.model, this.listenTo(this.childParts.defaultScrapPreview, "removeImage", function() {
                this._updateScrapPreview()
            }), this.listenTo(this.childParts.magazineScrapPreview, "removeImage", function() {
                this._updateScrapPreview()
            })
        },
        onRender: function() {
            this.ui.inputWrapper.toggle(!this._isHideLinkInput), this.addPart("placeholder", "part/plugin/PlaceholderPart", {
                selector: "._linkInput",
                options: {
                    placeholder: this.ui.placeholder,
                    forceActivate: !0
                }
            }).next(function() {
                this.childParts.placeholder.update()
            })
        },
        events: {
            "blur ._linkInputWrapper": function() {
                var i = this.ui.input.val();
                i && this._status === n.READY && this.scrap(s.trim(i))
            },
            "input ._linkInput": function() {
                var i = this.ui.input.val();
                this._lazyScrap(i)
            },
            "keypress ._linkInput": function(i) {
                i.keyCode === s.KEY.ENTER && (i.preventDefault(), this.scrap(s.trim(this.ui.input.val())))
            },
            "paste ._linkInput": function() {
                var i = this;
                _.defer(function() {
                    i.scrap(i.ui.input.val())
                })
            },
            "click ._linkInputCancelBtn": function(e) {
                e.preventDefault(), this._cancelled = !0, i.send(l + (this.hasContent() ? ".515" : ".510")), this.clearContent(), this.trigger("cancel")
            },
            "click ._linkPreviewRetryBtn": function(i) {
                i.preventDefault(), this.scrap(this._isExternalShareWriting ? this._previousUrl : this.ui.input.val())
            }
        },
        options: {
            modeOptions: "setModeOptions"
        },
        setModeOptions: function(i) {
            this._isHideLinkInput = i && i.isHideLinkInput, this._isExternalShareWriting = i && i.isExternalShareWriting
        },
        focus: function() {
            var i = this;
            _.defer(function() {
                i.ui.input.focus()
            })
        },
        hasContent: function() {
            return this.model && this.model.isScraped()
        },
        isProgress: function() {
            return this._status === n.PROGRESS
        },
        clearContent: function() {
            this.ui.input.val(""), this.isAvailableChildPart("placeholder") && this.childParts.placeholder.update(), this._setStatus(n.READY), this.model.isScraped() && this.model.clear()
        },
        scrap: function(i) {
            return !r.isUrlByWeakRule(i) || this.flow.isChildFlowPending("scrap") ? Q.reject() : (this._cancelled = !1, i = r.prependProtocol(i), this._setStatus(n.PROGRESS), this.ui.input.val(i), this._previousUrl = i, this.isAvailableChildPart("placeholder") && this.childParts.placeholder.update(), this.flow.forkWith(this.model.requestScrap(i), "scrap").next(function() {
                this._cancelled || (this._setStatus(n.SUCCESS), this.trigger("scrap"))
            }).stopped(function() {
                this._cancelled || this._setStatus(n.FAIL)
            }).getPromise())
        },
        _setStatus: function(i) {
            this._status = i, this._updateScrapPreview(), this.trigger("change")
        },
        getScrapContent: function() {
            return JSON.stringify(this.model.toFilteredData())
        },
        _lazyScrap: _.debounce(function() {
            this._status === n.READY && this.scrap(this.ui.input.val())
        }, a),
        _updateScrapPreview: function() {
            var i, e;
            switch (this.ui.preview.removeClass(this.styles.moviePreview + " " + this.styles.magazinePreview + " " + this.styles.textOnlyPreview), this.ui.preview.children().hide(), this._status) {
                case n.READY:
                    this.ui.previewReady.show();
                    break;
                case n.PROGRESS:
                    this.ui.previewLoading.show();
                    break;
                case n.FAIL:
                    this.ui.previewRetry.show();
                    break;
                case n.SUCCESS:
                    i = this.model.isSupportEmbeddingPlay(), e = this.model.get("isMagazine"), this.childParts.defaultScrapPreview.toggle(!i && !e), this.childParts.videoScrapPreview.toggle(i && !e), this.childParts.magazineScrapPreview.toggle(e), i ? this.ui.preview.addClass(this.styles.moviePreview) : e ? this.ui.preview.addClass(this.styles.magazinePreview) : this.model.hasPreviewImage() || this.ui.preview.addClass(this.styles.textOnlyPreview)
            }
        }
    })
});
define("part/feed/FeedSettingPart", ["template/feed", "model/me", "model/Activity", "model/Activities", "model/WritingSetting", "part/plugin/LayerPart", "module/static/report", "module/static/dialog", "module/static/error", "module/static/toastPopup", "module/static/writingView", "part/writing/WritingPart", "kant"], function(e, t, i, n, s, o, r, a, l, h, c, m, d) {
    var p = "feed.u.pcmt",
        u = "feed.u.penb",
        S = {};
    return S[i.PERMISSION.ALL] = "feed.u.pall", S[i.PERMISSION.FRIENDS] = "feed.u.pfri", S[i.PERMISSION.ME_ONLY] = "feed.u.pme", o.extend({
        template: e.setting,
        model: null,
        ui: _.extend({}, o.prototype.ui, {
            btnActivityHide: "._btnActivityHide",
            btnActivityDelete: "._btnActivityDelete",
            btnActivityModify: "._btnActivityModify",
            btnPermission: "._btnChangePermission",
            shareLayer: "._allowShareLayer",
            enableShare: "._enableShare",
            commentLayer: "._allowCommentLayer",
            enableAllComment: "._enableAllComment",
            permissionSpan: "._permissionSpan",
            enableShareSpan: "._enableShareSpan",
            enableAllCommentSpan: "._enableAllCommentSpan",
            modifyBtnContainer: "._modifyBtnContainer"
        }),
        styles: _.extend({}, o.prototype.styles, {
            checkButton: "checked",
            outline: "outline"
        }),
        initialize: function() {
            o.prototype.initialize.apply(this, arguments), this._permission = null, this._writingSetting = null
        },
        onSetup: function() {
            return this._writingSetting = new s, this.flow.forkWith(this._writingSetting.fetch().fail(l.getHandler()))
        },
        extendData: function() {
            return {
                isMine: this.model.get("actor").get("isMe")
            }
        },
        onRender: function() {
            var e = !this.model.collection || this.model.collection.getType() === n.TYPE.MY_STORY,
                t = e && !this.model.get("actor").get("isMe") || !this.model.get("feed_id");
            this._setPermission(), this._setEnableShareValue(), this._setSharedVisibility(), this._setEnableAllCommentWritableValue(), this.ui.btnActivityHide.toggle(!t), this.ui.modifyBtnContainer.toggle(!agent.type.is.mobile)
        },
        _setPermission: function(e) {
            e = e || this.model.get("permission"), e !== this._permission && (this._permission && this.ui.permissionSpan.filter('[data-permission="' + this._permission + '"]').removeClass(this.styles.checkButton).find("input").removeAttr("checked"), this._permission = e, this.ui.permissionSpan.filter('[data-permission="' + this._permission + '"]').addClass(this.styles.checkButton).find("input").attr("checked", "checked"), this.ui.shareLayer.toggle(this._permission === this.model.PERMISSION.FRIENDS && !(this.model.get("verb") === this.model.VERB.SHARE && this.model.getShareActivity().get("permission") !== this.model.PERMISSION.ALL)), this.ui.commentLayer.toggle(this._permission === this.model.PERMISSION.ALL))
        },
        _setSharedVisibility: function() {
            this._isSharedMeOnly() && this._permission !== this.model.PERMISSION.ALL && this.ui.permissionSpan.filter('[data-permission="' + this.model.PERMISSION.ALL + '"]').parent().hide().find("input").hide().removeAttr("checked"), this.model.get("verb") === i.VERB.SHARE && this.model.getShareActivity().get("permission") === i.PERMISSION.FRIENDS && this.ui.permissionSpan.filter('[data-permission!="' + this._permission + '"][data-permission="' + i.PERMISSION.ALL + '"]').parent().hide().find("input").hide().removeAttr("checked")
        },
        _setEnableShareValue: function(e) {
            "undefined" == typeof e && (e = this._permission === i.PERMISSION.FRIENDS ? this.model.get("sharable") : this._writingSetting.get("sharable")), this._permission === i.PERMISSION.ME_ONLY && (e = !0), e ? this.ui.enableShareSpan.addClass(this.styles.checkButton).find("input").attr("checked", "checked") : this.ui.enableShareSpan.removeClass(this.styles.checkButton).find("input").removeAttr("checked")
        },
        _setEnableAllCommentWritableValue: function(e) {
            "undefined" == typeof e && (e = this._permission === i.PERMISSION.ALL ? this.model.get("comment_all_writable") : this._writingSetting.get("comment_all_writable")), e ? this.ui.enableAllCommentSpan.removeClass(this.styles.checkButton).find("input").removeAttr("checked") : this.ui.enableAllCommentSpan.addClass(this.styles.checkButton).find("input").attr("checked", "checked")
        },
        _save: function() {
            var e = !0,
                t = !0;
            this._permission === this.model.PERMISSION.FRIENDS && (e = this.ui.enableShare.is(":checked") ? !0 : !1), this._permission === this.model.PERMISSION.ALL && (t = this.ui.enableAllComment.is(":checked") ? !1 : !0), (this._permission !== this.model.get("permission") || e !== this.model.get("enable_share") || t !== this.model.get("comment_all_writable")) && this.model.changePermission(this._permission, e, t).fail(l.getHandler({
                message: intl.t("activity.permission.error")
            }))
        },
        _changePermission: function(e) {
            var t, n = this.ui.btnPermission.filter(":checked"),
                s = n.val();
            return s === this._permission ? Q.resolve() : (t = this.flow.fork(), this._isSharedMeOnly() ? t.next(function() {
                return a.confirm(intl.t("activity.permission.canNotChangePermission", {
                    permission: this.model.getPermissionText(this._permission)
                }), e.target, {
                    ok: intl.t("activity.permission.canNotChangePermissionOk", {
                        permission: this.model.getPermissionText(s)
                    }),
                    cancel: intl.t("activity.permission.canNotChangePermissionCancel")
                })
            }) : s === i.PERMISSION.ME_ONLY && t.next(this.model.get("share_count") ? function() {
                return a.confirm(intl.t("activity.permission.changePermissionSharedActivityToMeOnly"), e.target)
            } : function() {
                return a.confirm(intl.t("activity.permission.changePermissionToMeOnly"), e.target)
            }), t.next(function() {
                d.send(S[s]), this._setPermission(s), this._save(), this._setSharedVisibility()
            }).getPromise())
        },
        _changeEnableShare: function() {
            var e = this.ui.enableShare.is(":checked");
            this._setEnableShareValue(e), this._save(), d.send(u)
        },
        _changeEnableAllComment: function() {
            var e = !this.ui.enableAllComment.is(":checked");
            this._setEnableAllCommentWritableValue(e), this._save(), d.send(p)
        },
        _isSharedMeOnly: function() {
            return this.model.get("verb") === i.VERB.SHARE && this.model.getShareActivity().get("permission") === i.PERMISSION.ME_ONLY
        },
        events: {
            "click ._btnActivityHide": function(e) {
                e.preventDefault(), this.flow.forkWith(this.model.hide()).next(function() {
                    h.show(h.TYPE.ACTIVITY_HIDDEN), this.hide()
                })
            },
            "click ._btnActivityReport": function(e) {
                var t = this.model.get("media_type");
                e.preventDefault(), t === i.MEDIA_TYPE.VIDEO ? r.reportVideo(this.model.get("id"), this.model.get("actor").get("id")) : r.reportActivity(this.model.get("id"), this.model.get("actor").get("id")), this.hide()
            },
            "click ._btnActivityModify": function(e) {
                e.preventDefault(), c.show(m.MODE.MODIFY, {
                    originalModel: this.model
                })
            },
            "click ._btnActivityDelete": function(e) {
                var t = this;
                e.preventDefault(), a.confirm(intl.t("activity.deleteConfirm"), this.ui.btnActivityDelete).then(function() {
                    t.model.destroy()
                }).fin(function() {
                    t.hide()
                })
            },
            "click ._permissionSpan": function(e) {
                var t = $(e.currentTarget).find("input");
                e.preventDefault(), t.prop("checked", !0), this._changePermission(e)
            },
            "click ._enableShareSpan": function(e) {
                var t = $(e.target).find("input");
                e.currentTarget === e.target && (t.prop("checked", t.is(":checked") ? !1 : !0), this._changeEnableShare())
            },
            "click ._btnChangePermission": function(e) {
                this._changePermission(e)
            },
            "click ._enableShare": function() {
                this._changeEnableShare()
            },
            "click ._enableAllCommentSpan": function(e) {
                var t = $(e.target).find("input");
                e.currentTarget === e.target && (t.prop("checked", t.is(":checked") ? !1 : !0), this._changeEnableAllComment())
            },
            "click ._enableAllComment": function() {
                this._changeEnableAllComment()
            },
            "click ._btnSettingClose": function(e) {
                e.preventDefault(), this.hide()
            }
        }
    })
});
define("part/feed/FeedItemPart", ["template/feed", "template/decorator", "part/feed/FeedSettingPart", "part/writing/WritingPart", "model/me", "model/Activities", "module/static/writingView", "module/static/dialog", "module/static/error", "module/static/loginView", "common/util", "common/imgUtil", "common/urlUtil", "common/urlKey", "common/ellipsis", "common/decoratorUtil"], function(t, e, i, n, s, o, a, r, l, h, d, c, m, u, g, f) {
    var p = 20,
        P = 9999,
        y = ", ",
        k = agent.type.is.mobile ? 1 : 5,
        b = 20,
        L = space.Part.extend({
            template: t.item,
            model: null,
            childParts: {
                comment: "part/comment/CommentPart",
                likeThumbnail: "part/feed/LikeThumbnailPart"
            },
            ui: {
                content: "._content",
                contentWrapper: "._contentWrapper",
                btnMore: "._btnFeedMore",
                moreBtnContainer: "._moreBtnContainer",
                btnLike: "._btnLike",
                btnViewLikes: "._btnViewLikes",
                likeCount: "._likeCount",
                likeText: "._likeText",
                canLike: "._canLike",
                liked: "._liked",
                shareButtonLayer: "._shareButtonLayer",
                btnViewShareList: "._btnViewShareList",
                shareCount: "._shareCount",
                commentCount: "._commentCount",
                btnGroup: "._btnGroup",
                btnViewComments: "._btnViewComments",
                btnSetting: "._btnSetting",
                btnWithTags: "._btnWithTags",
                permissionFriends: "._permissionFriends",
                permissionMeOnly: "._permissionMeOnly",
                btnShare: "._btnShare",
                btnShareStory: "._btnShareStory",
                btnPermalink: "._btnPermalink",
                profileImage: "._profileImage",
                sticonContainer: "._sticonContainer",
                countContainer: "._countContainer"
            },
            styles: {
                liked: {
                    like: "bn_like",
                    good: "bn_good",
                    pleasure: "bn_pleasure",
                    sad: "bn_sad",
                    cheerup: "bn_cheerup"
                },
                showPermissionSetting: "open",
                showLayer: "on",
                noData: "nodata",
                onlyPermalink: "first",
                onlyShareButton: "only_share"
            },
            ELLIPSIS_TEXT_LINE: 20,
            ELLIPSIS_MEDIA_LINE: 10,
            initialize: function() {
                this._didEllipsis = !1, this._isDomReadyMedia = !1, this._isPreview = !1
            },
            onSetup: function() {
                var t = this,
                    e = this.model.get("application"),
                    i = this.model.getDisplayMediaType(),
                    n = e && e.get("icon") && e.get("name") && (!i || i === this.model.DISPLAY_MEDIA_TYPE.PHOTO || i === this.model.DISPLAY_MEDIA_TYPE.VIDEO);
                return n && require(["part/feed/ThirdPartyLinkPart"], function(i) {
                    t.addPart("thirdPartyLink", i, {
                        options: {
                            model: e
                        }
                    })
                }), this.childParts.comment.model = this.model, this.childParts.comment.collection = this.model.get("comments"), this.listenTo(this.model.get("comments"), {
                    "add,remove": this._setCommentCount
                }), this.childParts.likeThumbnail.collection = this.model.get("likes").clone(), this.childParts.likeThumbnail.setActivityForBindingEvents(this.model), this._loadMedia()
            },
            onDomReady: function() {
                this._ellipsisContent(), this._triggerMediaReady()
            },
            onRender: function() {
                var t;
                this.ui.sticonContainer.length && (t = $(e.sticonCover()).one("abort error", function(t) {
                    $(t.target).hide()
                }), this.ui.sticonContainer.append(t)), this.model.get("verb") !== this.model.VERB.SHARE || this.model.get("content") || this.ui.content.addClass(this.styles.noData), this.addPart("shareButtonLayer", "part/plugin/LayerPart", {
                    selector: this.ui.shareButtonLayer,
                    options: {
                        exceptionClass: "_btnShare"
                    }
                }), this._setShareActionVisibility(), this._applyLikeValue(), this._setPermissionBtnVisibility(), this._setCommentCount(), this._setLikeCount(), this._setShareCount(), this._setLoginActionVisibility(), this._resizeProfileImage(), this.$el.show(), this._ellipsisContent()
            },
            extendData: function() {
                var t = this,
                    i = "",
                    n = !this.model.collection && !this.isShareActivity || this.model.collection && this.model.collection.getType() === o.TYPE.MY_STORY,
                    s = this.model.collection && this.model.collection.getType() === o.TYPE.HASHTAG,
                    a = s && this.model.collection.parent.get("tag"),
                    r = this.model.get("content_decorators") || [],
                    l = this.model.get("media_type") || (this.model.get("object") ? this.model.get("object").object_type : null);
                switch (_.each(r, function(e) {
                    e.type === f.DECORATOR_TYPE.HASHTAG ? (e.tag = e.text.replace(/^#/, ""), e.profileUrlKey = t.model.get("actor").get("urlKey"), e.activityUrlKey = t.model.get("urlKey"), e.isCurrentTag = s && e.tag === a) : e.type === f.DECORATOR_TYPE.PROFILE && (e.urlKey = u.profile.idToUrlKey(e.id))
                }), i = f.toMarkup(r, {
                    profile: e.contentProfile,
                    sticon: e.contentSticon,
                    image: e.image,
                    hashtag: e.hashtag
                }, {
                    isLinkUrl: !0,
                    activityId: t.model.get("id")
                }), this.getMediaPartPath(this.model), l) {
                    case this.model.MEDIA_TYPE.IMAGE:
                        l = "photo";
                        break;
                    case this.model.MEDIA_TYPE.VIDEO:
                        l = "video";
                        break;
                    case this.model.MEDIA_TYPE.SCRAP:
                        l = "link";
                        break;
                    case this.model.OBJECT_TYPE.MUSIC:
                        l = "music";
                        break;
                    default:
                        l = "text"
                }
                return {
                    withTag: this._getWithTag(),
                    isPost: !this.model.collection,
                    isMyStoryActivities: n,
                    isHashtagActivities: s,
                    escapedContent: i,
                    contentType: l
                }
            },
            _loadMedia: function() {
                var t = this.getMediaPartPath(this.model),
                    e = Q.defer(),
                    i = this;
                return t ? require([t], function(n) {
                    var s = -1 !== t.indexOf("SharePart") ? i.model.getObjectAsActivity() : i.model;
                    i.addPart("media", n, {
                        options: {
                            model: s,
                            isPreview: i._isPreview
                        },
                        listeners: {
                            domReady: function() {
                                this._isDomReadyMedia = !0, this._triggerMediaReady()
                            }
                        }
                    }).next(function() {
                        e.resolve()
                    }, function() {
                        e.reject()
                    })
                }) : e.resolve(), e.promise
            },
            _triggerMediaReady: function() {
                this._isDomReadyMedia && this.isDomReady() && this.trigger("mediaReady")
            },
            _ellipsisContent: function() {
                if (!this._didEllipsis && (this.model.collection || this.isShareActivity) && this.ui.content.is(":visible")) {
                    var t = this.hasChildPart("media") ? this.ELLIPSIS_MEDIA_LINE : this.ELLIPSIS_TEXT_LINE,
                        e = g.byLine(this.ui.content, t, {
                            characterCount: p,
                            useText: !0,
                            onHtml: !0
                        });
                    this.ui.moreBtnContainer.toggle( !! e), this._didEllipsis = !0
                }
            },
            _applyLikeValue: function() {
                var t;
                this.model.get("liked") ? (t = this.styles.liked[this.model.get("liked_emotion")], this.ui.btnLike.hide().filter("." + t).show()) : this.ui.btnLike.hide().first().show()
            },
            _setPermissionBtnVisibility: function() {
                var t = this.model.get("permission");
                this.model.get("actor").get("isMe") && (this.ui.permissionFriends.css("display", t === this.model.PERMISSION.FRIENDS ? "" : "none"), this.ui.permissionMeOnly.css("display", t === this.model.PERMISSION.ME_ONLY ? "" : "none"))
            },
            _setShareActionVisibility: function() {
                var t = this.model.getShareActivity(),
                    e = this.model.getSharable();
                if (this.model.get("verb") === this.model.VERB.SHARE) switch (t.get("permission")) {
                    case this.model.PERMISSION.ME_ONLY:
                        e = !1;
                        break;
                    case this.model.PERMISSION.FRIENDS:
                        (t.get("actor").get("isFriend") || t.get("actor").get("isMe")) && t.getSharable() || (e = !1)
                }
                this.ui.btnShare.toggle(e), agent.type.is.mobile && (this.ui.btnShareStory.hide(), this.ui.btnPermalink.addClass(this.styles.onlyPermalink))
            },
            _setLoginActionVisibility: function() {
                this.ui.btnSetting.toggle(s.isRegistered())
            },
            _resizeProfileImage: function() {
                c.resize(this.ui.profileImage, this.ui.profileImage.parent())
            },
            _getWithTag: function() {
                var e, i = this.model.getWithTag(),
                    n = 0,
                    s = [];
                return i ? (i.otherCount = i.totalCount, _.some(i.tags, function(e) {
                    var o = e.get("display_name").length;
                    return n + o > b ? !0 : s.length >= k ? !0 : (n += o, i.otherCount--, void s.push(t.withTag(e.attributes)))
                }), i.name = s.join(y), e = i.otherCount > 0 ? "activity.withTags" : "activity.withTag", intl.t(e, i)) : !1
            },
            getMediaPartPath: function(t) {
                switch (t.getDisplayMediaType()) {
                    case t.DISPLAY_MEDIA_TYPE.PHOTO:
                        return "part/feed/media/ImagePart";
                    case t.DISPLAY_MEDIA_TYPE.VIDEO:
                        return "part/feed/media/VideoPart";
                    case t.DISPLAY_MEDIA_TYPE.LINK:
                        return "part/feed/media/ScrapPart";
                    case t.DISPLAY_MEDIA_TYPE.MUSIC:
                        return "part/feed/media/MusicPart";
                    case t.DISPLAY_MEDIA_TYPE.SHARE:
                        return "part/feed/media/SharePart";
                    default:
                        return null
                }
            },
            _setCommentCount: function() {
                var t = this.model.get("comment_count");
                this.ui.commentCount.text(d.numberFormat(t, P)), this.ui.btnViewComments.toggle( !! t), this._setVisibilityCountContainer()
            },
            _setLikeCount: function() {
                var t = this.model.get("like_count");
                this.ui.likeCount.text(d.numberFormat(t, P)), this.ui.btnViewLikes.toggle( !! t), this._setVisibilityCountContainer()
            },
            _setShareCount: function() {
                var t = this.model.get("share_count");
                this.ui.shareCount.text(d.numberFormat(t, P)), this.ui.btnViewShareList.toggle( !! t), this._setVisibilityCountContainer()
            },
            _setVisibilityCountContainer: function() {
                var t = !this.model.get("share_count") && !this.model.get("comment_count") && !this.model.get("like_count");
                this.ui.countContainer.toggle(!t)
            },
            events: {
                "click ._btnFeedMore": function(t) {
                    t.preventDefault(), this.ui.moreBtnContainer.hide(), this.ui.content.css({
                        overflow: "visible",
                        height: "auto"
                    })
                },
                "click ._btnLike": function(t) {
                    return t.preventDefault(), s.isRegistered() ? void(this.flow.isChildFlowPending("like") || (this.model.get("liked") ? this.flow.forkWith(this.model.get("likes").unlike().fail(l.getHandler()), "like").next(function() {
                        this._applyLikeValue(), this._setLikeCount()
                    }) : this.addPart("likeButtonLayer", "part/feed/LikeButtonPart", {
                        options: {
                            exceptionClass: "_btnLike"
                        },
                        listeners: {
                            hide: function() {
                                this.removePart("likeButtonLayer")
                            }
                        }
                    }).next(function() {
                        this.childParts.likeButtonLayer.toggle()
                    }))) : void h.show()
                },
                "click ._btnLikeEmotion": function(t) {
                    var e = $(t.currentTarget).data("emotion");
                    t.preventDefault(), this.flow.isChildFlowPending("like") || (this.childParts.likeButtonLayer.hide(), this.flow.forkWith(this.model.get("likes").like(e), "like").next(function() {
                        this._applyLikeValue(), this._setLikeCount()
                    }).stopped(l.getHandler({
                        loginRequired: !0
                    })))
                },
                "click ._btnViewLikes": function(t) {
                    var e, i = this.model.get("likes");
                    t.preventDefault(), this.flow.isChildFlowPending("viewLike") || (e = this.flow.fork("viewLike"), this.model.get("like_count") && (i.length || e.next(function() {
                        return i.fetch().fail(l.getHandler())
                    }), e.next(function() {
                        return this.addPart("likes", "part/feed/LikeListPart", {
                            options: {
                                model: this.model,
                                collection: i
                            },
                            listeners: {
                                show: function() {
                                    this.ui.btnViewLikes.addClass(this.styles.showLayer)
                                },
                                hide: function() {
                                    this.ui.btnViewLikes.removeClass(this.styles.showLayer), this.removePart("likes")
                                }
                            }
                        })
                    })))
                },
                "click ._btnShare": function(t) {
                    t.preventDefault(), this._setShareActionVisibility(), this.childParts.shareButtonLayer.toggle(), this.isAvailableChildPart("permalink") && this.childParts.permalink.hide()
                },
                "click ._btnShareStory": function(t) {
                    return t.preventDefault(), s.isRegistered() ? (a.show(n.MODE.SHARE, {
                        sharedModel: this.model.getShareActivity()
                    }), void this.childParts.shareButtonLayer.hide()) : void h.show()
                },
                "click ._btnPermalink": function(t) {
                    t.preventDefault(), this.childParts.shareButtonLayer.hide(), this.addPart("permalink", "part/feed/PermalinkLayerPart", {
                        options: {
                            model: this.model
                        },
                        listeners: {
                            hide: function() {
                                this.removePart("permalink")
                            }
                        }
                    })
                },
                "click ._btnViewShareList": function(t) {
                    var e, i = this.model.get("shares");
                    t.preventDefault(), $(t.currentTarget).is("a[target=_blank]") || this.flow.isChildFlowPending("viewShare") || (e = this.flow.fork("viewShare"), this.model.get("share_count") && (i.length || e.next(function() {
                        return i.fetch().fail(l.getHandler())
                    }), e.next(function() {
                        return this.addPart("shareList", "part/feed/ShareListPart", {
                            options: {
                                model: this.model,
                                collection: i
                            },
                            listeners: {
                                show: function() {
                                    this.ui.btnViewShareList.addClass(this.styles.showLayer)
                                },
                                hide: function() {
                                    this.ui.btnViewShareList.removeClass(this.styles.showLayer), this.removePart("shareList")
                                }
                            }
                        })
                    })))
                },
                "click ._btnSetting": function(t) {
                    t.preventDefault(), this.addPart("setting", i, {
                        options: {
                            model: this.model,
                            exceptionClass: "_btnSetting"
                        },
                        listeners: {
                            show: function() {
                                this.ui.btnSetting.addClass(this.styles.showLayer)
                            },
                            hide: function() {
                                this.ui.btnSetting.removeClass(this.styles.showLayer), this.removePart("setting")
                            }
                        }
                    }).next(function() {
                        this.childParts.setting.toggle()
                    })
                },
                "click ._btnViewComments": function(t) {
                    t.preventDefault(), this.model.get("comment_count") && !this.childParts.comment.isExpanded() && this.childParts.comment.canBeExpanded() ? this.childParts.comment.expand() : this.childParts.comment.focus()
                },
                "click ._btnWithTags": function(t) {
                    var e, i = this.model.get("withTags");
                    t.preventDefault(), this.flow.isChildFlowPending("viewWithTags") || (e = this.flow.fork("viewWithTags"), this.model.get("with_tag_count") && (i.length || e.next(function() {
                        return i.fetch().fail(l.getHandler())
                    }), e.next(function() {
                        return this.addPart("withTags", "part/feed/WithTagListPart", {
                            options: {
                                model: this.model,
                                collection: i
                            },
                            listeners: {
                                show: function() {
                                    this.ui.btnWithTags.addClass(this.styles.showLayer)
                                },
                                hide: function() {
                                    this.ui.btnWithTags.removeClass(this.styles.showLayer), this.removePart("withTags")
                                }
                            }
                        })
                    })))
                },
                "click ._linkPost": function(t) {
                    var e, i = $(t.currentTarget),
                        n = space.Router.getCurrentRouter(),
                        s = n.getResolver().getName();
                    switch (t.preventDefault(), s) {
                        case "main":
                            e = "feed";
                            break;
                        case "hashtag":
                            e = "hashtag";
                            break;
                        default:
                            /^myStory\//.test(s) && (e = "home")
                    }
                    space.Router.navigate(i.attr("href"), {
                        params: {
                            from: e
                        }
                    })
                },
                "contextmenu ._sticonCover": function(t) {
                    t.preventDefault()
                }
            },
            modelEvents: {
                "change:permission": function() {
                    this._setPermissionBtnVisibility(), this.model.get("permission") === this.model.PERMISSION.ME_ONLY && this.model.collection && this.model.collection.getType() !== o.TYPE.MY_STORY && this.model.collection.remove(this.model)
                },
                "change:like_count": function() {
                    this._setLikeCount()
                },
                "change:comment_count": function() {
                    this._setCommentCount()
                },
                "change:share_count": function() {
                    this._setShareCount()
                },
                "change:liked": function() {
                    this._applyLikeValue()
                },
                "change:sharable": function() {
                    this._setShareActionVisibility()
                },
                update: function() {
                    this.render(), this.flow.forkWith(this._loadMedia())
                }
            }
        });
    return L.getMediaPartPath = L.prototype.getMediaPartPath, L
});
define("part/feed/media/SharePart", ["template/feed", "part/feed/FeedItemPart", "module/static/dialog"], function(t, e, i) {
    return e.extend({
        template: t.share,
        model: null,
        isShareActivity: !0,
        options: {
            isPreview: "setIsPreview"
        },
        initialize: function() {
            e.prototype.initialize.apply(this, arguments), this._isPreview = !1
        },
        onSetup: function() {
            var t = this;
            return e.prototype.onSetup.apply(this, arguments).then(function() {
                if (t._isPreview) {
                    var e = t.hasChildPart("media") ? t.childParts.media : t;
                    t.listenTo(e, "domReady", function() {
                        t.$el.find("a").attr("target", "_blank")
                    })
                }
            })
        },
        setIsPreview: function(t) {
            this._isPreview = t
        },
        getActivityId: function() {
            return this.model.get("id")
        },
        events: _.defaults({
            "click ._btnViewDetailInShare": function(t) {
                var e = $(t.currentTarget).attr("href"),
                    n = this.model.get("permission"),
                    a = this.model.get("actor"),
                    r = "/" + a.get("urlKey");
                this._isPreview || (t.preventDefault(), n !== this.model.PERMISSION.FRIENDS || a.get("isFriend") || a.get("isMe") ? n !== this.model.PERMISSION.ME_ONLY || a.get("isMe") ? space.Router.navigate(e) : i.confirm(intl.t("activity.share.meOnly"), t.target, {
                    ok: intl.t("activity.share.visitStory")
                }).then(function() {
                    space.Router.navigate(r)
                }) : i.confirm(intl.t("activity.share.canBeFriend"), t.target, {
                    ok: intl.t("activity.share.visitStory")
                }).then(function() {
                    space.Router.navigate(r)
                }))
            }
        }, e.prototype.events)
    })
});
define("part/writing/ShareModePart", ["template/writing", "part/feed/media/SharePart"], function(e, t) {
    return space.Part.extend({
        template: e.shareMode,
        model: null,
        hasContent: function() {
            return !!this.model
        },
        clearContent: function() {
            this.model = null, this.removePart("share")
        },
        options: {
            modeOptions: "setModeOptions"
        },
        setModeOptions: function(e) {
            this.model = e.sharedModel, this.addPart("share", t, {
                options: {
                    model: this.model,
                    isPreview: !0
                }
            })
        },
        getPermission: function() {
            return this.model.get("permission")
        },
        getShareId: function() {
            return this.model.get("id")
        }
    })
});
define("part/writing/ModifyModePart", ["template/writing", "part/feed/FeedItemPart"], function(i, t) {
    return space.Part.extend({
        template: i.modifyMode,
        model: null,
        initialize: function() {
            this._mediaPath = null, this._shareModel = null
        },
        hasContent: function() {
            return !0
        },
        clearContent: function() {},
        options: {
            modeOptions: "setModeOptions"
        },
        onRender: function() {
            this._mediaPath && this.addPart("media", this._mediaPath, {
                options: {
                    model: this._shareModel || this.model,
                    isPreview: !0
                },
                listeners: {
                    domReady: function() {
                        this.childParts.media.$("a").attr("target", "_blank")
                    }
                }
            })
        },
        extendData: function() {
            var i = this.model.getDisplayMediaType(),
                t = !1;
            switch (i) {
                case this.model.DISPLAY_MEDIA_TYPE.PHOTO:
                    t = intl.t("writing.modifyDescription.photo");
                    break;
                case this.model.DISPLAY_MEDIA_TYPE.VIDEO:
                    t = intl.t("writing.modifyDescription.video");
                    break;
                case this.model.DISPLAY_MEDIA_TYPE.MUSIC:
                    t = intl.t("writing.modifyDescription.music");
                    break;
                case this.model.DISPLAY_MEDIA_TYPE.LINK:
                    t = intl.t("writing.modifyDescription.link");
                    break;
                case this.model.DISPLAY_MEDIA_TYPE.SHARE:
                    t = intl.t("writing.modifyDescription.share")
            }
            return {
                description: t
            }
        },
        setModeOptions: function(i) {
            this.model = i.originalModel, this._mediaPath = t.getMediaPartPath(this.model), this._shareModel = i.sharedModel
        },
        isProgress: function() {
            return !1
        },
        getPermission: function() {
            return this.model.get("permission")
        }
    })
});
define("part/plugin/EditorHistoryPart", [], function() {
    return space.Part.extend({
        initialize: function() {
            this.reset()
        },
        _createSnapshot: function() {
            return this.$el.html()
        },
        _applySnapshot: function(t) {
            this.$el.html(t)
        },
        setDefaultSnapshot: function(t) {
            this._defaultSnapshot = t, this._undoStack = [t]
        },
        undo: function() {
            var t;
            return this._undoStack.length ? (t = this._createSnapshot(), this._applySnapshot(this._undoStack.pop()), this._redoStack.push(t), void(t === this.$el.html() && this.undo())) : void this._undoStack.push(this._defaultSnapshot)
        },
        redo: function() {
            var t;
            this._redoStack.length && (t = this._createSnapshot(), this._applySnapshot(this._redoStack.pop()), this._undoStack.push(t), t === this.$el.html() && this.redo())
        },
        record: function() {
            var t = this._createSnapshot();
            this._redoStack = [], t !== _.last(this._undoStack) && "" !== t && this._undoStack.push(t)
        },
        reset: function() {
            this._defaultSnapshot = "", this._undoStack = [this._defaultSnapshot], this._redoStack = []
        }
    })
});
define("template/recommendList", ["Handlebars"], function(a) {
    var t = function(t) {
        var e = a.template(t);
        return function(a) {
            return e(a, {
                partials: s
            })
        }
    }, s = {
        __p__: ""
    };
    return {
        friendMentionList: function() {
            var a = t(function(a, t, s, e, i) {
                return this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), i = i || {}, '<ul class="_list"></ul>'
            });
            return a.wrap = '<div class="ly friend_layer">', a
        }(),
        friendMentionItem: function() {
            var a = t(function(a, t, s, e, i) {
                function n(a, t) {
                    var e, i, n = "";
                    return n += ' <span class="ic_music">' + p((e = s.t || a && a.t, i = {
                        hash: {},
                        data: t
                    }, e ? e.call(a, "friend.alt.music", i) : d.call(a, "t", "friend.alt.music", i))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), i = i || {};
                var l, r, h, c = "",
                    d = s.helperMissing,
                    p = this.escapeExpression,
                    o = "function",
                    f = this;
                return c += '<li data-id="', (r = s.id) ? l = r.call(t, {
                    hash: {},
                    data: i
                }) : (r = t && t.id, l = typeof r === o ? r.call(t, {
                    hash: {},
                    data: i
                }) : r), c += p(l) + '" data-kant-id="149" data-kant-ignore="true"><div class="pf"><a href="#" tabindex="-1" data-kant-id="false"><img class="_friendDropdownImg" src="' + p((r = s.profileImage || t && t.profileImage, h = {
                    hash: {
                        url: t && t.profile_image_url,
                        size: "30"
                    },
                    data: i
                }, r ? r.call(t, h) : d.call(t, "profileImage", h))) + '" style="left: -70px; top: -45px"><span class="line"></span></a></div><p class="txt"><a href="#" data-kant-id="false">', (r = s.display_name) ? l = r.call(t, {
                    hash: {},
                    data: i
                }) : (r = t && t.display_name, l = typeof r === o ? r.call(t, {
                    hash: {},
                    data: i
                }) : r), c += p(l) + "</a> ", l = s["if"].call(t, t && t.isMusicStatus, {
                    hash: {},
                    inverse: f.noop,
                    fn: f.program(1, n, i),
                    data: i
                }), (l || 0 === l) && (c += l), c += ' <span class="inner_txt">', (r = s.statusMessage) ? l = r.call(t, {
                    hash: {},
                    data: i
                }) : (r = t && t.statusMessage, l = typeof r === o ? r.call(t, {
                    hash: {},
                    data: i
                }) : r), c += p(l) + "</span></p></li>"
            });
            return a
        }(),
        hashtagList: function() {
            var a = t(function(a, t, s, e, i) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), i = i || {};
                var n, l, r = "",
                    h = s.helperMissing,
                    c = this.escapeExpression;
                return r += '<p class="_guide hash_info" style="display:none">' + c((n = s.t || t && t.t, l = {
                    hash: {},
                    data: i
                }, n ? n.call(t, "writing.hashtagLayerPermissionGuide", l) : h.call(t, "t", "writing.hashtagLayerPermissionGuide", l))) + '</p><ul class="_list"></ul>'
            });
            return a.wrap = '<div class="ly hash_layer">', a
        }(),
        hashtagItem: function() {
            var a = t(function(a, t, s, e, i) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), i = i || {};
                var n, l, r = "",
                    h = "function",
                    c = this.escapeExpression;
                return r += '<li data-id="', (l = s.tag) ? n = l.call(t, {
                    hash: {},
                    data: i
                }) : (l = t && t.tag, n = typeof l === h ? l.call(t, {
                    hash: {},
                    data: i
                }) : l), r += c(n) + '"><a href="#" data-kant-id="523" data-kant-ignore="true">#', (l = s.tag) ? n = l.call(t, {
                    hash: {},
                    data: i
                }) : (l = t && t.tag, n = typeof l === h ? l.call(t, {
                    hash: {},
                    data: i
                }) : l), r += c(n) + "</a></li>"
            });
            return a
        }()
    }
});
define("template/plugin", ["Handlebars"], function(r) {
    var a = function(a) {
        var e = r.template(a);
        return function(r) {
            return e(r, {
                partials: t
            })
        }
    }, t = {
        __p__: ""
    };
    return {
        autoResizeWidthMirror: function() {
            var r = a(function(r, a, t, e, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, r.helpers), n = n || {}, '<span tabindex="-1" class="autoResizeWidthMirror"></span>'
            });
            return r
        }(),
        anchor: function() {
            var r = a(function(r, a, t, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, r.helpers), n = n || {};
                var i, l, s = "",
                    h = "function",
                    u = this.escapeExpression;
                return s += '<a href="', (l = t.url) ? i = l.call(a, {
                    hash: {},
                    data: n
                }) : (l = a && a.url, i = typeof l === h ? l.call(a, {
                    hash: {},
                    data: n
                }) : l), s += u(i) + '" target="_blank" data-kant-id="324">', (l = t.value) ? i = l.call(a, {
                    hash: {},
                    data: n
                }) : (l = a && a.value, i = typeof l === h ? l.call(a, {
                    hash: {},
                    data: n
                }) : l), s += u(i) + "</a>"
            });
            return r
        }(),
        tagHighlighter: function() {
            var r = a(function(r, a, t, e, n) {
                this.compilerInfo = [4, ">= 1.0.0"], t = this.merge(t, r.helpers), n = n || {};
                var i = "";
                return i
            });
            return r.wrap = '<div class="tagHighlighter">', r
        }()
    }
});
define("part/plugin/DropdownPart", ["template/plugin", "common/util"], function(t, e) {
    var i = 4,
        s = 8;
    return space.Part.extend({
        events: {
            "click li": function(t) {
                t.preventDefault(), this._onSelectItem(t.currentTarget)
            },
            "mouseover li": function(t) {
                var e = $(t.currentTarget);
                this._getActiveItem().removeClass(this._selectedClass), this._setActiveIdx(e.index()), this._getActiveItem().addClass(this._selectedClass)
            }
        },
        documentEvents: {
            click: function(t) {
                $(t.currentTarget).closest(this.$el).length || this.hide()
            }
        },
        options: {
            itemTemplate: "setItemTemplate",
            selectedClass: "setSelectedClass",
            tabAsEnter: "setTabAsEnter"
        },
        initialize: function() {
            this._activeIdx = -1, this._itemTemplate = null, this._selectedClass = "active", this._tabAsEnter = !0, this._isUpSide = !1, this._$window = $(window)
        },
        isVisible: function() {
            return this.$el.is(":visible")
        },
        setItemTemplate: function(t) {
            this._itemTemplate = t
        },
        setSelectedClass: function(t) {
            this._selectedClass = t
        },
        setTabAsEnter: function(t) {
            this._tabAsEnter = t
        },
        _onSelectItem: function(t) {
            this.trigger("selectItem", t)
        },
        _setItems: function(t) {
            var e = this.$el.find("._list");
            e.html(_.map(t, function(t) {
                return this._itemTemplate(t.toData && _.isFunction(t.toData) ? t.toData() : t)
            }, this).join("")), this._$items = e.children()
        },
        toggle: function(t, e) {
            t.length > 0 ? this.show(t, e) : this.hide()
        },
        show: function(t, e, n) {
            var o, l, h, c, a, r, d;
            n = n || {}, this._setItems(t), this.$el.show(), e && e.isFirstItemSelect && (this._setActiveIdx(0), this._getActiveItem().addClass(this._selectedClass)), e && e.layerPosition && (o = e.layerPosition, o && o.isFixed ? n.top = o.containerHeight : (l = o.range.getBoundingClientRect(), n.top = l.bottom - o.containerTop, r = this.$el.height(), d = l.bottom - l.top, this._isUpSide ? n.top = n.top - r - d - s : (h = this._$window.height(), c = h - l.bottom, a = h - c, r > c && a >= r ? (n.top = n.top - r - d - s, this._isUpSide = !0) : n.top += i))), n && this.$el.css(n)
        },
        hide: function() {
            this._activeIdx = -1, this._isUpSide = !1, this._$items = null, this.$el.hide()
        },
        handleKeydown: function(t) {
            if (t === e.KEY.UP || t === e.KEY.DOWN) this._navigateDropdown(t);
            else if (t === e.KEY.ENTER || this._tabAsEnter && t === e.KEY.TAB) this._onSelectItem(this._activeIdx > -1 ? _.first(this._getActiveItem()) : null);
            else {
                if (t !== e.KEY.ESC) return !1;
                this.hide()
            }
            return !0
        },
        _navigateDropdown: function(t) {
            this._getActiveItem().removeClass(this._selectedClass), this._setActiveIdx(t === e.KEY.UP ? this._activeIdx - 1 : this._activeIdx + 1), this._getActiveItem().addClass(this._selectedClass), this._scrollToActive()
        },
        _scrollToActive: function() {
            var t = this.$el[0].getBoundingClientRect(),
                i = this._getActiveItem()[0].getBoundingClientRect();
            if (!e.isBoundsInBounds(i, t)) {
                var s = i.bottom - t.bottom;
                0 > s && (s = i.top - t.top), this.$el.scrollTop(this.$el.scrollTop() + s)
            }
        },
        _getActiveItem: function() {
            return this._$items.eq(this._activeIdx)
        },
        _setActiveIdx: function(t) {
            0 > t ? t = this._$items.length - 1 : t >= this._$items.length && (t = 0), this._activeIdx = t
        }
    })
});
define("part/writing/HashtagLayerPart", ["template/recommendList", "part/plugin/DropdownPart"], function(t, e) {
    return e.extend({
        template: t.hashtagList,
        model: null,
        initialize: function() {
            e.prototype.initialize.apply(this), this.setItemTemplate(t.hashtagItem), this._beforeWord = ""
        },
        _onSelectItem: function(t) {
            var e = {
                tag: $(t).data("id")
            };
            this.trigger("selectItem", e)
        },
        show: function(t, i, o) {
            ("" === this._beforeWord || this._beforeWord !== t) && this.flow.forkWith(this.model.getSuggestionList(t, i), "show").next(function(t) {
                return 0 === t.length ? void this.hide() : (e.prototype.show.call(this, t, i, o), void this.$el.find("._guide").toggle(!(!i || !i.isShowGuide)))
            }), this._beforeWord = t
        },
        hide: function() {
            var t = this.flow.getChildFlow("show");
            t && t.abort(), this._beforeWord = "", e.prototype.hide.apply(this, arguments)
        }
    })
});
define("part/writing/FriendMentionLayerPart", ["template/recommendList", "common/imgUtil", "part/plugin/DropdownPart"], function(e, t, i) {
    return i.extend({
        template: e.friendMentionList,
        collection: null,
        initialize: function() {
            i.prototype.initialize.apply(this), this.setItemTemplate(e.friendMentionItem), this._recentPrependList = null
        },
        _onSelectItem: function(e) {
            var t = $(e).data("id"),
                i = this.collection.getFriendById(t);
            !i && this._recentPrependList && (i = _.find(this._recentPrependList, function(e) {
                return e.get("id") === t
            })), this.trigger("selectItem", i)
        },
        show: function(e, t, n) {
            var r = this.collection.getFriendsForMentioning(e || "", t);
            return 0 === r.length ? void this.hide() : (t = _.defaults(t || {}, {
                isFirstItemSelect: !0
            }), this._recentPrependList = t && t.prependList || [], i.prototype.show.call(this, r, t, n), void this._resizeProfileImage())
        },
        hide: function() {
            this._isUpSide = !1, this._recentPrependList = [], i.prototype.hide.apply(this, arguments)
        },
        _resizeProfileImage: function() {
            _.each(this.$el.find("._friendDropdownImg"), function(e) {
                t.resize($(e))
            })
        }
    })
});
define("template/scroll", ["Handlebars"], function(n) {
    var r = function(r) {
        var t = n.template(r);
        return function(n) {
            return t(n, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        layout: function() {
            var n = r(function(n, r, e, t, s) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, n.helpers), s = s || {}, '<div class="scroll" style="display:none"><span class="top"></span><span class="bottom"></span></div>'
            });
            return n
        }(),
        wrapper: function() {
            var n = r(function(n, r, e, t, s) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, n.helpers), s = s || {}, '<div class="fake_scroll"></div>'
            });
            return n
        }()
    }
});
(function() {
    function t(n, o) {
        function i(t, e) {
            return function() {
                return t.apply(e, arguments)
            }
        }
        var r;
        if (o = o || {}, this.trackingClick = !1, this.trackingClickStart = 0, this.targetElement = null, this.touchStartX = 0, this.touchStartY = 0, this.lastTouchIdentifier = 0, this.touchBoundary = o.touchBoundary || 10, this.layer = n, this.tapDelay = o.tapDelay || 200, !t.notNeeded(n)) {
            for (var a = ["onMouse", "onClick", "onTouchStart", "onTouchMove", "onTouchEnd", "onTouchCancel"], c = this, s = 0, l = a.length; l > s; s++) c[a[s]] = i(c[a[s]], c);
            e && (n.addEventListener("mouseover", this.onMouse, !0), n.addEventListener("mousedown", this.onMouse, !0), n.addEventListener("mouseup", this.onMouse, !0)), n.addEventListener("click", this.onClick, !0), n.addEventListener("touchstart", this.onTouchStart, !1), n.addEventListener("touchmove", this.onTouchMove, !1), n.addEventListener("touchend", this.onTouchEnd, !1), n.addEventListener("touchcancel", this.onTouchCancel, !1), Event.prototype.stopImmediatePropagation || (n.removeEventListener = function(t, e, o) {
                var i = Node.prototype.removeEventListener;
                "click" === t ? i.call(n, t, e.hijacked || e, o) : i.call(n, t, e, o)
            }, n.addEventListener = function(t, e, o) {
                var i = Node.prototype.addEventListener;
                "click" === t ? i.call(n, t, e.hijacked || (e.hijacked = function(t) {
                    t.propagationStopped || e(t)
                }), o) : i.call(n, t, e, o)
            }), "function" == typeof n.onclick && (r = n.onclick, n.addEventListener("click", function(t) {
                r(t)
            }, !1), n.onclick = null)
        }
    }
    var e = navigator.userAgent.indexOf("Android") > 0,
        n = /iP(ad|hone|od)/.test(navigator.userAgent),
        o = n && /OS 4_\d(_\d)?/.test(navigator.userAgent),
        i = n && /OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),
        r = navigator.userAgent.indexOf("BB10") > 0;
    t.prototype.needsClick = function(t) {
        switch (t.nodeName.toLowerCase()) {
            case "button":
            case "select":
            case "textarea":
                if (t.disabled) return !0;
                break;
            case "input":
                if (n && "file" === t.type || t.disabled) return !0;
                break;
            case "label":
            case "video":
                return !0
        }
        return /\bneedsclick\b/.test(t.className)
    }, t.prototype.needsFocus = function(t) {
        switch (t.nodeName.toLowerCase()) {
            case "textarea":
                return !0;
            case "select":
                return !e;
            case "input":
                switch (t.type) {
                    case "button":
                    case "checkbox":
                    case "file":
                    case "image":
                    case "radio":
                    case "submit":
                        return !1
                }
                return !t.disabled && !t.readOnly;
            default:
                return /\bneedsfocus\b/.test(t.className)
        }
    }, t.prototype.sendClick = function(t, e) {
        var n, o;
        document.activeElement && document.activeElement !== t && document.activeElement.blur(), o = e.changedTouches[0], n = document.createEvent("MouseEvents"), n.initMouseEvent(this.determineEventType(t), !0, !0, window, 1, o.screenX, o.screenY, o.clientX, o.clientY, !1, !1, !1, !1, 0, null), n.forwardedTouchEvent = !0, t.dispatchEvent(n)
    }, t.prototype.determineEventType = function(t) {
        return e && "select" === t.tagName.toLowerCase() ? "mousedown" : "click"
    }, t.prototype.focus = function(t) {
        var e;
        n && t.setSelectionRange && 0 !== t.type.indexOf("date") && "time" !== t.type ? (e = t.value.length, t.setSelectionRange(e, e)) : t.focus()
    }, t.prototype.updateScrollParent = function(t) {
        var e, n;
        if (e = t.fastClickScrollParent, !e || !e.contains(t)) {
            n = t;
            do {
                if (n.scrollHeight > n.offsetHeight) {
                    e = n, t.fastClickScrollParent = n;
                    break
                }
                n = n.parentElement
            } while (n)
        }
        e && (e.fastClickLastScrollTop = e.scrollTop)
    }, t.prototype.getTargetElementFromEventTarget = function(t) {
        return t.nodeType === Node.TEXT_NODE ? t.parentNode : t
    }, t.prototype.onTouchStart = function(t) {
        var e, i, r;
        if (t.targetTouches.length > 1) return !0;
        if (e = this.getTargetElementFromEventTarget(t.target), i = t.targetTouches[0], n) {
            if (r = window.getSelection(), r.rangeCount && !r.isCollapsed) return !0;
            if (!o) {
                if (i.identifier && i.identifier === this.lastTouchIdentifier) return t.preventDefault(), !1;
                this.lastTouchIdentifier = i.identifier, this.updateScrollParent(e)
            }
        }
        return this.trackingClick = !0, this.trackingClickStart = t.timeStamp, this.targetElement = e, this.touchStartX = i.pageX, this.touchStartY = i.pageY, t.timeStamp - this.lastClickTime < this.tapDelay && t.preventDefault(), !0
    }, t.prototype.touchHasMoved = function(t) {
        var e = t.changedTouches[0],
            n = this.touchBoundary;
        return Math.abs(e.pageX - this.touchStartX) > n || Math.abs(e.pageY - this.touchStartY) > n ? !0 : !1
    }, t.prototype.onTouchMove = function(t) {
        return this.trackingClick ? ((this.targetElement !== this.getTargetElementFromEventTarget(t.target) || this.touchHasMoved(t)) && (this.trackingClick = !1, this.targetElement = null), !0) : !0
    }, t.prototype.findControl = function(t) {
        return void 0 !== t.control ? t.control : t.htmlFor ? document.getElementById(t.htmlFor) : t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")
    }, t.prototype.onTouchEnd = function(t) {
        var r, a, c, s, l, u = this.targetElement;
        if (!this.trackingClick) return !0;
        if (t.timeStamp - this.lastClickTime < this.tapDelay) return this.cancelNextClick = !0, !0;
        if (this.cancelNextClick = !1, this.lastClickTime = t.timeStamp, a = this.trackingClickStart, this.trackingClick = !1, this.trackingClickStart = 0, i && (l = t.changedTouches[0], u = document.elementFromPoint(l.pageX - window.pageXOffset, l.pageY - window.pageYOffset) || u, u.fastClickScrollParent = this.targetElement.fastClickScrollParent), c = u.tagName.toLowerCase(), "label" === c) {
            if (r = this.findControl(u)) {
                if (this.focus(u), e) return !1;
                u = r
            }
        } else if (this.needsFocus(u)) return t.timeStamp - a > 100 || n && window.top !== window && "input" === c ? (this.targetElement = null, !1) : (this.focus(u), this.sendClick(u, t), n && "select" === c || (this.targetElement = null, t.preventDefault()), !1);
        return n && !o && (s = u.fastClickScrollParent, s && s.fastClickLastScrollTop !== s.scrollTop) ? !0 : (this.needsClick(u) || (t.preventDefault(), this.sendClick(u, t)), !1)
    }, t.prototype.onTouchCancel = function() {
        this.trackingClick = !1, this.targetElement = null
    }, t.prototype.onMouse = function(t) {
        return this.targetElement ? t.forwardedTouchEvent ? !0 : t.cancelable && (!this.needsClick(this.targetElement) || this.cancelNextClick) ? (t.stopImmediatePropagation ? t.stopImmediatePropagation() : t.propagationStopped = !0, t.stopPropagation(), t.preventDefault(), !1) : !0 : !0
    }, t.prototype.onClick = function(t) {
        var e;
        return this.trackingClick ? (this.targetElement = null, this.trackingClick = !1, !0) : "submit" === t.target.type && 0 === t.detail ? !0 : (e = this.onMouse(t), e || (this.targetElement = null), e)
    }, t.prototype.destroy = function() {
        var t = this.layer;
        e && (t.removeEventListener("mouseover", this.onMouse, !0), t.removeEventListener("mousedown", this.onMouse, !0), t.removeEventListener("mouseup", this.onMouse, !0)), t.removeEventListener("click", this.onClick, !0), t.removeEventListener("touchstart", this.onTouchStart, !1), t.removeEventListener("touchmove", this.onTouchMove, !1), t.removeEventListener("touchend", this.onTouchEnd, !1), t.removeEventListener("touchcancel", this.onTouchCancel, !1)
    }, t.notNeeded = function(t) {
        var n, o, i;
        if ("undefined" == typeof window.ontouchstart) return !0;
        if (o = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [, 0])[1]) {
            if (!e) return !0;
            if (n = document.querySelector("meta[name=viewport]")) {
                if (-1 !== n.content.indexOf("user-scalable=no")) return !0;
                if (o > 31 && document.documentElement.scrollWidth <= window.outerWidth) return !0
            }
        }
        if (r && (i = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/), i[1] >= 10 && i[2] >= 3 && (n = document.querySelector("meta[name=viewport]")))) {
            if (-1 !== n.content.indexOf("user-scalable=no")) return !0;
            if (document.documentElement.scrollWidth <= window.outerWidth) return !0
        }
        return "none" === t.style.msTouchAction ? !0 : !1
    }, t.attach = function(e, n) {
        return new t(e, n)
    }, "function" == typeof define && "object" == typeof define.amd && define.amd ? define("fastclick", [], function() {
        return t
    }) : "undefined" != typeof module && module.exports ? (module.exports = t.attach, module.exports.FastClick = t) : window.FastClick = t
})();
define("part/plugin/ScrollPart", ["template/scroll", "fastclick"], function(t, e) {
    var s = 16,
        i = 8,
        o = 1,
        l = 500,
        h = 3e3;
    return space.Part.extend({
        initialize: function() {
            this._$document = $(document), this._$wrapper = null, this._$scrollBar = null, this._maxVerticalDistance = 0, this._maxScrollTop = 0, this._scrollTop = 0, this._scrollHeight = 0, this._height = 0, this._barHeight = 0, this._barTop = 0, this._moveInfo = null, this._enabledScroll = !1, this._fOnMouseUp = _.bind(this._onMouseUp, this), this._fOnMouseMove = _.bind(this._onMouseMove, this), this._eventCategory = "." + this.cid, this._timerResize = null, this._isShownBar = !1, this._fastClick = null, this._debouncedActivateScrollBar = _.debounce(function() {
                this._stopResizeTimer(), this._$scrollBar.hide()
            }, h), this._wheelEventName = ["wheel", "mousewheel", "DOMMouseScroll"].join(this._eventCategory + " ") + this._eventCategory
        },
        onRender: function() {
            var i = this;
            return agent.type.is.desktop ? (this.$el.wrap($(t.wrapper())), this._$wrapper = this.$el.parent(), this.$el.css({
                overflow: "hidden"
            }), this._$scrollBar = $(t.layout()).appendTo(this._$wrapper), this._$wrapper.on("mouseenter" + this._eventCategory, function() {
                i.resizeScrollBar(), i._$scrollBar.toggle(i._enabledScroll), i._startResizeTimer(), i._isShownBar = !0
            }).on("mouseleave" + this._eventCategory, function() {
                null === i._moveInfo && (i._$scrollBar.hide(), i._stopResizeTimer(), i._isShownBar = !1)
            }).on("mousedown" + this._eventCategory, function(t) {
                var e = i.$el.offset(),
                    o = $(t.target);
                i._enabledScroll && i.$el.width() - (t.pageX - e.left) <= s && (t.preventDefault(), i._moveInfo = {
                    isOnBar: o.closest(i._$scrollBar).length > 0,
                    y: t.pageY,
                    scrollTop: i._scrollTop,
                    offset: e
                }, i._$document.on("mouseup", i._fOnMouseUp), i._$document.on("mousemove", i._fOnMouseMove))
            }).on(this._wheelEventName, function(t) {
                var e = agent.getWheelDelta(t);
                i._enabledScroll && (t.preventDefault(), i._isShownBar || (i._$scrollBar.show(), i._startResizeTimer(), i._debouncedActivateScrollBar()), i.scrollTo(i._scrollTop + -1 * e * o))
            }), this.resizeScrollBar(), this._$scrollBar.toggle(this._enabledScroll), void(this._enabledScroll && this._startResizeTimer())) : (this.$el.css({
                overflow: "auto"
            }), void(this._fastClick = new e(this.$el[0])))
        },
        onStop: function() {
            this._stopResizeTimer(), this._$wrapper && this._$wrapper.off(this._eventCategory), this._fastClick && (this._fastClick.destroy(), this._fastClick = null)
        },
        _stopResizeTimer: function() {
            this._timerResize && (clearInterval(this._timerResize), this._timerResize = null)
        },
        _startResizeTimer: function() {
            this._stopResizeTimer(), this._timerResize = setInterval(_.bind(this.resizeScrollBar, this), l)
        },
        _pixelToScrollTop: function(t) {
            return t * (this._maxScrollTop / this._maxVerticalDistance)
        },
        _onMouseMove: function(t) {
            null !== this._moveInfo && (t.preventDefault(), this.scrollTo(this._moveInfo.scrollTop + this._pixelToScrollTop(t.pageY - this._moveInfo.y)))
        },
        _onMouseUp: function(t) {
            var e, s, i = $(t.target);
            null !== this._moveInfo && (e = t.pageY - this._moveInfo.y, 0 !== e || this._moveInfo.isOnBar || (s = t.pageY - this._moveInfo.offset.top < this._barTop ? -1 : 1, this.scrollTo(this._scrollTop + this._pixelToScrollTop(this._barHeight) * s)), this._moveInfo = null, this._$document.off("mouseup", this._fOnMouseUp), this._$document.off("mousemove", this._fOnMouseMove)), i.closest(this._$wrapper).length || (this._$scrollBar.hide(), this._isShownBar = !1)
        },
        resizeScrollBar: function() {
            var t = this.$el.scrollTop();
            this._scrollHeight = this.$el[0].scrollHeight, this._height = this.$el[0].clientHeight || this.$el.height(), this._barHeight = Math.max(i, Math.round(this._height * this._height / this._scrollHeight)), this._enabledScroll = this._scrollHeight !== this._height, this._$scrollBar.height(this._barHeight), this._maxVerticalDistance = this._height - this._barHeight - i, this._maxScrollTop = this._scrollHeight - this._height, t !== this._scrollTop && this.scrollTo(t), this._scrollTop && (this._barTop = this._maxVerticalDistance * this._scrollTop / this._maxScrollTop, this._$scrollBar.css("top", this._barTop + "px"))
        },
        scrollTo: function(t) {
            this._enabledScroll && (this._scrollTop = t, this._scrollTop = Math.min(this._maxScrollTop, this._scrollTop), this._scrollTop = Math.max(0, this._scrollTop), this._barTop = this._maxVerticalDistance * this._scrollTop / this._maxScrollTop, this.$el.scrollTop(this._scrollTop), this._$scrollBar.css("top", this._barTop + "px"))
        },
        getScrollTop: function() {
            return this._scrollTop
        },
        isAvailableScroll: function() {
            return (this.$el[0].clientHeight || this.$el.height()) !== this.$el[0].scrollHeight
        }
    })
});
define("part/plugin/AutoResizeWidthPart", ["template/plugin"], function(t) {
    var e = ["fontFamily", "fontSize", "fontWeight", "fontStyle", "letterSpacing", "lineHeight", "textTransform", "wordSpacing", "textIndent", "whiteSpace"];
    return space.Part.extend({
        initialize: function() {
            this._$mirror = null, this._range = {}
        },
        events: {
            input: "_onTextChange",
            propertychange: function(t) {
                "value" === t.originalEvent.propertyName && this._onTextChange()
            }
        },
        options: {
            range: "setRange"
        },
        onStop: function() {
            this.deactivate()
        },
        activate: function() {
            this._$mirror || (this._$mirror = $(t.autoResizeWidthMirror()).appendTo(document.body), this._$mirror.css(this.$el.css(e)))
        },
        deactivate: function() {
            this._$mirror && (this._$mirror.remove(), this._$mirror = null)
        },
        setRange: function(t) {
            this._range = t
        },
        execute: function(t) {
            this._onTextChange(t)
        },
        _onTextChange: function(t) {
            var e, i;
            this._$mirror && (i = this.$el.val(), "undefined" == typeof t && (t = !i), "undefined" != typeof this._range.placeholder && t ? e = this._range.placeholder : (this._$mirror.text(this.$el.val()), e = this._$mirror.width(), "undefined" != typeof this._range.min && (e = Math.max(e, this._range.min)), "undefined" != typeof this._range.max && (e = Math.min(e, this._range.max))), this.$el.width(e))
        }
    })
});
(function(t) {
    "function" == typeof define && define.amd ? define("jquery-ui", ["jquery"], t) : t(jQuery)
})(function(t) {
    function e(e, s) {
        var n, o, r, h = e.nodeName.toLowerCase();
        return "area" === h ? (n = e.parentNode, o = n.name, e.href && o && "map" === n.nodeName.toLowerCase() ? (r = t("img[usemap=#" + o + "]")[0], !! r && i(r)) : !1) : (/input|select|textarea|button|object/.test(h) ? !e.disabled : "a" === h ? e.href || s : s) && i(e)
    }
    function i(e) {
        return t.expr.filters.visible(e) && !t(e).parents().addBack().filter(function() {
            return "hidden" === t.css(this, "visibility")
        }).length
    }
    t.ui = t.ui || {}, t.extend(t.ui, {
        version: "1.11.0",
        keyCode: {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        }
    }), t.fn.extend({
        scrollParent: function() {
            var e = this.css("position"),
                i = "absolute" === e,
                s = this.parents().filter(function() {
                    var e = t(this);
                    return i && "static" === e.css("position") ? !1 : /(auto|scroll)/.test(e.css("overflow") + e.css("overflow-y") + e.css("overflow-x"))
                }).eq(0);
            return "fixed" !== e && s.length ? s : t(this[0].ownerDocument || document)
        },
        uniqueId: function() {
            var t = 0;
            return function() {
                return this.each(function() {
                    this.id || (this.id = "ui-id-" + ++t)
                })
            }
        }(),
        removeUniqueId: function() {
            return this.each(function() {
                /^ui-id-\d+$/.test(this.id) && t(this).removeAttr("id")
            })
        }
    }), t.extend(t.expr[":"], {
        data: t.expr.createPseudo ? t.expr.createPseudo(function(e) {
            return function(i) {
                return !!t.data(i, e)
            }
        }) : function(e, i, s) {
            return !!t.data(e, s[3])
        },
        focusable: function(i) {
            return e(i, !isNaN(t.attr(i, "tabindex")))
        },
        tabbable: function(i) {
            var s = t.attr(i, "tabindex"),
                n = isNaN(s);
            return (n || s >= 0) && e(i, !n)
        }
    }), t("<a>").outerWidth(1).jquery || t.each(["Width", "Height"], function(e, i) {
        function s(e, i, s, o) {
            return t.each(n, function() {
                i -= parseFloat(t.css(e, "padding" + this)) || 0, s && (i -= parseFloat(t.css(e, "border" + this + "Width")) || 0), o && (i -= parseFloat(t.css(e, "margin" + this)) || 0)
            }), i
        }
        var n = "Width" === i ? ["Left", "Right"] : ["Top", "Bottom"],
            o = i.toLowerCase(),
            r = {
                innerWidth: t.fn.innerWidth,
                innerHeight: t.fn.innerHeight,
                outerWidth: t.fn.outerWidth,
                outerHeight: t.fn.outerHeight
            };
        t.fn["inner" + i] = function(e) {
            return void 0 === e ? r["inner" + i].call(this) : this.each(function() {
                t(this).css(o, s(this, e) + "px")
            })
        }, t.fn["outer" + i] = function(e, n) {
            return "number" != typeof e ? r["outer" + i].call(this, e) : this.each(function() {
                t(this).css(o, s(this, e, !0, n) + "px")
            })
        }
    }), t.fn.addBack || (t.fn.addBack = function(t) {
        return this.add(null == t ? this.prevObject : this.prevObject.filter(t))
    }), t("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (t.fn.removeData = function(e) {
        return function(i) {
            return arguments.length ? e.call(this, t.camelCase(i)) : e.call(this)
        }
    }(t.fn.removeData)), t.ui.ie = !! /msie [\w.]+/.exec(navigator.userAgent.toLowerCase()), t.fn.extend({
        focus: function(e) {
            return function(i, s) {
                return "number" == typeof i ? this.each(function() {
                    var e = this;
                    setTimeout(function() {
                        t(e).focus(), s && s.call(e)
                    }, i)
                }) : e.apply(this, arguments)
            }
        }(t.fn.focus),
        disableSelection: function() {
            var t = "onselectstart" in document.createElement("div") ? "selectstart" : "mousedown";
            return function() {
                return this.bind(t + ".ui-disableSelection", function(t) {
                    t.preventDefault()
                })
            }
        }(),
        enableSelection: function() {
            return this.unbind(".ui-disableSelection")
        },
        zIndex: function(e) {
            if (void 0 !== e) return this.css("zIndex", e);
            if (this.length) for (var i, s, n = t(this[0]); n.length && n[0] !== document;) {
                if (i = n.css("position"), ("absolute" === i || "relative" === i || "fixed" === i) && (s = parseInt(n.css("zIndex"), 10), !isNaN(s) && 0 !== s)) return s;
                n = n.parent()
            }
            return 0
        }
    }), t.ui.plugin = {
        add: function(e, i, s) {
            var n, o = t.ui[e].prototype;
            for (n in s) o.plugins[n] = o.plugins[n] || [], o.plugins[n].push([i, s[n]])
        },
        call: function(t, e, i, s) {
            var n, o = t.plugins[e];
            if (o && (s || t.element[0].parentNode && 11 !== t.element[0].parentNode.nodeType)) for (n = 0; n < o.length; n++) t.options[o[n][0]] && o[n][1].apply(t.element, i)
        }
    };
    var s = 0,
        n = Array.prototype.slice;
    t.cleanData = function(e) {
        return function(i) {
            for (var s, n = 0; null != (s = i[n]); n++) try {
                t(s).triggerHandler("remove")
            } catch (o) {}
            e(i)
        }
    }(t.cleanData), t.widget = function(e, i, s) {
        var n, o, r, h, a = {}, l = e.split(".")[0];
        return e = e.split(".")[1], n = l + "-" + e, s || (s = i, i = t.Widget), t.expr[":"][n.toLowerCase()] = function(e) {
            return !!t.data(e, n)
        }, t[l] = t[l] || {}, o = t[l][e], r = t[l][e] = function(t, e) {
            return this._createWidget ? void(arguments.length && this._createWidget(t, e)) : new r(t, e)
        }, t.extend(r, o, {
            version: s.version,
            _proto: t.extend({}, s),
            _childConstructors: []
        }), h = new i, h.options = t.widget.extend({}, h.options), t.each(s, function(e, s) {
            return t.isFunction(s) ? void(a[e] = function() {
                var t = function() {
                    return i.prototype[e].apply(this, arguments)
                }, n = function(t) {
                    return i.prototype[e].apply(this, t)
                };
                return function() {
                    var e, i = this._super,
                        o = this._superApply;
                    return this._super = t, this._superApply = n, e = s.apply(this, arguments), this._super = i, this._superApply = o, e
                }
            }()) : void(a[e] = s)
        }), r.prototype = t.widget.extend(h, {
            widgetEventPrefix: o ? h.widgetEventPrefix || e : e
        }, a, {
            constructor: r,
            namespace: l,
            widgetName: e,
            widgetFullName: n
        }), o ? (t.each(o._childConstructors, function(e, i) {
            var s = i.prototype;
            t.widget(s.namespace + "." + s.widgetName, r, i._proto)
        }), delete o._childConstructors) : i._childConstructors.push(r), t.widget.bridge(e, r), r
    }, t.widget.extend = function(e) {
        for (var i, s, o = n.call(arguments, 1), r = 0, h = o.length; h > r; r++) for (i in o[r]) s = o[r][i], o[r].hasOwnProperty(i) && void 0 !== s && (e[i] = t.isPlainObject(s) ? t.isPlainObject(e[i]) ? t.widget.extend({}, e[i], s) : t.widget.extend({}, s) : s);
        return e
    }, t.widget.bridge = function(e, i) {
        var s = i.prototype.widgetFullName || e;
        t.fn[e] = function(o) {
            var r = "string" == typeof o,
                h = n.call(arguments, 1),
                a = this;
            return o = !r && h.length ? t.widget.extend.apply(null, [o].concat(h)) : o, this.each(r ? function() {
                var i, n = t.data(this, s);
                return "instance" === o ? (a = n, !1) : n ? t.isFunction(n[o]) && "_" !== o.charAt(0) ? (i = n[o].apply(n, h), i !== n && void 0 !== i ? (a = i && i.jquery ? a.pushStack(i.get()) : i, !1) : void 0) : t.error("no such method '" + o + "' for " + e + " widget instance") : t.error("cannot call methods on " + e + " prior to initialization; attempted to call method '" + o + "'")
            } : function() {
                var e = t.data(this, s);
                e ? (e.option(o || {}), e._init && e._init()) : t.data(this, s, new i(o, this))
            }), a
        }
    }, t.Widget = function() {}, t.Widget._childConstructors = [], t.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {
            disabled: !1,
            create: null
        },
        _createWidget: function(e, i) {
            i = t(i || this.defaultElement || this)[0], this.element = t(i), this.uuid = s++, this.eventNamespace = "." + this.widgetName + this.uuid, this.options = t.widget.extend({}, this.options, this._getCreateOptions(), e), this.bindings = t(), this.hoverable = t(), this.focusable = t(), i !== this && (t.data(i, this.widgetFullName, this), this._on(!0, this.element, {
                remove: function(t) {
                    t.target === i && this.destroy()
                }
            }), this.document = t(i.style ? i.ownerDocument : i.document || i), this.window = t(this.document[0].defaultView || this.document[0].parentWindow)), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
        },
        _getCreateOptions: t.noop,
        _getCreateEventData: t.noop,
        _create: t.noop,
        _init: t.noop,
        destroy: function() {
            this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
        },
        _destroy: t.noop,
        widget: function() {
            return this.element
        },
        option: function(e, i) {
            var s, n, o, r = e;
            if (0 === arguments.length) return t.widget.extend({}, this.options);
            if ("string" == typeof e) if (r = {}, s = e.split("."), e = s.shift(), s.length) {
                for (n = r[e] = t.widget.extend({}, this.options[e]), o = 0; o < s.length - 1; o++) n[s[o]] = n[s[o]] || {}, n = n[s[o]];
                if (e = s.pop(), 1 === arguments.length) return void 0 === n[e] ? null : n[e];
                n[e] = i
            } else {
                if (1 === arguments.length) return void 0 === this.options[e] ? null : this.options[e];
                r[e] = i
            }
            return this._setOptions(r), this
        },
        _setOptions: function(t) {
            var e;
            for (e in t) this._setOption(e, t[e]);
            return this
        },
        _setOption: function(t, e) {
            return this.options[t] = e, "disabled" === t && (this.widget().toggleClass(this.widgetFullName + "-disabled", !! e), e && (this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus"))), this
        },
        enable: function() {
            return this._setOptions({
                disabled: !1
            })
        },
        disable: function() {
            return this._setOptions({
                disabled: !0
            })
        },
        _on: function(e, i, s) {
            var n, o = this;
            "boolean" != typeof e && (s = i, i = e, e = !1), s ? (i = n = t(i), this.bindings = this.bindings.add(i)) : (s = i, i = this.element, n = this.widget()), t.each(s, function(s, r) {
                function h() {
                    return e || o.options.disabled !== !0 && !t(this).hasClass("ui-state-disabled") ? ("string" == typeof r ? o[r] : r).apply(o, arguments) : void 0
                }
                "string" != typeof r && (h.guid = r.guid = r.guid || h.guid || t.guid++);
                var a = s.match(/^([\w:-]*)\s*(.*)$/),
                    l = a[1] + o.eventNamespace,
                    c = a[2];
                c ? n.delegate(c, l, h) : i.bind(l, h)
            })
        },
        _off: function(t, e) {
            e = (e || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, t.unbind(e).undelegate(e)
        },
        _delay: function(t, e) {
            function i() {
                return ("string" == typeof t ? s[t] : t).apply(s, arguments)
            }
            var s = this;
            return setTimeout(i, e || 0)
        },
        _hoverable: function(e) {
            this.hoverable = this.hoverable.add(e), this._on(e, {
                mouseenter: function(e) {
                    t(e.currentTarget).addClass("ui-state-hover")
                },
                mouseleave: function(e) {
                    t(e.currentTarget).removeClass("ui-state-hover")
                }
            })
        },
        _focusable: function(e) {
            this.focusable = this.focusable.add(e), this._on(e, {
                focusin: function(e) {
                    t(e.currentTarget).addClass("ui-state-focus")
                },
                focusout: function(e) {
                    t(e.currentTarget).removeClass("ui-state-focus")
                }
            })
        },
        _trigger: function(e, i, s) {
            var n, o, r = this.options[e];
            if (s = s || {}, i = t.Event(i), i.type = (e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e).toLowerCase(), i.target = this.element[0], o = i.originalEvent) for (n in o) n in i || (i[n] = o[n]);
            return this.element.trigger(i, s), !(t.isFunction(r) && r.apply(this.element[0], [i].concat(s)) === !1 || i.isDefaultPrevented())
        }
    }, t.each({
        show: "fadeIn",
        hide: "fadeOut"
    }, function(e, i) {
        t.Widget.prototype["_" + e] = function(s, n, o) {
            "string" == typeof n && (n = {
                effect: n
            });
            var r, h = n ? n === !0 || "number" == typeof n ? i : n.effect || i : e;
            n = n || {}, "number" == typeof n && (n = {
                duration: n
            }), r = !t.isEmptyObject(n), n.complete = o, n.delay && s.delay(n.delay), r && t.effects && t.effects.effect[h] ? s[e](n) : h !== e && s[h] ? s[h](n.duration, n.easing, o) : s.queue(function(i) {
                t(this)[e](), o && o.call(s[0]), i()
            })
        }
    });
    var o = (t.widget, !1);
    t(document).mouseup(function() {
        o = !1
    });
    t.widget("ui.mouse", {
        version: "1.11.0",
        options: {
            cancel: "input,textarea,button,select,option",
            distance: 1,
            delay: 0
        },
        _mouseInit: function() {
            var e = this;
            this.element.bind("mousedown." + this.widgetName, function(t) {
                return e._mouseDown(t)
            }).bind("click." + this.widgetName, function(i) {
                return !0 === t.data(i.target, e.widgetName + ".preventClickEvent") ? (t.removeData(i.target, e.widgetName + ".preventClickEvent"), i.stopImmediatePropagation(), !1) : void 0
            }), this.started = !1
        },
        _mouseDestroy: function() {
            this.element.unbind("." + this.widgetName), this._mouseMoveDelegate && this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate)
        },
        _mouseDown: function(e) {
            if (!o) {
                this._mouseStarted && this._mouseUp(e), this._mouseDownEvent = e;
                var i = this,
                    s = 1 === e.which,
                    n = "string" == typeof this.options.cancel && e.target.nodeName ? t(e.target).closest(this.options.cancel).length : !1;
                return s && !n && this._mouseCapture(e) ? (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function() {
                    i.mouseDelayMet = !0
                }, this.options.delay)), this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = this._mouseStart(e) !== !1, !this._mouseStarted) ? (e.preventDefault(), !0) : (!0 === t.data(e.target, this.widgetName + ".preventClickEvent") && t.removeData(e.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function(t) {
                    return i._mouseMove(t)
                }, this._mouseUpDelegate = function(t) {
                    return i._mouseUp(t)
                }, this.document.bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), e.preventDefault(), o = !0, !0)) : !0
            }
        },
        _mouseMove: function(e) {
            return t.ui.ie && (!document.documentMode || document.documentMode < 9) && !e.button ? this._mouseUp(e) : e.which ? this._mouseStarted ? (this._mouseDrag(e), e.preventDefault()) : (this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, e) !== !1, this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)), !this._mouseStarted) : this._mouseUp(e)
        },
        _mouseUp: function(e) {
            return this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, e.target === this._mouseDownEvent.target && t.data(e.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(e)), o = !1, !1
        },
        _mouseDistanceMet: function(t) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - t.pageX), Math.abs(this._mouseDownEvent.pageY - t.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function() {
            return this.mouseDelayMet
        },
        _mouseStart: function() {},
        _mouseDrag: function() {},
        _mouseStop: function() {},
        _mouseCapture: function() {
            return !0
        }
    }), t.widget("ui.sortable", t.ui.mouse, {
        version: "1.11.0",
        widgetEventPrefix: "sort",
        ready: !1,
        options: {
            appendTo: "parent",
            axis: !1,
            connectWith: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            dropOnEmpty: !0,
            forcePlaceholderSize: !1,
            forceHelperSize: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            items: "> *",
            opacity: !1,
            placeholder: !1,
            revert: !1,
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1e3,
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },
        _isOverAxis: function(t, e, i) {
            return t >= e && e + i > t
        },
        _isFloating: function(t) {
            return /left|right/.test(t.css("float")) || /inline|table-cell/.test(t.css("display"))
        },
        _create: function() {
            var t = this.options;
            this.containerCache = {}, this.element.addClass("ui-sortable"), this.refresh(), this.floating = this.items.length ? "x" === t.axis || this._isFloating(this.items[0].item) : !1, this.offset = this.element.offset(), this._mouseInit(), this._setHandleClassName(), this.ready = !0
        },
        _setOption: function(t, e) {
            this._super(t, e), "handle" === t && this._setHandleClassName()
        },
        _setHandleClassName: function() {
            this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"), t.each(this.items, function() {
                (this.instance.options.handle ? this.item.find(this.instance.options.handle) : this.item).addClass("ui-sortable-handle")
            })
        },
        _destroy: function() {
            this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"), this._mouseDestroy();
            for (var t = this.items.length - 1; t >= 0; t--) this.items[t].item.removeData(this.widgetName + "-item");
            return this
        },
        _mouseCapture: function(e, i) {
            var s = null,
                n = !1,
                o = this;
            return this.reverting ? !1 : this.options.disabled || "static" === this.options.type ? !1 : (this._refreshItems(e), t(e.target).parents().each(function() {
                return t.data(this, o.widgetName + "-item") === o ? (s = t(this), !1) : void 0
            }), t.data(e.target, o.widgetName + "-item") === o && (s = t(e.target)), s && (!this.options.handle || i || (t(this.options.handle, s).find("*").addBack().each(function() {
                this === e.target && (n = !0)
            }), n)) ? (this.currentItem = s, this._removeCurrentsFromItems(), !0) : !1)
        },
        _mouseStart: function(e, i, s) {
            var n, o, r = this.options;
            if (this.currentContainer = this, this.refreshPositions(), this.helper = this._createHelper(e), this._cacheHelperProportions(), this._cacheMargins(), this.scrollParent = this.helper.scrollParent(), this.offset = this.currentItem.offset(), this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            }, t.extend(this.offset, {
                click: {
                    left: e.pageX - this.offset.left,
                    top: e.pageY - this.offset.top
                },
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }), this.helper.css("position", "absolute"), this.cssPosition = this.helper.css("position"), this.originalPosition = this._generatePosition(e), this.originalPageX = e.pageX, this.originalPageY = e.pageY, r.cursorAt && this._adjustOffsetFromHelper(r.cursorAt), this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            }, this.helper[0] !== this.currentItem[0] && this.currentItem.hide(), this._createPlaceholder(), r.containment && this._setContainment(), r.cursor && "auto" !== r.cursor && (o = this.document.find("body"), this.storedCursor = o.css("cursor"), o.css("cursor", r.cursor), this.storedStylesheet = t("<style>*{ cursor: " + r.cursor + " !important; }</style>").appendTo(o)), r.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")), this.helper.css("opacity", r.opacity)), r.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")), this.helper.css("zIndex", r.zIndex)), this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()), this._trigger("start", e, this._uiHash()), this._preserveHelperProportions || this._cacheHelperProportions(), !s) for (n = this.containers.length - 1; n >= 0; n--) this.containers[n]._trigger("activate", e, this._uiHash(this));
            return t.ui.ddmanager && (t.ui.ddmanager.current = this), t.ui.ddmanager && !r.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e), this.dragging = !0, this.helper.addClass("ui-sortable-helper"), this._mouseDrag(e), !0
        },
        _mouseDrag: function(e) {
            var i, s, n, o, r = this.options,
                h = !1;
            for (this.position = this._generatePosition(e), this.positionAbs = this._convertPositionTo("absolute"), this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs), this.options.scroll && (this.scrollParent[0] !== document && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < r.scrollSensitivity ? this.scrollParent[0].scrollTop = h = this.scrollParent[0].scrollTop + r.scrollSpeed : e.pageY - this.overflowOffset.top < r.scrollSensitivity && (this.scrollParent[0].scrollTop = h = this.scrollParent[0].scrollTop - r.scrollSpeed), this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < r.scrollSensitivity ? this.scrollParent[0].scrollLeft = h = this.scrollParent[0].scrollLeft + r.scrollSpeed : e.pageX - this.overflowOffset.left < r.scrollSensitivity && (this.scrollParent[0].scrollLeft = h = this.scrollParent[0].scrollLeft - r.scrollSpeed)) : (e.pageY - t(document).scrollTop() < r.scrollSensitivity ? h = t(document).scrollTop(t(document).scrollTop() - r.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < r.scrollSensitivity && (h = t(document).scrollTop(t(document).scrollTop() + r.scrollSpeed)), e.pageX - t(document).scrollLeft() < r.scrollSensitivity ? h = t(document).scrollLeft(t(document).scrollLeft() - r.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < r.scrollSensitivity && (h = t(document).scrollLeft(t(document).scrollLeft() + r.scrollSpeed))), h !== !1 && t.ui.ddmanager && !r.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)), this.positionAbs = this._convertPositionTo("absolute"), this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"), this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"), i = this.items.length - 1; i >= 0; i--) if (s = this.items[i], n = s.item[0], o = this._intersectsWithPointer(s), o && s.instance === this.currentContainer && n !== this.currentItem[0] && this.placeholder[1 === o ? "next" : "prev"]()[0] !== n && !t.contains(this.placeholder[0], n) && ("semi-dynamic" === this.options.type ? !t.contains(this.element[0], n) : !0)) {
                if (this.direction = 1 === o ? "down" : "up", "pointer" !== this.options.tolerance && !this._intersectsWithSides(s)) break;
                this._rearrange(e, s), this._trigger("change", e, this._uiHash());
                break
            }
            return this._contactContainers(e), t.ui.ddmanager && t.ui.ddmanager.drag(this, e), this._trigger("sort", e, this._uiHash()), this.lastPositionAbs = this.positionAbs, !1
        },
        _mouseStop: function(e, i) {
            if (e) {
                if (t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e), this.options.revert) {
                    var s = this,
                        n = this.placeholder.offset(),
                        o = this.options.axis,
                        r = {};
                    o && "x" !== o || (r.left = n.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollLeft)), o && "y" !== o || (r.top = n.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop)), this.reverting = !0, t(this.helper).animate(r, parseInt(this.options.revert, 10) || 500, function() {
                        s._clear(e)
                    })
                } else this._clear(e, i);
                return !1
            }
        },
        cancel: function() {
            if (this.dragging) {
                this._mouseUp({
                    target: null
                }), "original" === this.options.helper ? this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper") : this.currentItem.show();
                for (var e = this.containers.length - 1; e >= 0; e--) this.containers[e]._trigger("deactivate", null, this._uiHash(this)), this.containers[e].containerCache.over && (this.containers[e]._trigger("out", null, this._uiHash(this)), this.containers[e].containerCache.over = 0)
            }
            return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]), "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(), t.extend(this, {
                helper: null,
                dragging: !1,
                reverting: !1,
                _noFinalSort: null
            }), this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)), this
        },
        serialize: function(e) {
            var i = this._getItemsAsjQuery(e && e.connected),
                s = [];
            return e = e || {}, t(i).each(function() {
                var i = (t(e.item || this).attr(e.attribute || "id") || "").match(e.expression || /(.+)[\-=_](.+)/);
                i && s.push((e.key || i[1] + "[]") + "=" + (e.key && e.expression ? i[1] : i[2]))
            }), !s.length && e.key && s.push(e.key + "="), s.join("&")
        },
        toArray: function(e) {
            var i = this._getItemsAsjQuery(e && e.connected),
                s = [];
            return e = e || {}, i.each(function() {
                s.push(t(e.item || this).attr(e.attribute || "id") || "")
            }), s
        },
        _intersectsWith: function(t) {
            var e = this.positionAbs.left,
                i = e + this.helperProportions.width,
                s = this.positionAbs.top,
                n = s + this.helperProportions.height,
                o = t.left,
                r = o + t.width,
                h = t.top,
                a = h + t.height,
                l = this.offset.click.top,
                c = this.offset.click.left,
                u = "x" === this.options.axis || s + l > h && a > s + l,
                p = "y" === this.options.axis || e + c > o && r > e + c,
                f = u && p;
            return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > t[this.floating ? "width" : "height"] ? f : o < e + this.helperProportions.width / 2 && i - this.helperProportions.width / 2 < r && h < s + this.helperProportions.height / 2 && n - this.helperProportions.height / 2 < a
        },
        _intersectsWithPointer: function(t) {
            var e = "x" === this.options.axis || this._isOverAxis(this.positionAbs.top + this.offset.click.top, t.top, t.height),
                i = "y" === this.options.axis || this._isOverAxis(this.positionAbs.left + this.offset.click.left, t.left, t.width),
                s = e && i,
                n = this._getDragVerticalDirection(),
                o = this._getDragHorizontalDirection();
            return s ? this.floating ? o && "right" === o || "down" === n ? 2 : 1 : n && ("down" === n ? 2 : 1) : !1
        },
        _intersectsWithSides: function(t) {
            var e = this._isOverAxis(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height),
                i = this._isOverAxis(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width),
                s = this._getDragVerticalDirection(),
                n = this._getDragHorizontalDirection();
            return this.floating && n ? "right" === n && i || "left" === n && !i : s && ("down" === s && e || "up" === s && !e)
        },
        _getDragVerticalDirection: function() {
            var t = this.positionAbs.top - this.lastPositionAbs.top;
            return 0 !== t && (t > 0 ? "down" : "up")
        },
        _getDragHorizontalDirection: function() {
            var t = this.positionAbs.left - this.lastPositionAbs.left;
            return 0 !== t && (t > 0 ? "right" : "left")
        },
        refresh: function(t) {
            return this._refreshItems(t), this._setHandleClassName(), this.refreshPositions(), this
        },
        _connectWith: function() {
            var t = this.options;
            return t.connectWith.constructor === String ? [t.connectWith] : t.connectWith
        },
        _getItemsAsjQuery: function(e) {
            function i() {
                h.push(this)
            }
            var s, n, o, r, h = [],
                a = [],
                l = this._connectWith();
            if (l && e) for (s = l.length - 1; s >= 0; s--) for (o = t(l[s]), n = o.length - 1; n >= 0; n--) r = t.data(o[n], this.widgetFullName), r && r !== this && !r.options.disabled && a.push([t.isFunction(r.options.items) ? r.options.items.call(r.element) : t(r.options.items, r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), r]);
            for (a.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                options: this.options,
                item: this.currentItem
            }) : t(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]), s = a.length - 1; s >= 0; s--) a[s][0].each(i);
            return t(h)
        },
        _removeCurrentsFromItems: function() {
            var e = this.currentItem.find(":data(" + this.widgetName + "-item)");
            this.items = t.grep(this.items, function(t) {
                for (var i = 0; i < e.length; i++) if (e[i] === t.item[0]) return !1;
                return !0
            })
        },
        _refreshItems: function(e) {
            this.items = [], this.containers = [this];
            var i, s, n, o, r, h, a, l, c = this.items,
                u = [
                    [t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, {
                        item: this.currentItem
                    }) : t(this.options.items, this.element), this]
                ],
                p = this._connectWith();
            if (p && this.ready) for (i = p.length - 1; i >= 0; i--) for (n = t(p[i]), s = n.length - 1; s >= 0; s--) o = t.data(n[s], this.widgetFullName), o && o !== this && !o.options.disabled && (u.push([t.isFunction(o.options.items) ? o.options.items.call(o.element[0], e, {
                item: this.currentItem
            }) : t(o.options.items, o.element), o]), this.containers.push(o));
            for (i = u.length - 1; i >= 0; i--) for (r = u[i][1], h = u[i][0], s = 0, l = h.length; l > s; s++) a = t(h[s]), a.data(this.widgetName + "-item", r), c.push({
                item: a,
                instance: r,
                width: 0,
                height: 0,
                left: 0,
                top: 0
            })
        },
        refreshPositions: function(e) {
            this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
            var i, s, n, o;
            for (i = this.items.length - 1; i >= 0; i--) s = this.items[i], s.instance !== this.currentContainer && this.currentContainer && s.item[0] !== this.currentItem[0] || (n = this.options.toleranceElement ? t(this.options.toleranceElement, s.item) : s.item, e || (s.width = n.outerWidth(), s.height = n.outerHeight()), o = n.offset(), s.left = o.left, s.top = o.top);
            if (this.options.custom && this.options.custom.refreshContainers) this.options.custom.refreshContainers.call(this);
            else for (i = this.containers.length - 1; i >= 0; i--) o = this.containers[i].element.offset(), this.containers[i].containerCache.left = o.left, this.containers[i].containerCache.top = o.top, this.containers[i].containerCache.width = this.containers[i].element.outerWidth(), this.containers[i].containerCache.height = this.containers[i].element.outerHeight();
            return this
        },
        _createPlaceholder: function(e) {
            e = e || this;
            var i, s = e.options;
            s.placeholder && s.placeholder.constructor !== String || (i = s.placeholder, s.placeholder = {
                element: function() {
                    var s = e.currentItem[0].nodeName.toLowerCase(),
                        n = t("<" + s + ">", e.document[0]).addClass(i || e.currentItem[0].className + " ui-sortable-placeholder").removeClass("ui-sortable-helper");
                    return "tr" === s ? e.currentItem.children().each(function() {
                        t("<td> </td>", e.document[0]).attr("colspan", t(this).attr("colspan") || 1).appendTo(n)
                    }) : "img" === s && n.attr("src", e.currentItem.attr("src")), i || n.css("visibility", "hidden"), n
                },
                update: function(t, n) {
                    (!i || s.forcePlaceholderSize) && (n.height() || n.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css("paddingTop") || 0, 10) - parseInt(e.currentItem.css("paddingBottom") || 0, 10)), n.width() || n.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css("paddingLeft") || 0, 10) - parseInt(e.currentItem.css("paddingRight") || 0, 10)))
                }
            }), e.placeholder = t(s.placeholder.element.call(e.element, e.currentItem)), e.currentItem.after(e.placeholder), s.placeholder.update(e, e.placeholder)
        },
        _contactContainers: function(e) {
            var i, s, n, o, r, h, a, l, c, u, p = null,
                f = null;
            for (i = this.containers.length - 1; i >= 0; i--) if (!t.contains(this.currentItem[0], this.containers[i].element[0])) if (this._intersectsWith(this.containers[i].containerCache)) {
                if (p && t.contains(this.containers[i].element[0], p.element[0])) continue;
                p = this.containers[i], f = i
            } else this.containers[i].containerCache.over && (this.containers[i]._trigger("out", e, this._uiHash(this)), this.containers[i].containerCache.over = 0);
            if (p) if (1 === this.containers.length) this.containers[f].containerCache.over || (this.containers[f]._trigger("over", e, this._uiHash(this)), this.containers[f].containerCache.over = 1);
            else {
                for (n = 1e4, o = null, c = p.floating || this._isFloating(this.currentItem), r = c ? "left" : "top", h = c ? "width" : "height", u = c ? "clientX" : "clientY", s = this.items.length - 1; s >= 0; s--) t.contains(this.containers[f].element[0], this.items[s].item[0]) && this.items[s].item[0] !== this.currentItem[0] && (a = this.items[s].item.offset()[r], l = !1, e[u] - a > this.items[s][h] / 2 && (l = !0), Math.abs(e[u] - a) < n && (n = Math.abs(e[u] - a), o = this.items[s], this.direction = l ? "up" : "down"));
                if (!o && !this.options.dropOnEmpty) return;
                if (this.currentContainer === this.containers[f]) return;
                o ? this._rearrange(e, o, null, !0) : this._rearrange(e, null, this.containers[f].element, !0), this._trigger("change", e, this._uiHash()), this.containers[f]._trigger("change", e, this._uiHash(this)), this.currentContainer = this.containers[f], this.options.placeholder.update(this.currentContainer, this.placeholder), this.containers[f]._trigger("over", e, this._uiHash(this)), this.containers[f].containerCache.over = 1
            }
        },
        _createHelper: function(e) {
            var i = this.options,
                s = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e, this.currentItem])) : "clone" === i.helper ? this.currentItem.clone() : this.currentItem;
            return s.parents("body").length || t("parent" !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(s[0]), s[0] === this.currentItem[0] && (this._storedCSS = {
                width: this.currentItem[0].style.width,
                height: this.currentItem[0].style.height,
                position: this.currentItem.css("position"),
                top: this.currentItem.css("top"),
                left: this.currentItem.css("left")
            }), (!s[0].style.width || i.forceHelperSize) && s.width(this.currentItem.width()), (!s[0].style.height || i.forceHelperSize) && s.height(this.currentItem.height()), s
        },
        _adjustOffsetFromHelper: function(e) {
            "string" == typeof e && (e = e.split(" ")), t.isArray(e) && (e = {
                left: +e[0],
                top: +e[1] || 0
            }), "left" in e && (this.offset.click.left = e.left + this.margins.left), "right" in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left), "top" in e && (this.offset.click.top = e.top + this.margins.top), "bottom" in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
        },
        _getParentOffset: function() {
            this.offsetParent = this.helper.offsetParent();
            var e = this.offsetParent.offset();
            return "absolute" === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(), e.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                top: 0,
                left: 0
            }), {
                top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ("relative" === this.cssPosition) {
                var t = this.currentItem.position();
                return {
                    top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(),
                    left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft()
                }
            }
            return {
                top: 0,
                left: 0
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
                top: parseInt(this.currentItem.css("marginTop"), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var e, i, s, n = this.options;
            "parent" === n.containment && (n.containment = this.helper[0].parentNode), ("document" === n.containment || "window" === n.containment) && (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, t("document" === n.containment ? document : window).width() - this.helperProportions.width - this.margins.left, (t("document" === n.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]), /^(document|window|parent)$/.test(n.containment) || (e = t(n.containment)[0], i = t(n.containment).offset(), s = "hidden" !== t(e).css("overflow"), this.containment = [i.left + (parseInt(t(e).css("borderLeftWidth"), 10) || 0) + (parseInt(t(e).css("paddingLeft"), 10) || 0) - this.margins.left, i.top + (parseInt(t(e).css("borderTopWidth"), 10) || 0) + (parseInt(t(e).css("paddingTop"), 10) || 0) - this.margins.top, i.left + (s ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css("borderLeftWidth"), 10) || 0) - (parseInt(t(e).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, i.top + (s ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css("borderTopWidth"), 10) || 0) - (parseInt(t(e).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top])
        },
        _convertPositionTo: function(e, i) {
            i || (i = this.position);
            var s = "absolute" === e ? 1 : -1,
                n = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                o = /(html|body)/i.test(n[0].tagName);
            return {
                top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : o ? 0 : n.scrollTop()) * s,
                left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : o ? 0 : n.scrollLeft()) * s
            }
        },
        _generatePosition: function(e) {
            var i, s, n = this.options,
                o = e.pageX,
                r = e.pageY,
                h = "absolute" !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                a = /(html|body)/i.test(h[0].tagName);
            return "relative" !== this.cssPosition || this.scrollParent[0] !== document && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()), this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (o = this.containment[0] + this.offset.click.left), e.pageY - this.offset.click.top < this.containment[1] && (r = this.containment[1] + this.offset.click.top), e.pageX - this.offset.click.left > this.containment[2] && (o = this.containment[2] + this.offset.click.left), e.pageY - this.offset.click.top > this.containment[3] && (r = this.containment[3] + this.offset.click.top)), n.grid && (i = this.originalPageY + Math.round((r - this.originalPageY) / n.grid[1]) * n.grid[1], r = this.containment ? i - this.offset.click.top >= this.containment[1] && i - this.offset.click.top <= this.containment[3] ? i : i - this.offset.click.top >= this.containment[1] ? i - n.grid[1] : i + n.grid[1] : i, s = this.originalPageX + Math.round((o - this.originalPageX) / n.grid[0]) * n.grid[0], o = this.containment ? s - this.offset.click.left >= this.containment[0] && s - this.offset.click.left <= this.containment[2] ? s : s - this.offset.click.left >= this.containment[0] ? s - n.grid[0] : s + n.grid[0] : s)), {
                top: r - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : a ? 0 : h.scrollTop()),
                left: o - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : a ? 0 : h.scrollLeft())
            }
        },
        _rearrange: function(t, e, i, s) {
            i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? e.item[0] : e.item[0].nextSibling), this.counter = this.counter ? ++this.counter : 1;
            var n = this.counter;
            this._delay(function() {
                n === this.counter && this.refreshPositions(!s)
            })
        },
        _clear: function(t, e) {
            function i(t, e, i) {
                return function(s) {
                    i._trigger(t, s, e._uiHash(e))
                }
            }
            this.reverting = !1;
            var s, n = [];
            if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem), this._noFinalSort = null, this.helper[0] === this.currentItem[0]) {
                for (s in this._storedCSS)("auto" === this._storedCSS[s] || "static" === this._storedCSS[s]) && (this._storedCSS[s] = "");
                this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")
            } else this.currentItem.show();
            for (this.fromOutside && !e && n.push(function(t) {
                this._trigger("receive", t, this._uiHash(this.fromOutside))
            }), !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || n.push(function(t) {
                this._trigger("update", t, this._uiHash())
            }), this !== this.currentContainer && (e || (n.push(function(t) {
                this._trigger("remove", t, this._uiHash())
            }), n.push(function(t) {
                return function(e) {
                    t._trigger("receive", e, this._uiHash(this))
                }
            }.call(this, this.currentContainer)), n.push(function(t) {
                return function(e) {
                    t._trigger("update", e, this._uiHash(this))
                }
            }.call(this, this.currentContainer)))), s = this.containers.length - 1; s >= 0; s--) e || n.push(i("deactivate", this, this.containers[s])), this.containers[s].containerCache.over && (n.push(i("out", this, this.containers[s])), this.containers[s].containerCache.over = 0);
            if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor), this.storedStylesheet.remove()), this._storedOpacity && this.helper.css("opacity", this._storedOpacity), this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex), this.dragging = !1, this.cancelHelperRemoval) {
                if (!e) {
                    for (this._trigger("beforeStop", t, this._uiHash()), s = 0; s < n.length; s++) n[s].call(this, t);
                    this._trigger("stop", t, this._uiHash())
                }
                return this.fromOutside = !1, !1
            }
            if (e || this._trigger("beforeStop", t, this._uiHash()), this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.helper[0] !== this.currentItem[0] && this.helper.remove(), this.helper = null, !e) {
                for (s = 0; s < n.length; s++) n[s].call(this, t);
                this._trigger("stop", t, this._uiHash())
            }
            return this.fromOutside = !1, !0
        },
        _trigger: function() {
            t.Widget.prototype._trigger.apply(this, arguments) === !1 && this.cancel()
        },
        _uiHash: function(e) {
            var i = e || this;
            return {
                helper: i.helper,
                placeholder: i.placeholder || t([]),
                position: i.position,
                originalPosition: i.originalPosition,
                offset: i.positionAbs,
                item: i.currentItem,
                sender: e ? e.element : null
            }
        }
    })
});
define("jquery-ui-touch-punch", ["jquery-ui"], function() {
    (function(o) {
        function t(o, t) {
            if (!(o.originalEvent.touches.length > 1)) {
                o.preventDefault();
                var e = o.originalEvent.changedTouches[0],
                    u = document.createEvent("MouseEvents");
                u.initMouseEvent(t, !0, !0, window, 1, e.screenX, e.screenY, e.clientX, e.clientY, !1, !1, !1, !1, 0, null), o.target.dispatchEvent(u)
            }
        }
        if (o.support.touch = "ontouchend" in document, o.support.touch) {
            var e, u = o.ui.mouse.prototype,
                n = u._mouseInit,
                c = u._mouseDestroy;
            u._touchStart = function(o) {
                var u = this;
                !e && u._mouseCapture(o.originalEvent.changedTouches[0]) && (e = !0, u._touchMoved = !1, t(o, "mouseover"), t(o, "mousemove"), t(o, "mousedown"))
            }, u._touchMove = function(o) {
                e && (this._touchMoved = !0, t(o, "mousemove"))
            }, u._touchEnd = function(o) {
                e && (t(o, "mouseup"), t(o, "mouseout"), this._touchMoved || t(o, "click"), e = !1)
            }, u._mouseInit = function() {
                var t = this;
                t.element.bind({
                    touchstart: o.proxy(t, "_touchStart"),
                    touchmove: o.proxy(t, "_touchMove"),
                    touchend: o.proxy(t, "_touchEnd")
                }), n.call(t)
            }, u._mouseDestroy = function() {
                var t = this;
                t.element.unbind({
                    touchstart: o.proxy(t, "_touchStart"),
                    touchmove: o.proxy(t, "_touchMove"),
                    touchend: o.proxy(t, "_touchEnd")
                }), c.call(t)
            }
        }
    })(jQuery)
});
define("part/writing/PhotoPreviewListPart", ["kant", "template/writing", "model/PhotoPreview", "module/static/dialog", "jquery-ui", "jquery-ui-touch-punch"], function(t, e, i, n) {
    var o = 10,
        s = 3145728,
        l = 5,
        r = 1e3;
    return space.Part.extend({
        template: e.photoPreviewList,
        itemPart: "part/writing/PhotoPreviewPart",
        styles: {
            nondrag: "ui-sortable-disabled",
            sorting: "ui-sortable-sorting",
            selected: "ui-sortable-selected",
            sortableHelper: "ui-sortable-helper",
            sortablePlaceholder: "ui-sortable-placeholder",
            size: "size"
        },
        collection: null,
        collectionEvents: {
            add: function() {
                this.addItemPart.apply(this, arguments), this._onChange()
            },
            "change:state": function(t, e) {
                var i, o, l, r, c = this.collection.indexOf(t);
                if (!(0 > c || e !== t.UPLOAD_STATE.SUCCESS)) {
                    if (o = t.isGif(), l = this.collection.first().isGif() && c > 0, r = o && t.get("fileSize") > s, l) return n.alert(intl.t("writing.photoMode.maxGifMixedWarning")), void this.collection.remove(this.collection.first());
                    if (1 !== this.getPreviewCount() && o || l ? i = "writing.photoMode.maxGifMixedWarning" : r && (i = "writing.photoMode.error.entityTooLargeGif"), i) return n.alert(intl.t(i)), void this.collection.remove(t);
                    0 === c && this.trigger("activateFriendInput"), this._onChange()
                }
            },
            changeFileInput: function(t) {
                this.trigger("changeFileInput", t)
            },
            retry: function(t) {
                this.trigger("request", t)
            },
            remove: function() {
                this.removeItemPart.apply(this, arguments), (0 === this.collection.length || this.collection.every(function(t) {
                    return t.isDone()
                })) && this.collection.add(new i), this._onChange()
            },
            reset: function() {
                this.render(), this._onChange()
            }
        },
        onSetup: function() {
            var e, i, n = this,
                o = "> li._photo:not(." + this.styles.nondrag + ")";
            this.$el.sortable({
                containment: "body",
                items: o,
                placeholder: this.styles.sortablePlaceholder,
                start: function(t, i) {
                    e = i.item.index(), n.collection.last().set("visible", !1), $(t.target).data("ui-sortable").floating = !0, i.item.parent().addClass(n.styles.sorting), i.item.parent().children("." + n.styles.selected).removeClass(n.styles.selected)
                },
                over: function() {
                    n._resize()
                },
                change: function() {
                    n._resize()
                },
                update: function(t, i) {
                    var o, s, l;
                    return i.item.index() === i.item.parent().children().length - 1 ? void $(this).sortable("cancel") : (o = n.collection.models, s = i.item.index(), l = o.splice(e, 1)[0], void o.splice(s, 0, l))
                },
                stop: function(e, o) {
                    var s = o.item;
                    s.parent().removeClass(n.styles.sorting), s.addClass(n.styles.selected), clearTimeout(i), i = setTimeout(function() {
                        s.removeClass(n.styles.selected)
                    }, r), n._onChange(), t.send("wrt.529")
                }
            }), this.$el.disableSelection()
        },
        isEmpty: function() {
            return 1 === this.collection.length
        },
        isFull: function() {
            return this.collection.length - 1 >= o
        },
        isAppendable: function(t) {
            var e = {}, n = this.collection.filter(function(t) {
                return t.isProgress() || t.isDone()
            }),
                o = _.countBy(n, function(t) {
                    return t.isGif() ? i.EXTENSION.GIF : i.EXTENSION.OTHERS
                });
            return e[i.EXTENSION.GIF] = 0, e[i.EXTENSION.OTHERS] = 0, _.each(o, function(t, i) {
                e[i] += t
            }), _.each(t, function(t, i) {
                e[i] += t
            }), e[i.EXTENSION.GIF] > 1 || e[i.EXTENSION.GIF] > 0 && e[i.EXTENSION.OTHERS] > 0 ? !1 : !0
        },
        getPreviewCount: function() {
            return this.collection.filter(function(t) {
                return !t.isReady()
            }).length
        },
        getAvailableCount: function() {
            return o - (this.collection.length - 1)
        },
        _onChange: function() {
            var t = this.collection.first(),
                e = !1;
            this.trigger("change"), this.collection.length > 1 && (this.collection.last().set("visible", !this.isFull()), e = this.collection.length > 2 && t.get("state") === t.UPLOAD_STATE.SUCCESS, t.set("sortable", e)), this.$el.sortable("option", "disabled", this.collection.length <= 2), this._resize()
        },
        _resize: function() {
            var t = this;
            this.$el.children(":not(." + this.styles.sortableHelper + ")").each(function(e) {
                $(this).toggleClass(t.styles.size, 1 >= e % l)
            })
        }
    })
});
define("part/writing/PhotoPreviewPart", ["template/writing", "common/imgUtil"], function(e, t) {
    return space.Part.extend({
        template: e.photoPreview,
        ui: {
            previewControls: "._photoPreviewControl",
            fileInputWrapper: "._photoPreviewFileInputWrapper",
            fileInput: "._photoPreviewFileInput",
            swfupload: ".swfupload",
            image: "._photoPreviewImg",
            progress: "._photoPreviewProgress",
            retry: "._photoPreviewRetry",
            removeBtn: "._photoPreviewRemoveBtn"
        },
        styles: {
            ready: "add",
            fail: "again",
            goaway: "goaway",
            nondrag: "ui-sortable-disabled"
        },
        model: null,
        modelEvents: {
            "change:state": "_updatePreviewControls",
            "change:visible": "_toggleVisible",
            "change:sortable": "_toggleSortable"
        },
        onRender: function() {
            this._updatePreviewControls()
        },
        events: {
            "click ._photoPreviewRemoveBtn": function(e) {
                e.preventDefault(), this.model.trigger("destroy", this.model)
            },
            "change ._photoPreviewFileInput": function(e) {
                var t = $(e.currentTarget);
                t.val() && this.model.trigger("changeFileInput", t)
            },
            "click ._photoPreviewRetryBtn": function(e) {
                var t = this.model,
                    i = t.get("uploadOptions");
                e.preventDefault(), i.swfupload && i.swfupload.getStats().in_progress > 0 || this.model.trigger("retry", i)
            }
        },
        _updatePreviewControls: function() {
            switch (this.ui.previewControls.hide(), this.model.get("state")) {
                case this.model.UPLOAD_STATE.READY:
                    this.$el.addClass(this.styles.ready), this.ui.fileInputWrapper.show(), this.model.set("sortable", !1);
                    break;
                case this.model.UPLOAD_STATE.WAIT:
                case this.model.UPLOAD_STATE.PROGRESS:
                    this.ui.progress.show(), this.ui.removeBtn.show(), this.model.set("sortable", !1);
                    break;
                case this.model.UPLOAD_STATE.SUCCESS:
                    this.ui.image.attr("src", this.model.get("previewPath")).show(), t.resize(this.ui.image, this.ui.image.parent()), this.ui.removeBtn.show(), this.model.set("sortable", !0);
                    break;
                case this.model.UPLOAD_STATE.FAIL:
                    this.$el.addClass(this.styles.fail), this.ui.retry.show(), this.ui.removeBtn.show(), this.model.set("sortable", !1)
            }
        },
        _toggleVisible: function() {
            this.$el.toggleClass(this.styles.goaway, !this.model.get("visible"))
        },
        _toggleSortable: function() {
            this.$el.toggleClass(this.styles.nondrag, !this.model.get("sortable"))
        }
    })
});
define("common/videoPlayer", ["template/feed", "kant", "config", "swfobject"], function(e, n, a, o) {
    var t = "vdp",
        i = function() {
            return window.kakao = window.kakao || {}, window.kakao.player = window.kakao.player || {}, window.kakao.player
        }, l = function() {
            window.kakao = window.kakao || {}, window.kakao.player = {}
        }, r = function(e) {
            _.each(i(), function(n) {
                n.id !== e && n.player.pause()
            })
        }, s = function(e, o) {
            var l, r, s = e.attr("id"),
                u = $(document),
                d = "webkitfullscreenchange mozfullscreenchange fullscreenchange",
                c = function() {
                    u.on(d, function() {
                        var e = document.webkitFullscreenElement || document.mozFullscreenElement || document.fullscreenElement;
                        n.send(e ? t + ".vfon" : t + ".vfof")
                    })
                }, p = function() {
                    u.off(d)
                }, f = {
                    play: "onPlay",
                    seeked: "onSeek",
                    pause: "onPause",
                    ended: "onEnd"
                }, k = {
                    play: function() {
                        c(), n.send(t + ".vply")
                    },
                    seeked: function() {
                        n.send(t + ".vseek")
                    },
                    pause: function(e) {
                        var a = $(e.currentTarget);
                        a.prop("paused") && !a.prop("ended") && (p(), n.send(t + ".vpe"))
                    },
                    ended: function() {
                        p()
                    }
                };
            e.mediaelementplayer({
                pluginPath: a.videoPlayer.mediaElementPath,
                AndroidUseNativeControls: agent.isNativeAndroidBrowser(),
                success: function(n) {
                    var a = i();
                    a[s] = {
                        id: s,
                        player: n,
                        $video: e
                    }, _.each(_.keys(f), function(e) {
                        $(a[s].player).on(e, function() {
                            l = o && o.listeners && o.listeners[f[e]], l && l.apply(l, arguments)
                        })
                    }), _.each(_.keys(k), function(e) {
                        $(a[s].player).on(e, function() {
                            r = k[e], r.apply(r, arguments)
                        })
                    }), a[s].player.play()
                }
            })
        }, u = function(e, a) {
            var o = i(),
                l = "kakao.player." + e,
                s = l + ".initCallback",
                u = l + ".playerCallback",
                d = function(e, n) {
                    var o = a && a.listeners && a.listeners[e];
                    return o || n ? function() {
                        o && o.apply(o, arguments), n && n.apply(n, arguments)
                    } : null
                };
            return o[e] = {
                id: e,
                initCallbackName: s,
                initCallback: function() {
                    return {
                        onError: u + ".onError",
                        onLoad: u + ".onLoad",
                        onMetadata: u + ".onMetadata",
                        onPlay: u + ".onPlay",
                        onSeek: u + ".onSeek",
                        onPause: u + ".onPause",
                        onStop: u + ".onStop",
                        onEnd: u + ".onEnd",
                        onFullScreen: u + ".onFullScreen",
                        onClickSuggestionList: u + ".onClickSuggestionList",
                        getSuggestionList: u + ".getSuggestionList"
                    }
                },
                playerCallback: {
                    onLoad: d("onLoad"),
                    onMetadata: d("onMetadata"),
                    onPlay: d("onPlay", function() {
                        r(e), n.send(t + ".vply")
                    }),
                    onSeek: d("onSeek", function() {
                        n.send(t + ".vseek")
                    }),
                    onPause: d("onPause", function() {
                        n.send(t + ".vpe")
                    }),
                    onStop: d("onStop"),
                    onEnd: d("onEnd"),
                    onFullScreen: d("onFullScreen", function(e) {
                        n.send(e ? t + ".vfon" : t + ".vfof")
                    }),
                    onError: d("onError"),
                    onClickSuggestionList: d("onClickSuggestionList", function() {
                        n.send(t + ".vsl")
                    }),
                    getSuggestionList: d("getSuggestionList")
                }
            }, o[e]
        }, d = function(e, n) {
            var t, i, l, s, d = e.attr("id");
            r(d), t = u(d, n), i = _.defaults(n && n.vars || {}, {
                url: n.url,
                thumbnailUrl: n.previewPath,
                init: t.initCallbackName,
                visibleControl: !0,
                seekable: !0,
                autoStart: !0
            }), l = _.defaults(n && n.params || {}, {
                quality: "high",
                bgcolor: "#000000",
                allowscriptaccess: "always",
                allowfullscreen: "true",
                wmode: "transparent"
            }), s = _.defaults(n && n.attributes || {}, {
                id: d,
                name: "KakaoPlayer",
                align: "middle"
            }), o.embedSWF(a.videoPlayer.kakaoPlayerPath + "KakaoPlayer.swf", d, n.width, n.height, "10.1.0", a.videoPlayer.kakaoPlayerPath + "playerProductInstall.swf", i, l, s), t.player = $("#" + d)[0]
        };
    return {
        play: function(n, a) {
            var o, t = _.uniqueId("videoPlayer");
            return a = a || {}, agent.type.is.desktop ? (o = $('<div id="' + t + '">').insertBefore(n), o.html(e.noFlashPlayer()), a = _.defaults(a, {
                width: n.attr("width") || n.width(),
                height: n.attr("height") || n.height(),
                previewPath: n.attr("data-preview-path"),
                url: n.attr("src")
            }), n.remove(), d(o, a)) : (n.attr("id", t), s(n, a)), t
        },
        release: function(e) {
            if (e) {
                var n = i();
                agent.type.is.desktop || n[e].$video.off("loadeddata"), $(n[e].player).remove(), n[e] = null, delete n[e]
            } else l()
        }
    }
});
define("part/writing/VideoPreviewPart", ["template/writing", "template/feed", "common/imgUtil", "common/animate", "common/videoPlayer", "common/urlUtil", "common/util"], function(e, i, t, r, o, l, a) {
    var s = 1e3,
        d = 300;
    return space.Part.extend({
        template: e.videoPreview,
        ui: {
            preview: "._videoPreview",
            progress: "._videoPreviewProgress",
            progressBar: "._videoPreviewProgressBar",
            fileSizeWrapper: "._videoPreviewFile",
            fileSize: "._videoPreviewFileSize",
            fileName: "._videoPreviewFileName",
            loading: "._videoPreviewLoading",
            loadComplete: "._videoPreviewComplete",
            previewImg: "._videoPreviewImg",
            reload: "._videoPreviewReload"
        },
        initialize: function() {
            this._previewVideoPlayerId = null
        },
        model: null,
        modelEvents: {
            "change:state": function() {
                var e = this;
                switch (this.model.get("state")) {
                    case this.model.UPLOAD_STATE.READY:
                    case this.model.UPLOAD_STATE.PROGRESS:
                        this._updateProgressBar(0).then(function() {
                            e.ui.preview.show(), e.ui.progress.show(), e.ui.loading.show(), e.ui.loadComplete.hide(), e.ui.reload.hide()
                        });
                        break;
                    case this.model.TRANSCODING_STATE.SUCCESS:
                        this.ui.previewImg.attr("alt", this.model.get("title")), this._updateProgressBar(100, d).then(function() {
                            e.ui.progressBar.stop().width(0), e.ui.preview.show(), e.ui.loadComplete.show(), e.ui.loading.hide(), e.ui.reload.hide(), t.resize(e.ui.previewImg, e.ui.previewImg.parent(), {
                                url: e.model.get("previewPath"),
                                isCrop: !1,
                                autoResizeHeight: !0
                            })
                        });
                        break;
                    case this.model.TRANSCODING_STATE.FAIL:
                    case this.model.UPLOAD_STATE.FAIL:
                        this._updateProgressBar(0).then(function() {
                            e.ui.loading.hide(), e.ui.loadComplete.hide(), e.ui.reload.show()
                        })
                }
                this._releaseVideoPlayer()
            },
            "change:percent": function() {
                this._updateProgressBar(this.model.get("percent"), s)
            }
        },
        onStop: function() {
            this._releaseVideoPlayer()
        },
        events: {
            "click ._videoPreviewPlayBtn": function(e) {
                var t, r = this.model.get("downloadPath"),
                    l = $(e.currentTarget).parent();
                e.preventDefault(), t = $(i.videoPlayer({
                    url: r,
                    width: "100%",
                    height: this.ui.previewImg.height(),
                    previewPath: this.model.get("previewPath"),
                    defaultControls: agent.isNativeAndroidBrowser()
                })), l.empty().append(t), this._previewVideoPlayerId = o.play(t.find("video"))
            },
            "click ._videoPreviewRetryBtn": function(e) {
                e.preventDefault(e), this.trigger("retryFileupload")
            },
            "click ._removeVideoBtn": function(e) {
                e.preventDefault(), this.trigger("removeVideo")
            }
        },
        _updateProgressBar: function(e, i) {
            var t, o;
            return i ? t = r(this.ui.progressBar, {
                width: e + "%"
            }, i) : (this.ui.progressBar.stop(), this.ui.progressBar.width(e + "%"), t = Q.resolve()), this.model.get("filename") && (o = this.model.get("filename").split("/").pop().split("\\").pop(), this.ui.fileName.html(o)), this.ui.fileSizeWrapper.toggle( !! this.model.get("fileSize")), this.ui.fileSize.html(a.convertByteToMb(this.model.get("fileSize"), 1)), t
        },
        _releaseVideoPlayer: function() {
            this._previewVideoPlayerId && (o.release(this._previewVideoPlayerId), this._previewVideoPlayerId = null)
        }
    })
});
define("part/writing/DefaultScrapPreviewPart", ["template/writing", "common/imgUtil", "common/ellipsis", "common/urlUtil"], function(e, t, i, r) {
    var n = 124,
        a = 4;
    return space.Part.extend({
        template: e.defaultScrapPreview,
        ui: {
            image: "._defaultScrapPreviewImg",
            description: "._defaultScrapDescription"
        },
        model: null,
        modelEvents: {
            change: function() {
                var e = this.model.isScraped() && !this.model.isSupportEmbeddingPlay();
                e && (this.render(), this.model.hasPreviewImage() && t.resize(this.ui.image, this.ui.image.parent(), {
                    containerWidth: n,
                    containerHeight: n
                }))
            }
        },
        extendData: function() {
            return {
                scrapHost: r.removeWwwFromScrapHost(this.model.get("host")).toUpperCase()
            }
        },
        show: function() {
            this.$el.show(), i.byLine(this.ui.description, a)
        },
        events: {
            "click ._defaultScrapPreviewImgRemoveBtn": function(e) {
                e.preventDefault(), this.model.unset("image"), this.trigger("removeImage")
            }
        }
    })
});
define("part/writing/MagazineScrapPreviewPart", ["template/writing", "common/imgUtil", "common/ellipsis"], function(e, i, t) {
    var a = 3,
        n = 4,
        r = 5;
    return space.Part.extend({
        template: e.magazineScrapPreview,
        ui: {
            image: "._magazineScrapPreviewImg",
            title: "._magazineScrapTitle",
            description: "._magazineScrapDescription"
        },
        model: null,
        modelEvents: {
            change: function() {
                this.model.get("isMagazine") && (this.render(), this.model.hasPreviewImage() && i.resize(this.ui.image))
            }
        },
        show: function() {
            var e;
            this.$el.show(), e = t.byLine(this.ui.title, a), t.byLine(this.ui.description, e ? r - a : n)
        },
        events: {
            "click ._magazineScrapPreviewImgRemoveBtn": function(e) {
                e.preventDefault(), this.model.unset("image"), this.trigger("removeImage")
            }
        }
    })
});
define("part/writing/VideoScrapPreviewPart", ["template/writing", "common/ellipsis", "common/urlUtil"], function(e, i, t) {
    var n = 2;
    return space.Part.extend({
        template: e.videoScrapPreview,
        ui: {
            description: "._videoScrapDescription"
        },
        styles: {
            writing: "v2",
            popup: "movie"
        },
        model: null,
        modelEvents: {
            "change:type": function() {
                this.model.isSupportEmbeddingPlay() && this.render()
            }
        },
        extendData: function() {
            return {
                scrapHost: t.removeWwwFromScrapHost(this.model.get("host")).toUpperCase()
            }
        },
        show: function() {
            this.$el.show(), _.defer(_.bind(this._ellipsisText, this))
        },
        _ellipsisText: function() {
            i.byLine(this.ui.description, n)
        }
    })
});
define("part/comment/CommentPart", ["template/comment", "module/static/error"], function(t, i) {
    var e = 2;
    return space.Part.extend({
        model: null,
        collection: null,
        template: t.layout,
        childParts: {
            list: "part/comment/CommentListPart",
            write: "part/comment/CommentWritePart"
        },
        initialize: function() {
            this._isExpanded = !1, this._$window = $(window), this._$content = $(document.documentElement || document.body), this._filterToCollapse = _.bind(function(t, i) {
                return i >= this.collection.length - e
            }, this)
        },
        ui: {
            btnMore: "._btnCommentMore",
            moreBtnContainer: "._commentMoreBtnContainer",
            loading: "._commentLoading"
        },
        onSetup: function() {
            this.childParts.list.collection = this.collection, this.childParts.write.collection = this.collection, this.collection.length > e && (this._isExpanded = !0), this.listenTo(this.childParts.list, "itemPart:reply", function(t) {
                this.isAvailableChildPart("write") && this.childParts.write.addMention(t)
            })
        },
        onRender: function() {
            this._updateMoreBtnVisibility()
        },
        expandOrCollapse: function() {
            return this.canBeExpanded() ? this.isExpanded() ? this.collapse() : this.expand() : Q.resolve()
        },
        expand: function() {
            return this._isExpanded = !0, this.canBeExpanded() ? (this.ui.loading.show(), this.flow.forkWith(this.collection.fetch().fail(i.getHandler())).next(function() {
                this._updateMoreBtnVisibility(), this.childParts.list.render()
            }).fin(function() {
                this.ui.loading.hide()
            }).getPromise()) : (this.render(), Q.resolve())
        },
        collapse: function() {
            return this._isExpanded = !1, this.collection.reset(this.collection.filter(this._filterToCollapse)), this.render(), Q.resolve()
        },
        isExpanded: function() {
            return this._isExpanded
        },
        focus: function() {
            this.childParts.write.focus()
        },
        _updateMoreBtnVisibility: function() {
            var t = this.canBeExpanded();
            this.ui.moreBtnContainer.toggle(t)
        },
        canBeExpanded: function() {
            return this.model.get("comment_count") > this.collection.length
        },
        events: {
            "click ._btnCommentMore": function(t) {
                t.preventDefault(), this.expand()
            }
        }
    })
});
define("common/Effect", ["common/animate"], function(i) {
    var t = {
        COLLAPSE_AND_EXPAND: {
            duration: 150,
            direction: "vertical"
        },
        TRANSPARENT: {
            duration: 200
        }
    }, e = function(i) {
        this._$el = i, this._promise = Q.resolve()
    };
    return _.extend(e.prototype, {
        collapse: function(e) {
            var n = this._$el,
                s = n.css("overflow"),
                o = n.css("minHeight"),
                r = n.css("minWidth");
            return e = _.defaults(e || {}, t.COLLAPSE_AND_EXPAND), this._promise = this._promise.then(function() {
                var t;
                return n.css({
                    overflow: "hidden",
                    minHeight: 0,
                    minWidth: 0
                }), t = "vertical" === e.direction ? {
                    height: 0
                } : {
                    width: 0
                }, i(n, t, e.duration).then(function() {
                    n.css({
                        overflow: s,
                        minHeight: o,
                        minWidth: r
                    })
                })
            }), this
        },
        expand: function(e) {
            var n = this._$el,
                s = n.width(),
                o = n.height(),
                r = n.css("overflow"),
                h = n.css("minHeight"),
                c = n.css("minWidth");
            return e = _.defaults(e || {}, t.COLLAPSE_AND_EXPAND), this._promise = this._promise.then(function() {
                var t;
                return n.css({
                    overflow: "hidden",
                    minHeight: 0,
                    minWidth: 0
                }), "vertical" === e.direction ? (n.css("height", 0), t = {
                    height: o
                }) : (n.css("width", 0), t = {
                    width: s
                }), i(n, t, e.duration).then(function() {
                    n.css({
                        overflow: r,
                        minHeight: h,
                        minWidth: c
                    })
                })
            }), this
        },
        transparent: function(e) {
            var n = this._$el;
            return e = _.defaults(e || {}, t.TRANSPARENT), this._promise = this._promise.then(function() {
                return i(n, {
                    opacity: 0
                }, e.duration)
            }), this
        },
        complete: function(i) {
            this._promise.fin(i)
        }
    }), e
});
define("part/feed/LikeThumbnailPart", ["template/feed", "common/imgUtil", "common/Effect"], function(t, e, i) {
    var n = space.Part.extend({
        template: t.likeThumbnailItem,
        ui: {
            profileImage: "._profileImage"
        },
        model: null,
        extendData: function() {
            return {
                text: this.model.getEmotionText()
            }
        },
        onRender: function() {
            e.resize(this.ui.profileImage)
        }
    }),
        o = space.Part.extend({
            LIST_LIMIT: 4,
            collection: null,
            template: t.likeThumbnailContainer,
            itemPart: n,
            itemPartContainer: "._likeThumbnailContainer",
            setActivityForBindingEvents: function(t) {
                this.listenTo(t, "change:liked", function() {
                    var e = t.get("likes"),
                        i = 0;
                    t.get("liked") ? this.collection.add(e.first(), {
                        at: 0
                    }) : this.collection.some(function(t) {
                        return t.get("actor").get("isMe") ? (this.collection.remove(t), e.length >= this.LIST_LIMIT && e.some(function(t) {
                            return t.get("actor").get("isMe") ? !1 : this.collection.at(i) && this.collection.at(i).get("id") === t.get("id") ? void i++ : (this.collection.add(t, {
                                at: i + 1
                            }), !0)
                        }, this), !0) : void 0
                    }, this)
                })
            },
            collectionEvents: {
                add: function(t, e, n) {
                    var o = this.addItemPart(t, e, n);
                    this.collection.length > this.LIST_LIMIT && this.collection.remove(this.collection.last()), agent.isIe8AndBelow() && this.itemPartContainer.css("visibility", "hidden").css("visibility", "visible"), new i(o.$el).expand({
                        direction: "horizontal"
                    })
                },
                remove: function(t) {
                    var e = this,
                        n = this.getItemPart(t);
                    new i(n.$el).collapse({
                        direction: "horizontal"
                    }).complete(function() {
                        e.removeItemPart(t)
                    })
                }
            }
        });
    return o
});
define("part/feed/ThirdPartyLinkPart", ["template/feed", "common/mobileAppLink"], function(t, e) {
    return space.Part.extend({
        template: t.thirdPartyLink,
        styles: {
            thirdPartyLinkWithMedia: "adjoin"
        },
        model: null,
        events: {
            "click ._thirdPartyLink": function(t) {
                t.preventDefault(), e.openApp(this.model.get("openAppOptions"))
            }
        },
        onSetup: function() {
            var t = this.model.parent.getDisplayMediaType();
            t && this.$el.addClass(this.styles.thirdPartyLinkWithMedia)
        }
    })
});
define("part/feed/media/ImagePart", ["template/feed", "module/static/mediaView", "common/imgUtil", "common/imgPath", "common/api"], function(t, e, i, h, n) {
    var o = /\.gif(?:\?[^\?]*)$/i,
        r = 26,
        a = 102,
        g = 90,
        d = 56,
        s = 50,
        l = 80,
        p = 486,
        m = 2;
    return space.Part.extend({
        template: t.image,
        model: null,
        ui: {
            containers: "._mediaImageContainer"
        },
        options: {
            isPreview: function(t) {
                this._isPreview = t
            }
        },
        WRAP_HEIGHTS: [486, 242, 323, 364, 486],
        IMAGE_STYLES: [
            [{
                width: "486px",
                height: "486px",
                left: 0,
                top: 0
            }],
            [{
                width: "242px",
                height: "242px",
                left: 0
            }, {
                width: "242px",
                height: "242px",
                right: 0
            }],
            [{
                width: "323px",
                height: "100%",
                left: 0
            }, {
                width: "161px",
                height: "161px",
                right: 0,
                top: 0
            }, {
                width: "161px",
                height: "160px",
                right: 0,
                bottom: 0
            }],
            [{
                width: "364px",
                height: "100%",
                left: 0
            }, {
                width: "120px",
                height: "120px",
                right: 0
            }, {
                width: "120px",
                height: "120px",
                right: 0,
                top: "122px"
            }, {
                width: "120px",
                height: "120px",
                right: 0,
                bottom: 0
            }],
            [{
                width: "323px",
                height: "323px",
                left: 0
            }, {
                width: "161px",
                height: "161px",
                right: 0
            }, {
                width: "161px",
                height: "160px",
                right: 0,
                top: "163px"
            }, {
                width: "161px",
                height: "161px",
                left: 0,
                bottom: 0
            }, {
                width: "323px",
                height: "161px",
                right: 0,
                bottom: 0
            }]
        ],
        initialize: function() {
            this._mobileRatio = this._getMobileRatio(), this._isPreview = !1
        },
        extendData: function() {
            var t = this,
                e = this.model.get("media") || [],
                i = this._getMediaIndex(),
                h = this.WRAP_HEIGHTS.length,
                n = e.length,
                o = this.IMAGE_STYLES[i];
            return n > h && (e = e.slice(0, h)), {
                media: _.map(e, function(e, i) {
                    return _.defaults({
                        style: _.reduce(o[i], function(e, i, h) {
                            return i && -1 === i.indexOf("%") && (i = t._getSize(parseInt(i, 10)) + "px"), e + h + ":" + i + ";"
                        }, "")
                    }, e)
                }),
                moreImageCount: Math.max(0, n - h),
                isPreview: this._isPreview
            }
        },
        onRender: function() {
            var t = this,
                e = this.model.get("media") || [],
                n = this._getMediaIndex(),
                r = 0 === n,
                c = this.WRAP_HEIGHTS.length,
                u = Math.max(0, e.length - c);
            r || this.$el.height(this._getSize(this.WRAP_HEIGHTS[n])), _.each(this.$("._mediaImageContainer"), function(_, f) {
                var x, w = $(_),
                    I = w.find("img"),
                    v = I.attr("src"),
                    M = o.test(v),
                    E = "/" + t.model.get("actor").get("urlKey") + "/" + t.model.get("urlKey") + "/photos/" + f,
                    H = 0;
                w.is("a") && w.attr("href", E), f === c - 1 && u && w.find("._gradation").show(),
                function P() {
                    i.resize(I, w, {
                        url: v,
                        width: e[f].width,
                        height: e[f].height,
                        fitWidth: !M && r,
                        autoResizeHeight: r,
                        expand: M && r ? !1 : !0,
                        isCrop: !r || !M,
                        verticalAlign: r ? "top" : "middle"
                    }).then(function(e) {
                        r && t.$el.height(Math.min(t._getSize(t.WRAP_HEIGHTS[n]), e.height)), H > 0 && t._logImageLoadError(x, v)
                    }).fail(function(e) {
                        x = e && e.type ? e.type : "", H += 1, m > H ? (I.removeAttr("src"), P()) : (t._logImageLoadError("retry", v), I.attr("src", h.get("/img/img_failed_rtn.png", {
                            retina: !1
                        })).css({
                            width: a,
                            height: g
                        }).show(), r && (w.css({
                            height: l
                        }), I.css({
                            width: d,
                            height: s,
                            top: l / 2 - s / 2,
                            left: p / 2 - d / 2
                        }), t.$el.height(l)))
                    })
                }()
            })
        },
        _logImageLoadError: function(t, e) {
            n.request({
                url: "/web/error_log",
                type: "POST",
                data: {
                    type: "A",
                    id: this.model.get("id"),
                    contents: [t, e].join("-")
                }
            })
        },
        _getSize: function(t) {
            return agent.type.is.mobile ? t * this._mobileRatio : t
        },
        _getMediaIndex: function() {
            var t = this.model.get("media") || [],
                e = t.length - 1,
                i = this.WRAP_HEIGHTS.length;
            return e >= i && (e = i - 1), e
        },
        _viewMedia: function(t) {
            e.addActivity(this.model), e.show(e.MODE.ACTIVITY, {
                profile: this.model.get("actor"),
                mediaIndex: t
            })
        },
        _getMobileRatio: function(t) {
            return t = t || $(window).width(), (t - r) / this.WRAP_HEIGHTS[0]
        },
        events: {
            "click ._btnMediaView": function(t) {
                var e, i = $(t.currentTarget);
                t.preventDefault(), e = i.data("index"), this._viewMedia(parseInt(e || 0, 10))
            },
            "click ._btnViewImageMore": function(t) {
                var e = this.WRAP_HEIGHTS.length;
                t.preventDefault(), this._viewMedia(e - 1)
            },
            contextmenu: function(t) {
                t.preventDefault()
            }
        },
        windowEvents: {
            orientationchange: function() {
                var t = 90 === Math.abs(window.orientation) ? screen.height : screen.width;
                this._mobileRatio = this._getMobileRatio(t), this.render()
            }
        }
    })
});
define("part/feed/media/VideoPart", ["template/feed", "common/imgUtil", "common/videoPlayer"], function(e, i, t) {
    return space.Part.extend({
        template: e.video,
        model: null,
        ui: {
            thumbnail: "._videoThumbnail",
            container: "._videoContainer"
        },
        initialize: function() {
            this._videoPlayerId = null
        },
        onRender: function() {
            var e = this;
            _.each(this.ui.thumbnail, function(t, n) {
                var a = $(t),
                    r = a.find("img"),
                    d = e.model.get("media")[n];
                i.resize(r, a, {
                    isCrop: !1,
                    autoResizeHeight: !0,
                    width: d.width,
                    height: d.height
                })
            })
        },
        onStop: function() {
            this._releasePlayer()
        },
        _releasePlayer: function() {
            this._videoPlayerId && (t.release(this._videoPlayerId), this._videoPlayerId = null)
        },
        events: {
            "click ._btnViewVideo": function(i) {
                var n, a = this,
                    r = $(i.currentTarget),
                    d = r.data("url"),
                    o = r.closest("._videoContainer"),
                    l = o.find("._videoThumbnailImg"),
                    h = o.height(),
                    s = o.html();
                i.preventDefault(), n = $(e.videoPlayer({
                    url: d,
                    width: "100%",
                    height: h,
                    previewPath: l.attr("src"),
                    defaultControls: agent.isNativeAndroidBrowser()
                })), o.height(h), o.empty().append(n), this._videoPlayerId = t.play(n.find("video"), {
                    width: "100%",
                    height: h,
                    listeners: {
                        onEnd: function() {
                            a._releasePlayer(), o.html(s), a.trigger("end")
                        }
                    }
                })
            }
        }
    })
});
define("template/scrap", ["Handlebars"], function(a) {
    var t = function(t) {
        var r = a.template(t);
        return function(a) {
            return r(a, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        image: function() {
            var a = t(function(a, t, e, r, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var i, s, n = "",
                    h = "function",
                    c = this.escapeExpression;
                return n += '<a href="', (s = e.url) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.url, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '" target="_blank" class="img" data-kant-id="353"><img src="', (s = e.image) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.image, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '"></a>'
            });
            return a
        }(),
        magazineImage: function() {
            var a = t(function(a, t, e, r, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var i, s, n = "",
                    h = "function",
                    c = this.escapeExpression;
                return n += '<div class="img"><a href="', (s = e.url) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.url, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '" target="_blank" data-kant-id="546"><img src="', (s = e.image) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.image, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '"> <span class="line"></span></a></div>'
            });
            return a
        }(),
        video: function() {
            var a = t(function(a, t, e, r, l) {
                function i(a, t) {
                    var r, l, i = "";
                    return i += ' <img src="', (l = e.image) ? r = l.call(a, {
                        hash: {},
                        data: t
                    }) : (l = a && a.image, r = typeof l === o ? l.call(a, {
                        hash: {},
                        data: t
                    }) : l), i += f(r) + '"> <span class="line"></span> '
                }
                function s() {
                    return '<div class="empty"></div>'
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var n, h, c, d = "",
                    o = "function",
                    f = this.escapeExpression,
                    p = this,
                    u = e.helperMissing;
                return d += '<a href="', (h = e.dest_url) ? n = h.call(t, {
                    hash: {},
                    data: l
                }) : (h = t && t.dest_url, n = typeof h === o ? h.call(t, {
                    hash: {},
                    data: l
                }) : h), d += f(n) + '" target="_blank" class="_video" data-kant-id="354">', n = e["if"].call(t, t && t.image, {
                    hash: {},
                    inverse: p.program(3, s, l),
                    fn: p.program(1, i, l),
                    data: l
                }), (n || 0 === n) && (d += n), d += '</a> <a href="', (h = e.dest_url) ? n = h.call(t, {
                    hash: {},
                    data: l
                }) : (h = t && t.dest_url, n = typeof h === o ? h.call(t, {
                    hash: {},
                    data: l
                }) : h), d += f(n) + '" target="_blank" class="bn_play _btnPlayVideo" data-kant-id="355">' + f((h = e.t || t && t.t, c = {
                    hash: {},
                    data: l
                }, h ? h.call(t, "activity.alt.videoPlay", c) : u.call(t, "t", "activity.alt.videoPlay", c))) + "</a>"
            });
            return a
        }(),
        embeddedVideo: function() {
            var a = t(function(a, t, e, r, l) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), l = l || {};
                var i, s, n = "",
                    h = "function",
                    c = this.escapeExpression;
                return n += '<iframe src="', (s = e.url) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.url, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '" frameborder="0" width="', (s = e.width) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.width, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '" height="', (s = e.height) ? i = s.call(t, {
                    hash: {},
                    data: l
                }) : (s = t && t.height, i = typeof s === h ? s.call(t, {
                    hash: {},
                    data: l
                }) : s), n += c(i) + '"></iframe>'
            });
            return a
        }()
    }
});
define("part/feed/media/ScrapMediaPart", ["template/scrap", "common/imgUtil"], function(e, t) {
    return space.Part.extend({
        model: null,
        onRender: function() {
            this.$el.empty().append(this._getMediaContent())
        },
        _getMediaContent: function() {
            var i, d, a, n;
            switch (this.model.get("type")) {
                case this.model.TYPE.VIDEO:
                    i = $(e.video(_.extend(this.model.toJSON(), {
                        image: this.model.get("image")[0]
                    })));
                    break;
                default:
                    _.isEmpty(this.model.get("image")) || (n = this.model.get("isMagazine") ? e.magazineImage : e.image, i = $(n(_.extend(this.model.toJSON(), {
                        image: this.model.get("image")[0]
                    }))), d = i.find("img"), a = d.parent(), t.resize(d, a))
            }
            return i
        },
        events: {
            "click ._video,._btnPlayVideo": function(t) {
                var i = this.$("._video"),
                    d = this.$("._btnPlayVideo"),
                    a = i.find("img"),
                    n = a.width(),
                    m = a.height();
                if (this.model.isSupportEmbeddingPlay()) {
                    if (t.preventDefault(), d.remove(), !n || !m) return;
                    i.replaceWith(e.embeddedVideo({
                        width: n,
                        height: m,
                        url: this.model.getEmbedUrl()
                    }))
                }
            }
        }
    })
});
define("part/feed/media/ScrapPart", ["template/feed", "part/feed/media/ScrapMediaPart", "common/ellipsis", "common/urlUtil"], function(e, t, i, r) {
    var a = 2,
        s = 4,
        o = 2,
        n = 4,
        c = 5,
        d = ["youtube.com", "vimeo.com"];
    return space.Part.extend({
        template: e.scrap,
        ui: {
            wrapper: "._scrapWrapper",
            title: "._scrapTitle",
            content: "._scrapContent"
        },
        styles: {
            hasNotPreview: "v2"
        },
        model: null,
        extendData: function() {
            var e = this.model.get("scrap"),
                t = !1,
                i = !1,
                a = e.get("isMagazine"),
                s = !1,
                o = e.get("url");
            switch (e.get("type")) {
                case e.TYPE.VIDEO:
                    t = !0;
                    break;
                default:
                    i = !0
            }
            return t && (s = _.some(d, function(t) {
                return e.get("url").indexOf(t) > -1
            }), s && (o = r.getRedirectUrl(e.get("dest_url"), {
                activityId: this.model.get("id")
            }))), {
                isVideo: t,
                isUrl: i,
                isMagazine: a,
                scrapHost: r.removeWwwFromScrapHost(e.get("host")).toUpperCase(),
                scrapUrl: o,
                scrapHostRedirect: r.getRedirectUrl(e.get("hostWithProtocol"), {
                    activityId: this.model.get("id")
                })
            }
        },
        childParts: {
            "media ._scrapMediaContainer": t
        },
        onSetup: function() {
            this.childParts.media.model = this.model.get("scrap")
        },
        onDomReady: function() {
            var e, t = this.model.get("scrap"),
                r = t.get("isMagazine"),
                d = t.get("type") === t.TYPE.VIDEO ? a : s;
            r ? (e = i.byLine(this.ui.title, o), i.byLine(this.ui.content, e ? c - o : n)) : i.byLine(this.ui.content, d)
        },
        onRender: function() {
            var e = this.model.get("scrap").get("previewImage");
            this.ui.wrapper.toggleClass(this.styles.hasNotPreview, !e)
        }
    })
});
define("part/feed/media/MusicPart", ["template/feed", "common/musicPlayer", "config", "module/static/error"], function(e, t, n, i) {
    return space.Part.extend({
        template: e.music,
        model: null,
        extendData: function() {
            return {
                serviceUrl: n.serviceUrl.music
            }
        },
        events: {
            "click ._btnOpenMusicPlayer": function(e) {
                e.preventDefault(), t.openByActivityId(this.model.get("id")).fail(i.getHandler())
            },
            "click ._btnOpenKakaoMusic": function(e) {
                var t = this.model.get("application");
                !agent.type.is.desktop && t && t.install_url && (e.preventDefault(), window.open(t.install_url))
            }
        }
    })
});
define("part/feed/LikeButtonPart", ["template/feed", "part/plugin/LayerPart", "common/animate"], function(i, t, n) {
    var e = 100,
        a = 30,
        o = 60;
    return t.extend({
        template: i.likeButtonLayer,
        ui: _.extend(t.prototype.ui, {
            btnLike: "._btnLikeEmotion"
        }),
        initialize: function() {
            t.prototype.initialize.apply(this, arguments), this._$window = $(window), this._animationPromise = Q.resolve()
        },
        show: function() {
            var i = this;
            this._animationPromise.isPending() || (this.ui.btnLike.hide(), t.prototype.show.apply(this, arguments), this._animationPromise = this._animationPromise.then(function() {
                return Q.all(_.map(i.ui.btnLike, function(i, t) {
                    var r = $(i).css({
                        opacity: 0,
                        marginTop: o,
                        display: ""
                    });
                    return Q.delay(a * t).then(function() {
                        return n(r, {
                            opacity: 1,
                            marginTop: 0
                        }, e)
                    })
                }))
            }))
        },
        hide: function() {
            var i = this,
                r = _.toArray(arguments),
                u = this.ui.btnLike.length;
            this._animationPromise = this._animationPromise.then(function() {
                return Q.all(_.map(i.ui.btnLike, function(i, t) {
                    var r = $(i);
                    return Q.delay(a * (u - (t + 1))).then(function() {
                        return n(r, {
                            opacity: 0,
                            marginTop: o
                        }, e)
                    })
                })).then(function() {
                    t.prototype.hide.apply(i, r)
                })
            })
        }
    })
});
define("template/like", ["Handlebars"], function(t) {
    var a = function(a) {
        var l = t.template(a);
        return function(t) {
            return l(t, {
                partials: n
            })
        }
    }, n = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = a(function(t, a, n, l, e) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, t.helpers), e = e || {};
                var i, s, r = "",
                    c = n.helperMissing,
                    o = this.escapeExpression;
                return r += '<div class="ly_con friend _layerContainer"><div class="inner"><h1>' + o((i = n.t || a && a.t, s = {
                    hash: {},
                    data: e
                }, i ? i.call(a, "activity.like.description", s) : c.call(a, "t", "activity.like.description", s))) + '(<span class="_likeCount">' + o((i = n.numberFormat || a && a.numberFormat, s = {
                    hash: {},
                    data: e
                }, i ? i.call(a, a && a.like_count, s) : c.call(a, "numberFormat", a && a.like_count, s))) + '</span>)</h1><ul class="give _listContainer"></ul><button class="bn_x _likeListLayerClose" data-kant-id="false">' + o((i = n.t || a && a.t, s = {
                    hash: {},
                    data: e
                }, i ? i.call(a, "activity.alt.close", s) : c.call(a, "t", "activity.alt.close", s))) + "</button></div></div>"
            });
            return t.wrap = '<div class="dim_ly" data-kant-group="like">', t
        }(),
        item: function() {
            var t = a(function(t, a, n, l, e) {
                function i(t, a) {
                    var l, e, i = "";
                    return i += ' <span class="ic_birthday">' + u((l = n.t || t && t.t, e = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, "profile.alt.birthdayTitle", e) : d.call(t, "t", "profile.alt.birthdayTitle", e))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, t.helpers), e = e || {};
                var s, r, c, o = "",
                    d = n.helperMissing,
                    u = this.escapeExpression,
                    h = "function",
                    p = this;
                return o += '<div class="pf"><a href="/' + u((s = a && a.actor, s = null == s || s === !1 ? s : s.urlKey, typeof s === h ? s.apply(a) : s)) + '" data-kant-id="201"><img src="' + u((r = n.profileImage || a && a.profileImage, c = {
                    hash: {
                        url: (s = a && a.actor, null == s || s === !1 ? s : s.profile_thumbnail_url),
                        size: "36"
                    },
                    data: e
                }, r ? r.call(a, c) : d.call(a, "profileImage", c))) + '" alt="" class="_profileImage"></a></div><span class="ico_feel ', (r = n.emotionClass) ? s = r.call(a, {
                    hash: {},
                    data: e
                }) : (r = a && a.emotionClass, s = typeof r === h ? r.call(a, {
                    hash: {},
                    data: e
                }) : r), o += u(s) + '">', (r = n.emotion) ? s = r.call(a, {
                    hash: {},
                    data: e
                }) : (r = a && a.emotion, s = typeof r === h ? r.call(a, {
                    hash: {},
                    data: e
                }) : r), o += u(s) + '</span><p class="txt"><a href="/' + u((s = a && a.actor, s = null == s || s === !1 ? s : s.urlKey, typeof s === h ? s.apply(a) : s)) + '" data-kant-id="202"><strong>' + u((s = a && a.actor, s = null == s || s === !1 ? s : s.display_name, typeof s === h ? s.apply(a) : s)) + " ", s = n["if"].call(a, (s = a && a.actor, null == s || s === !1 ? s : s.is_birthday), {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, i, e),
                    data: e
                }), (s || 0 === s) && (o += s), o += "</strong></a> ", (r = n.emotion) ? s = r.call(a, {
                    hash: {},
                    data: e
                }) : (r = a && a.emotion, s = typeof r === h ? r.call(a, {
                    hash: {},
                    data: e
                }) : r), o += u(s) + '</p><div class="bn_group"> <button class="btn_del _btnLikeDelete" data-kant-id="203">' + u((r = n.t || a && a.t, c = {
                    hash: {},
                    data: e
                }, r ? r.call(a, "activity.alt.likeDelete", c) : d.call(a, "t", "activity.alt.likeDelete", c))) + '</button> <button class="btn_com btn_wh _btnRequestFriend _friendButtons" data-kant-id="204">' + u((r = n.t || a && a.t, c = {
                    hash: {},
                    data: e
                }, r ? r.call(a, "friend.btn.invite", c) : d.call(a, "t", "friend.btn.invite", c))) + '</button> <button class="btn_com ing _btnRequestingFriend _friendButtons" data-kant-id="false">' + u((r = n.t || a && a.t, c = {
                    hash: {},
                    data: e
                }, r ? r.call(a, "friend.btn.inviting", c) : d.call(a, "t", "friend.btn.inviting", c))) + '</button> <button class="btn_com ing _btnCancelRequestingFriend _friendButtons" data-kant-id="206">' + u((r = n.t || a && a.t, c = {
                    hash: {},
                    data: e
                }, r ? r.call(a, "friend.btn.cancel", c) : d.call(a, "t", "friend.btn.cancel", c))) + '</button> <button class="btn_com btn_wh _btnAcceptFriend _friendButtons" data-kant-id="207">' + u((r = n.t || a && a.t, c = {
                    hash: {},
                    data: e
                }, r ? r.call(a, "friend.btn.accept", c) : d.call(a, "t", "friend.btn.accept", c))) + "</button></div>"
            });
            return t.wrap = '<li data-kant-group="like">', t
        }()
    }
});
define("part/feed/LikeListPart", ["template/like", "part/plugin/CoverLayerPart", "common/Effect", "common/util", "common/kantUtil", "module/static/error"], function(t, e, i, n, l, o) {
    var r = 5,
        a = "lkp";
    return e.extend({
        collection: null,
        model: null,
        template: t.layout,
        itemPart: "part/feed/LikeItemPart",
        itemPartContainer: "._listContainer",
        ui: _.extend({}, e.prototype.ui, {
            listContainer: "._listContainer",
            likeCount: "._likeCount"
        }),
        onSetup: function() {
            var t = this;
            return this.model.get("like_count") > this.collection.length && this.collection.length <= r ? this.collection.fetch().fail(o.getHandler()).fail(function() {
                t.hide()
            }) : void 0
        },
        onRender: function() {
            this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: this.ui.listContainer,
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.collection.fetch().then(function(t) {
                                t && t.length && l.sendPageView(a)
                            }).fail(o.getHandler())
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }), this.addPart("customScroll", "part/plugin/ScrollPart", {
                selector: this.ui.listContainer
            }), l.sendPageView(a), this.show()
        },
        events: {
            "click ._likeListLayerClose": function(t) {
                t.preventDefault(), this.hide()
            }
        },
        collectionEvents: {
            add: "addItemPart",
            remove: function(t) {
                var e = this,
                    l = this.getItemPart(t),
                    o = this.model.get("like_count") - 1;
                this.model.set("like_count", o), t.get("actor").get("isMe") && (this.model.set("liked", !1), this.model.set("liked_emotion", null)), this.ui.likeCount.text(n.numberFormat(o)), new i(l.$el).collapse().complete(function() {
                    e.removeItemPart(t), e.resize(), e.collection.length || e.hide()
                })
            }
        }
    })
});
define("part/feed/PermalinkLayerPart", ["template/feed", "part/plugin/CoverLayerPart"], function(t, e) {
    return e.extend({
        model: null,
        template: t.permalink,
        ui: _.extend({}, e.prototype.ui, {
            input: "._shareUrlInput"
        }),
        onRender: function() {
            this.show(), agent.type.is.desktop ? (this.ui.input[0].focus(), this.ui.input[0].select()) : this.ui.input.on("keydown cut", function(t) {
                t.preventDefault()
            })
        },
        extendData: function() {
            var t = intl.t("activity.url.description");
            return agent.type.is.desktop && (agent.os.is.windows ? t = intl.t("activity.url.windowsDescription") : agent.os.is.mac && (t = intl.t("activity.url.macDescription"))), {
                isDesktop: agent.type.is.desktop,
                copyUrlDescription: t,
                shareUrl: this._getShareUrl()
            }
        },
        onStop: function() {
            this.ui.input.off("keydown cut")
        },
        _getShareUrl: function() {
            return location.protocol + "//" + location.host + "/" + this.model.get("actor").get("urlKey") + "/" + this.model.get("urlKey")
        },
        events: {
            "click ._btnCloseLayer": function(t) {
                t.preventDefault(), this.hide()
            }
        }
    })
});
define("template/shareLayer", ["Handlebars"], function(t) {
    var a = function(a) {
        var l = t.template(a);
        return function(t) {
            return l(t, {
                partials: n
            })
        }
    }, n = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = a(function(t, a, n, l, i) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, t.helpers), i = i || {};
                var e, r, s = "",
                    c = n.helperMissing,
                    o = this.escapeExpression;
                return s += '<div class="ly_con friend _layerContainer"><div class="inner"><h1>' + o((e = n.t || a && a.t, r = {
                    hash: {},
                    data: i
                }, e ? e.call(a, "activity.share.description", r) : c.call(a, "t", "activity.share.description", r))) + "(" + o((e = n.numberFormat || a && a.numberFormat, r = {
                    hash: {},
                    data: i
                }, e ? e.call(a, a && a.share_count, r) : c.call(a, "numberFormat", a && a.share_count, r))) + ')</h1><ul class="v2 _listContainer"></ul><button class="bn_x _btnCloseShareLayer" data-kant-id="false">' + o((e = n.t || a && a.t, r = {
                    hash: {},
                    data: i
                }, e ? e.call(a, "activity.alt.close", r) : c.call(a, "t", "activity.alt.close", r))) + "</button></div></div>"
            });
            return t.wrap = '<div class="dim_ly" data-kant-group="shr">', t
        }(),
        item: function() {
            var t = a(function(t, a, n, l, i) {
                function e(t, a) {
                    var l, i, e = "";
                    return e += ' <span class="ic_birthday">' + h((l = n.t || t && t.t, i = {
                        hash: {},
                        data: a
                    }, l ? l.call(t, "profile.alt.birthdayTitle", i) : d.call(t, "t", "profile.alt.birthdayTitle", i))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, t.helpers), i = i || {};
                var r, s, c, o = "",
                    d = n.helperMissing,
                    h = this.escapeExpression,
                    u = "function",
                    p = this;
                return o += '<div class="pf"><a href="/' + h((r = a && a.actor, r = null == r || r === !1 ? r : r.urlKey, typeof r === u ? r.apply(a) : r)) + "/", (s = n.activityUrlKey) ? r = s.call(a, {
                    hash: {},
                    data: i
                }) : (s = a && a.activityUrlKey, r = typeof s === u ? s.call(a, {
                    hash: {},
                    data: i
                }) : s), o += h(r) + '" data-kant-id="368"><img src="' + h((s = n.profileImage || a && a.profileImage, c = {
                    hash: {
                        url: (r = a && a.actor, null == r || r === !1 ? r : r.profile_thumbnail_url),
                        size: "36"
                    },
                    data: i
                }, s ? s.call(a, c) : d.call(a, "profileImage", c))) + '" alt="" class="_profileImage"><span class="line"></span></a></div><p class="txt"><a href="/' + h((r = a && a.actor, r = null == r || r === !1 ? r : r.urlKey, typeof r === u ? r.apply(a) : r)) + "/", (s = n.activityUrlKey) ? r = s.call(a, {
                    hash: {},
                    data: i
                }) : (s = a && a.activityUrlKey, r = typeof s === u ? s.call(a, {
                    hash: {},
                    data: i
                }) : s), o += h(r) + '" data-kant-id="369"><strong>' + h((r = a && a.actor, r = null == r || r === !1 ? r : r.display_name, typeof r === u ? r.apply(a) : r)) + " ", r = n["if"].call(a, (r = a && a.actor, null == r || r === !1 ? r : r.is_birthday), {
                    hash: {},
                    inverse: p.noop,
                    fn: p.program(1, e, i),
                    data: i
                }), (r || 0 === r) && (o += r), o += '</strong></a></p><div class="bn_group"> <button class="btn_com btn_wh _btnRequestFriend _friendButtons" data-kant-id="371">' + h((s = n.t || a && a.t, c = {
                    hash: {},
                    data: i
                }, s ? s.call(a, "friend.btn.invite", c) : d.call(a, "t", "friend.btn.invite", c))) + '</button> <button class="btn_com ing _btnRequestingFriend _friendButtons" data-kant-id="false">' + h((s = n.t || a && a.t, c = {
                    hash: {},
                    data: i
                }, s ? s.call(a, "friend.btn.inviting", c) : d.call(a, "t", "friend.btn.inviting", c))) + '</button> <button class="btn_com ing _btnCancelRequestingFriend _friendButtons" data-kant-id="373">' + h((s = n.t || a && a.t, c = {
                    hash: {},
                    data: i
                }, s ? s.call(a, "friend.btn.cancel", c) : d.call(a, "t", "friend.btn.cancel", c))) + '</button> <button class="btn_com btn_wh _btnAcceptFriend _friendButtons" data-kant-id="374">' + h((s = n.t || a && a.t, c = {
                    hash: {},
                    data: i
                }, s ? s.call(a, "friend.btn.accept", c) : d.call(a, "t", "friend.btn.accept", c))) + "</button></div>"
            });
            return t.wrap = '<li data-kant-group="shr">', t
        }()
    }
});
define("part/feed/FeedLayerItemPart", ["model/me", "model/Profile", "module/static/dialog", "module/static/error", "common/imgUtil"], function(e, t, i, n, r) {
    return space.Part.extend({
        model: null,
        ui: {
            friendButtons: "._friendButtons",
            btnRequestFriend: "._btnRequestFriend",
            btnRequestingFriend: "._btnRequestingFriend",
            btnCancelRequestingFriend: "._btnCancelRequestingFriend",
            btnAcceptFriend: "._btnAcceptFriend",
            profileImage: "._profileImage"
        },
        onRender: function() {
            this._setFriendButtonVisibility(), r.resize(this.ui.profileImage, this.ui.profileImage.parent())
        },
        _getProfile: function() {
            return this.model instanceof t ? this.model : this.model.get("actor")
        },
        _setFriendButtonVisibility: function() {
            var t = this._getProfile();
            this.ui.friendButtons.hide(), e.isRegistered() && (t.get("isRequestReceived") ? this.ui.btnAcceptFriend.show() : t.get("isRequestSent") ? this.ui.btnRequestingFriend.show() : t.get("canAddFriend") && this.ui.btnRequestFriend.show())
        },
        events: {
            "mouseenter ._btnRequestingFriend,._btnCancelRequestingFriend": function() {
                this._getProfile().get("isRequestSent") && (this.ui.btnRequestingFriend.hide(), this.ui.btnCancelRequestingFriend.show())
            },
            "mouseleave ._btnRequestingFriend,._btnCancelRequestingFriend": function() {
                this._getProfile().get("isRequestSent") && (this.ui.btnRequestingFriend.show(), this.ui.btnCancelRequestingFriend.hide())
            },
            "click ._btnRequestingFriend": function(e) {
                e.preventDefault(), this.ui.btnRequestingFriend.hide(), this.ui.btnCancelRequestingFriend.show()
            },
            "click ._btnRequestFriend": function(e) {
                var t = this,
                    i = this._getProfile();
                e.preventDefault(), i.invite().then(function() {
                    t.ui.btnRequestFriend.hide(), t.ui.btnRequestingFriend.show()
                }).fail(n.getHandler({
                    loginRedirect: !0
                }))
            },
            "click ._btnCancelRequestingFriend": function(e) {
                var t = this,
                    r = this._getProfile(),
                    s = intl.t("friend.dialog.cancel");
                e.preventDefault(), i.confirm(s, e.target).then(function() {
                    return r.cancel().then(function() {
                        t.ui.btnCancelRequestingFriend.hide(), t.ui.btnRequestingFriend.hide(), t.ui.btnRequestFriend.show()
                    }).fail(n.getHandler({
                        loginRedirect: !0
                    }))
                })
            },
            "click ._btnAcceptFriend": function(e) {
                var t = this,
                    i = this._getProfile();
                e.preventDefault(), i.accept().then(function() {
                    t.ui.friendButtons.hide()
                }).fail(n.getHandler({
                    loginRedirect: !0
                }))
            }
        }
    })
});
define("part/feed/ShareListPart", ["template/shareLayer", "part/plugin/CoverLayerPart", "part/feed/FeedLayerItemPart", "module/static/error", "common/kantUtil"], function(t, e, n, r, i) {
    var a = "shp";
    return e.extend({
        collection: null,
        model: null,
        template: t.layout,
        itemPart: n.extend({
            template: t.item
        }),
        itemPartContainer: "._listContainer",
        ui: _.extend({}, e.prototype.ui, {
            listContainer: "._listContainer"
        }),
        onRender: function() {
            this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: this.ui.listContainer,
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.collection.fetch().then(function(t) {
                                t && t.length && i.sendPageView(a)
                            }).fail(r.getHandler())
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }), this.addPart("customScroll", "part/plugin/ScrollPart", {
                selector: this.ui.listContainer
            }), i.sendPageView(a), this.show()
        },
        events: {
            "click ._btnCloseShareLayer": function(t) {
                t.preventDefault(), this.hide()
            }
        },
        collectionEvents: {
            add: "addItemPart",
            remove: "removeItemPart"
        }
    })
});
define("template/withTags", ["Handlebars"], function(t) {
    var a = function(a) {
        var i = t.template(a);
        return function(t) {
            return i(t, {
                partials: n
            })
        }
    }, n = {
        __p__: ""
    };
    return {
        layout: function() {
            var t = a(function(t, a, n, i, l) {
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, t.helpers), l = l || {};
                var e, s, r, c = "",
                    d = "function",
                    o = this.escapeExpression,
                    h = n.helperMissing;
                return c += '<div class="ly_con friend _layerContainer"><div class="inner"><h1>', (s = n.withTagCount) ? e = s.call(a, {
                    hash: {},
                    data: l
                }) : (s = a && a.withTagCount, e = typeof s === d ? s.call(a, {
                    hash: {},
                    data: l
                }) : s), c += o(e) + '</h1><ul class="v2 _listContainer"></ul><button class="bn_x _btnCloseLayer" data-kant-id="false">' + o((s = n.t || a && a.t, r = {
                    hash: {},
                    data: l
                }, s ? s.call(a, "activity.alt.close", r) : h.call(a, "t", "activity.alt.close", r))) + "</button></div></div>"
            });
            return t.wrap = '<div class="dim_ly" data-kant-group="with">', t
        }(),
        item: function() {
            var t = a(function(t, a, n, i, l) {
                function e(t, a) {
                    var i, l, e = "";
                    return e += ' <span class="ic_birthday">' + h((i = n.t || t && t.t, l = {
                        hash: {},
                        data: a
                    }, i ? i.call(t, "profile.alt.birthdayTitle", l) : o.call(t, "t", "profile.alt.birthdayTitle", l))) + "</span> "
                }
                this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, t.helpers), l = l || {};
                var s, r, c, d = "",
                    o = n.helperMissing,
                    h = this.escapeExpression,
                    u = "function",
                    f = this;
                return d += '<div class="pf"><a href="/', (r = n.urlKey) ? s = r.call(a, {
                    hash: {},
                    data: l
                }) : (r = a && a.urlKey, s = typeof r === u ? r.call(a, {
                    hash: {},
                    data: l
                }) : r), d += h(s) + '" data-kant-id="381"><img src="' + h((r = n.profileImage || a && a.profileImage, c = {
                    hash: {
                        url: a && a.profile_thumbnail_url,
                        size: "36"
                    },
                    data: l
                }, r ? r.call(a, c) : o.call(a, "profileImage", c))) + '" alt="" class="_profileImage"></a></div><p class="txt"><a href="/', (r = n.urlKey) ? s = r.call(a, {
                    hash: {},
                    data: l
                }) : (r = a && a.urlKey, s = typeof r === u ? r.call(a, {
                    hash: {},
                    data: l
                }) : r), d += h(s) + '" data-kant-id="382"><strong>', (r = n.display_name) ? s = r.call(a, {
                    hash: {},
                    data: l
                }) : (r = a && a.display_name, s = typeof r === u ? r.call(a, {
                    hash: {},
                    data: l
                }) : r), d += h(s) + " ", s = n["if"].call(a, a && a.is_birthday, {
                    hash: {},
                    inverse: f.noop,
                    fn: f.program(1, e, l),
                    data: l
                }), (s || 0 === s) && (d += s), d += '</strong></a></p><div class="bn_group"> <button class="btn_com btn_wh _btnRequestFriend _friendButtons" data-kant-id="384">' + h((r = n.t || a && a.t, c = {
                    hash: {},
                    data: l
                }, r ? r.call(a, "friend.btn.invite", c) : o.call(a, "t", "friend.btn.invite", c))) + '</button> <button class="btn_com ing _btnRequestingFriend _friendButtons" data-kant-id="false">' + h((r = n.t || a && a.t, c = {
                    hash: {},
                    data: l
                }, r ? r.call(a, "friend.btn.inviting", c) : o.call(a, "t", "friend.btn.inviting", c))) + '</button> <button class="btn_com ing _btnCancelRequestingFriend _friendButtons" data-kant-id="386">' + h((r = n.t || a && a.t, c = {
                    hash: {},
                    data: l
                }, r ? r.call(a, "friend.btn.cancel", c) : o.call(a, "t", "friend.btn.cancel", c))) + '</button> <button class="btn_com btn_wh _btnAcceptFriend _friendButtons" data-kant-id="387">' + h((r = n.t || a && a.t, c = {
                    hash: {},
                    data: l
                }, r ? r.call(a, "friend.btn.accept", c) : o.call(a, "t", "friend.btn.accept", c))) + "</button></div>"
            });
            return t.wrap = '<li data-kant-group="with">', t
        }()
    }
});
define("part/feed/WithTagListPart", ["template/withTags", "part/plugin/CoverLayerPart", "part/feed/FeedLayerItemPart", "common/util", "module/static/error"], function(t, e, i, n, r) {
    return e.extend({
        collection: null,
        model: null,
        template: t.layout,
        itemPart: i.extend({
            template: t.item
        }),
        itemPartContainer: "._listContainer",
        ui: _.extend({}, e.prototype.ui, {
            listContainer: "._listContainer"
        }),
        extendData: function() {
            return {
                withTagCount: intl.t("activity.withTagCount", {
                    count: n.numberFormat(this.model.get("with_tag_count"))
                })
            }
        },
        onRender: function() {
            this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: this.ui.listContainer,
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.collection.fetch().fail(r.getHandler())
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }), this.addPart("customScroll", "part/plugin/ScrollPart", {
                selector: this.ui.listContainer
            }), this.show()
        },
        events: {
            "click ._btnCloseLayer": function(t) {
                t.preventDefault(), this.hide()
            }
        },
        collectionEvents: {
            add: "addItemPart",
            remove: "removeItemPart"
        }
    })
});
define("model/Report", ["common/api"], function(t) {
    var e = space.Model.extend({
        defaults: {
            categories: null,
            notifiable_id: null,
            description: null,
            original_text: null,
            type: null,
            category: null,
            abuser_profile_id: null,
            email: null
        },
        url: "/abuse_report/categories",
        CATEGORY: {
            ETC: "1",
            AD: "12",
            UNLAWFUL: "13",
            LIBEL: "14",
            ADULT: "15",
            EXCEED: "16"
        },
        TYPE: {
            ACTIVITY: "activity",
            COMMENT: "comment",
            PROFILE: "profile",
            VIDEO: "video"
        },
        parse: function(t) {
            return {
                categories: t
            }
        },
        initialize: function() {
            this.source = null, this.commentId = null
        },
        submitHarmful: function(t) {
            var e = _.extend({
                notifiable_id: this.get("notifiable_id"),
                abuser_profile_id: this.get("abuser_profile_id"),
                original_text: this.get("original_text"),
                type: this.getHarmfulType()
            }, t);
            return this._submit(e)
        },
        submitLibelous: function(t) {
            var e = _.extend({
                notifiable_id: this.get("notifiable_id"),
                abuser_profile_id: this.get("abuser_profile_id"),
                original_text: this.get("original_text"),
                type: this.getLibelousType()
            }, t);
            return this._submit(e)
        },
        _submit: function(e) {
            var i = {
                url: "/abuse_report",
                type: "POST",
                data: e
            };
            return t.request(i)
        },
        setReportData: function(t, e, i, s, r) {
            var n = {};
            return this.clear({
                silent: !0
            }), this.source = t.toLowerCase(), this.commentId = i, this.set("notifiable_id", e), this.set("abuser_profile_id", s), this.source === this.TYPE.COMMENT && (this.set("notifiable_id", this.commentId + "," + e), r && this.set("original_text", r)), this.source === this.TYPE.VIDEO && (n.data = {
                type: this.TYPE.VIDEO
            }), this.fetch(n)
        },
        getHarmfulType: function() {
            switch (this.source) {
                case this.TYPE.ACTIVITY:
                case this.TYPE.VIDEO:
                    return "A";
                case this.TYPE.COMMENT:
                    return "C";
                case this.TYPE.PROFILE:
                    return "P"
            }
        },
        getLibelousType: function() {
            switch (this.source) {
                case this.TYPE.ACTIVITY:
                case this.TYPE.VIDEO:
                    return "VA";
                case this.TYPE.COMMENT:
                    return "VC";
                case this.TYPE.PROFILE:
                    return "VP"
            }
        }
    });
    return e.CATEGORY = e.prototype.CATEGORY, e.TYPE = e.prototype.TYPE, e
});
define("part/report/ReportPart", ["model/Report", "template/report", "common/util", "module/static/error", "module/static/dialog"], function(e, t, r, i, n) {
    return space.Part.extend({
        template: t.report,
        model: null,
        ui: {
            reportMenu: "._reportMenu",
            typeTitle: "._typeTitle",
            harmfulPane: "._harmfulPane",
            harmfulProfile: "._harmfulProfile",
            LibelousPane: "._LibelousPane",
            harmForm: "._harmForm",
            harmProfileForm: "._harmProfileForm",
            harmReason: "._harmReason",
            etcReason: "._etcReason",
            libelousForm: "._libelousForm",
            libReason: "._libReason",
            categoryContainer: "._categoryContainer"
        },
        MAX_LENGTH: 1e3,
        events: {
            "click ._btnClose": function(e) {
                e.preventDefault(), this._resetReport()
            },
            "click ._harmful": function(e) {
                e.preventDefault(), this._showHarmfulPane()
            },
            "click ._harmReason": function(e) {
                e.preventDefault(), this.ui.etcReason.prop("checked", !0)
            },
            "click ._harmfulSubmit": function(t) {
                var i = this,
                    o = $("input:radio[name=harm]:checked").val(),
                    a = r.trim(this.ui.harmReason.val()),
                    l = {};
                if (t.preventDefault(), this._type === e.TYPE.PROFILE) {
                    if (a.length < 1) return n.alert(intl.t("report.harm.noReason"), i.ui.harmReason), !1;
                    if (a.length > this.MAX_LENGTH) return n.alert(intl.t("report.harm.maxLength", {
                        count: r.numberFormat(this.MAX_LENGTH)
                    }), i.ui.harmReason), !1;
                    l = {
                        description: a
                    }
                } else {
                    if (!o) return n.alert(intl.t("report.harm.noCategory")), !1;
                    if (o === e.CATEGORY.ETC && a.length < 1) return n.alert(intl.t("report.harm.categoryEtc"), i.ui.harmReason), !1;
                    if (a.length > this.MAX_LENGTH) return n.alert(intl.t("report.harm.maxLength", {
                        count: r.numberFormat(this.MAX_LENGTH)
                    }), i.ui.harmReason), !1;
                    l = {
                        category: o,
                        description: a
                    }
                }
                this.model.submitHarmful(l).then(function() {
                    n.alert(intl.t("report.success")).then(function() {
                        i._resetReport(), i._hide()
                    })
                }).fail(function() {
                    n.alert(intl.t("report.harm.error"), $("._harmfulSubmit"))
                })
            },
            "click ._libelous": function(e) {
                e.preventDefault(), this._showLibelousPane()
            },
            "click ._libelousSubmit": function(e) {
                var t = this,
                    i = r.trim(this.ui.libReason.val()),
                    o = {};
                return e.preventDefault(), i.length < 1 ? (n.alert(intl.t("report.libel.noReason"), this.ui.libReason), !1) : i.length > this.MAX_LENGTH ? (n.alert(intl.t("report.libel.maxLength", {
                    count: r.numberFormat(this.MAX_LENGTH)
                }), this.ui.libReason), !1) : (o = {
                    description: i
                }, void this.model.submitLibelous(o).then(function() {
                    n.alert(intl.t("report.success")).then(function() {
                        t._resetReport(), t._hide()
                    })
                }).fail(function() {
                    n.alert(intl.t("report.libel.error"), $("._libelousSubmit"))
                }))
            }
        },
        extendData: function() {
            return {
                isProfile: this._type === e.TYPE.PROFILE
            }
        },
        initialize: function() {
            this._type = null
        },
        onSetup: function() {
            this.model = new e, this.listenTo(this.model, "change:categories", this._updateCategory)
        },
        _resetReport: function() {
            this._resetPane(), this._resetForm(), this._type = null
        },
        _resetForm: function() {
            this.ui.harmForm && this.ui.harmForm[0].reset(), this.ui.libelousForm && this.ui.libelousForm[0].reset()
        },
        _showHarmfulPane: function() {
            this.ui.harmfulPane.show(), this.ui.reportMenu.hide(), this.ui.LibelousPane.hide()
        },
        _showLibelousPane: function() {
            this.ui.LibelousPane.show(), this.ui.reportMenu.hide(), this.ui.harmfulPane.hide()
        },
        _resetPane: function() {
            this.ui.reportMenu.show(), this.ui.harmfulPane.hide(), this.ui.LibelousPane.hide()
        },
        resetPane: function() {
            this._resetPane()
        },
        _hide: function() {
            this.parent.hide()
        },
        _updateCategory: function() {
            var e = this.model.get("categories");
            this.ui.categoryContainer.children().remove("._selectable"), this.ui.categoryContainer.prepend(t.categories({
                items: e
            }))
        },
        _report: function(e, t, r, n, o) {
            return this.render(), this.ui.typeTitle.html(this._getTilteByType(e)), this.model.setReportData(e, t, r, n, o).fail(i.getHandler())
        },
        reportActivity: function(t, r) {
            return this._report(e.TYPE.ACTIVITY, t, null, r)
        },
        reportVideo: function(t, r) {
            return this._report(e.TYPE.VIDEO, t, null, r)
        },
        reportComment: function(t, r, i, n) {
            return this._report(e.TYPE.COMMENT, t, r, i, n)
        },
        reportProfile: function(t) {
            return this._type = e.TYPE.PROFILE, this._report(e.TYPE.PROFILE, t, null, t)
        },
        _getTilteByType: function(t) {
            switch (t) {
                case e.TYPE.ACTIVITY:
                case e.TYPE.VIDEO:
                    return intl.t("report.harm.activity");
                case e.TYPE.COMMENT:
                    return intl.t("report.harm.comment");
                case e.TYPE.PROFILE:
                    return intl.t("report.harm.profile")
            }
        }
    })
});
define("part/comment/CommentListPart", ["template/comment", "common/Effect", "common/domUtil"], function(t, e, n) {
    var o = "photo",
        m = 700;
    return space.Part.extend({
        collection: null,
        template: t.commentList,
        itemPart: "part/comment/CommentItemPart",
        initialize: function() {
            this._commentId = null
        },
        onSetup: function(t, e, n, m) {
            this._commentId = n, this._isOpenCommentPhoto = m === o
        },
        onDomReady: function() {
            var t, e, o = this.flow.fork();
            if (this._commentId) {
                if (t = this.collection.get(this._commentId), !t) return;
                e = this.getItemPart(t), o.next(function() {
                    return Q.delay(m)
                }).next(function() {
                    return n.scrollTo(e.$el.offset().top, !0)
                }), this._isOpenCommentPhoto && o.next(function() {
                    e.viewPhoto(!0)
                })
            }
        },
        collectionEvents: {
            add: "addItemPart",
            remove: function(t) {
                var n = this,
                    o = this.getItemPart(t);
                new e(o.$el).collapse().complete(function() {
                    n.removeItemPart(t)
                })
            }
        }
    })
});
define("part/comment/ImagePart", ["common/decoratorUtil"], function(e) {
    return space.Part.extend({
        decorator: {
            type: e.DECORATOR_TYPE.IMAGE,
            text: e.DECORATOR_TEXT.IMAGE,
            media_path: ""
        },
        model: null,
        removeModel: function() {
            this.model && this.model.trigger("destroy", this.model)
        }
    })
});
define("part/comment/CommentWritingPart", ["kant", "template/comment", "model/me", "model/PhotoPreview", "model/sticonCategories", "model/usedSticon", "part/sticon/SticonPart", "part/comment/ImagePart", "common/util", "common/urlUtil", "common/imgUtil", "common/decoratorUtil", "common/kage", "module/static/loginView", "module/static/dialog"], function(t, e, i, o, r, n, a, s, h, c, l, u, g, d, f) {
    var p = 80,
        m = 200,
        v = u.DECORATOR_TEXT.STICON.length,
        D = u.DECORATOR_TEXT.IMAGE.length,
        y = 1e3,
        x = "feed.u",
        P = u.DECORATOR_TYPE,
        S = agent.browser.is.firefox,
        w = agent.os.is.ios && (agent.browser.is.safari || agent.browser.is.chrome),
        C = !agent.type.is.desktop,
        L = 50;
    return space.Part.extend({
        template: e.commentWriting,
        TRIGGER_MENTION_CHAR: "@",
        ui: {
            text: "._text",
            commentWriting: "._commentWriting",
            placeholder: "._commentWritingPlaceholder",
            btnShowSticon: "._btnShowSticon",
            btnPhotoFile: "._photo",
            photoForm: "._photoForm",
            photoLoading: "._photoLoading",
            photoUploadError: "._photoUploadError",
            decoratorLayer: "._decoratorLayer",
            sticonDecoratorLayer: "._sticonDecoratorLayer",
            imageDecoratorLayer: "._imageDecoratorLayer",
            dropdownWrapper: "._dropdownWrapper",
            overflowCount: "._commentWritingOverflowCount"
        },
        styles: {
            btnShowSticonActive: "on",
            btnPhotoActive: "on",
            btnPhotoLoading: "ing"
        },
        collection: null,
        initialize: function() {
            this._profileDecorators = [], this._previousValue = "", this._previousSuggestedWord = "", this._sticonDecorator = null, this._imageDecorator = null, this._caretRangeForOldIe = null, this._isImageUploading = !1
        },
        options: {
            isFriendOrMe: "setIsFriendOrMe"
        },
        setIsFriendOrMe: function(t) {
            this._isFriendOrMe = t
        },
        onRender: function() {
            var e = this;
            if (this.addPart("friendMentionLayer", "part/writing/FriendMentionLayerPart", {
                options: {
                    collection: i.get("friends")
                },
                selector: "._dropdownWrapper",
                listeners: {
                    selectItem: function(e) {
                        t.send(x + ".149"), this._selectDropdownItem(e)
                    }
                }
            }), this.addPart("placeholder", "part/plugin/PlaceholderPart", {
                selector: "._text",
                options: {
                    placeholder: this.ui.placeholder,
                    forceActivate: !0
                }
            }).next(function() {
                this.childParts.placeholder.update()
            }), agent.isIe8AndBelow()) {
                this.ui.text.on("propertychange", function(t) {
                    "value" === t.originalEvent.propertyName && (e.trigger("change"), e._updateDecorator(e.ui.text.val()))
                });
                var r = this.ui.text[0];
                this._caretRangeForOldIe = null, this.ui.text.on("beforedeactivate", function() {
                    e._caretRangeForOldIe = h.getCaretRange(r)
                })
            }
            this.listenTo(this, {
                changeFileInput: function(t) {
                    var e, i = t[0],
                        r = !1;
                    if (t.val()) {
                        if (i.files && i.files.length > 0 ? r = i.files[0].type === o.EXTENSION.GIF : (e = c.getExtension(i.value), r = e === o.EXTENSION.GIF), r) return void f.alert(intl.t("activity.comment.image.invalidFileByGifError"));
                        this._hideSticonDecoratorLayer(), this._hideImageDecoratorLayer(), this._postPhoto(t)
                    }
                }
            }), this.resizeTextarea()
        },
        focus: function() {
            var t = _.bind(function() {
                this.ui.text.focus()
            }, this);
            agent.os.is.android ? _.defer(t) : t()
        },
        onStop: function() {
            agent.isIe8AndBelow() && this.ui.text.off("propertychange")
        },
        events: {
            "keydown ._text": function(t) {
                var e = this;
                if (this.isAvailableChildPart("friendMentionLayer") && this.childParts.friendMentionLayer.isVisible()) this.childParts.friendMentionLayer.handleKeydown(t.keyCode) && t.preventDefault();
                else if (t.keyCode === h.KEY.ENTER) {
                    if (C || t.altKey || t.shiftKey || t.ctrlKey || t.metaKey) return;
                    t.preventDefault(), this.hasContent() && this.trigger("submit")
                }
                this.isAvailableChildPart("sticon") && this.childParts.sticon.hide(), agent.browser.is.ie && agent.browser.version < 10 && agent.browser.version >= 9 && _.defer(function() {
                    e._updateDecorator(e.ui.text.val()), e.trigger("change")
                })
            },
            "input ._text": _.debounce(function() {
                this._updateDecorator(this.ui.text.val()), S && this._watchContentsHandler(), this.trigger("change")
            }, L),
            "keyup ._text": function() {
                S || this._watchContentsHandler()
            },
            "click ._btnShowSticon": function(t) {
                t.preventDefault(), this.toggleSticonLayer()
            },
            "click ._closeSticonPreview": function(t) {
                t.preventDefault(), this._hideSticonDecoratorLayer(), this.focus()
            },
            "click ._closeImagePreview": function(t) {
                t.preventDefault(), this.childParts.image.removeModel(), this.focus(), this._hideImageDecoratorLayer()
            }
        },
        documentEvents: {
            click: function(t) {
                var e = $(t.target),
                    i = "._btnViewComments, ._closeSticonPreview, ._closeImagePreview, ._btnCommentReply",
                    o = !e.closest(this.$el).length && !e.closest(i).length;
                o && this.trigger("focusout")
            }
        },
        _watchContentsHandler: function() {
            var t, e, o = h.getCaretRange(this.ui.text[0]),
                r = "",
                n = "";
            o.start = o.end, r = h.getWordBeforePosition(this.ui.text.val(), o.start), this._previousSuggestedWord !== r && (r.charAt(0) === this.TRIGGER_MENTION_CHAR ? (n = r.length > 1 ? r.substring(1) : "", t = _.pluck(this._profileDecorators, "id"), t.push(i.get("id")), e = this.collection.getWritersByPartialName(n).reverse(), this.childParts.friendMentionLayer.show(n, {
                rejectList: t,
                prependList: e
            })) : this._hideFriendMentionLayer(), this._previousSuggestedWord = r)
        },
        _hideFriendMentionLayer: function() {
            this.isAvailableChildPart("friendMentionLayer") && this.childParts.friendMentionLayer.hide()
        },
        toggleSticonLayer: function() {
            this.addPart("sticon", a, {
                selector: "._sticonLayerContainer",
                options: {
                    collection: r,
                    exceptionClass: "_btnShowSticon",
                    writingArea: this.$el,
                    usedSticon: n
                },
                listeners: {
                    show: function() {
                        this.ui.btnShowSticon.focus()
                    },
                    hide: function() {
                        this.ui.btnShowSticon.toggleClass(this.styles.btnShowSticonActive, !! this._sticonDecorator)
                    },
                    addSticon: this._showSticonDecoratorLayer
                }
            }).next(function(t) {
                t || this.childParts.sticon.toggle()
            })
        },
        getParams: function() {
            var t = {
                text: this.ui.text.val(),
                decorators: this._createDecorator()
            };
            return this._imageDecorator && (t.text = this._imageDecorator.text + t.text, t.decorators.unshift(this._imageDecorator)), this._sticonDecorator && (t.text = this._sticonDecorator.text + t.text, t.decorators.unshift(this._sticonDecorator)), t
        },
        clear: function() {
            this._previousValue = "", this._previousSuggestedWord = "", this._safeSetValue(""), this.isAvailableChildPart("placeholder") && this.childParts.placeholder.update(), this._hideSticonDecoratorLayer(), this._hideImageDecoratorLayer(), this._clearProfileDecorator()
        },
        blur: function() {
            this.ui.text.blur()
        },
        addMention: function(t) {
            t.get("isMe") || !t.get("isFriend") && !this.collection.find(function(e) {
                return e.get("writer").get("id") === t.get("id")
            }) || this._profileDecorators && _.find(this._profileDecorators, function(e) {
                return e.id === t.get("id")
            }) || (this._addMention(t), this.isAvailableChildPart("placeholder") && this.childParts.placeholder.update())
        },
        _clearProfileDecorator: function() {
            this._profileDecorators = [], this._renderDecorator()
        },
        isEmpty: function() {
            var t = this.ui.text.val();
            return _.isEmpty(h.trim(t)) && !this._sticonDecorator && !this._imageDecorator
        },
        _showSticonDecoratorLayer: function(t, i) {
            var o = this.ui.sticonDecoratorLayer,
                r = $(e.sticonDecorator({
                    src: i
                })),
                n = null !== this._sticonDecorator;
            this._hideImageDecoratorLayer(), this._sticonDecorator = t, n && (o.height(o.height()), r.find("img").on("load", function() {
                o.css({
                    height: "auto"
                }), r.find("img").off()
            })), o.html(r).show(), this.focus(), this._updateDecorator(this.ui.text.val(), !0), this.trigger("change")
        },
        _hideSticonDecoratorLayer: function() {
            this._sticonDecorator = null, this.ui.sticonDecoratorLayer.hide().empty(), this.ui.btnShowSticon.removeClass(this.styles.btnShowSticonActive), this._updateDecorator(this.ui.text.val(), !0), this.trigger("change")
        },
        _postPhoto: function(t) {
            var e = this;
            this.addPart("image", s, {
                selector: "._imageDecoratorLayer"
            }).next(function() {
                var i = new o,
                    r = this.childParts.image;
                r.model = i, r.listenTo(r.model, {
                    "change:state": function(t, i) {
                        switch (i) {
                            case t.UPLOAD_STATE.SUCCESS:
                                if (t.get("contentType") === o.CONTENT_TYPE.GIF) return void f.alert(intl.t("activity.comment.image.invalidFileByGifError")).then(function() {
                                    r.removeModel()
                                });
                                e._showImageDecoratorLayer(t);
                                break;
                            case t.UPLOAD_STATE.FAIL:
                                e._hideImageDecoratorLayer()
                        }
                        e.trigger("change")
                    },
                    destroy: function() {
                        e._hideImageDecoratorLayer()
                    }
                }), this._request(i, t)
            })
        },
        _request: function(t, e) {
            var i = this,
                o = e.closest("form")[0];
            this._onImageUploading(), this.flow.forkWith(t.requestFileUpload(e)).next(function(t) {
                this._onImageComplete(), this._sticonDecorator = null, this._imageDecorator = _.defaults({
                    media_path: t.mediaPath
                }, this.childParts.image.decorator), this.focus(), this._updateDecorator(this.ui.text.val(), !0), this.trigger("change", this.hasContent()), o.reset()
            }).stopped(function(e) {
                var r = Q.resolve();
                switch (e) {
                    case g.UPLOAD_STATUS_CODE.ENTITY_TOO_LARGE:
                        r = f.alert(intl.t("activity.comment.image.entityTooLargeError"));
                        break;
                    case g.UPLOAD_STATUS_CODE.UNSUPPORTED_MEDIA_TYPE:
                        r = f.alert(intl.t("activity.comment.image.invalidFileError"));
                        break;
                    case g.UPLOAD_STATUS_CODE.BAD_REQUEST:
                    case g.UPLOAD_STATUS_CODE.INTERNAL_SERVER_ERROR:
                    case g.UPLOAD_STATUS_CODE.FATAL_ERROR:
                        this.ui.photoUploadError.stop(!0, !0).fadeIn().delay(y).fadeOut();
                        break;
                    case g.UPLOAD_STATUS_CODE.UNAUTHORIZED:
                        d.show()
                }
                r.then(function() {
                    i._onImageComplete(), t.trigger("destroy", t), o.reset()
                })
            })
        },
        _onImageUploading: function() {
            this._isImageUploading = !0, this.ui.photoForm.hide(), this.ui.photoLoading.show(), this.ui.btnPhotoFile.addClass(this.styles.btnPhotoLoading), this.ui.btnShowSticon.hide(), this.isAvailableChildPart("sticon") && this.childParts.sticon.hide()
        },
        _onImageComplete: function() {
            this._isImageUploading = !1, this.ui.photoForm.show(), this.ui.photoLoading.hide(), this.ui.btnPhotoFile.removeClass(this.styles.btnPhotoLoading), this.ui.btnShowSticon.show()
        },
        _showImageDecoratorLayer: function(t) {
            this.ui.btnPhotoFile.addClass(this.styles.btnPhotoActive), this.ui.imageDecoratorLayer.html(e.image({
                previewPath: t.get("previewPath")
            })).show()
        },
        _hideImageDecoratorLayer: function() {
            this._imageDecorator = null, this.ui.imageDecoratorLayer.hide().empty(), this.ui.btnPhotoFile.removeClass(this.styles.btnPhotoActive), this._updateDecorator(this.ui.text.val(), !0), this.trigger("change", this.hasContent())
        },
        _selectDropdownItem: function(t) {
            this._addMention(t, !0), this._hideFriendMentionLayer(), this._previousSuggestedWord = ""
        },
        _addMention: function(t, e) {
            var i = this.ui.text[0],
                o = this.ui.text.val(),
                r = this._getSafeCaretRange(i),
                n = e ? h.getWordBeforePosition(o, r.start) : "",
                a = t.get("display_name"),
                s = {
                    id: t.get("id"),
                    type: P.PROFILE,
                    text: a,
                    range: {
                        start: r.start - n.length,
                        end: r.start - n.length + a.length
                    }
                }, c = o.substring(0, r.start - n.length),
                l = o.substring(r.start),
                u = s.text + " ";
            this._safeSetValue(c + u + l), h.setCaretPosition(i, c.length + u.length), this._profileDecorators.push(s), this._profileDecorators = _.sortBy(this._profileDecorators, function(t) {
                return t.range.start
            }), this.trigger("change", this.hasContent()), e || (this._previousValue = this.ui.text.val(), this._previousRange = r), this._updateDecorator(this.ui.text.val(), e)
        },
        _getSafeCaretRange: function(t) {
            return agent.isIe8AndBelow() && this._caretRangeForOldIe && (h.setCaretPosition(t, this._caretRangeForOldIe.start), this._caretRangeForOldIe = null), h.getCaretRange(t)
        },
        _safeSetValue: function(t) {
            var e = this;
            this.ui.text.val(t), agent.isIe8AndBelow() && this.ui.text.one("keyup", function() {
                e.trigger("change", e.hasContent()), e._updateDecorator(e.ui.text.val())
            })
        },
        _updateDecorator: function(t, e) {
            var i = t.length - this._previousValue.length,
                o = h.getCaretRange(this.ui.text[0]);
            if (o.start = o.end, !e && 0 > i && this._removeChangedProfileDecorator({
                start: o.start,
                end: o.start - i
            }), this._updateProfileDecoratorPosition(o, i), !e && i > 0) {
                var r = {
                    start: o.start - i,
                    end: o.start
                };
                this._previousRange && o.start === this._previousRange.start && (r = h.shiftRange(r, 1)), this._removeChangedProfileDecorator(r)
            }
            this._renderDecorator(), this._previousValue = t, this._previousRange = o
        },
        _updateProfileDecoratorPosition: function(t, e) {
            _.each(this._profileDecorators, function(i) {
                e > 0 ? i.range.start >= t.start - e && (i.range = h.shiftRange(i.range, e)) : 0 > e && i.range.start > t.start + e && (i.range = h.shiftRange(i.range, e))
            })
        },
        _removeChangedProfileDecorator: function(t) {
            this._profileDecorators = _.reject(this._profileDecorators, function(e) {
                var i = h.getIntersectRange(t, e.range);
                return i && !h.isCollapsedRange(i)
            })
        },
        _createDecorator: function() {
            var t = this.ui.text.val(),
                e = [],
                i = _.first(this._profileDecorators);
            return e.push({
                type: P.TEXT,
                text: i ? t.substr(0, i.range.start) : t
            }), _.each(this._profileDecorators, function(i, o, r) {
                e.push({
                    type: P.PROFILE,
                    id: i.id,
                    text: i.text
                }), e.push(r[o + 1] ? {
                    type: P.TEXT,
                    text: t.substring(i.range.end, r[o + 1].range.start)
                } : {
                    type: P.TEXT,
                    text: t.substring(i.range.end)
                })
            }, this), e
        },
        isImageUploading: function() {
            return this._isImageUploading
        },
        hasContent: function() {
            return this._isValidValueRange() && !this._isImageUploading && (h.trim(this.ui.text.val()).length > 0 || !! this._sticonDecorator || !! this._imageDecorator)
        },
        _getMaxTextCount: function() {
            var t = this._isFriendOrMe ? m : p;
            return this._sticonDecorator && (t -= v), this._imageDecorator && (t -= D), t
        },
        _isValidValueRange: function() {
            var t = this.ui.text.val();
            return 0 <= t.length && t.length <= this._getMaxTextCount()
        },
        _renderDecorator: function() {
            for (var t, i, o = this.ui.text.val(), r = this._createDecorator(), n = "", a = "", s = 0; s < r.length; s++) {
                if (t = r[s], i = t.text, a.length + t.text.length > this._getMaxTextCount() && (i = t.text.substr(0, this._getMaxTextCount() - a.length)), n += t.type === P.PROFILE ? e.profileDecorator({
                    text: i
                }) : h.escapeHtmlString(i), a.length + t.text.length > this._getMaxTextCount()) {
                    n += e.overflowDecorator({
                        text: o.substr(this._getMaxTextCount())
                    });
                    break
                }
                a += t.text
            }
            this.resizeTextarea(), this.ui.decoratorLayer.html(n + "﻿"), this._isValidValueRange() ? this.ui.overflowCount.hide() : this.ui.overflowCount.text(this._getMaxTextCount() - o.length).show(), this.ui.text.height(this.ui.decoratorLayer.height())
        },
        isShownSticonLayer: function() {
            return this.isAvailableChildPart("sticon") && this.childParts.sticon.isShown()
        },
        resizeTextarea: function() {
            var t = this.ui.commentWriting.width();
            this.ui.decoratorLayer.width(t), this.ui.text.width(t), w && this.ui.text.css({
                width: t + 6 + "px",
                left: "7px"
            })
        }
    })
});
define("part/comment/CommentWritePart", ["template/comment", "model/me", "module/static/error", "module/static/loginView", "part/comment/CommentWritingPart", "common/util", "kant"], function(t, i, e, n, s, o, a) {
    var c = "feed.u.40",
        r = {
            TEXT: "text",
            MENTION: "profile",
            IMAGE: "image",
            STICON: "sticon"
        }, m = "on";
    return space.Part.extend({
        template: t.commentWrite,
        collection: null,
        ui: {
            submit: "._btnCommentSubmit",
            commentWriting: "._commentWriting",
            placeholder: "._commentWritingPlaceholder",
            text: "._text"
        },
        styles: {
            writingAreaActive: "bn_right",
            placeholderActive: "on",
            activePostBtn: "btn_or",
            inactivePostBtn: "inactive",
            disabled: "dis"
        },
        initialize: function() {
            this._isImageUploading = !1, this._isCommentWritable = !0
        },
        events: {
            "click ._btnCommentSubmit": function(t) {
                t.preventDefault(), this.childParts.commentWriting.hasContent() && this._submit(!0)
            },
            "click ._commentWriting": function(t) {
                var i = $(t.target);
                i.is("input[type=file]") || i.hasClass("_sticonLayerContainer") || (t.preventDefault(), (agent.type.is.desktop || !i.hasClass("_btnShowSticon")) && this.focus())
            },
            "click ._btnShowSticon": function(t) {
                t.preventDefault(), this._activateCommentWriting(!0)
            },
            "click ._photoFileInput": function() {
                this._activateCommentWriting()
            },
            "keydown ._photoFileInput": function(t) {
                agent.browser.is.ie && t.keyCode === o.KEY.ENTER && t.preventDefault()
            },
            "change ._photoFileInput": function(t) {
                this.isAvailableChildPart("commentWriting") && this.childParts.commentWriting.trigger("changeFileInput", $(t.currentTarget))
            }
        },
        extendData: function() {
            var t = this.collection.parent.get("actor");
            return {
                cid: this.cid,
                isStoryPlus: function() {
                    return t.get("isStoryPlus")
                },
                isCommentWritable: this._isCommentWritable
            }
        },
        onSetup: function() {
            this._isCommentWritable = this.collection.isCommentWritable()
        },
        onRender: function() {
            this._isCommentWritable || (this.ui.commentWriting.addClass(this.styles.disabled), this.ui.text.prop("disabled", "disabled"))
        },
        _activateCommentWriting: function(t) {
            var e;
            return i.isRegistered() ? void(this._isCommentWritable && (e = this.collection.parent.get("actor").get("isFriend") || this.collection.parent.get("actor").get("isMe"), this.addPart("commentWriting", s, {
                selector: this.$el,
                options: {
                    collection: this.collection,
                    isFriendOrMe: e
                },
                listeners: {
                    change: function() {
                        this.updateSubmitBtn(this.childParts.commentWriting.hasContent())
                    },
                    focusout: function() {
                        var t = this.childParts.commentWriting;
                        !t.isEmpty() || t.hasContent() || t.isImageUploading() || this._deactivateCommentWriting()
                    },
                    domReady: function() {
                        t && this.childParts.commentWriting.toggleSticonLayer()
                    },
                    submit: function() {
                        this.childParts.commentWriting.hasContent() && this._submit()
                    }
                }
            }), this.ui.submit.show(), this.ui.commentWriting.addClass(this.styles.writingAreaActive), this.ui.placeholder.addClass(this.styles.placeholderActive), this.childParts.commentWriting.resizeTextarea())) : (n.show(), Q.reject())
        },
        updateSubmitBtn: function(t) {
            t ? (this.ui.submit.addClass(this.styles.activePostBtn), this.ui.submit.removeClass(this.styles.inactivePostBtn)) : (this.ui.submit.addClass(this.styles.inactivePostBtn), this.ui.submit.removeClass(this.styles.activePostBtn))
        },
        _deactivateCommentWriting: function() {
            this.ui.submit.hide(), this.ui.commentWriting.removeClass(this.styles.writingAreaActive), this.ui.placeholder.removeClass(this.styles.placeholderActive), this.ui.text.width(this.ui.commentWriting.width()), this.isAvailableChildPart("commentWriting") && this.childParts.commentWriting.clear(), this.removePart("commentWriting")
        },
        _attachWritingListener: function(t) {
            var i = this;
            _.each(t, function(t, e) {
                i.listenTo(i.childParts.commentWriting, e, t)
            })
        },
        _submit: function(t) {
            var i = {}, n = this.childParts.commentWriting.getParams();
            this.flow.isChildFlowPending("submit") || this.flow.fork("submit").next(function() {
                return this.updateSubmitBtn(!1), this.ui.submit.text(intl.t("activity.comment.saving")), this.collection.createAndWait(n).fail(e.getHandler())
            }).next(function() {
                this.clear(), i.m = t ? "click" : "enter", _.each(n.decorators, function(t) {
                    switch (t.type) {
                        case r.TEXT:
                            t.text.length && (i.txt = m);
                            break;
                        case r.MENTION:
                            i.men = m;
                            break;
                        case r.STICON:
                            i.stc = m;
                            break;
                        case r.IMAGE:
                            i.img = m
                    }
                }), a.send(c, i)
            }).fin(function() {
                this._clearButtonState()
            })
        },
        clear: function() {
            this._clearButtonState(), this.childParts.commentWriting.clear(), this.childParts.commentWriting.blur(), this._deactivateCommentWriting()
        },
        _clearButtonState: function() {
            this.updateSubmitBtn(!0), this.ui.submit.text(intl.t("activity.comment.save"))
        },
        focus: function() {
            this._isCommentWritable && (this._activateCommentWriting(), this.ui.text.focus())
        },
        isEmpty: function() {
            return this.childParts.commentWriting.isEmpty()
        },
        addMention: function(t) {
            this._activateCommentWriting(), this.focus(), this.isAvailableChildPart("commentWriting") && this.childParts.commentWriting.addMention(t)
        }
    })
});
define("part/comment/CommentItemPart", ["template/comment", "template/decorator", "model/me", "model/Profile", "common/util", "common/imgUtil", "common/urlUtil", "common/decoratorUtil", "common/urlKey", "module/static/report", "module/static/dialog", "module/static/error", "module/static/mediaView"], function(e, t, i, o, n, r, s, a, l, m, c, d, h) {
    var u = 190;
    return space.Part.extend({
        template: e.item,
        model: null,
        ui: {
            button: "._btnCommentTool",
            profileImage: "._profileImage",
            sticonContainer: "._sticonContainer",
            name: "._namePlaceholder"
        },
        styles: {
            showLayer: "on",
            storyPlusComment: "channel"
        },
        onRender: function() {
            var e;
            r.resize(this.ui.profileImage, this.ui.profileImage.parent()), this.ui.sticonContainer.length && (e = $(t.sticonCover()).one("abort error", function(e) {
                $(e.target).hide()
            }), this.ui.sticonContainer.append(e)), agent.type.is.desktop || this.ui.button.show(), this.model.get("writer").get("type") === o.TYPE.OFFICIAL && this.ui.name.addClass(this.styles.storyPlusComment)
        },
        extendData: function() {
            var e = this.model,
                o = this.model.collection.parent,
                r = i.is(this.model.get("writer").get("id"));
            return {
                canDelete: r || o.get("actor").get("isMe"),
                isMine: r,
                isMobile: agent.type.is.mobile,
                hideButtton: agent.type.is.desktop || !i.isRegistered(),
                isPost: !o.collection,
                linkViewComment: "/" + o.get("actor").get("urlKey") + "/" + o.get("urlKey") + "/" + e.get("id"),
                decoratedText: function() {
                    var i = e.get("decorators"),
                        r = "";
                    return i ? (_.each(i, function(e) {
                        e.type === a.DECORATOR_TYPE.PROFILE && (e.urlKey = l.profile.idToUrlKey(e.id))
                    }), r = a.toMarkup(i, {
                        profile: t.profile,
                        sticon: t.sticon,
                        image: t.image
                    }, {
                        isLinkUrl: !0,
                        maxImageSize: u,
                        isComment: !0,
                        activityId: o.get("id"),
                        commentId: e.get("id")
                    })) : r = n.escapeHtmlStringWithUrlAnchor(e.get("text")) || "", r
                }
            }
        },
        viewPhoto: function(e) {
            var t = this.model.get("writer");
            _.some(this.model.get("decorators"), function(i) {
                return "image" === i.type ? (h.addImages(i.media.origin_url), h.show(h.MODE.COMMENT, {
                    profile: t,
                    totalCount: 1,
                    hidePagination: !0,
                    skipNavigation: e
                }), !0) : void 0
            })
        },
        _hideLayer: function() {
            !agent.type.is.desktop || this.isAvailableChildPart("layer") && this.childParts.layer.isShown() || this.ui.button.hide()
        },
        events: {
            click: function(e) {
                var t = $(e.target);
                !agent.type.is.mobile || t.closest("a, button, input").length && !t.hasClass("_name") || (e.preventDefault(), this.trigger("reply", this.model.get("writer")))
            },
            "click ._name": function(e) {
                e.preventDefault()
            },
            "click ._btnCommentTool": function(e) {
                e.preventDefault(), agent.type.is.desktop || this.addPart("layer", "part/plugin/LayerPart", {
                    options: {
                        exceptionClass: "_btnCommentTool"
                    },
                    listeners: {
                        show: function() {
                            this.$el.addClass(this.styles.showLayer)
                        },
                        hide: function() {
                            this.$el.removeClass(this.styles.showLayer), this._hideLayer()
                        }
                    }
                }).next(function() {
                    this.childParts.layer.toggle()
                })
            },
            "click ._btnCommentDelete": function(e) {
                var t = this;
                e.preventDefault(), this.isAvailableChildPart("layer") && this.childParts.layer.hide(), c.confirm(intl.t("activity.comment.deleteConfirm")).then(function() {
                    t.model.destroy().fail(d.getHandler({
                        message: {
                            403: intl.t("activity.comment.permissionError"),
                            "*": intl.t("activity.comment.deleteError")
                        }
                    }))
                })
            },
            "click ._btnCommentReport": function(e) {
                e.preventDefault();
                var t = this.model.collection.parent;
                m.reportComment(t.get("id"), this.model.get("id"), this.model.get("writer").get("id"), this.model.get("text")), this._hideLayer()
            },
            "click ._btnCommentReply": function(e) {
                e.preventDefault(), this.trigger("reply", this.model.get("writer"))
            },
            "click ._viewCommentImage": function(e) {
                e.preventDefault(), this.viewPhoto()
            },
            "contextmenu ._sticonCover": function(e) {
                e.preventDefault()
            },
            mouseenter: function() {
                agent.type.is.desktop && i.isRegistered() && this.ui.button.show()
            },
            mouseleave: function() {
                agent.type.is.desktop && this._hideLayer()
            }
        }
    })
});
define("part/feed/LikeItemPart", ["template/like", "part/feed/FeedLayerItemPart", "module/static/error"], function(e, t, i) {
    return t.extend({
        model: null,
        template: e.item,
        ui: _.extend({}, t.prototype.ui, {
            btnLikeDelete: "._btnLikeDelete"
        }),
        styles: {
            like: "ico_like",
            good: "ico_good",
            pleasure: "ico_pleasure",
            cheerup: "ico_cheerup",
            sad: "ico_sad"
        },
        initialize: function() {
            this._canDelete = !1
        },
        extendData: function() {
            return {
                emotion: this.model.getEmotionText(),
                emotionClass: this.styles[this.model.get("emotion")]
            }
        },
        onSetup: function() {
            var e = this.model.collection.parent;
            this._canDelete = this.model.get("actor").get("isMe") || e.get("actor").get("isMe")
        },
        onRender: function() {
            t.prototype.onRender.apply(this, arguments), (agent.type.is.desktop || !this._canDelete) && this.ui.btnLikeDelete.hide()
        },
        events: _.extend({}, t.prototype.events, {
            mouseenter: function() {
                agent.type.is.desktop && this._canDelete && this.ui.btnLikeDelete.show()
            },
            mouseleave: function() {
                agent.type.is.desktop && this._canDelete && this.ui.btnLikeDelete.hide()
            },
            "click ._btnLikeDelete": function(e) {
                e.preventDefault(), this.model.destroy().fail(i.getHandler({
                    loginRedirect: !0
                }))
            }
        })
    })
});
define("part/plugin/InfinityScrollPart", [], function() {
    return space.Part.extend({
        el: null,
        skipGlobalEvents: !0,
        SCROLL_INTERVAL: 150,
        END_THRESHOLD: 150,
        setScrollInterval: function(t) {
            this._scrollInterval = t, this._fOnScroll = _.throttle(_.bind(this._onScroll, this), this._scrollInterval)
        },
        setEndThreshold: function(t) {
            this._endThreshold = t
        },
        getContentElement: function() {
            return this.$el.is($(window)) ? $(document.documentElement || document.body) : this.$el
        },
        initialize: function() {
            this._scrollInterval = this.SCROLL_INTERVAL, this._endThreshold = this.END_THRESHOLD, this._$content = null, this._isActivated = !1, this.setScrollInterval(this._scrollInterval)
        },
        activate: function() {
            this._isActivated || (this.$el.on("scroll", this._fOnScroll), this._$content = this.getContentElement(), this._isActivated = !0)
        },
        deactivate: function() {
            this._isActivated && this.$el && (this.$el.off("scroll", this._fOnScroll), this._$content = null, this._isActivated = !1)
        },
        onStop: function() {
            this.deactivate()
        },
        _onScroll: function() {
            if (this.$el && this._$content && this.$el[0].scrollHeight !== this.$el.height() && this.isStarted()) {
                var t = this.$el.height(),
                    i = Math.round(t * this._endThreshold / 100);
                this.trigger("scroll"), this.flow.isPending(!0) || this.$el.scrollTop() >= this._$content[0].scrollHeight - t - i && this.trigger("end")
            }
        }
    })
});
define("part/gnb/GnbSuggestionInputPart", ["part/suggestion/SuggestionInputPart", "template/gnb", "common/util"], function(t, e, i) {
    var n = 300,
        s = .6,
        o = 400;
    return t.extend({
        template: e.suggestionInput,
        RESULT_ITEM_HEIGHT: 52,
        styles: {
            focused: "outline"
        },
        windowEvents: {
            "resize,orientationchange": _.throttle(function() {
                this._updateSearchResultCount()
            }, n)
        },
        events: _.defaults({
            "focusin ._gnbQuery": function() {
                this.$el.addClass(this.styles.focused), this.ui.query.val() && this.trigger("focusOnExistingQuery")
            },
            "focusout ._gnbQuery": function() {
                this.$el.removeClass(this.styles.focused)
            },
            "keydown ._gnbQuery": function(t) {
                switch (t.keyCode) {
                    case i.KEY.UP:
                        this.trigger("up"), t.preventDefault();
                        break;
                    case i.KEY.DOWN:
                        this.trigger("down"), t.preventDefault();
                        break;
                    case i.KEY.TAB:
                        if (!this.ui.query.val()) break;
                        t.preventDefault(), this.trigger(t.shiftKey ? "up" : "down");
                        break;
                    case i.KEY.ENTER:
                        this.trigger("enter")
                }
            }
        }, t.prototype.events),
        onRender: function() {
            t.prototype.onRender.call(this), this._updateSearchResultCount(), agent.type.is.mobile && this.hide()
        },
        _updateSearchResultCount: function() {
            var t = this._getListHeight(),
                e = Math.floor(t / this.RESULT_ITEM_HEIGHT);
            this.model.setMaxTotalCount(e)
        },
        _getListHeight: function() {
            return agent.type.is.desktop ? this._getDesktopListHeight() : this._getMobileTabletListHeight()
        },
        _getDesktopListHeight: function() {
            var t = $(window).height() * s;
            return Math.max(t, o)
        },
        _getMobileTabletListHeight: function() {
            var t, e = $(window);
            return t = e.height() > e.width() ? screen.height : screen.width, t * s
        },
        scrollToInput: function() {
            var t = this.$el.offset().top;
            $(window).scrollTop(t)
        },
        disableTouchScroll: function() {
            this.$el.on("touchmove", function(t) {
                t.preventDefault()
            })
        },
        enableTouchScroll: function() {
            this.$el.off("touchmove")
        }
    })
});
define("part/gnb/SuggestionLayerPart", ["template/gnb", "model/me", "common/util", "common/urlUtil", "common/kantUtil", "part/plugin/LayerPart"], function(i, t, s, e, n, o) {
    return o.extend({
        template: i.suggestionLayer,
        ui: {
            loading: "._loading",
            errorMessage: "._errorMessage"
        },
        childParts: {
            suggestionList: "part/gnb/GnbSuggestionListPart"
        },
        events: {
            "wheel,mousewheel,DOMMouseScroll,touchmove": function(i) {
                i.preventDefault()
            }
        },
        initialize: function() {
            o.prototype.initialize.apply(this), this.addExceptionClass("_suggestionInputArea")
        },
        onSetup: function() {
            this.childParts.suggestionList.model = this.model, this.listenTo(this.childParts.suggestionList, {
                selectLink: function() {
                    this.hide(), this.trigger("selectLink")
                }
            })
        },
        activatePrevItem: function() {
            this.isAvailableChildPart("suggestionList") && this.childParts.suggestionList.activatePrevItem()
        },
        activateNextItem: function() {
            this.isAvailableChildPart("suggestionList") && this.childParts.suggestionList.activateNextItem()
        },
        selectCurrentItem: function() {
            this.isAvailableChildPart("suggestionList") && this.childParts.suggestionList.selectCurrentItem()
        },
        showLoading: function() {
            this.ui.errorMessage.hide(), this.ui.loading.show(), this.isAvailableChildPart("suggestionList") && this.childParts.suggestionList.hide()
        },
        hideLoading: function() {
            this.ui.errorMessage.hide(), this.ui.loading.hide(), this.isAvailableChildPart("suggestionList") && this.childParts.suggestionList.show()
        },
        showErrorMessage: function() {
            this.ui.errorMessage.show(), this.ui.loading.hide(), this.isAvailableChildPart("suggestionList") && this.childParts.suggestionList.hide()
        },
        show: function() {
            agent.type.is.desktop || this._resizeLayerHeight(), o.prototype.show.apply(this)
        },
        _resizeLayerHeight: function() {
            this.$el.height(screen.height)
        }
    })
});
define("part/gnb/GnbSuggestionListPart", ["part/suggestion/SuggestionListPart", "template/gnb"], function(t, e) {
    return t.extend({
        PROFILE_NAME_WIDTH: 175,
        ID_SEARCH_PROFILE_NAME_WIDTH: 135,
        template: e.suggestionList,
        styles: {
            active: "active"
        },
        events: _.defaults({
            "mouseenter ._searchItem": function(t) {
                this._activateItem($(t.currentTarget))
            },
            "click ._searchLink": function() {
                this.trigger("selectLink")
            }
        }, t.prototype.events),
        initialize: function() {
            this._$items = null
        },
        getIdSearchResultTemplate: function() {
            return {
                idFound: e.idFound,
                idNotFound: e.idNotFound
            }
        },
        onRender: function() {
            t.prototype.onRender.call(this), this._refreshSearchedItems(), this.activateNextItem()
        },
        _refreshSearchedItems: function() {
            this._$items = this.$el.find("._searchItem")
        },
        activateNextItem: function() {
            var t, e, s = this._$items;
            s && s.length && (t = this._getCurrentIdx(), e = t + 1 === s.length ? 0 : t + 1, s.eq(t).removeClass(this.styles.active), s.eq(e).addClass(this.styles.active))
        },
        activatePrevItem: function() {
            var t, e, s = this._$items;
            s && s.length && (t = this._getCurrentIdx(), e = 0 > t - 1 ? s.length - 1 : t - 1, s.eq(t).removeClass(this.styles.active), s.eq(e).addClass(this.styles.active))
        },
        _activateItem: function(t) {
            this._$items.removeClass(this.styles.active), t.addClass(this.styles.active)
        },
        selectCurrentItem: function() {
            var t, e = this._getCurrentIdx(); - 1 !== e && (t = this._$items.eq(e), t.hasClass("_searchId") ? this.searchId() : (space.Router.navigate(t.attr("href")), this.trigger("selectLink")))
        },
        _getCurrentIdx: function() {
            var t = this._$items,
                e = -1,
                s = this;
            return _.some(t, function(t, i) {
                return $(t).hasClass(s.styles.active) ? (e = i, !0) : void 0
            }), e
        },
        hide: function() {
            this.$el.hide().empty(), this._$items = null
        },
        onIdFound: function() {
            var t = this.$el.find("._idFound");
            this._refreshSearchedItems(), this._activateItem(t)
        }
    })
});
define("part/friend/FriendItemPart", ["module/static/dialog", "module/static/error", "common/musicPlayer", "common/imgUtil", "common/ellipsis"], function(e, i, t, n, l) {
    return space.Part.extend({
        PROFILE_NAME_WIDTH: 0,
        model: null,
        ui: {
            profileName: "._profileName",
            profileImage: "._profileImage"
        },
        modelEvents: {
            "change:is_favorite": "_favoriteChanged"
        },
        events: {
            "click ._makeFav": function(e) {
                e.preventDefault(), this.model.makeFavorite().fail(i.getHandler())
            },
            "click ._makeUnfav": function(e) {
                e.preventDefault(), this.model.makeUnfavorite().fail(i.getHandler())
            },
            "click ._deleteFriend": function(t) {
                t.preventDefault();
                var n = this,
                    l = intl.t("friend.dialog.delete");
                e.confirm(l, t.target).then(function() {
                    return n.model.deleteFriend().fail(i.getHandler())
                }).fail(function() {})
            },
            "click ._unfollow": function(t) {
                t.preventDefault();
                var n = this,
                    l = intl.t("friend.dialog.unfollow");
                e.confirm(l, t.target).then(function() {
                    return n.model.unfollow().fail(i.getHandler())
                }).fail(function() {})
            },
            "click ._playMusic": function(e) {
                e.preventDefault(), t.openByProfileId(this.model.get("id")).fail(i.getHandler())
            }
        },
        _favoriteChanged: function() {
            var e = this;
            this.render(), require(["module/myStory/mainProfile"], function(i) {
                i && i.isStarted() && i.changeFavoriteFriendStatus(e.model)
            })
        },
        onRender: function() {
            this.ui.profileImage && this.ui.profileImage.length && n.resize(this.ui.profileImage, this.ui.profileImage.parent())
        },
        onDomReady: function() {
            this.PROFILE_NAME_WIDTH && this.ui.profileName && this.ui.profileName.length && l.byWidth(this.ui.profileName, {
                width: this.PROFILE_NAME_WIDTH
            })
        }
    })
});
define("part/friend/FriendListPart", ["common/Effect"], function(t) {
    return space.Part.extend({
        collection: null,
        itemPartContainer: "._list",
        itemFilter: null,
        toggleListByItemCount: !1,
        collectionEvents: {
            add: function(t, e) {
                this._addFriendItem(t, e)
            },
            remove: function(t) {
                this._removeFriendItem(t)
            }
        },
        _addFriendItem: function(t, e) {
            var i = e.indexOf(t);
            this.addItemPart(t, e, {
                at: i
            }), this.toggleListByItemCount && this._toggleListByItemCount()
        },
        _removeFriendItem: function(e) {
            var i = this,
                n = this.getItemPart(e);
            n && new t(n.$el).transparent().collapse().complete(function() {
                i.removeItemPart(e), i.toggleListByItemCount && i._toggleListByItemCount()
            })
        },
        _toggleListByItemCount: function() {
            var t;
            t = _.isFunction(this.itemFilter) ? this.collection.some(this.itemFilter) : this.collection.length > 0, this.toggle(t), this.trigger("toggle", t)
        },
        onDomReady: function() {
            this._toggleListByItemCount()
        }
    })
});
define("part/gnb/FriendListPart", ["template/gnbFriend", "model/me", "model/fragment", "part/friend/FriendItemPart", "part/friend/FriendListPart"], function(t, i, e, n, s) {
    var o = 300,
        l = 20,
        r = n.extend({
            PROFILE_NAME_WIDTH: 160,
            template: t.friendItem,
            styles: _.defaults({
                alone: "alone"
            }, n.prototype.styles),
            onRender: function() {
                n.prototype.onRender.call(this), this.model.get("statusMessage") || this.$el.addClass(this.styles.alone)
            }
        }),
        a = s.extend({
            template: t.newList,
            itemPartContainer: "._list",
            itemPart: r,
            toggleListByItemCount: !0,
            itemFilter: function(t) {
                return t.collection.isNewFriend(t)
            },
            onDomReady: function() {
                s.prototype.onDomReady.call(this), this.collection.clearNewFriend()
            }
        }),
        d = s.extend({
            template: t.favoriteList,
            itemPartContainer: null,
            itemPart: r,
            toggleListByItemCount: !0,
            itemFilter: function(t) {
                return t.get("is_favorite")
            }
        }),
        h = s.extend({
            template: t.unfavoriteList,
            itemPartContainer: null,
            itemPart: r,
            toggleListByItemCount: !0,
            itemFilter: function(t) {
                return !t.get("is_favorite")
            },
            onDomReady: function() {
                var t = this.$el.closest("._listWrap");
                this.addPart("infinityScroll", "part/plugin/InfinityScrollPart", {
                    selector: t,
                    listeners: {
                        end: function() {
                            this.collection.addNextFragment()
                        }
                    }
                }).next(function() {
                    this.childParts.infinityScroll.activate()
                }), s.prototype.onDomReady.call(this)
            }
        });
    return space.Part.extend({
        template: t.friendListLayout,
        skipGlobalEvents: !0,
        MIN_HEIGHT: 300,
        TOP_PADDING: 200,
        BOTTOM_PADDING: 200,
        childParts: {
            newList: a,
            favoriteList: d,
            unfavoriteList: h
        },
        ui: {
            listWrap: "._listWrap",
            friendLayout: "._gnbFriendLayout",
            noFriend: "._gnbNoFriend",
            gnbFriendCount: "._gnbFriendCount"
        },
        windowEvents: {
            resize: _.throttle(function() {
                this.isShown() && (this._updateListHeight(), this.isAvailableChildPart("scroll") && this.childParts.scroll.resizeScrollBar())
            }, o)
        },
        initialize: function() {
            this._$window = $(window), this._lastScrollTop = 0
        },
        onSetup: function() {
            var t = i.get("friends");
            this.childParts.newList.collection = t, this.childParts.favoriteList.collection = t, this.childParts.unfavoriteList.collection = e.clone(t, {
                limit: l,
                intoTheMiddle: !0
            })
        },
        extendData: function() {
            return {
                total: i.get("friends").length
            }
        },
        onRender: function() {
            this._updateListStatus()
        },
        _updateListStatus: function() {
            if (this.isRendered()) {
                var t = i.get("friends").length,
                    e = t > 0;
                this._updateFriendCount(t), this._toggleList(e), this._updateListHeight(e), this._addCustomScroll(e)
            }
        },
        _updateFriendCount: function(t) {
            this.ui.gnbFriendCount.text(t)
        },
        _toggleList: function(t) {
            this.ui.friendLayout.toggle(t), this.ui.noFriend.toggle(!t)
        },
        _updateListHeight: function(t) {
            var i, e = this.ui.listWrap;
            t && (i = Math.max(this.MIN_HEIGHT, this._$window.height() - this.BOTTOM_PADDING - this.TOP_PADDING), e.css({
                "max-height": i
            }))
        },
        _addCustomScroll: function(t) {
            t ? this.addPart("scroll", "part/plugin/ScrollPart", {
                selector: this.ui.listWrap
            }).next(function() {
                this.childParts.scroll.scrollTo(this._lastScrollTop)
            }) : this.removePart("scroll")
        },
        show: function() {
            var t = i.get("friends");
            this.$el.show(), this.attachGlobalEvents(), this.listenTo(t, {
                "add,remove": function() {
                    this._updateListStatus()
                },
                fetched: function() {
                    var i = this.childParts.unfavoriteList.collection;
                    (0 === i.length || t.length < l) && i.addNextFragment()
                }
            })
        },
        hide: function() {
            this.$el.hide(), this.detachGlobalEvents(), this.stopListening(i.get("friends")), this.childParts.scroll && (this._lastScrollTop = this.childParts.scroll.getScrollTop())
        }
    })
});
define("part/friend/InvitationItemPart", ["module/static/dialog", "module/static/error", "common/imgUtil", "common/ellipsis"], function(e, i, t, n) {
    return space.Part.extend({
        PROFILE_NAME_WIDTH: 0,
        model: null,
        ui: {
            profileName: "._profileName",
            profileImage: "._profileImage"
        },
        events: {
            "click ._cancel": function(t) {
                t.preventDefault();
                var n = this,
                    l = intl.t("friend.dialog.cancel");
                e.confirm(l).then(function() {
                    return n.model.cancel().fail(i.getHandler())
                }).fail(function() {})
            },
            "click ._accept": function(e) {
                e.preventDefault(), this.model.accept().fail(i.getHandler())
            },
            "click ._ignore": function(t) {
                t.preventDefault();
                var n = this,
                    l = intl.t("friend.dialog.ignore");
                e.confirm(l).then(function() {
                    return n.model.ignore().fail(i.getHandler())
                }).fail(function() {})
            }
        },
        onRender: function() {
            this.ui.profileImage && this.ui.profileImage.length && t.resize(this.ui.profileImage, this.ui.profileImage.parent())
        },
        onDomReady: function() {
            this.PROFILE_NAME_WIDTH && this.ui.profileName && this.ui.profileName.length && n.byWidth(this.ui.profileName, {
                width: this.PROFILE_NAME_WIDTH
            })
        }
    })
});
define("part/friend/InvitationListPart", ["model/me"], function(e) {
    return space.Part.extend({
        collection: null,
        itemPartContainer: "._list",
        readReceivedInvitation: function() {
            var t;
            this.collection && (t = this.collection.getRecentReceivedInvitationId(), t && e.get("newCount").readReceivedInvitation(t))
        }
    })
});
define("model/RecommendFriend", ["common/api", "common/urlKey", "model/Invitation", "model/Friendship"], function(e, t, i, n) {
    var s = {
        TEXT: "text",
        MUSIC: "music"
    };
    return space.Model.extend({
        url: {
            ignore: "/friendship/recommends/ignore"
        },
        defaults: {
            user_id: null,
            display_name: null,
            profile_image_url: null,
            full_profile_image_url: null,
            has_profile: !0,
            sent: null,
            status_objects: null,
            recommend_type: null,
            recommend_type_msg: null
        },
        virtuals: {
            statusMessage: function() {
                var e = _.first(this.get("status_objects")),
                    t = "",
                    i = "";
                if (e) switch (t = e.object_type) {
                    case s.MUSIC:
                        i = e.title;
                        break;
                    case s.TEXT:
                        i = e.message
                }
                return i
            },
            isMusicStatus: function() {
                var e = _.first(this.get("status_objects"));
                return e && e.object_type === s.MUSIC
            },
            urlKey: function() {
                return t.profile.idToUrlKey(this.get("user_id"))
            }
        },
        hasMessage: function() {
            return !(!this.get("recommend_type_msg") && !this.get("statusMessage"))
        },
        invite: function() {
            var e = this,
                t = this.get("user_id"),
                n = this.get("has_profile");
            return i.invite(t, n).then(function() {
                e.set("sent", !0)
            })
        },
        cancel: function() {
            var e = this,
                t = this.get("user_id"),
                n = this.get("has_profile");
            return i.cancel(t, n).then(function() {
                e.set("sent", !1)
            })
        },
        follow: function() {
            var e = this,
                t = this.get("user_id");
            return n.follow(t).then(function() {
                e.trigger("destroy", e)
            })
        },
        ignore: function() {
            var t = this;
            return e.request({
                url: this.url.ignore,
                type: "POST",
                data: {
                    friend_id: this.get("user_id")
                }
            }).then(function() {
                t.trigger("destroy", t)
            })
        }
    })
});
define("model/RecommendFriends", ["model/RecommendFriend"], function(e) {
    return space.Collection.extend({
        model: e
    })
});
define("model/Recommends", ["model/RecommendFriends", "common/api"], function(e, t) {
    var n = {
        STORY: "story",
        STORY_PLUS: "story_plus",
        TALK: "talk"
    };
    return space.Model.extend({
        url: "/friendship/recommends",
        defaults: {
            story: e,
            story_plus: e,
            talk: e
        },
        TYPE: n,
        fetch: function(e, s) {
            var o = this,
                r = {
                    foaf: !! s
                }, a = _.values(n);
            return _.each(e, function(e) {
                _.contains(a, e) && (r[e] = !0)
            }), t.request({
                url: _.result(this, "url"),
                type: "GET",
                data: r
            }).then(function(e) {
                _.each(e, function(e, t) {
                    o.get(t).set(e.data, {
                        parse: !0
                    })
                })
            })
        }
    })
});
define("model/recommendStoryPlus", ["model/me", "model/Profiles", "model/RecommendFriends"], function(e, t, n) {
    var r = ["@kakaostory", "@kakaofriends"],
        i = n.extend({
            initialize: function() {
                this._isFecthed = !1
            },
            fetch: function() {
                var e, t = this;
                return this._isFecthed ? Q.resolve() : (e = _.map(this._getRecommendIds(), function(e) {
                    return t._fetchProfile(e)
                }), Q.all(e).then(function(e) {
                    t._isFecthed = !0, t.add(e)
                }))
            },
            _getRecommendIds: function() {
                var t = e.get("friends");
                return _.filter(r, function(e) {
                    return !t.getFriendById(e)
                })
            },
            _fetchProfile: function(e) {
                var n = new t({
                    id: e
                });
                return n.fetch().then(function() {
                    var e = n.get("profile");
                    return {
                        user_id: e.get("id"),
                        display_name: e.get("display_name"),
                        profile_image_url: e.get("profile_image_url"),
                        full_profile_image_url: "",
                        has_profile: !0,
                        sent: null,
                        status_objects: e.get("status_objects"),
                        recommend_type: "normal",
                        recommend_type_msg: null
                    }
                })
            }
        });
    return new i
});
define("part/friend/RecommendFriendItemPart", ["module/static/dialog", "module/static/error", "part/profile/ProfilePart"], function(e, t, n) {
    return n.extend({
        model: null,
        modelEvents: _.defaults({
            "change:sent": "render"
        }, n.prototype.modelEvents),
        ui: _.defaults({
            inviting: "._inviting",
            cancel: "._cancel"
        }, n.prototype.ui),
        events: _.defaults({
            "click ._ignore": function(n) {
                n.preventDefault();
                var i = this,
                    r = intl.t("friend.dialog.ignoreRecommend", {
                        name: this.model.get("display_name")
                    });
                e.confirm(r, n.target).then(function() {
                    return i.model.ignore().fail(t.getHandler())
                }).fail(function() {})
            }
        }, n.prototype.events)
    })
});
define("part/friend/RecommendFriendListPart", ["common/Effect"], function(e) {
    return space.Part.extend({
        collection: null,
        itemPartContainer: "._list",
        collectionEvents: {
            add: "addItemPart",
            remove: function(t) {
                var n = this,
                    r = this.getItemPart(t);
                new e(r.$el).transparent().collapse().complete(function() {
                    n.removeItemPart(t), 0 === n.collection.length && n.trigger("empty")
                })
            }
        }
    })
});
define("part/gnb/FriendRequestsPart", ["template/gnbFriend", "model/me", "common/Effect", "common/util", "module/static/error", "part/friend/InvitationItemPart", "part/friend/InvitationListPart", "model/Recommends", "model/recommendStoryPlus", "part/friend/RecommendFriendItemPart", "part/friend/RecommendFriendListPart"], function(t, e, i, n, s, o, r, a, l, d, c) {
    var h = 300,
        m = r.extend({
            template: t.invitationList,
            ui: _.defaults({
                count: "._count"
            }, r.prototype.ui),
            itemPart: o.extend({
                PROFILE_NAME_WIDTH: 155,
                template: t.invitationItem,
                styles: _.defaults({
                    alone: "alone"
                }, o.prototype.styles),
                onRender: function() {
                    o.prototype.onRender.call(this), this.$el.addClass(this.styles.alone)
                }
            }),
            collectionEvents: _.defaults({
                remove: function(t) {
                    var e = this,
                        n = this.getItemPart(t);
                    n && new i(n.$el).transparent().collapse().complete(function() {
                        e.removeItemPart(t), e._updateCount()
                    })
                }
            }, r.prototype.collectionEvents),
            itemFilter: function(t) {
                return t.get("isReceived")
            },
            extendData: function() {
                return {
                    id: e.get("id")
                }
            },
            _updateCount: function() {
                var t = this.collection.filter(this.itemFilter).length;
                this.ui.count.text(n.numberFormat(t)), 0 === t && this.trigger("empty")
            },
            onRender: function() {
                this.readReceivedInvitation()
            },
            onDomReady: function() {
                this._updateCount()
            }
        }),
        u = d.extend({
            PROFILE_NAME_WIDTH: 135,
            styles: _.defaults({
                alone: "alone"
            }, d.prototype.styles),
            onRender: function() {
                d.prototype.onRender.call(this), this.model.hasMessage() || this.$el.addClass(this.styles.alone)
            }
        }),
        p = c.extend({
            onDomReady: function() {
                0 === this.collection.length && this.remove()
            }
        });
    return space.Part.extend({
        skipGlobalEvents: !0,
        MAX_RECOMMEND_ITEM_COUNT: 8,
        MIN_HEIGHT: 400,
        TOP_PADDING: 200,
        BOTTOM_PADDING: 100,
        template: t.friendRequestsLayout,
        childParts: {
            receivedList: m,
            friendRecommendList: p.extend({
                template: t.storyRecommendList,
                itemPart: u.extend({
                    template: t.storyRecommendItem
                })
            }),
            storyPlusRecommendList: p.extend({
                template: t.storyPlusRecommendList,
                itemPart: u.extend({
                    template: t.storyPlusRecommendItem
                })
            })
        },
        ui: {
            listWrap: "._listWrap"
        },
        windowEvents: {
            resize: _.throttle(function() {
                this.isShown() && (this._updateListHeight(), this.isAvailableChildPart("scroll") && this.childParts.scroll.resizeScrollBar())
            }, h)
        },
        initialize: function() {
            this._invitations = e.get("invitations"), this._recommends = new a, this._$window = $(window)
        },
        onSetup: function() {
            var t = this;
            return t._recommends.get("story").parse = function(e) {
                return _.first(e, t.MAX_RECOMMEND_ITEM_COUNT)
            }, this.childParts.receivedList.collection = this._invitations, this.childParts.friendRecommendList.collection = this._recommends.get("story"), this.childParts.storyPlusRecommendList.collection = l, this.listenTo(this.childParts.receivedList, "empty", this._updateListStatus), this.listenTo(this.childParts.storyPlusRecommendList, "empty", this._updateListStatus), Q.all([e.get("invitations").fetch(), this._recommends.fetch([this._recommends.TYPE.STORY], !0)]).then(function() {
                return 0 === t._recommends.get("story").length ? l.fetch() : void 0
            }).fail(s.getHandler())
        },
        _updateListStatus: function() {
            var t = this._recommends.get("story").length + l.length;
            0 === t ? this.render() : this.childParts.receivedList.remove()
        },
        extendData: function() {
            var t = this._invitations.filter(function(t) {
                return t.get("isReceived")
            }).length,
                i = this._recommends.get("story").length + l.length;
            return {
                id: e.get("id"),
                receivedCount: t,
                recommendsCount: i,
                total: t + i
            }
        },
        onRender: function() {
            this._updateListHeight(), this.ui.listWrap.length ? this.addPart("scroll", "part/plugin/ScrollPart", {
                selector: this.ui.listWrap
            }) : this.removePart("scroll")
        },
        _updateListHeight: function() {
            var t, e = this.ui.listWrap;
            e && (t = Math.max(this.MIN_HEIGHT, this._$window.height() - this.BOTTOM_PADDING - this.TOP_PADDING), e.css({
                "max-height": t
            }))
        },
        show: function() {
            this.$el.show(), this.attachGlobalEvents()
        },
        hide: function() {
            this.$el.hide(), this.detachGlobalEvents()
        }
    })
});
define("part/myStory/EditingImagePart", ["template/myStory", "part/plugin/LayerPart", "model/SectionActivities", "model/PhotoPreview", "module/static/error", "module/static/dialog"], function(e, t, i, n, l, r) {
    return t.extend({
        template: e.editImage,
        model: null,
        ui: _.defaults({
            btnDelete: "._btnDelete"
        }, t.prototype.ui),
        toggleDelete: function(e) {
            this.ui.btnDelete.parent().toggle(e)
        },
        events: {
            "click ._btnSelect": function(e) {
                var t = new i({
                    id: this.model.get("profile").get("id"),
                    profile: this.model.get("profile"),
                    type: i.TYPE.PHOTOS
                });
                e.preventDefault(), this.addPart("album", "part/myStory/AlbumLayerPart", {
                    options: {
                        model: t
                    },
                    listeners: {
                        select: function(e, t) {
                            this.trigger("select", e, t), this.hide()
                        },
                        hide: function() {
                            this.removePart("album")
                        }
                    }
                }).next(function() {
                    this.hide()
                })
            },
            "click ._btnDelete": function(e) {
                e.preventDefault(), this.trigger("delete"), this.hide()
            },
            "change ._uploadInput": function(e) {
                var t, i = $(e.currentTarget),
                    o = this;
                i.val() && (t = new n, t.requestFileUpload(i).then(function(e) {
                    i.closest("form")[0].reset(), e.contentType === n.CONTENT_TYPE.GIF ? r.alert(intl.t("profile.image.invalidFileByGif")).then(function() {
                        o.hide()
                    }) : (o.trigger("upload", t.get("mediaPath")), o.hide())
                }).fail(l.getHandler()))
            }
        }
    })
});
define("part/myStory/AlbumLayerPart", ["template/myStory", "model/me", "model/SectionActivities", "part/plugin/CoverLayerPart", "module/static/error", "module/static/dialog", "common/util", "common/imgUtil"], function(t, e, i, o, r, n, l, a) {
    var s = /\.gif(?:\?|\#)?[^\?]*$/i;
    return o.extend({
        template: t.albumLayer,
        model: null,
        collection: null,
        ui: _.extend({}, o.prototype.ui, {
            listContainer: "._listContainer",
            imageCount: "._imageCount"
        }),
        styles: {
            hover: "over"
        },
        onSetup: function() {
            this.collection = this.model.get("activities")
        },
        onRender: function() {
            this.flow.forkWith(this.model.fetch().fail(r.getHandler())).next(function() {
                this.ui.imageCount.text(l.numberFormat(this.model.get("count"))), this.isAvailableChildPart("customScroll") && this.childParts.customScroll.resizeScrollBar()
            }).stopped(function() {
                this.hide()
            }), this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: this.ui.listContainer,
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.model.fetch()
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }), this.addPart("customScroll", "part/plugin/ScrollPart", {
                selector: this.ui.listContainer
            }), this.show()
        },
        _renderImageItem: function(e) {
            this.ui.listContainer.append(t.albumItem(e.toData())), this._resizeImage(e.get("id"))
        },
        _resizeImage: function(t) {
            var e = this.$el.find(t ? '[data-id="' + t + '"] ._media' : "._media");
            _.each(e, function(t) {
                var e = $(t);
                a.resize(e, e.parent())
            })
        },
        events: {
            "click ._btnCloseLayer": function(t) {
                t.preventDefault(), this.hide()
            },
            "mouseover,focusin ._selectImage": function(t) {
                $(t.currentTarget).addClass(this.styles.hover)
            },
            "mouseout,focusout ._selectImage": function(t) {
                $(t.currentTarget).removeClass(this.styles.hover)
            },
            "click ._selectImage": function(t) {
                var e = $(t.currentTarget),
                    i = e.data("id"),
                    o = e.data("idx"),
                    r = this.collection.get(i),
                    l = r.get("media");
                return t.preventDefault(), s.test(l[o].url) ? void n.alert(intl.t("profile.doNotUseGif")) : (this.trigger("select", i, o), void this.hide())
            }
        },
        collectionEvents: {
            add: "_renderImageItem"
        }
    })
});
define("part/feed/WritingButtonPart", ["template/feed", "part/writing/WritingPart"], function(t, e) {
    return space.Part.extend({
        template: t.writingButton,
        events: {
            "click ._changeMode": function(t) {
                var e = $(t.currentTarget).data("mode");
                t.preventDefault(), this.trigger("changeMode", e)
            }
        },
        changeMode: function(t) {
            var n = t === e.MODE.READY;
            agent.type.is.mobile || this.toggle(n)
        }
    })
});
define("part/feed/FeedUpdateItemPart", ["template/feed", "common/imgUtil"], function(e, t) {
    return space.Part.extend({
        template: e.itemUpdate,
        ui: {
            profileImage: "._profileImage"
        },
        onRender: function() {
            t.resize(this.ui.profileImage, this.ui.profileImage.parent())
        },
        events: {
            click: function(e) {
                e.preventDefault(), space.Router.navigate("/" + this.model.get("actor").get("urlKey") + "/" + this.model.get("urlKey"))
            }
        }
    })
});
define("part/feed/FeedJoinItemPart", ["template/feed", "model/me", "common/imgUtil"], function(e, t, i) {
    return space.Part.extend({
        template: e.itemJoin,
        ui: {
            profileImage: "._profileImage"
        },
        onRender: function() {
            var e = this.model.get("actor").get("relationship");
            i.resize(this.ui.profileImage, this.ui.profileImage.parent()), e && e !== this.model.get("actor").RELATIONSHIP.FRIEND && this.addPart("friendButton", "part/feed/FeedLayerItemPart", {
                options: {
                    model: this.model.get("actor")
                }
            })
        },
        extendData: function() {
            var e = this.model.get("actor"),
                t = e.get("relationship");
            return {
                displayRelationship: t && t !== e.RELATIONSHIP.FRIEND
            }
        }
    })
});
define("part/feed/FeedListPart", ["template/feed", "part/feed/FeedItemPart", "part/feed/FeedUpdateItemPart", "part/feed/FeedJoinItemPart", "model/Activities", "model/me", "model/fragment", "module/static/cover", "module/static/writingView", "module/static/error", "module/static/gnb", "common/animate", "common/util"], function(t, e, i, n, o, s, r, a, l, h, c, d, u) {
    var m = 300,
        f = 300,
        p = 5;
    return space.Part.extend({
        template: t.listContainer,
        itemPart: function(t) {
            var o = t.get("verb");
            switch (o) {
                case t.VERB.UPDATE:
                    return i;
                case t.VERB.JOIN:
                    return n;
                default:
                    return e
            }
        },
        initialize: function() {
            this._isShownLoading = !1, this._currentYear = null, this._$document = $(document), this._$moreCard = null, this._$noRelationship = $(t.noRelationship()), this._listType = null, this._isExist = null
        },
        onSetup: function() {
            var e, i = this.collection;
            this._listType = this.collection.getType(), this._listType === o.TYPE.HASHTAG && (e = this.collection.parent.get("tag")), this.collection = r.clone(this.collection, {
                limit: p
            }), this.listenTo(a, {
                show: function() {
                    this.isAvailableChildPart("scroll") && this.childParts.scroll.deactivate()
                },
                hide: function() {
                    this.isAvailableChildPart("scroll") && this.childParts.scroll.activate()
                }
            }), this._listType === o.TYPE.MY_STORY && this.listenTo(this, "renderItemPart", function(e) {
                var i = e.model,
                    n = u.dateFormat(i.get("created_at"), "YYYY");
                this._currentYear && this._currentYear !== n && $(t.year({
                    year: n
                })).insertBefore(e.$el), this._currentYear = n
            }), (this._listType !== o.TYPE.MY_STORY || i.isMine()) && this.listenTo(l, {
                post: function(t) {
                    this._listType !== o.TYPE.MY_STORY && t.isMeOnlyPermission() || (this._listType !== o.TYPE.HASHTAG || _.contains(t.getHashtags(), e)) && this.addActivity(t)
                }
            })
        },
        onRender: function() {
            var t = this,
                e = s.get("friends"),
                i = function() {
                    e.length || t._$noRelationship.show()
                };
            this._fetchData(!0), this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: $(window),
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t._viewMoreFeed()
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }), this._listType === o.TYPE.FEED && (e.isFetched() ? i() : this.listenToOnce(e, "fetched", function() {
                i()
            })), this._$noRelationship.appendTo(this.itemPartContainer)
        },
        onStop: function() {
            this._removeMoreCard(), this._$noRelationship && this._$noRelationship.remove()
        },
        _showMoreCard: function() {
            this._$moreCard || (this._$moreCard = $(t.moreCard())), this._$moreCard.appendTo(this.itemPartContainer)
        },
        _hideMoreCard: function() {
            this._$moreCard && this._$moreCard.detach()
        },
        _removeMoreCard: function() {
            this._$moreCard && (this._$moreCard.remove(), this._$moreCard = null)
        },
        _changeListStatus: function(t) {
            t = !! t, (null === this._isExist || t !== this._isExist) && (this._isExist = t, this.trigger("changeListStatus", t))
        },
        _fetchData: function(e) {
            var i, n = null,
                o = this.collection.originalCollection,
                s = e && o.length;
            return o.isEnd() && !this.collection.hasNextFragment() ? (this._$moreCard && (this._$moreCard.remove(), this._$moreCard = null), Q.resolve()) : (i = this.flow.fork(), this._isShownLoading || (n = $(t.loading()).appendTo(this.itemPartContainer)), this.collection.isRequireFetch() && !s && i.next(function() {
                return o.fetch().fail(h.getHandler())
            }).stopped(function() {
                this._removeMoreCard()
            }), i.next(function() {
                s || this.collection.addNextFragment()
            }).fin(function() {
                n && (n.remove(), this._isShownLoading = !1), this._changeListStatus(this.collection.length ? !0 : !1), o.isEnd() && !this.collection.hasNextFragment() ? this._hideMoreCard() : this._showMoreCard(), this.trigger("fetchData")
            }).getPromise())
        },
        _viewMoreFeed: function() {
            return this._hideMoreCard(), this._fetchData()
        },
        events: {
            "click ._btnFindFriend": function(t) {
                t.preventDefault(), c.toggleFriendRequestsLayer()
            },
            "click ._viewMoreFeed": function(t) {
                t.preventDefault(), this._viewMoreFeed()
            }
        },
        collectionEvents: {
            add: function(t, e, i) {
                var n;
                i && 0 === i.at ? (n = this.addItemPart(t, e, i), n && (n.$el.css("opacity", 0), this.flow.forkWith(Q.delay(f)).next(function() {
                    return d(n.$el, {
                        opacity: 1
                    }, m)
                }))) : this.addItemPart(t, e, i), 1 === this.collection.length && this._changeListStatus(!0)
            },
            remove: function() {
                this.removeItemPart.apply(this, arguments), 0 === this.collection.length && (this.collection.originalCollection.isEnd() || self._showMoreCard(), this._changeListStatus(!1))
            }
        },
        addActivity: function(t) {
            this.collection.originalCollection.add([t], {
                at: 0
            })
        }
    })
});
define("part/feed/CampaignItemPart", ["template/feed"], function(t) {
    var e = space.Part.extend({
        template: t.campaignItem,
        model: null,
        styles: {
            textCampaign: "admin_txt",
            noContent: "v2"
        },
        extendData: function() {
            var t = "",
                e = "",
                a = "",
                n = [];
            return this.model.get("isTextCampaign") && (n.push(this.styles.textCampaign), this.model.get("hasContent") || n.push(this.styles.noContent)), t = n.join(" "), a = agent.support.retina ? this.model.get("image_2x") || this.model.get("image_1x") : this.model.get("image_1x"), e = this.model.get("isTextCampaign") && a ? "background:url('" + a + "') 100% 50% no-repeat;" : "", {
                itemClass: t,
                itemStyle: e,
                imagePath: a
            }
        }
    });
    return e
});
define("part/feed/CampaignListPart", ["template/feed", "model/me", "part/feed/CampaignItemPart"], function(e, t, n) {
    var i = t.get("property");
    return space.Part.extend({
        template: e.campaignList,
        itemPart: n,
        collection: null,
        events: {
            "click ._closeButton": function(e) {
                var t = this.collection.at(0).get("id"),
                    n = i.get(i.TYPE.LAST_CAMPAIGN_ID_LIST);
                this.collection.getFetchedCount() > 1 ? n.push(t) : n = [t], i.updateProperty(i.TYPE.LAST_CAMPAIGN_ID_LIST, n), this.hide(), e.preventDefault()
            },
            "contextmenu img": function(e) {
                e.preventDefault()
            }
        },
        collectionEvents: {
            reset: "render"
        },
        onRender: function() {
            this.collection.length && this.show()
        }
    })
});
define("part/feed/BlockedUserPart", ["template/feed", "config"], function(e, t) {
    return space.Part.extend({
        template: e.blockedUser,
        options: {
            message: "setMessage"
        },
        events: {
            "click ._inquiry": function(e) {
                e.preventDefault(), window.open(t.customer.request)
            }
        },
        initialize: function() {
            this._message = null, this._buttonLabel = null
        },
        setMessage: function(e) {
            this._message = e
        },
        setButtonLabel: function(e) {
            this._buttonLabel = e
        },
        extendData: function() {
            return {
                message: this._message,
                buttonLabel: this._buttonLabel ? this._buttonLabel : intl.t("dialog.ok")
            }
        }
    })
});
define("part/myStory/friend/FriendMenuPart", ["model/me", "template/myStoryFriend"], function(e, t) {
    return space.Part.extend({
        template: t.friendMenu,
        styles: {
            selected: "selected"
        },
        ui: {
            menus: "._myStoryFriendMenu",
            newInvitationBadge: "._newInvitationBadge"
        },
        events: {
            "click ._myStoryFriendMenu": "_highlightMenu"
        },
        onSetup: function() {
            this.listenTo(e.get("newCount"), "change:received_count", function() {
                this._updateNewInvitationBadge()
            })
        },
        onRoute: function() {
            this._highlightMenu()
        },
        onRender: function() {
            this._updateNewInvitationBadge()
        },
        _highlightMenu: function() {
            var e = this.styles.selected,
                t = _.last(space.Router.getPath().split("/"));
            _.each(this.ui.menus, function(n) {
                var i = $(n);
                i.toggleClass(e, t === i.attr("data-menu"))
            }, this)
        },
        _updateNewInvitationBadge: function() {
            this.ui.newInvitationBadge && this.ui.newInvitationBadge.css({
                display: e.get("newCount").get("received_count") ? "" : "none"
            })
        }
    })
});
define("part/myStory/friend/FriendListPart", ["template/myStoryFriend", "model/me", "model/fragment", "part/friend/FriendItemPart", "part/friend/FriendListPart"], function(t, e, i, n, o) {
    var l = 20,
        r = n.extend({
            PROFILE_NAME_WIDTH: 220,
            template: t.friendItem
        }),
        a = o.extend({
            template: t.newList,
            itemPart: r,
            itemFilter: function(t) {
                return t.collection.isNewFriend(t)
            },
            toggleListByItemCount: !0,
            onDomReady: function() {
                o.prototype.onDomReady.call(this), this.collection.clearNewFriend()
            }
        }),
        s = o.extend({
            template: t.favoriteList,
            itemPart: r,
            itemFilter: function(t) {
                return t.get("is_favorite")
            },
            toggleListByItemCount: !0
        }),
        d = o.extend({
            template: t.wholeList,
            itemPart: r,
            toggleListByItemCount: !0,
            ui: {
                loading: "._loading"
            },
            onRender: function() {
                this.addPart("infinityScroll", "part/plugin/InfinityScrollPart", {
                    selector: $(window),
                    listeners: {
                        end: function() {
                            this.collection.hasNextFragment() ? this.collection.addNextFragment() : this.ui.loading.hide()
                        }
                    }
                }).next(function() {
                    this.childParts.infinityScroll.activate()
                }), this.collection.hasNextFragment() && this.ui.loading.show()
            }
        });
    return space.Part.extend({
        template: t.friendListLayout,
        ui: {
            noFriend: "._noFriend"
        },
        childParts: {
            newList: a,
            favoriteList: s,
            wholeList: d
        },
        onSetup: function() {
            var t = this,
                n = e.get("friends");
            return this.childParts.newList.collection = n, this.childParts.favoriteList.collection = n, this.childParts.wholeList.collection = i.clone(n, {
                limit: l,
                intoTheMiddle: !0
            }), this.listenTo(n, {
                fetched: function() {
                    var e = t.childParts.wholeList.collection;
                    (0 === e.length || n.length < l) && e.addNextFragment()
                }
            }), this.listenTo(this.childParts.wholeList, "toggle", function(t) {
                this.ui.noFriend.toggle(!t)
            }), n.fetch()
        }
    })
});
define("part/myStory/friend/FriendRecommendPart", ["template/myStoryFriend", "model/Recommends", "model/recommendStoryPlus", "model/fragment", "part/friend/RecommendFriendItemPart", "part/friend/RecommendFriendListPart", "module/static/error"], function(t, e, i, n, o, s, r) {
    var d = 20,
        l = s.extend({
            template: t.storyRecommendList,
            ui: {
                loading: "._loading"
            },
            itemPart: o.extend({
                PROFILE_NAME_WIDTH: 220,
                template: t.storyRecommendItem
            }),
            onRender: function() {
                this.addPart("infinityScroll", "part/plugin/InfinityScrollPart", {
                    selector: $(window),
                    listeners: {
                        end: function() {
                            this.collection.hasNextFragment() ? this.collection.addNextFragment() : this.ui.loading.hide()
                        }
                    }
                }).next(function() {
                    this.childParts.infinityScroll.activate()
                }), this.collection.hasNextFragment() && this.ui.loading.show()
            }
        }),
        a = s.extend({
            template: t.storyPlusRecommendList,
            itemPart: o.extend({
                PROFILE_NAME_WIDTH: 220,
                template: t.storyPlusRecommendItem
            })
        });
    return space.Part.extend({
        template: t.friendRecommendLayout,
        childParts: {
            storyRecommendList: l,
            storyPlusRecommendList: a
        },
        ui: {
            listWrap: "._listWrap",
            noData: "._noData"
        },
        initialize: function() {
            this._recommends = new e
        },
        onSetup: function() {
            var t = this._recommends,
                e = t.get("story"),
                o = i;
            return this.listenTo(e, "reset,add,remove", this._updateListVisibility), this.listenTo(o, "reset,add,remove", this._updateListVisibility), this.flow.forkWith(t.fetch([t.TYPE.STORY], !0)).next(function() {
                return this.childParts.storyRecommendList.collection = n.clone(e, {
                    limit: d
                }), this.childParts.storyPlusRecommendList.collection = o, 0 === e.length ? i.fetch() : void 0
            }).stopped(r.getHandler())
        },
        onRender: function() {
            this._updateListVisibility()
        },
        _updateListVisibility: function() {
            var t = this._recommends,
                e = t.get("story").length + i.length > 0;
            this.ui && this.ui.listWrap && (this.ui.listWrap.toggle(e), this.ui.noData.toggle(!e))
        }
    })
});
define("part/myStory/friend/FriendRequestsPart", ["template/myStoryFriend", "model/me", "part/friend/InvitationItemPart", "part/friend/InvitationListPart", "common/Effect"], function(t, e, i, n, r) {
    var s = n.extend({
        template: t.invitationList,
        ui: _.defaults({
            count: "._count"
        }, n.prototype.ui),
        itemPart: i.extend({
            PROFILE_NAME_WIDTH: 220,
            template: t.invitationItem
        }),
        collectionEvents: _.defaults({
            remove: function(t) {
                var e = this,
                    i = this.getItemPart(t);
                i && new r(i.$el).transparent().collapse().complete(function() {
                    e.removeItemPart(t), e._updateListStatus()
                })
            }
        }, n.prototype.collectionEvents),
        _updateListStatus: function() {
            var t = this.collection.filter(this.itemFilter).length;
            this.ui.count.text(t), 0 === t && (this.hide(), this.trigger("empty"))
        }
    });
    return space.Part.extend({
        template: t.friendRequestsLayout,
        childParts: {
            receivedList: s.extend({
                itemFilter: function(t) {
                    return t.get("isReceived")
                },
                extendData: function() {
                    return {
                        title: intl.t("friend.title.receivedList")
                    }
                },
                onRender: function() {
                    this.readReceivedInvitation()
                }
            }),
            sentList: s.extend({
                itemFilter: function(t) {
                    return t.get("isSent")
                },
                extendData: function() {
                    return {
                        title: intl.t("friend.title.sentList")
                    }
                }
            })
        },
        onSetup: function() {
            var t = e.get("invitations");
            return this.childParts.receivedList.collection = t, this.childParts.sentList.collection = t, this.listenTo(this.childParts.receivedList, "empty", function() {
                this._renderIfEmpty()
            }), this.listenTo(this.childParts.sentList, "empty", function() {
                this._renderIfEmpty()
            }), t.fetch()
        },
        _renderIfEmpty: function() {
            0 === e.get("invitations").length && this.render()
        },
        extendData: function() {
            return {
                total: e.get("invitations").length
            }
        }
    })
});
define("template/myStoryMusic", ["Handlebars"], function(a) {
    var t = function(t) {
        var i = a.template(t);
        return function(a) {
            return i(a, {
                partials: s
            })
        }
    }, s = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, s, i, n) {
                function l(a, t) {
                    var i, n, l, e = "";
                    return e += '<p class="tt_music"><a href="#" class="_btnOpenMusicRoom" data-kant-id="289" data-kant-option="t:', (n = s.storyType) ? i = n.call(a, {
                        hash: {},
                        data: t
                    }) : (n = a && a.storyType, i = typeof n === c ? n.call(a, {
                        hash: {},
                        data: t
                    }) : n), e += o(i) + '"><span class="ico_play"></span>' + o((i = a && a.profile, i = null == i || i === !1 ? i : i.display_name, typeof i === c ? i.apply(a) : i)) + o((n = s.t || a && a.t, l = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.musicRoom", l) : p.call(a, "t", "myStory.musicRoom", l))) + "</a></p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), n = n || {};
                var e, r = "",
                    c = "function",
                    o = this.escapeExpression,
                    p = s.helperMissing,
                    u = this;
                return e = s["if"].call(t, t && t.hasMusic, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(1, l, n),
                    data: n
                }), (e || 0 === e) && (r += e), r += '<ul class="lst_music _listContainer"></ul>'
            });
            return a.wrap = '<div data-kant-group="my.music">', a
        }(),
        item: function() {
            var a = t(function(a, t, s, i, n) {
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), n = n || {};
                var l, e, r, c = "",
                    o = "function",
                    p = this.escapeExpression,
                    u = s.helperMissing;
                return c += '<div class="inner"><a href="#" class="img_album _playMusic _media" data-kant-id="290"><img src="' + p((l = t && t.object, l = null == l || l === !1 ? l : l.album_image, typeof l === o ? l.apply(t) : l)) + '" alt=""><span class="mask"></span></a><div class="txt"><p class="tit"><a href="#" class="_playMusic" data-kant-id="291">' + p((l = t && t.object, l = null == l || l === !1 ? l : l.title, typeof l === o ? l.apply(t) : l)) + "</a></p><p>" + p((l = t && t.object, l = null == l || l === !1 ? l : l.artist, typeof l === o ? l.apply(t) : l)) + '</p><p class="info"><a href="#" class="_activityInfo" data-kant-id="293"><span class="ic_heart">' + p((e = s.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, e ? e.call(t, "activity.like.text", r) : u.call(t, "t", "activity.like.text", r))) + "</span> " + p((e = s.numberFormat || t && t.numberFormat, r = {
                    hash: {},
                    data: n
                }, e ? e.call(t, t && t.like_count, r) : u.call(t, "numberFormat", t && t.like_count, r))) + ' <span class="ic_commont">' + p((e = s.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, e ? e.call(t, "activity.comment.text", r) : u.call(t, "t", "activity.comment.text", r))) + "</span> " + p((e = s.numberFormat || t && t.numberFormat, r = {
                    hash: {},
                    data: n
                }, e ? e.call(t, t && t.comment_count, r) : u.call(t, "numberFormat", t && t.comment_count, r))) + '</a></p><a href="#" class="bn_play _playMusic" data-kant-id="294">' + p((e = s.t || t && t.t, r = {
                    hash: {},
                    data: n
                }, e ? e.call(t, "activity.alt.musicPlay", r) : u.call(t, "t", "activity.alt.musicPlay", r))) + "</a></div></div>"
            });
            return a.wrap = '<li data-kant-group="my.music">', a
        }(),
        empty: function() {
            var a = t(function(a, t, s, i, n) {
                function l(a, t) {
                    var i, n, l = "";
                    return l += "<p>" + m((i = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "myStory.empty.music", n) : u.call(a, "t", "myStory.empty.music", n))) + '</p><div class="bx_nodata"><a href="#" class="_writeButton" data-kant-id="295"><span class="ic_music"></span>' + m((i = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "myStory.empty.musicButton", n) : u.call(a, "t", "myStory.empty.musicButton", n))) + "</a></div>"
                }
                function e() {
                    return '<p class="friend"><span class="ic_music"></span></p>'
                }
                function r(a, t) {
                    var i, n = "";
                    return n += " ", i = s.unless.call(a, (i = a && a.profile, null == i || i === !1 ? i : i.isMe), {
                        hash: {},
                        inverse: h.noop,
                        fn: h.program(6, c, t),
                        data: t
                    }), (i || 0 === i) && (n += i), n += " "
                }
                function c(a, t) {
                    var i, n, l = "";
                    return l += "<p>" + m((i = s.t || a && a.t, n = {
                        hash: {},
                        data: t
                    }, i ? i.call(a, "myStory.emptyOther.music", n) : u.call(a, "t", "myStory.emptyOther.music", n))) + "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), n = n || {};
                var o, p = "",
                    u = s.helperMissing,
                    m = this.escapeExpression,
                    h = this;
                return p += '<div class="nodata" data-kant-group="my.music">', o = s["if"].call(t, (o = t && t.profile, null == o || o === !1 ? o : o.isMe), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(1, l, n),
                    data: n
                }), (o || 0 === o) && (p += o), p += " ", o = s["if"].call(t, (o = t && t.profile, null == o || o === !1 ? o : o.isFriend), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(3, e, n),
                    data: n
                }), (o || 0 === o) && (p += o), p += " ", o = s.unless.call(t, (o = t && t.profile, null == o || o === !1 ? o : o.isFriend), {
                    hash: {},
                    inverse: h.noop,
                    fn: h.program(5, r, n),
                    data: n
                }), (o || 0 === o) && (p += o), p += "</div>"
            });
            return a
        }(),
        emptyMobile: function() {
            var a = t(function(a, t, s, i, n) {
                return this.compilerInfo = [4, ">= 1.0.0"], s = this.merge(s, a.helpers), n = n || {}, '<div class="nodata"><p class="friend"><span class="ic_music"></span></p></div>'
            });
            return a
        }()
    }
});
define("part/myStory/MusicListPart", ["template/myStoryMusic", "part/writing/WritingPart", "module/static/writingView", "module/static/error", "common/musicPlayer", "common/kantUtil"], function(t, e, i, n, l, o) {
    return space.Part.extend({
        model: null,
        collection: null,
        template: t.layout,
        itemPart: "part/myStory/MusicItemPart",
        itemPartContainer: "._listContainer",
        initialize: function() {
            this._$originalElement = null
        },
        onSetup: function() {
            return this.collection = this.model.get("activities"), this.model.isMine() && this.listenTo(i, {
                post: function(t, i) {
                    i === e.MODE.MUSIC && (this._$originalElement && (this.setElement(this._$originalElement), this._$originalElement = null), this.collection.add([t], {
                        at: 0
                    }))
                }
            }), this.model.fetch()
        },
        onRender: function() {
            var e;
            this.collection.length ? this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: $(window),
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.model.fetch()
                        }).next(function(e) {
                            e && e.activities && o.sendPageView(t.model.get("profile").get("isMe") ? "my.04" : "fs.04")
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }) : (this._$originalElement = this.$el.detach(), e = agent.type.is.mobile && this.model.isMine() ? t.emptyMobile() : t.empty(this.model.toData()), this.setElement($(e))), o.sendPageView(this.model.get("profile").get("isMe") ? "my.04" : "fs.04")
        },
        extendData: function() {
            var t = this.model.get("profile"),
                e = "";
            return e = t.get("isMe") ? "my" : t.get("isFriend") ? "friend" : "other", {
                hasMusic: this.collection.length > 0 ? !0 : !1,
                storyType: e
            }
        },
        collectionEvents: {
            add: "addItemPart",
            remove: "removeItemPart"
        },
        events: {
            "click ._writeButton": function(t) {
                t.preventDefault(), i.show(e.MODE.MUSIC)
            },
            "click ._btnOpenMusicRoom": function(t) {
                var e;
                t.preventDefault(), this.collection.length && (e = this.collection.first(), l.openByActivityId(e.get("id"), !0).fail(n.getHandler()))
            }
        }
    })
});
define("part/myStory/MusicItemPart", ["template/myStoryMusic", "common/imgUtil", "common/musicPlayer", "module/static/error"], function(e, t, i, n) {
    return space.Part.extend({
        model: null,
        template: e.item,
        ui: {
            media: "._media"
        },
        onRender: function() {
            var e = this.ui.media.find("img");
            t.resize(e, this.ui.media)
        },
        events: {
            "click ._playMusic": function(e) {
                e.preventDefault(), i.openByActivityId(this.model.get("id")).fail(n.getHandler())
            },
            "click ._activityInfo": function(e) {
                var t = this.model.collection.parent.get("profile");
                e.preventDefault(), space.Router.navigate("/" + t.get("urlKey") + "/" + this.model.get("urlKey"))
            }
        }
    })
});
define("template/myStoryPhotos", ["Handlebars"], function(a) {
    var t = function(t) {
        var n = a.template(t);
        return function(a) {
            return n(a, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, e, n, s) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var r = "";
                return r
            });
            return a.wrap = '<div class="gallery_wrap" data-kant-group="my.photo">', a
        }(),
        item: function() {
            var a = t(function(a, t, e, n, s) {
                function r(a, t) {
                    var n, s, r = "";
                    return r += '<p class="pic_info"><a href="#" class="_link _focusTarget" style="height:16px" data-kant-id="297">', (s = e.escapedTextContent) ? n = s.call(a, {
                        hash: {},
                        data: t
                    }) : (s = a && a.escapedTextContent, n = typeof s === h ? s.call(a, {
                        hash: {},
                        data: t
                    }) : s), (n || 0 === n) && (r += n), r += "</a></p>"
                }
                function o() {
                    return " _focusTarget"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var l, i, c, p = "",
                    h = "function",
                    d = this.escapeExpression,
                    m = e.helperMissing,
                    u = this;
                return p += '<div class="img_art loading _mediaItem" style="position:absolute;top:0;left:0px" data-url-key="', (i = e.urlKey) ? l = i.call(t, {
                    hash: {},
                    data: s
                }) : (i = t && t.urlKey, l = typeof i === h ? i.call(t, {
                    hash: {},
                    data: s
                }) : i), p += d(l) + '" data-activity-index="', (i = e.activityIndex) ? l = i.call(t, {
                    hash: {},
                    data: s
                }) : (i = t && t.activityIndex, l = typeof i === h ? i.call(t, {
                    hash: {},
                    data: s
                }) : i), p += d(l) + '" data-index="', (i = e.mediaIndex) ? l = i.call(t, {
                    hash: {},
                    data: s
                }) : (i = t && t.mediaIndex, l = typeof i === h ? i.call(t, {
                    hash: {},
                    data: s
                }) : i), p += d(l) + '" data-kant-group="my.photo"><a href="#" class="in_img" data-kant-id="296"><img src="', (i = e.url) ? l = i.call(t, {
                    hash: {},
                    data: s
                }) : (i = t && t.url, l = typeof i === h ? i.call(t, {
                    hash: {},
                    data: s
                }) : i), p += d(l) + '" style="position:absolute" alt="" style="width:100%;display:none" class="_media"> <span class="bg_dim _dimmed"></span> <span class="cover"></span></a><div class="in_txt"><strong class="date">' + d((i = e.dateFormat || t && t.dateFormat, c = {
                    hash: {},
                    data: s
                }, i ? i.call(t, t && t.created_at, "MM.DD", c) : m.call(t, "dateFormat", t && t.created_at, "MM.DD", c))) + "</strong> ", l = e["if"].call(t, t && t.escapedTextContent, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(1, r, s),
                    data: s
                }), (l || 0 === l) && (p += l), p += '<p class="feel"><a href="#" class="_link', l = e.unless.call(t, t && t.escapedTextContent, {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(3, o, s),
                    data: s
                }), (l || 0 === l) && (p += l), p += '" data-kant-id="298"><span class="ico_like"></span>' + d((i = e.numberFormat || t && t.numberFormat, c = {
                    hash: {},
                    data: s
                }, i ? i.call(t, t && t.like_count, c) : m.call(t, "numberFormat", t && t.like_count, c))) + '<span class="ico_comm"></span>' + d((i = e.numberFormat || t && t.numberFormat, c = {
                    hash: {},
                    data: s
                }, i ? i.call(t, t && t.comment_count, c) : m.call(t, "numberFormat", t && t.comment_count, c))) + "</a></p></div></div>"
            });
            return a
        }(),
        empty: function() {
            var a = t(function(a, t, e, n, s) {
                function r(a, t) {
                    var n, s, r = "";
                    return r += "<p>" + d((n = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.empty.photos", s) : h.call(a, "t", "myStory.empty.photos", s))) + '</p><div class="bx_nodata"><a href="#" class="_writeButton" data-kant-id="299"><span class="ic_camera"></span>' + d((n = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.empty.photoButton", s) : h.call(a, "t", "myStory.empty.photoButton", s))) + "</a></div>"
                }
                function o() {
                    return '<p class="friend"><span class="ic_photo"></span></p>'
                }
                function l(a, t) {
                    var n, s = "";
                    return s += " ", n = e.unless.call(a, (n = a && a.profile, null == n || n === !1 ? n : n.isMe), {
                        hash: {},
                        inverse: m.noop,
                        fn: m.program(6, i, t),
                        data: t
                    }), (n || 0 === n) && (s += n), s += " "
                }
                function i(a, t) {
                    var n, s, r = "";
                    return r += "<p>" + d((n = e.t || a && a.t, s = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.emptyOther.photos", s) : h.call(a, "t", "myStory.emptyOther.photos", s))) + "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {};
                var c, p = "",
                    h = e.helperMissing,
                    d = this.escapeExpression,
                    m = this;
                return p += '<div class="nodata" data-kant-group="my.photo">', c = e["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isMe), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(1, r, s),
                    data: s
                }), (c || 0 === c) && (p += c), p += " ", c = e["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isFriend), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(3, o, s),
                    data: s
                }), (c || 0 === c) && (p += c), p += " ", c = e.unless.call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isFriend), {
                    hash: {},
                    inverse: m.noop,
                    fn: m.program(5, l, s),
                    data: s
                }), (c || 0 === c) && (p += c), p += "</div>"
            });
            return a
        }(),
        emptyMobile: function() {
            var a = t(function(a, t, e, n, s) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), s = s || {}, '<div class="nodata"><p class="friend"><span class="ic_photo"></span></p></div>'
            });
            return a
        }()
    }
});
define("part/myStory/PhotoListPart", ["template/myStoryPhotos", "part/writing/WritingPart", "module/static/cover", "module/static/mediaView", "module/static/writingView", "common/imgUtil", "common/kantUtil", "common/animate"], function(t, i, e, n, o, s, l, h) {
    var a = 500,
        r = 500,
        c = 100,
        d = 4;
    return space.Part.extend({
        MAX_COLUMN_LENGTH: 3,
        COLUMN_WIDTH: 250,
        COLUMN_HEIGHT: 150,
        COLUMN_VERTICAL_MARGIN: 10,
        COLUMN_HORIZONTAL_MARGIN: 10,
        COLUMN_LENGTH_LIMIT: [1024, 768],
        model: null,
        collection: null,
        template: t.layout,
        styles: {
            loading: "loading",
            hover: "hover"
        },
        initialize: function() {
            this._columnLength = this.MAX_COLUMN_LENGTH, this._columnLastBottoms = [], this._$window = $(window), this._promise = Q.resolve(), this._activityIndex = 0, this._mediaCount = 0, this._$originalElement = null;
            for (var t = 0; t < this.MAX_COLUMN_LENGTH; t++) this._columnLastBottoms.push(0)
        },
        onSetup: function() {
            return this.collection = this.model.get("activities"), this.listenTo(e, {
                show: function() {
                    this.detachGlobalEvents(), this.childParts.scroll && this.childParts.scroll.deactivate()
                },
                hide: function() {
                    this.attachGlobalEvents(), this.childParts.scroll && this.childParts.scroll.activate()
                }
            }), this.listenTo(n, {
                hide: function(t, i) {
                    var e = $("._mediaItem[data-activity-index=" + t + "][data-index=" + i + "]");
                    _.isEmpty(e) || e.find("._focusTarget").focus()
                },
                end: function() {
                    var t = this;
                    this._promise.isPending() || (this._promise = this._promise.then(function() {
                        return t.model.fetch().then(function(i) {
                            i && i.activities && l.sendPageView(t.model.get("profile").get("isMe") ? "my.02" : "fs.02")
                        })
                    }))
                }
            }), this.model.isMine() && this.listenTo(o, {
                post: function(t, e) {
                    var n;
                    e === i.MODE.PHOTO && (this.collection.add([t], {
                        at: 0,
                        slient: !0
                    }), this._$originalElement && (this.setElement(this._$originalElement), this._$originalElement = null), n = t.get("media") ? t.get("media").length : 0, this.model.set("count", parseInt(this.model.get("count"), 10) + n), this.render())
                }
            }), this.model.fetch()
        },
        onRender: function() {
            var i;
            this.collection.length ? (this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: $(window),
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.model.fetch()
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }), this._calcColumnLength(), this._renderPhotos(), this._resizeContainer()) : (this._$originalElement = this.$el.detach(), i = agent.type.is.mobile && this.model.isMine() ? t.emptyMobile() : t.empty(this.model.toData()), this.setElement($(i))), l.sendPageView(this.model.get("profile").get("isMe") ? "my.02" : "fs.02")
        },
        _calcColumnLength: function() {
            var t = this.MAX_COLUMN_LENGTH,
                i = this._$window.width();
            _.some(this.COLUMN_LENGTH_LIMIT, function(e) {
                return i >= e ? !0 : void t--
            }), this._columnLength = t
        },
        _renderPhotos: function() {
            var t = this;
            this._reset(), _.each(this.collection.models, function(i) {
                t._renderPhoto(i)
            })
        },
        _renderPhoto: function(i) {
            var e = this,
                n = i.get("media");
            _.isEmpty(n) || _.each(n, function(n, o) {
                var l = n.width || e.COLUMN_WIDTH,
                    h = n.height || e.COLUMN_HEIGHT,
                    a = Math.round(h * (e.COLUMN_WIDTH / l)),
                    r = $(t.item(_.extend(i.toData(), n, {
                        urlKey: i.get("urlKey"),
                        activityIndex: e._activityIndex,
                        mediaIndex: o
                    }))),
                    c = a < e.COLUMN_HEIGHT,
                    m = r.find("img");
                a = Math.max(e.COLUMN_HEIGHT, a), n && n.width && n.height && n.height / n.width >= d && m.attr("src", n.origin_url), s.resize(m, r, {
                    fitWidth: !c,
                    isCrop: c,
                    containerWidth: e.COLUMN_WIDTH,
                    containerHeight: a,
                    width: n ? n.width : null,
                    height: n ? n.height : null
                }).then(function() {
                    r.removeClass(e.styles.loading), m.show()
                }), e._mediaCount++, e._adjustMediaContainer(r, a), r.appendTo(e.$el)
            }), this._activityIndex++
        },
        _adjustMediaContainer: function(t, i) {
            var e = this._getShortestColumnIndex();
            t.css({
                width: this.COLUMN_WIDTH,
                height: i,
                left: e * (this.COLUMN_WIDTH + this.COLUMN_HORIZONTAL_MARGIN),
                top: this._columnLastBottoms[e]
            }), this._columnLastBottoms[e] += i + this.COLUMN_VERTICAL_MARGIN, this._setContainerHeight()
        },
        _resizeContainer: function() {
            this.$el.width(this._columnLength * this.COLUMN_WIDTH + (this._columnLength - 1) * this.COLUMN_VERTICAL_MARGIN)
        },
        _setContainerHeight: _.debounce(function() {
            this.$el.height(_.max(this._columnLastBottoms))
        }, r),
        _getShortestColumnIndex: function() {
            for (var t = null, i = null, e = 0, n = this._columnLength; n > e; e++)(null === i || this._columnLastBottoms[e] < i) && (t = e, i = this._columnLastBottoms[e]);
            return t
        },
        _isImageTooLongHeight: function() {
            var t = null,
                i = null;
            return _.each(this._columnLastBottoms, function(e) {
                (null === t || t > e) && (t = e), (null === i || e > i) && (i = e)
            }), Math.abs(t - i) >= this._$window.height()
        },
        _reset: function() {
            this._columnLastBottoms = _.map(this._columnLastBottoms, function() {
                return 0
            }), this._activityIndex = 0, this._mediaCount = 0
        },
        collectionEvents: {
            add: "_renderPhoto"
        },
        windowEvents: {
            resize: _.throttle(function() {
                var t = this._columnLength;
                this._calcColumnLength(), t !== this._columnLength && (this.$el.height(_.max(this._columnLastBottoms)), this.render())
            }, a)
        },
        events: {
            "click ._writeButton": function(t) {
                t.preventDefault(), o.show(i.MODE.PHOTO)
            },
            "click ._mediaItem": function(t) {
                var i = this.model.get("profile"),
                    e = $(t.currentTarget),
                    o = !1;
                t.preventDefault(), $(t.target).closest("._link").length || (i.get("isMe") || this.model.get("profile").get("isFriend") || (o = !0), n.collection = this.collection, n.show(n.MODE.ACTIVITY, {
                    profile: this.model.get("profile"),
                    activityIndex: parseInt(e.data("activity-index"), 10),
                    mediaIndex: parseInt(e.data("index"), 10),
                    totalCount: this.model.get("count"),
                    hidePagination: o
                }))
            },
            "click ._activityInfo": function(t) {
                t.preventDefault()
            },
            "click ._link": function(t) {
                t.preventDefault(), space.Router.navigate("/" + this.model.get("profile").get("urlKey") + "/" + $(t.currentTarget).closest("._mediaItem").attr("data-url-key"))
            },
            "mouseenter ._mediaItem": function(t) {
                var i = $(t.currentTarget),
                    e = i.find("._dimmed");
                h(e, {
                    opacity: 0
                }, c)
            },
            "mouseleave ._mediaItem": function(t) {
                var i = $(t.currentTarget),
                    e = i.find("._dimmed");
                h(e, {
                    opacity: .3
                }, c)
            }
        }
    })
});
define("part/myStory/ProfileSettingsPart", ["model/me", "model/Account", "model/Profiles", "model/MyMusic", "template/myStorySettings", "part/plugin/LayerPart", "common/util", "common/musicPlayer", "common/domUtil", "common/headerArea", "module/static/dialog", "module/static/error", "module/static/toastPopup"], function(t, e, i, s, a, r, u, n, l, o, h, d, c) {
    var m = 20,
        f = 2e3,
        p = 110,
        M = -1,
        g = 18;
    return space.Part.extend({
        template: a.profile,
        model: null,
        ui: {
            nameText: "._text",
            lastName: "._lastName",
            firstName: "._firstName",
            lastNameMarker: "._lastNameMarker",
            firstNameMarker: "._firstNameMarker",
            statusTypeMsg: "._radioBtn",
            statusMsg: "._statusMsg",
            statusMsgPlaceholder: "._StatusMsgPlaceholder",
            counter: "._counter",
            guideMusic: "._guideMusic",
            guideNoMusic: "._guideNoMusic",
            musicRadioBtn: "._musicRadioBtn",
            musicSelector: "._musicSelector",
            musicIntro: "._musicIntro",
            selectedMusic: "._selectedMusic",
            selectedMusicPlayBtn: "._selectedMusicItemPlayBtn",
            birthYear: "._birthYear",
            birthMonth: "._birthMonth",
            birthDate: "._birthDate",
            birthType: "._birthType",
            birthFields: "._birth",
            nameGuideLayer: "._nameGuideLayer",
            submitBtn: "._submit",
            checkFields: "._checkModified"
        },
        styles: {
            error: "error",
            disabled: "dis",
            disabledCursor: "dis_cursor",
            inactive: "inactive",
            active: "btn_or"
        },
        events: {
            "click ._nameGuideBtn": function(t) {
                t.preventDefault(), this.addPart("nameGuide", "part/myStory/ProfileSettingsNameGuidePart").next(function() {
                    this.childParts.nameGuide.show()
                })
            },
            "click ._nameGuideCloseBtn": function(t) {
                t.preventDefault(), this.childParts.nameGuide && this.childParts.nameGuide.hide()
            },
            "input ._checkModified": "_updateSubmitBtn",
            "click ._radioBtn": "_updateSubmitBtn",
            "click ._birthType": "_updateSubmitBtn",
            "input ._statusMsg": "_checkStatusMsg",
            "input ._birth": "_updateBirthTypeField",
            "click ._submit": function(t) {
                var e, i = u.trim(this.ui.firstName.val()),
                    s = u.trim(this.ui.lastName.val()),
                    a = this.ui.birthYear.val(),
                    r = this.ui.birthMonth.val(),
                    n = this.ui.birthDate.val(),
                    l = null,
                    o = this.ui.birthType.is(":checked"),
                    h = o ? "-" : "+",
                    _ = $(this.ui.statusTypeMsg.selector + ":checked").val(),
                    m = u.trim(this.ui.statusMsg.val()),
                    f = this.ui.selectedMusic.find("._musicItem").data("id"),
                    p = !1,
                    g = !1,
                    T = !1;
                if (t.preventDefault(), this._submitBtnEnabled) {
                    if (!this._checkName(i, s)) return !1;
                    if (!this.flow.isChildFlowPending("submit")) {
                        if (p = this._checkNameModified(i, s), f || (f = M), g = this._checkStatusMsgModified(_, m, f), !this._checkBirthday(a, r, n)) return !1;
                        T = this._checkBirthdayModified(a, r, n, h), l = (a + r + n).length > 0 ? u.makeValidDate(a, r, n) : "", e = this.flow.forkWith(this._updateName(i, s), "submit"), g && e.next(function() {
                            return this._updateStatusTextAndMusic(_, m, f)
                        }), T && e.next(function() {
                            return this._updateBirthday(l, o)
                        }), e.next(function(t) {
                            (null !== t || g || T) && (this.render(), this._updateTitle(this.model.get("display_name")), this._scrollTop(), c.show(c.TYPE.PROFILE_EDITED), this._updateSubmitBtn())
                        }), e.stopped(function(t) {
                            return t && 401 === t.status ? (space.Router.onBeforeUnload = null, this.detachGlobalEvents(), d.getHandler()(t)) : void this._handleFail(t)
                        })
                    }
                }
            },
            "click ._cancel": function() {
                history.back()
            },
            "change [name=statusMsgType]": function(t) {
                var i = $(t.target).val();
                switch (i) {
                    case e.STATUS_OBJECT_TYPE.TEXT:
                        this._textStatusSelected();
                        break;
                    case e.STATUS_OBJECT_TYPE.MUSIC:
                        this._musicStatusSelected();
                        break;
                    case e.STATUS_OBJECT_TYPE.NO_SETTING:
                        this._noSettingSelected()
                }
            },
            "click ._selectedMusicItemPlayBtn": function(t) {
                t.preventDefault(), this.ui.selectedMusic.hasClass(this.styles.disabled) || n.openByPlayUrl(this._selectedMusic.get("play_url")).fail(d.getHandler())
            }
        },
        windowEvents: {
            beforeunload: function(t) {
                var e;
                if (this._checkModified()) {
                    if (e = intl.t("profile.edit.beforeLeaveNewLine"), !agent.isIe8AndBelow()) return e;
                    t.originalEvent.returnValue = e
                }
            }
        },
        extendData: function() {
            return {
                statusTextMsgMaxLength: m
            }
        },
        _updateSubmitBtn: function() {
            var t = u.trim(this.ui.firstName.val()),
                e = u.trim(this.ui.lastName.val());
            return 0 === t.length || 0 === e.length ? void this._disableSubmitBtn() : this._checkModified() ? void this._enableSubmitBtn() : void this._disableSubmitBtn()
        },
        _disableSubmitBtn: function() {
            var t = this.ui.submitBtn;
            t.removeClass(this.styles.active).addClass(this.styles.disabledCursor).addClass(this.styles.inactive), this._submitBtnEnabled = !1
        },
        _enableSubmitBtn: function() {
            var t = this.ui.submitBtn;
            t.addClass(this.styles.active).removeClass(this.styles.disabledCursor).removeClass(this.styles.inactive), this._submitBtnEnabled = !0
        },
        _showErrorTooltip: function(t, e) {
            var i = t.data("id"),
                s = t.find("._tooltip"),
                r = null,
                u = $(document).scrollTop();
            t.addClass(this.styles.error), s.html(a.tooltip({
                message: e
            })).show(), r = s.offset().top, u > r && l.scrollTo(r - o.getBottom() - g), this._tooltipTimer[i] && (clearTimeout(this._tooltipTimer[i]), this._tooltipTimer[i] = null), this._tooltipTimer[i] = setTimeout(_.bind(this._hideErrorTooltip, this, t), f)
        },
        _hideErrorTooltip: function(t) {
            t.removeClass(this.styles.error), t.find("._tooltip").hide().html("")
        },
        _checkName: function(t, e) {
            return 0 === t.length ? (this._showErrorTooltip(this.ui.firstNameMarker, intl.t("profile.edit.firstNameRequired")), !1) : 0 === e.length ? (this._showErrorTooltip(this.ui.lastNameMarker, intl.t("profile.edit.lastNameRequired")), !1) : !0
        },
        _checkNameModified: function(t, e) {
            return t !== this.model.get("first_name") || e !== this.model.get("last_name") ? !0 : !1
        },
        _updateName: function(i, s) {
            var a = this;
            return this.model.checkName(i, s).then(function(r) {
                return r ? h.confirm(u.nl2br(r.message)).then(function() {
                    return a.model.updateName(i, s).then(function(e) {
                        return t.set("display_name", a.model.get("display_name")), e
                    })
                }, function() {
                    return Q.reject(e.NAME.NOT_CHANGED_BY_USER)
                }) : Q.resolve(null)
            })
        },
        _getInvalidNameField: function() {
            var t = u.trim(this.ui.firstName.val()),
                e = u.trim(this.ui.lastName.val()),
                i = this.ui.firstName,
                s = this.ui.lastName,
                a = "._firstNameMarker",
                r = "._lastNameMarker";
            return u.isValidStoryNameChar(t) ? u.isValidStoryNameChar(e) && t.length > e.length ? i.closest(a) : s.closest(r) : i.closest(a)
        },
        _updateStatusTextAndMusic: function(i, s, a) {
            var r = this,
                u = Q.resolve(),
                n = null;
            return u = u.then(function() {
                return i === e.STATUS_OBJECT_TYPE.TEXT || i === e.STATUS_OBJECT_TYPE.NO_SETTING ? (n = i === e.STATUS_OBJECT_TYPE.TEXT ? s : "", r.model.updateStatusMessage(n)) : a === M ? r.model.updateStatusMessage("") : r.model.updateMusicStatusMessage(a)
            }), u = u.then(function(e) {
                return e ? (t.set("status_objects", _.clone(r.model.get("status_objects"))), t.trigger("change:status_objects", t), e) : void 0
            })
        },
        _checkBirthday: function(t, e, i) {
            return 0 === (t + e + i).length ? !0 : u.isValidBirthday(t, e, i) ? !0 : (this._showErrorTooltip(this._getInvalidBirthField(), intl.t("profile.edit.invalidBirth")), !1)
        },
        _checkBirthdayModified: function(t, e, i, s) {
            var a = !1;
            return (t + e + i).length > 0 ? ((parseInt(t, 10) !== this.model.get("birthday").year || parseInt(e, 10) !== this.model.get("birthday").month || parseInt(i, 10) !== this.model.get("birthday").date) && (a = !0), s !== this.model.get("birth_type") && (a = !0)) : t !== this.model.get("birthday").year && e !== this.model.get("birthday").month && i !== this.model.get("birthday").date && (a = !0), a
        },
        _updateBirthday: function(e, i) {
            var s = this;
            return this.model.updateBirth(e, i).then(function(e) {
                var i = null;
                return e ? (i = s.model.get("birth"), i && 8 === i.length ? t.set("birthday", i.substring(4, 8)) : t.set("birthday", ""), t.set("birth_type", s.model.get("birth_type")), e) : null
            })
        },
        _handleFail: function(t) {
            var i = null,
                s = null;
            if (t && (!t || t !== e.NAME.NOT_CHANGED_BY_USER)) switch (i = t.responseJSON.message || t.responseJSON.error_message || t.responseJSON.error, i = u.nl2br(i), s = t.responseJSON.status || t.responseJSON.error_code) {
                case e.BIRTH.INVALID_FORMAT:
                    return void this._showErrorTooltip(this._getInvalidBirthField(), i);
                case e.NAME.PROFILE_FORBIDDEN_NAME_DETAIL:
                case e.NAME.PROFILE_NAME_REQUIRED:
                    return void this._showErrorTooltip(this._getInvalidNameField(), i);
                case e.NAME.ALREADY_ACCEPTED_CHANGE_NAME:
                case e.NAME.PROFILE_FORBIDDEN_NAME:
                    return void h.alert(i);
                case e.NAME.PROFILE_WARNING_ACCEPTED_CHANGE_NAME:
                    return h.alert(i), this.ui.firstName.prop("value", this.model.get("first_name")), void this.ui.lastName.prop("value", this.model.get("last_name"));
                case e.ETC.INTERNAL_ERROR:
                    return void h.alert(intl.t("error.general"));
                default:
                    return void h.alert(i)
            }
        },
        _checkModified: function() {
            var t = u.trim(this.ui.firstName.val()),
                e = u.trim(this.ui.lastName.val()),
                i = this.ui.birthYear.val(),
                s = this.ui.birthMonth.val(),
                a = this.ui.birthDate.val(),
                r = this.ui.birthType.is(":checked"),
                n = r ? "-" : "+",
                l = this.ui.statusTypeMsg.filter(":checked").val(),
                o = u.trim(this.ui.statusMsg.val()),
                h = this.ui.selectedMusic.find("._musicItem").data("id"),
                d = !1,
                c = !1,
                _ = !1;
            return h || (h = M), d = this._checkNameModified(t, e), c = this._checkStatusMsgModified(l, o, h), _ = this._checkBirthdayModified(i, s, a, n), d || c || _ ? !0 : !1
        },
        _updateTitle: function(t) {
            document.title = intl.t("title.profileSetting", {
                name: t
            })
        },
        _checkStatusMsg: function() {
            var t = this.ui.statusMsg.val();
            return t.length > m ? (this.ui.statusMsg.prop("value", this._prevStatusMsg), !1) : (this._updateTextCounter(t.length), void(this._prevStatusMsg = t))
        },
        _updateTextCounter: function(t) {
            this.ui.counter.text(t)
        },
        _textStatusSelected: function() {
            this._setTextStatus(!0), this._setMusicStatus(!1)
        },
        _musicStatusSelected: function() {
            this._setTextStatus(!1), this._setMusicStatus(!0)
        },
        _noSettingSelected: function() {
            this._setTextStatus(!1), this._setMusicStatus(!1)
        },
        _setTextStatus: function(t) {
            t ? (this.ui.statusMsg.removeAttr("disabled"), this.ui.statusMsg.closest("._dis").removeClass(this.styles.disabled)) : (this.ui.statusMsg.attr("disabled", "disabled"), this.ui.statusMsg.closest("._dis").addClass(this.styles.disabled))
        },
        _setInitialTextStatus: function(t) {
            this._setTextStatus(t), this.model.get("statusTextMsg").length > 0 && this.ui.statusMsgPlaceholder.hide()
        },
        _showMusicSelector: function(t) {
            this.addPart("musicSelector", "part/myStory/ProfileSettingsMusicPart", {
                options: {
                    model: this.myMusic
                },
                listeners: {
                    select: function(t) {
                        this._setMusic(t), this._updateSubmitBtn()
                    },
                    deselect: function() {
                        this._unsetMusic(), this._updateSubmitBtn()
                    }
                }
            }).next(function(e) {
                e || this.childParts.musicSelector.show(), t && this.childParts.musicSelector.setMusic(t), this.ui.musicSelector.show()
            })
        },
        _setMusic: function(t) {
            var e = a.selectedMusic(t.toData());
            this._selectedMusic = t, this.ui.musicIntro.hide(), this.ui.selectedMusic.html(e).show(), agent.isIe8AndBelow() && this.ui.selectedMusic.height()
        },
        _getMusicTrackId: function() {
            return this.ui.selectedMusic.find("._musicItem").data("id")
        },
        _unsetMusic: function() {
            this.ui.selectedMusic.empty().hide(), this.ui.guideMusic.show(), this._selectedMusic = null
        },
        _hideMusicSelector: function() {
            this.ui.musicSelector.hide(), this.childParts.musicSelector && this.childParts.musicSelector.hide()
        },
        _setInitialMusicStatus: function(t, e) {
            var i = this.myMusic.get("musics").length;
            t ? this._showMusicSelector(e) : (this.ui.musicIntro.hide(), 0 === i ? (this.ui.guideNoMusic.show(), this.ui.musicRadioBtn.attr("disabled", "disabled")) : this.ui.guideMusic.show())
        },
        _setMusicStatus: function(t) {
            t ? (this._showMusicSelector(this._getMusicTrackId()), this.ui.selectedMusic.is(":visible") && (this.ui.selectedMusic.removeClass(this.styles.disabled), this.$el.find("._selectedMusicItemPlayBtn").removeAttr("disabled"))) : (this._hideMusicSelector(), this.ui.selectedMusic.is(":visible") && (this.ui.selectedMusic.addClass(this.styles.disabled), this.$el.find("._selectedMusicItemPlayBtn").attr("disabled", "disabled")))
        },
        _checkStatusMsgModified: function(t, i, s) {
            var a = this.model.get("statusType"),
                r = this.model.get("statusType") !== t,
                u = this.model.get("statusTextMsg") !== i,
                n = i && i.length > 0 ? !1 : !0,
                l = this.model.get("trackId").toString() !== s.toString(),
                o = s !== M;
            if (!r) return t === e.STATUS_OBJECT_TYPE.TEXT && u ? !0 : t === e.STATUS_OBJECT_TYPE.MUSIC && l ? !0 : !1;
            if (a === e.STATUS_OBJECT_TYPE.NO_SETTING) {
                if (t === e.STATUS_OBJECT_TYPE.TEXT && n) return !1;
                if (t === e.STATUS_OBJECT_TYPE.MUSIC && !o) return !1
            }
            return !0
        },
        _getInvalidBirthField: function() {
            var t = this.ui.birthYear.val(),
                e = this.ui.birthMonth.val();
            return 0 === t.length ? this.ui.birthYear.closest("._yearMarker") : u.isValidDate(t, "YYYY") && u.isValidBirthYear(t) ? 0 === e.length ? this.ui.birthMonth.closest("._monthMarker") : u.isValidDate((t + e).substring(0, 6), "YYYYMM") ? this.ui.birthDate.closest("._dateMarker") : this.ui.birthMonth.closest("._monthMarker") : this.ui.birthYear.closest("._yearMarker")
        },
        _makeDateString: function(t, e, i) {
            return e.length < 2 && (e = "0" + e), i.length < 2 && (i = "0" + i), t + e + i
        },
        _updateBirthTypeField: function() {
            var t = this.ui.birthYear.val(),
                e = this.ui.birthMonth.val(),
                i = this.ui.birthDate.val();
            (t + e + i).length > 0 ? this.ui.birthType.removeAttr("disabled") : this.ui.birthType.attr("disabled", "disabled")
        },
        _scrollTop: function() {
            agent.type.is.mobile || l.scrollTo(p)
        },
        initialize: function() {
            this._$window = $(window), this.model = null, this.profiles = null, this._prevStatusMsg = null, this._selectedMusic = null, this._tooltipTimer = {}, this._submitBtnEnabled = !1
        },
        onDomReady: function() {
            this._updateSubmitBtn()
        },
        onRoute: function() {
            var t = this;
            space.Router.onBeforeUnload = function() {
                return t._checkModified() ? h.confirm(intl.t("profile.edit.beforeLeave"), null, {
                    cancel: intl.t("profile.edit.stayHere"),
                    ok: intl.t("profile.edit.leavePage"),
                    reversedButton: !0
                }).then(function() {
                    t.detachGlobalEvents()
                }) : Q.resolve()
            }
        },
        onRender: function() {
            var t = this;
            agent.isIe8AndBelow() && (this.ui.checkFields.on("propertychange", function(e) {
                return "value" === e.originalEvent.propertyName ? t._updateSubmitBtn() : void 0
            }), this.ui.birthFields.on("propertychange", function(e) {
                return "value" === e.originalEvent.propertyName ? t._updateBirthTypeField() : void 0
            }), this.ui.statusMsg.on("propertychange", function(e) {
                return "value" === e.originalEvent.propertyName ? t._checkStatusMsg(e) : void 0
            })), this._setInitialTextStatus(this.model.get("isTextStatus")), this._setInitialMusicStatus(this.model.get("isMusicStatus"), this.model.get("trackId")), this._updateBirthTypeField(), this._scrollTop(), this.addPart("statusTextMsgPlaceholder", "part/plugin/PlaceholderPart", {
                selector: "._statusMsg",
                options: {
                    placeholder: this.ui.statusMsgPlaceholder
                }
            })
        },
        onSetup: function() {
            var e = this;
            return this.model = t.get("account"), this.myMusic = new s, this.listenTo(this, "domReady", function() {
                this._scrollTop()
            }), Q.all([this.model.fetch(), this.myMusic.fetch()]).then(function() {
                e._updateTitle(e.model.get("display_name"))
            }).fail(d.getHandler())
        },
        onStop: function() {
            agent.isIe8AndBelow() && (this.ui.checkFields.off("propertychange"), this.ui.birthFields.off("propertychange"), this.ui.statusMsg.off("propertychange"))
        }
    })
});
define("part/myStory/ProfileSettingsNameGuidePart", ["part/plugin/CoverLayerPart", "common/util", "template/myStorySettings"], function(e, t, n) {
    return e.extend({
        template: n.nameGuide,
        events: {
            "click ._nameGuideCloseBtn": function(e) {
                e.preventDefault(), this.hide()
            }
        }
    })
});
define("part/myStory/ProfileSettingsMusicPart", ["template/myStorySettings", "model/MyMusic", "common/musicPlayer", "module/static/error"], function(e, t, s, i) {
    var c = 50,
        l = 5,
        n = space.Part.extend({
            template: e.musicItem,
            ui: {
                selectBtn: "._musicItemSelectBtn",
                btnLabel: "._selectBtnLabel",
                musicItem: "._musicItem"
            },
            styles: {
                selected: "bn_choice",
                cancel: "bn_cancel"
            },
            text: {
                select: intl.t("profile.edit.select"),
                selected: intl.t("profile.edit.selected"),
                cancel: intl.t("profile.edit.cancel")
            },
            events: {
                "mouseover ._musicItemSelectBtn": function() {
                    this.ui.selectBtn.hasClass(this.styles.selected) && this.ui.btnLabel.text(this.text.cancel)
                },
                "mouseout ._musicItemSelectBtn": function() {
                    this.ui.selectBtn.hasClass(this.styles.selected) && this.ui.btnLabel.text(this.text.selected)
                },
                "click ._musicItemPlayBtn": function(e) {
                    e.preventDefault(), s.openByPlayUrl(this.model.get("play_url")).fail(i.getHandler())
                }
            },
            modelEvents: {
                "change:selected": "_updateBtn"
            },
            onRender: function() {
                this._updateBtn()
            },
            _updateBtn: function() {
                this.model.get("selected") ? (this.ui.selectBtn.addClass(this.styles.selected), this.ui.btnLabel.text(this.text.selected)) : (this.ui.selectBtn.removeClass(this.styles.selected), this.ui.selectBtn.removeClass(this.styles.cancel), this.ui.btnLabel.text(this.text.select))
            }
        }),
        u = space.Part.extend({
            template: e.musicList,
            itemPart: n,
            itemPartContainer: "._musicContainer",
            collection: null,
            styles: {
                selected: "bn_choice"
            },
            onRender: function() {
                var e = this.collection.length;
                e > l && (e = l, this.addPart("scroll", "part/plugin/ScrollPart", {
                    selector: "._musicContainer"
                }).next(function() {
                    this.itemPartContainer.scrollTop(c * this._getSelectedMusicIndex())
                })), this.itemPartContainer.css({
                    height: e * c + "px"
                })
            },
            resetSelectedMusics: function() {
                this.collection.each(function(e) {
                    e.set("selected", !1)
                })
            },
            getMusic: function(e) {
                return this.collection.get(e)
            },
            _getSelectedMusicIndex: function() {
                for (var e = 0, t = this.collection.length; t > e; e++) {
                    var s = this.collection.at(e);
                    if (s.get("selected")) return e
                }
            }
        });
    return space.Part.extend({
        template: e.musicContainer,
        model: null,
        ui: {
            musicItemSelectBtn: "._musicItemSelectBtn",
            selectBtnLabel: "._selectBtnLabel"
        },
        styles: {
            selected: "bn_choice",
            cance: "bn_cancel"
        },
        childParts: {
            musicList: u
        },
        events: {
            "click ._musicItemSelectBtn": function(e) {
                var t = null,
                    s = null;
                e.preventDefault(), t = $(e.currentTarget).closest("._musicItem").data("id"), s = this.childParts.musicList.getMusic(t), s.get("selected") ? (s.set("selected", !1), this._deselectMusic()) : (this._resetSelectedMusics(), this._selectMusic(s))
            }
        },
        _resetSelectedMusics: function() {
            this.childParts.musicList.resetSelectedMusics()
        },
        onSetup: function() {
            this.childParts.musicList.collection = this.model.get("musics")
        },
        _selectMusic: function(e) {
            e && (e.set("selected", !0), this.trigger("select", e))
        },
        _deselectMusic: function() {
            this.trigger("deselect")
        },
        setMusic: function(e) {
            var t = this.childParts.musicList.getMusic(e);
            this._selectMusic(t)
        },
        hide: function() {
            this.childParts.musicList.resetSelectedMusics(), space.Part.prototype.hide.apply(this, arguments)
        }
    })
});
define("template/myStoryVideos", ["Handlebars"], function(a) {
    var t = function(t) {
        var n = a.template(t);
        return function(a) {
            return n(a, {
                partials: e
            })
        }
    }, e = {
        __p__: ""
    };
    return {
        layout: function() {
            var a = t(function(a, t, e, n, r) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), r = r || {};
                var i = "";
                return i
            });
            return a.wrap = '<div class="feed" data-kant-group="my.video">', a
        }(),
        item: function() {
            var a = t(function(a, t, e, n, r) {
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), r = r || {};
                var i, s, o, l = "",
                    c = e.helperMissing,
                    p = this.escapeExpression,
                    d = "function";
                return l += '<div class="pf_date">' + p((s = e.dateFormat || t && t.dateFormat, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, t && t.created_at, "MM.DD", o) : c.call(t, "dateFormat", t && t.created_at, "MM.DD", o))) + '</div><div class="fd_cont"><div data-part="media"></div><div class="_activityInfoWrapper in_txt"><p class="pic_info"><a href="#" class="_content _activityInfo" data-kant-id="313">', (s = e.escapedContent) ? i = s.call(t, {
                    hash: {},
                    data: r
                }) : (s = t && t.escapedContent, i = typeof s === d ? s.call(t, {
                    hash: {},
                    data: r
                }) : s), (i || 0 === i) && (l += i), l += '</a></p><p class="feel"><a href="#" class="_activityInfo" data-kant-id="314"><span class="ico_like"></span>' + p((s = e.numberFormat || t && t.numberFormat, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, t && t.like_count, o) : c.call(t, "numberFormat", t && t.like_count, o))) + '<span class="ico_comm"></span>' + p((s = e.numberFormat || t && t.numberFormat, o = {
                    hash: {},
                    data: r
                }, s ? s.call(t, t && t.comment_count, o) : c.call(t, "numberFormat", t && t.comment_count, o))) + "</a></p></div></div>"
            });
            return a.wrap = '<div class="section myStoryVideo" data-kant-group="my.video">', a
        }(),
        empty: function() {
            var a = t(function(a, t, e, n, r) {
                function i(a, t) {
                    var n, r, i = "";
                    return i += "<p>" + m((n = e.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.empty.videos", r) : d.call(a, "t", "myStory.empty.videos", r))) + '</p><div class="bx_nodata"><a href="#" class="_writeButton" data-kant-id="315"><span class="ic_video"></span>' + m((n = e.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.empty.videoButton", r) : d.call(a, "t", "myStory.empty.videoButton", r))) + "</a></div>"
                }
                function s() {
                    return '<p class="friend"><span class="ic_movie"></span></p>'
                }
                function o(a, t) {
                    var n, r = "";
                    return r += " ", n = e.unless.call(a, (n = a && a.profile, null == n || n === !1 ? n : n.isMe), {
                        hash: {},
                        inverse: u.noop,
                        fn: u.program(6, l, t),
                        data: t
                    }), (n || 0 === n) && (r += n), r += " "
                }
                function l(a, t) {
                    var n, r, i = "";
                    return i += "<p>" + m((n = e.t || a && a.t, r = {
                        hash: {},
                        data: t
                    }, n ? n.call(a, "myStory.emptyOther.videos", r) : d.call(a, "t", "myStory.emptyOther.videos", r))) + "</p>"
                }
                this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), r = r || {};
                var c, p = "",
                    d = e.helperMissing,
                    m = this.escapeExpression,
                    u = this;
                return p += '<div class="nodata" data-kant-group="my.video">', c = e["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isMe), {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(1, i, r),
                    data: r
                }), (c || 0 === c) && (p += c), p += " ", c = e["if"].call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isFriend), {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(3, s, r),
                    data: r
                }), (c || 0 === c) && (p += c), p += " ", c = e.unless.call(t, (c = t && t.profile, null == c || c === !1 ? c : c.isFriend), {
                    hash: {},
                    inverse: u.noop,
                    fn: u.program(5, o, r),
                    data: r
                }), (c || 0 === c) && (p += c), p += "</div>"
            });
            return a
        }(),
        emptyMobile: function() {
            var a = t(function(a, t, e, n, r) {
                return this.compilerInfo = [4, ">= 1.0.0"], e = this.merge(e, a.helpers), r = r || {}, '<div class="nodata"><p class="friend"><span class="ic_movie"></span></p></div>'
            });
            return a
        }()
    }
});
define("part/myStory/VideoListPart", ["template/myStoryVideos", "part/writing/WritingPart", "module/static/writingView", "common/kantUtil"], function(t, e, i, n) {
    return space.Part.extend({
        model: null,
        collection: null,
        template: t.layout,
        itemPart: "part/myStory/VideoItemPart",
        initialize: function() {
            this._$originalElement = null
        },
        onSetup: function() {
            return this.collection = this.model.get("activities"), this.model.isMine() && this.listenTo(i, {
                post: function(t, i) {
                    i === e.MODE.VIDEO && (this._$originalElement && (this.setElement(this._$originalElement), this._$originalElement = null), this.collection.add([t], {
                        at: 0
                    }))
                }
            }), this.model.fetch()
        },
        onRender: function() {
            var e;
            this.collection.length ? this.addPart("scroll", "part/plugin/InfinityScrollPart", {
                selector: $(window),
                listeners: {
                    end: function() {
                        var t = this;
                        this.childParts.scroll.flow.next(function() {
                            return t.model.fetch()
                        }).next(function(e) {
                            e && e.activities && n.sendPageView(t.model.get("profile").get("isMe") ? "my.03" : "fs.03")
                        })
                    }
                }
            }).next(function() {
                this.childParts.scroll.activate()
            }) : (this._$originalElement = this.$el.detach(), e = agent.type.is.mobile && this.model.isMine() ? t.emptyMobile() : t.empty(this.model.toData()), this.setElement($(e))), n.sendPageView(this.model.get("profile").get("isMe") ? "my.03" : "fs.03")
        },
        collectionEvents: {
            add: "addItemPart",
            remove: "removeItemPart"
        },
        events: {
            "click ._writeButton": function(t) {
                t.preventDefault(), i.show(e.MODE.VIDEO)
            }
        }
    })
});
define("part/myStory/VideoItemPart", ["template/myStoryVideos", "common/ellipsis"], function(t, e) {
    var i = 2;
    return space.Part.extend({
        model: null,
        template: t.item,
        childParts: {
            media: "part/feed/media/VideoPart"
        },
        ui: {
            activityInfoWrapper: "._activityInfoWrapper",
            activityInfo: "._activityInfo",
            content: "._content"
        },
        onSetup: function() {
            this.childParts.media.model = this.model, this.listenTo(this.childParts.media, "end", function() {
                this.ui.activityInfoWrapper.show()
            })
        },
        onRender: function() {
            e.byLine(this.ui.content, i)
        },
        events: {
            "click ._activityInfo": function(t) {
                var e = this.model.collection.parent.get("profile");
                t.preventDefault(), space.Router.navigate("/" + e.get("urlKey") + "/" + this.model.get("urlKey"))
            },
            click: function(t) {
                $(t.target).hasClass("_btnViewVideo") && (t.preventDefault(), this.ui.activityInfoWrapper.hide())
            }
        }
    })
});
define("part/settings/AccountSettingsPart", ["model/me", "model/Account", "template/settings", "common/util", "common/imgUtil", "common/musicPlayer", "common/kantUtil", "common/urlUtil", "common/urlKey", "module/static/cover", "module/static/error", "module/static/dialog", "config"], function(t, e, i, r, n, o, a, s, d, l, u, c, m) {
    var h = {
        MIN: 4,
        MAX: 15
    };
    return space.Part.extend({
        template: i.account,
        model: null,
        ui: {
            profileImage: "._profileImage",
            profileImageContainer: "._profileImageContainer",
            searchable: "._searchable",
            makeId: "._makeId",
            makeIdForm: "._makeIdForm",
            idForm: "._idForm",
            idSubmitBtn: "._updateStoryId",
            idPlaceholder: "._idPlaceholder",
            retireMsgHolder: "._retireMsg"
        },
        styles: {
            placeholder: "txt_label",
            disabledCursor: "dis_cursor",
            active: "btn_or",
            inactive: "inactive"
        },
        events: {
            "click ._withdrawBtn": function(t) {
                return t.preventDefault(), this._isRetireMsgReady ? void this.addPart("withdraw", "part/settings/WithdrawLayerPart", {
                    options: {
                        model: this.model,
                        message: this._retireMsg
                    }
                }).next(function() {
                    this.childParts.withdraw.toggle()
                }) : void c.alert(intl.t("account.quitGuide.msgLoadError"))
            },
            "click ._makeIdBtn": function(t) {
                t.preventDefault(), this.ui.makeId.hide(), this.ui.makeIdForm.show(), this._updateIdSubmitButtonStatus()
            },
            "change ._searchable": function() {
                var t = this,
                    e = this.ui.searchable.is(":checked");
                this.ui.searchable.attr("disabled", "disabled"), this.model.updateSearchable(e).fail(function(t) {
                    var e = intl.t("account.storyId.error");
                    return t && t.responseJSON && (e = t.responseJSON.message), c.alert(e)
                }).fin(function() {
                    t.ui.searchable.removeAttr("disabled")
                })
            },
            "click ._idPlaceholder": function() {
                this.ui.idForm.focus()
            },
            "input ._idForm": "_updateIdSubmitButtonStatus",
            "click ._updateStoryId": function() {
                var t = this,
                    i = r.trim(this.ui.idForm.val()),
                    n = Q.resolve();
                n = n.then(function() {
                    return t.model.checkStoryId(i).then(function(n) {
                        return c.confirm(r.nl2br(n.message), t.ui.idSubmitBtn).then(function() {
                            return t.model.updateStoryId(i)
                        }, function() {
                            return Q.reject(e.STORYID.NOT_TO_CHANGE)
                        })
                    })
                }), n.then(function() {
                    location.reload()
                }).fail(function(i) {
                    var n = intl.t("account.storyId.error");
                    if (i) {
                        if (i === e.STORYID.NOT_TO_CHANGE) return !1;
                        i.responseJSON && (n = i.responseJSON.message || i.responseJSON.error_message || i.responseJSON.error, n = r.nl2br(n))
                    }
                    return c.alert(n).then(function() {
                        t.ui.idForm.focus()
                    })
                })
            },
            "click ._logout": function(e) {
                e.preventDefault(), a.send("acct.362").then(function() {
                    t.logout()
                })
            },
            "click ._changePasswd": function(t) {
                var e = m.kakaoLogin.pageUrl + m.kakaoLogin.findPassword + "?continue=" + s.getHostWithProtocol(location.href);
                t.preventDefault(), window.open(e)
            },
            "click ._btnOpenMusicPlayer": function(t) {
                t.preventDefault(), o.openByProfileId(this.model.get("id")).fail(u.getHandler())
            }
        },
        extendData: function() {
            var e = this;
            return {
                status: t.get("status"),
                isStoryId: function() {
                    var t = e.model.get("id");
                    return "_" !== t.charAt(0)
                },
                urlKey: function() {
                    return d.profile.idToUrlKey(e.model.get("id"))
                }
            }
        },
        initialize: function() {
            this._retireMsg = null, this._isRetireMsgReady = !1
        },
        onSetup: function() {
            var e = this;
            return this.model = t.get("account"), null === this._retireMsg ? this.model.getRetireMsg().then(function(t) {
                e._retireMsg = t.message, e._isRetireMsgReady = !0
            }).fail(u.getHandler()) : e._isRetireMsgReady = !0, this.model.fetch().fail(u.getHandler())
        },
        onRender: function() {
            var t = this;
            agent.isIe8AndBelow() && this.ui.idForm.on("propertychange", function(e) {
                return "value" === e.originalEvent.propertyName ? t._updateIdSubmitButtonStatus() : void 0
            }), n.resize(this.ui.profileImage, this.ui.profileImageContainer), this.addPart("idPlaceholder", "part/plugin/PlaceholderPart", {
                selector: "._idForm",
                options: {
                    placeholder: this.ui.idPlaceholder
                }
            })
        },
        onStop: function() {
            this._isRetireMsgReady = !1, agent.isIe8AndBelow() && this.ui.idForm.off("propertychange")
        },
        _updateIdSubmitButtonStatus: function() {
            var t = this.ui.idForm.val().length;
            t < h.MIN || t > h.MAX ? this._disableIdSubmitButton() : this._enableIdSubmitButton()
        },
        _disableIdSubmitButton: function() {
            var t = this.ui.idSubmitBtn;
            t.removeClass(this.styles.active).addClass(this.styles.disabledCursor).addClass(this.styles.inactive).attr("disabled", "disabled")
        },
        _enableIdSubmitButton: function() {
            var t = this.ui.idSubmitBtn;
            t.addClass(this.styles.active).removeClass(this.styles.disabledCursor).removeClass(this.styles.inactive).removeAttr("disabled")
        }
    })
});
define("part/settings/WithdrawLayerPart", ["model/me", "part/plugin/CoverLayerPart", "common/util", "module/static/dialog", "module/static/confirmPasswordView", "template/settings", "config"], function(t, e, i, r, n, o, s) {
    var a = -31022;
    return e.extend({
        template: o.withdraw,
        model: null,
        options: {
            message: "setMessage"
        },
        events: {
            "click ._withdrawCloseBtn": function(t) {
                t.preventDefault(), this.hide()
            },
            "click ._withdraw": function() {
                var e = this;
                this.hide(), this.flow.forkWith(n.show()).next(function(i) {
                    return this.model.withdraw(i).then(function() {
                        t.logout()
                    }).fail(function(t) {
                        var i = intl.t("account.storyId.error");
                        return t && t.responseJSON && (i = t.responseJSON.error_message || t.responseJSON.message, t.responseJSON.error_code === a) ? (i = e._beautifyStoryPlusErrorMsg(i), r.confirm(i, null, {
                            ok: intl.t("account.quit.myStoryPlus"),
                            reversedButton: !0,
                            onOk: function() {
                                window.open(s.storyPlus.list)
                            }
                        })) : r.alert(i)
                    })
                })
            }
        },
        extendData: function() {
            return this._withdrawMsgObj
        },
        initialize: function() {
            this._withdrawMsgObj = null, e.prototype.initialize.apply(this, arguments)
        },
        setMessage: function(t) {
            this._withdrawMsgObj = this._beautify(t)
        },
        _beautify: function(t) {
            var e = t.split("\n"),
                r = e[3].split("/");
            return r = _.map(r, function(t) {
                return i.trim(t)
            }), {
                guide: i.trim(e[0]),
                toBeDeleted: i.trim(e[2]),
                items: r
            }
        },
        _beautifyStoryPlusErrorMsg: function(t) {
            return t.replace(/\n/g, "<br>")
        }
    })
});
define("main", function() {});

require(["boot"]);
